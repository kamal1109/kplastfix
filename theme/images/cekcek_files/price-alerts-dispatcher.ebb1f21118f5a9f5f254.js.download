(window.webpackJsonp=window.webpackJsonp||[]).push([["price-alerts-dispatcher"],{"15Qe":function(t,e,r){"use strict";r.r(e),r.d(e,"getNotificationFromPriceEvent",(function(){return a})),r.d(e,"getNotificationFromAlertStopped",(function(){return l}));r("YFKU"),r("HbRj");var n=r("JZcM"),i=r("IWHC"),o=r("hp/T"),s=r("zNIe");function a(t){const e=t.shortSymbol(),r=t.get("symbol");return{id:"fired:price:"+t.id,fired:new Date(t.get("fireTime")),type:n.a.Fired,desktopNotificationTitle:window.t("Alert on {shortSymbol}").format({shortSymbol:e}),dialogTitle:window.t("Alert on {shortSymbol}").format({shortSymbol:`<a data-symbol="${r}" class="js-symbol" href="${Object(s.a)(r)}" target="_blank">${e}</span>`}),dialogSubTitle:t.get("name")||"",description:t.get("description")||"",title:e,alertId:Number(t.get("alertId")),alertCategory:i.AlertCategory.Price,eventId:t.get("id"),notifyWith:{email:!!t.get("sendEmail"),popup:!!t.get("showPopup"),sms:!!t.get("sendSms"),sound:!!t.get("playSound")},soundParams:{duration:t.get("soundDuration")||0,name:t.get("soundFile")||o.DEFAULT_SOUNDS.alert}}}function l(t){if("fire_control"===t.reason){const e=6e4,r=new Date(Math.round(Date.now()/e)*e);return{id:`fire_control:price:${t.alertId}:${r.getTime()/1e3}`,fired:r,type:n.a.FireControl,desktopNotificationTitle:t.shortSymbol+window.t("The alert is triggered too often"),description:t.description,title:t.shortSymbol,alertId:t.alertId,alertCategory:i.AlertCategory.Price,notifyWith:{popup:!0}}}return null}},"2qdo":function(t,e,r){"use strict";function n(){return Promise.all([r.e("vendors"),r.e(18),r.e("dialogs-core"),r.e(24),r.e(33),r.e(49),r.e(492),r.e(38),r.e(48),r.e(91),r.e("alert-notifier")]).then(r.bind(null,"Z59a")).then(t=>t.createAlertNotifier())}r.r(e),r.d(e,"createAlertNotifier",(function(){return n}))},"3DsO":function(t,e,r){"use strict";r.r(e),r.d(e,"showGoProInfExpDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alertsNoExpiration"})}},"3Tqy":function(t,e,r){"use strict";(function(n){Object.defineProperty(e,"__esModule",{value:!0});var i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t};e.prepareAlertsModels=z;var o,s=r("+GxX"),a=r("brCa"),l=r("ZF9k"),c=r("0dm4"),u=r("FBuY"),d=r("15Qe"),p=r("IWHC"),f=r("jA5l"),h=r("aIyQ"),_=(o=h)&&o.__esModule?o:{default:o},v=r("DJLU"),m=r("uOo4"),g=r("8I+7"),y=r("K81e")
;var S=r("2O5g").invokeAlertEditor,A=r("1UCy").AlertEditorAbortReason,b=r("sg6D"),E=r("Evi4").AlertVersioning,x=r("4pku").Alert,w=r("nmnj"),T=r("dfhE"),I=r("TxTq"),P=r("JWMC").trackEvent,D=r("NP3r").enabled,k=r("bKsZ").ProductFeatures,O=r("oNDq").createConfirmDialog,C=r("txPx").getLogger("Alerts.Price.Dispatcher"),N=r("hWRP").sendRequest,M=r("2qdo").createAlertNotifier,R=r("4BMm").server2clientParams,L=r("4BMm").client2serverParams,q=r("xlbu").telemetry,F=r("Zdjc").showGoProAlertsTrueSmsDialog,W=r("gdgp").showGoProMaxAlertsDialog,j=r("3DsO").showGoProInfExpDialog,U=r("zL88").showWarningAlertsMaxTotalCountExceeded,B="cancelled: new alert already generating",V=r("flg1").showAlertsMaintenanceDialog,H=r("8woN");function Y(){this._loading={},this._alertVersioning=new E,this._lastGenIds={},this._notifierPromise=null,this._onPushStreamMessage=new _.default,this._onPushStreamStatusChanged=t=>{t===v.ConnectionStatus.Open&&this._onPushStreamMessage.fire({source:"host",data:{m:"pushstream_ready"}})},this.alerts=new(n.Collection.extend({model:x})),this.events=new(n.Collection.extend({comparator:function(t,e){var r=t.get("fireTime"),n=e.get("fireTime");return r&&n?n-r:r?n?void 0:1:-1},model:b})),this._attachHandlers()}function J(t){t.forEach(t=>t.set("selected",!1))}function G(t,e){t.forEach(t=>{t!==e&&t.set("selected",!1)})}function K(t){const e=new Date;t.get("expired")<e&&(e.setMonth(e.getMonth()+1),t.set("expired",e))}function z(t,e){return Promise.all(t.map((function(t){const n=t.id,i=R(t);return e(i).catch(r("Migration failed",n)).then(t=>t&&new x(t)).catch(r("Alert creation failed",n))}))).then(t=>t.filter(t=>null!==t));function r(t,e){return r=>(C.logError(`${t}. Alert ID: ${e}. Error: ${r}`),null)}}function X(t,e){t.script=e.IL,e.inputs&&(t.inputs=e.inputs),e.genAlertData&&(0,s.isFeatureEnabled)("alerts-send-gen-alert-data")&&(t.gen_alert_data=e.genAlertData)}function Z(t,...e){"function"==typeof t&&t.apply(this,e)}Y.checkProPermissions=function(t){return t.get("sendTrueSms")&&!D(k.ALERTS_TRUE_SMS)?(F(),!1):t.get("noExpiration")&&!D(k.ALERTS_NO_EXPIRATION)?(j(),!1):"string"!=typeof t.get("webhookUrl")||D(k.ALERTS_WEBHOOK)?!!(0,c.canPlaceAlertOnResolution)(t.get("resolution"))||((0,l.showGoProAlertsOnSecondsDialog)(),!1):((0,f.showGoProAlertsWebhookDialog)(),!1)},Y.getAnalyticsHeaders=function(t,e){return{"X-Analytics-Price-Alert-Condition":String(t),"X-Analytics-Price-Alert-Action-Source":String(e)}},Y.prototype._onLoginStateChange=function(t){is_authenticated?(t||setTimeout(this.showOfflineEvents.bind(this),1),this._refreshPushStream()):(this.alerts.reset(),this.events.reset(),this._alertVersioning.cancelAllPossibleExtraUpdates()),this._offlineEventsRequestWasSent=!1,this._fullListWasRequested=!1},Y.prototype._attachHandlers=function(){var t=this;function e(e){var r=t.chartWidget(),n=r?r.model():null;if(n){var i=n.hoveredSource();e.set("hovered",i&&i.hasAlert&&i.hasAlert.value()&&i.alertId()===e.id);var o=n.selection().dataSources().some((function(t){return t.hasAlert.value()&&t.alertId()===e.id}));e.set("selected",o)}}
loginStateChange.subscribe(this,this._onLoginStateChange.bind(this)),this._onLoginStateChange(!0),t.alerts.on("add",r=>{e(r),function(e){if(e.isDrawing()&&t._chartWidgetCollection){var r=e.get("extra").drawing();t._chartWidgetCollection.getAll().forEach((function(t){t.applyAlertIdByExternalSource(r.id,e.id)}))}}(r)}).on("change:selected",(e,r,n)=>{if(r){var i=t.alerts;J(t.events),G(i,e)}}).on("change:id",e).on("destroy",e=>{e.isNew()||t.events.where({alertId:e.id}).forEach((function(t){t.destroy()}))}),t.events.on("change:selected",(e,r,n)=>{var i=t.events.models;r&&(J(t.alerts),G(i,e))}),t.alerts.on("change:id",e=>{let r=!1;for(const n of t.alerts.models)n.id===e.id&&(r?C.logWarn(`Two alerts share the same id ${e.id}, which may lead to undefined behaviour`):r=!0)}),u.TVXWindowEvents.on("alertevents-deleted",t=>{""===t?this.events.reset():this.events.remove(JSON.parse(t))})},Y.prototype.showOfflineEvents=function(){if(!window.is_authenticated||this._offlineEventsRequestWasSent)return Promise.resolve();this._offlineEventsRequestWasSent=!0;return Promise.all([this.sendRequest({method:"get_offline_events",preventMaintenanceDialog:!0,params:{}}),this.getAlertNotifier()]).then(([{fires:t,fire_controls:e},r])=>{const n=Object.keys(t),o=Object.keys(e),s=new Set([...n,...o]);s.size>0&&this.sendRequest({method:"clear_shown_events",preventMaintenanceDialog:!0,params:{alerts_ids:Array.from(s).map(t=>parseInt(t))}}).catch(t=>{C.logError("Could not mark offline events as shown: "+t)});const a=n.map(e=>t[e].latest_event).sort((t,e)=>t.id-e.id);for(const l of a){const e=new b(R(l));this.events.add(e),e.trigger("fired",e);const n=this.alerts.get(e.get("alertId"));void 0!==n&&n.trigger("fired",n),r.addNotification(i({},(0,d.getNotificationFromPriceEvent)(e),{count:t[e.get("alertId")].events_count}))}a.length>0&&this.events.trigger("offline_events");for(const i of Object.values(e))r.addNotification((0,d.getNotificationFromAlertStopped)({alertId:i.id,description:i.name||i.desc,reason:"fire_control",shortSymbol:H.shortName(i.sym)}))},t=>{C.logError("Failed to get offline events: "+t)})},Y.prototype._refreshPushStream=function(){I.off("alert"),I.offStatus(this._onPushStreamStatusChanged),is_authenticated&&(I.on("alert",this._onMessage.bind(this)),I.onPrivateStatus(this._onPushStreamStatusChanged))},Y.prototype._onMessage=function(t){var e,r,n,o,s,a=this;if(t)switch(C.logNormal(t),r=JSON.parse(t),this._onPushStreamMessage.fire({source:"alert",data:r}),n=r.m,e="new_alerts"===n?r.p.alerts.map(R):R(r.p),n){case"alert_running":a._alertVersioning.cancelPossibleExtraUpdate(e.id),a._alertVersioning.migrate(e).then((function(t){(o=a.alerts.get(t.id))?o.set(t):a.alerts.add(t,{at:0})}));break;case"new_alerts":for(const t of e)a.alerts.add(t);break;case"alert_stopped":if(o=a.alerts.get(e.id)){var l={active:!1,stopReason:e.stopReason,error:e.error};o.set(l)}"fire_control"===e.stopReason&&a.getAlertNotifier().then(t=>{const r=(0,d.getNotificationFromAlertStopped)({alertId:e.id,description:e.name||e.description,reason:e.stopReason,
shortSymbol:H.shortName(e.symbol)});r&&(t.addNotification(r),this.sendRequest({method:"clear_shown_events",preventMaintenanceDialog:!0,params:{alerts_ids:[e.id]}}))});break;case"alert_deleted":if(a._alertVersioning.cancelPossibleExtraUpdate(e.id),o=a.alerts.get(e.id)){const t=a.chartWidget();if(o.isDrawing()&&t){var c=o.get("extra").drawing();t.deleteAlertByExternalSource(c.id,o.id)}o.destroy()}break;case"event":this.getAlertNotifier().then(function(t){s=new b(i({},e)),a.events.add(s);const r=(0,d.getNotificationFromPriceEvent)(s);t.addNotification(r),s.trigger("fired",s),s.trigger("fired:online",s);const n=a.alerts.get(e.alertId);void 0!==n&&(n.set({fireTime:e.fireTime}),n.trigger("fired",n)),this.sendRequest({method:"clear_shown_events",preventMaintenanceDialog:!0,params:{alerts_ids:[e.alertId]}})}.bind(this))}},Y.prototype.cloneAlert=function(t,e={}){if(!(0,m.isAlertCloneable)(t))return"function"==typeof e.error&&e.error("Cannot clone alert"),void("function"==typeof e.complete&&e.complete());const r=t.getLocalClone();K(r),this.alerts.add(r),this.createAlert(r,i({},e,{eventName:"clone"}))},Y.prototype.detachAlert=function(t){var e=this.alerts.get(t);e&&e.destroy()},Y.prototype.createLocalAlert=function(t,e){var r;return e&&function(t){if(!t)throw new Error("Can't create alert. 'params' is required");for(var e=["symbol","resolution","expired","autoDeactivation","sendEmail","sendSms","sendTrueSms","showPopup","playSound","description","script"],r=[],n=e.length-1;n>=0;n--){var i=e[n];i in t||r.push(i)}r.length&&C.logError("[Alerts] Can't create alert. "+r.join(" ,")+(1===r.length?" is":" are")+" required")}(t),r=new x(t),this.alerts.add(r),r},Y.prototype.createAlert=function(t,e){var r=this;e=e||{};function n(t,r){"function"==typeof e.complete&&e.complete(),"function"==typeof e.error&&e.error(t,r)}if(t instanceof x){if(Y.checkProPermissions(t)){var i=Date.now(),o=t.prepareToSend();return r._generateScriptWithCancellation(t).then((function(n){return X(o,n),r.sendRequest({headers:Y.getAnalyticsHeaders(t.get("extra").conditionId(),e.actionSource),method:"create_alert",params:o,success:function(n){n=R(n||{});const i=r.alerts.get(n.id);i?(r.alerts.remove(t),t=i):(n.active=!0,t.set(n)),r._gaTrackEvent(e.eventName||"create",t,e.eventLabel),"function"==typeof e.success&&e.success(t)},complete:function(){var r=Date.now()-i;q.sendReport("alerts","full_time_frame",{value:r}),"function"==typeof e.complete&&e.complete(t)},error:e.error})})).catch((function(t){if(t===B)return C.logNormal("Alert generation is cancelled because next alert generation is started"),B;"function"==typeof e.error&&e.error("Can't generate source code: "+t),"function"==typeof e.complete&&e.complete()}))}n("cannot create alert with current pro plan",!0)}else n("'alert' should be instance of Alert")},Y.prototype.stopAlert=function(t,e){var r,n,i=this;e=e||{};t instanceof x?n=(r=t).get("id"):(n=t,r=i.alerts.get(n)),n?i.sendRequest({method:"stop_alert",params:{id:n},success:function(){i._gaTrackEvent("stop"),r&&r.set("active",!1),
"function"==typeof e.success&&e.success()},error:e.error,complete:e.complete}):C.logError("Alert id is required to stop alert")},Y.prototype.stopAllAlerts=function(t){var e,r=this,n={cross_int:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),t.showConfirm&&(e=t.symbol||t.resolution?$.t("Do you really want to stop filtered Alerts?"):$.t("Do you really want to stop all Alerts?")),r.sendRequest({method:"stop_all",params:n,success:function(){r._gaTrackEvent("stop_all"),r.alerts.each((function(t){n.symbol&&n.symbol!==t.get("symbol")||n.resolution&&n.resolution!==t.get("resolution")||t.set("active",!1)})),"function"==typeof t.success&&t.success()},confirmation:e,error:t.error,complete:t.complete})},Y.prototype.deleteAlert=function(t,e){var r,n,i,o=this;e=e||{};if(t instanceof x?i=(n=t).get("id"):(i=t,n=o.alerts.get(i)),n&&n.isNew())return n.destroy(),void("function"==typeof e.complete&&e.complete());i?(e.showConfirm&&(r=$.t("Do you really want to delete Alert '{0}' ?").format(n?n.title():i)),o.sendRequest({method:"delete_alert",params:{id:i},success:function(){o._gaTrackEvent("delete"),"function"==typeof e.success&&e.success(),n&&n.destroy()},error:e.error,cancel:e.cancel,complete:e.complete,confirmation:r})):C.logError("Alert id is required to delete alert")},Y.prototype.deleteAllAlerts=function(t){var e,r=this,n={crossInterval:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),"boolean"==typeof t.active&&(n.active=t.active),t.showConfirm&&(e=!1!==n.active||n.symbol||n.resolution?n.symbol||n.resolution||n.active?$.t("Do you really want to delete filtered Alerts?"):$.t("Do you really want to delete all Alerts?"):$.t("Do you really want to delete all inactive Alerts?")),r.sendRequest({method:"delete_all",params:n,success:function(){var e,i={};for(r._gaTrackEvent("delete_all"),n.symbol&&(i.symbol=n.symbol),n.resolution&&(i.resolution=n.resolution),"boolean"==typeof n.active&&(i.active=n.active),e=r.alerts.findWhere(i);e;)e.destroy(),e=r.alerts.findWhere(i);"function"==typeof t.success&&t.success()},error:t.error,complete:t.complete,confirmation:e})},Y.prototype.restartAlert=function(t,e){var r,n,i=this;e=e||{};if(t instanceof x?r=t:(n=t,r=i.alerts.get(n)),r){if(K(r),!Y.checkProPermissions(r))return"function"==typeof e.complete&&e.complete(),void("function"==typeof e.error&&e.error("cannot restart alert with current pro plan",!0));var o=Date.now(),s=r.prepareToSend();return i._generateScriptWithCancellation(r).then((function(t){return X(s,t),i.sendRequest({headers:Y.getAnalyticsHeaders(r.get("extra").conditionId(),e.actionSource),method:"restart_alert",params:s,success:function(){i._gaTrackEvent("restart",r),r.set("active",!0),"function"==typeof e.success&&e.success(r)},complete:function(){var t=Date.now()-o;q.sendReport("alerts","full_time_frame",{value:t}),"function"==typeof e.complete&&e.complete(r)},error:e.error})})).catch((function(t){if(t===B)return C.logNormal("Alert generation is cancelled because next alert generation is started"),B
;"function"==typeof e.error&&e.error("Can't generate alert source code for alert #"+n)}))}i.requestAlert(n,{success:function(t){t?i.restartAlert(t,e):("function"==typeof e.error&&e.error("Can't find alert "+n),"function"==typeof e.complete&&e.complete())}})},Y.prototype._generateScriptWithCancellation=function(t){var e=this;null==e._lastGenIds[t.cid]&&(e._lastGenIds[t.cid]=0),e._lastGenIds[t.cid]++;var r=e._lastGenIds[t.cid];return new Promise((function(e,r){const n=t.get("extra");let i=null,o="";if(n.isValid()?(i=n.toGenAlertJSON(t.get("description")),null===i&&(o="Can't generate alert JSON")):o="Can't generate alert on invalid AlertExtra",o)return C.logError(o),void r(o);w.generateAlert(JSON.stringify(i)).then((function(t,r,n,i){e({IL:r,inputs:n,genAlertData:i})}),r)})).then((function(n){return e._lastGenIds[t.cid]!==r?Promise.reject(B):(t.set("script",n.IL),n)}))},Y.prototype.restartAllAlerts=function(t){var e,r=this,n={crossInterval:!0};(t=t||{}).symbol&&(n.symbol=t.symbol),t.resolution&&(n.resolution=t.resolution),"boolean"==typeof t.active&&(n.active=t.active),t.showConfirm&&(e=t.symbol||t.resolution?$.t("Do you really want to restart filtered alerts?"):$.t("Do you really want to restart all inactive alerts?"));r.alerts.every(Y.checkProPermissions)&&r.sendRequest({method:"restart_all",params:n,success:function(){r._gaTrackEvent("restart_all"),r.alerts.each((function(t){n.symbol&&n.symbol!==t.get("symbol")||n.resolution&&n.resolution!==t.get("resolution")||t.set("active",!0)})),"function"==typeof t.success&&t.success()},error:t.error,complete:t.complete,confirmation:e})},Y.prototype.requestAlert=function(t,e){var r=this,n=(e=e||{},parseInt(t));function i(t){var i=r.alerts.get(n)||null;return(i||t)&&("function"==typeof e.success&&e.success(i),"function"==typeof e.complete&&e.complete()),!!i}function o(){r.sendRequest({method:"get_alert",preventMaintenanceDialog:!0,params:{id:n},success:function(t){var n,i=t.alert;i=R(i),r._alertVersioning.migrate(i).then((function(t){n=new x(t),r.alerts.add(n),"function"==typeof e.success&&e.success(n)})).catch((function(t){"function"==typeof e.error&&e.error(t)}))},complete:e.complete,error:function(r){"function"==typeof e.error?e.error(r):C.logError("Error in getting alert "+t+(r?": "+r:""))}})}!0===e.fromCache?i(!0):!1===e.fromCache?o():i()||o()},Y.prototype.getAlertSync=function(t){return this.alerts.get(t)||null},Y.prototype.ensureFullAlertsList=async function(t={}){try{if(window.is_authenticated||(this._fullListWasRequested=!0),this._fullListWasRequested)return void Z(t.success);const e=await this.sendRequest({method:"list_alerts",preventMaintenanceDialog:!0,params:{limit:2e3}});if(!e.alerts||!Array.isArray(e.alerts))throw new Error("Not valid params in alert list response");const r=await z(e.alerts,t=>this._alertVersioning.migrate(t));this.alerts.set(r),this._fullListWasRequested=!0,Z(t.success)}catch(e){const r=String(e);throw C.logError(r),Z(t.error,r),e}finally{Z(t.complete)}},Y.prototype.requestEventList=function(t){var e=this,r={sym:(t=t||{}).symbol,
res:t.resolution&&t.resolution.toString?t.resolution.toString():void 0,limit:t.limit,before:t.before,inc_cross_int:void 0===t.includeCrossInterval||t.includeCrossInterval};t.aid&&(r.aid=t.aid),this.sendRequest({method:"list_events",preventMaintenanceDialog:!0,params:r,success:function(r){var n=r.events;n&&$.isArray(n)?(n=$.map(n,(function(t){const r=new b(R(t));return e.events.add(r),r})),"function"==typeof t.success&&t.success(n)):console.warn("[Alerts] Not valid params in event list response")},error:t.error,complete:t.complete})},Y.prototype.deleteEvents=function(t={}){const e=t.ids;if(e&&0===e.length)return r(),void("function"==typeof t.complete&&t.complete());function r(){"function"==typeof t.success&&t.success()}this.sendRequest({method:"delete_events",params:e?{ids:e}:void 0,success:()=>{e?this.events.remove(e):this.events.reset(),u.TVXWindowEvents.emit("alertevents-deleted",e?JSON.stringify(e):""),r()},error:t.error,complete:t.complete})},Y.prototype.stopAlerts=function(t){const{ids:e,success:r,error:n,complete:i}=t;if(0===e.length)return Z(r),void Z(i);this.sendRequest({method:"stop_alerts",params:{ids:e},success:()=>{this._gaTrackEvent("stop_alerts");for(const t of e){const e=this.alerts.get(t);e&&e.set("active",!1)}Z(r)},error:n,complete:i})},Y.prototype.restartAlerts=function(t){const{ids:e,success:r,error:n,complete:i}=t;if(0===e.length)return Z(r),void Z(i);const o=[];for(const s of e){const t=this.alerts.get(s);t&&o.push(t)}if(!o.every(Y.checkProPermissions))return Z(n,"Cannot restart alerts with current pro plan"),void Z(i);this.sendRequest({method:"restart_alerts",params:{ids:e},success:()=>{this._gaTrackEvent("restart_alerts");for(const t of o)t.set("active",!0);Z(r)},error:t=>{"max_alerts_count_exceeded"===t&&W(),Z(n)},complete:i})},Y.prototype.cloneAlerts=function(t){const{success:e,error:r,complete:n}=t,i=t.ids.filter(t=>{const e=this.alerts.get(t);return Boolean(e&&(0,m.isAlertCloneable)(e))});if(0===i.length)return Z(e),void Z(n);this.sendRequest({method:"clone_alerts",params:{ids:i},success:()=>{this._gaTrackEvent("clone_alerts"),Z(e)},error:r,complete:n})},Y.prototype.deleteAlerts=function(t){const{ids:e,showConfirm:r,success:n,error:i,complete:o}=t;if(0===e.length)return Z(n),void Z(o);let s;if(r)if(1===e.length){const t=e[0],r=this.alerts.get(t);s=window.t("Do you really want to delete Alert '{0}' ?").format(r?r.title():t)}else s=window.t("Do you really want to delete selected alerts?");this.sendRequest({method:"delete_alerts",params:{ids:e},success:()=>{this._gaTrackEvent("delete_alerts");for(const t of e){const e=this.alerts.get(t);e&&e.destroy()}Z(n)},error:i,complete:o,confirmation:s})},Y.prototype.sendRequest=function(t){var e=t.method,r=L(t.params);if(function(t,e){if(["create_alert","restart_alert"].includes(t)){var r=e.extra&&JSON.parse(e.extra),n=r&&r.condition;["strategy","alerts","strategy_and_alerts"].includes(n.id)&&(e.ns_only_fire=!0)}}(e,r),g.alertsMaintenanceTracker.sync(),g.alertsMaintenanceTracker.value())return s("maintenance"),a(),Promise.reject("maintenance")
;if(t.confirmation){var n=!0;return new Promise((function(e,r){O({content:t.confirmation,title:$.t("Alert"),type:"modal"}).then((function(t){t.actionLoader("yes"),t.on("action:yes",(function(t){t.actionLoader("yes","start");var r=i();r.then((function(e){return t.actionLoader("yes","stop"),t.close(),e})).catch((function(e){return t.actionLoader("yes","stop"),e})),e(r),n=!1})),t.on("action:no",(function(){l(),a(),n=!1})),t.on("afterClose",(function(){n&&(l(),a())})),t.open()}))}))}return i();function i(){const n=N({method:e,params:r,noCache:t.noCache,headers:t.headers});return n.then(o,s),n}function o(e){if("function"==typeof t.success){var r=R(e);t.success(r)}return a(),r}function s(e){var r=!1;return"max_alerts_count_exceeded"===e?(W(),r=!0):"max_total_alerts_count_exceeded"===e?(U(),r=!0):"pro_plan_expired"===e?(j(),r=!0):"maintenance"===e&&(t.preventMaintenanceDialog||(setTimeout(V,0),r=!0)),"function"==typeof t.error?t.error(e,r):"maintenance"===e?C.logNormal("Alerts maintenance"):e&&C.logError("Reason: "+e),a(),e}function a(){"function"==typeof t.complete&&t.complete()}function l(){"function"==typeof t.cancel&&t.cancel()}},Y.prototype.setChartWidgetCollection=function(t){this._chartWidgetCollection=t},Y.prototype.chartWidget=function(){var t=null;return this._chartWidgetCollection&&(t=this._chartWidgetCollection.activeChartWidget.value()||null),t},Y.prototype.removeAlertFromAllChartsSilently=function(t,e){this._chartWidgetCollection&&this._chartWidgetCollection.getAll().forEach((function(r){r.deleteAlertByExternalSource(t,e)}))},Y.prototype._gaTrackEvent=function(t,e,r){var n;P("alert",t,r),"create"===t&&e instanceof x&&(n=e.get("extra"),P("alert","create__style",function(t){var e=t&&t.getMainSeries(),r=e&&e.getStyle&&e.getStyle();return r&&T.STYLE_SHORT_NAMES.hasOwnProperty(r)?T.STYLE_SHORT_NAMES[r]:"unknown"}(n)),P("alert","create__condition",function(t){var e=t.conditionId();return t.prepareAlertConditions()[e]&&(e="pine_condition"),e||"unknown"}(n)),P("alert","create__frequency",e.get("frequency")||"unknown"),e.isPrice()?P("alert","create__on","price"):e.isDrawing()?P("alert","create__on","drawing"):e.isMoving()?P("alert","create__on","moving"):n.band()||n.upperBand()||n.lowerBand()?P("alert","create__on","study"):P("alert","create__on","unknown"))},Y.prototype.getAlertDialogInvocations=function(){return y.alertEditorInvocationHandler.getDialogInvocations()},Y.prototype.openCreateDialog=function(t){S(i({type:"create_alert"},t))},Y.prototype.openEditDialog=function(t,e){var r,n,i=this;const o=t=>e.onAborted&&e.onAborted(t);!(e=e||{}).dataSourceHub&&i.chartWidget()&&(e.dataSourceHub=i.chartWidget().model().model()),t instanceof x?r=t:(n=t,r=i.alerts.get(n)),r?(e=$.extend(e,{alert:r,type:"edit_alert"}),S(e)):n?i.requestAlert(n,{success:function(t){i.openEditDialog(t,e)},error:function(t){"not_exists"===t&&(0,a.showNoticeDialog)({type:"modal",title:window.t("Alert"),content:window.t("Alert does not exist.")}),"function"==typeof e.error&&e.error(t),o(A.AlertIsInvalid)}
}):(console.error("[Alerts] alert id is required to edit alert"),o(A.AlertIsInvalid))},Y.prototype.subscribeToPushStream=function(t){this._onPushStreamMessage.subscribe(null,t)},Y.prototype.unsubscribeFromPushStream=function(t){t?this._onPushStreamMessage.unsubscribe(null,t):this._onPushStreamMessage.unsubscribeAll(null)},Y.prototype.getAlertNotifier=function(){if(null===this._notifierPromise){var t=this;this._notifierPromise=M().then((function(e){return e.onEditAlert.subscribe(null,(function(e,r,n){r===p.AlertCategory.Price&&t.openEditDialog(e,i({},n,{actionSource:"alert_notifier_edit"}))})),e.onRestartAlert.subscribe(null,(function(e,r,n){r===p.AlertCategory.Price&&t.restartAlert(e,i({},n,{actionSource:"alert_notifier_restart"}))})),e}))}return this._notifierPromise},t.exports.AlertsDispatcher=Y}).call(this,r("q1z7"))},"4BMm":function(t,e){var r={active:"active",aid:"alertId",alerts:"alerts",bar_time:"barTime",create_t:"createTime",cross_int:"crossInterval",deact:"autoDeactivation",desc:"description",email:"sendEmail",error:"error",events:"events",exp:"expired",fire_time:"fireTime",inc_cross_int:"includeCrossInterval",inf_exp:"noExpiration",internal_sym:"symbolInternal",popup:"showPopup",reason:"reason",res:"resolution",script_deps:"scriptDeps",script:"script",sms:"sendSms",true_sms:"sendTrueSms",snd:"playSound",push:"sendPush",snd_duration:"soundDuration",snd_file:"soundFile",sort_by:"sortBy",sort_dir:"sortDirection",start_t:"startTime",stop_t:"stopTime",stop:"stopReason",sym:"symbol",web_hook:"webhookUrl",inst_id:"instanceId",name:"name",alert_type:"alertType"},n=function(){var t={};return Object.keys(r).forEach((function(e){t[r[e]]=e})),t}();function i(t,e){var r={};return t?(Object.keys(t).forEach((function(n){var i=e(n),o=t[n];r[i]=o})),r):t}e.server2clientParams=function(t){return i(t,(function(t){return r[t]||t}))},e.client2serverParams=function(t){return i(t,(function(t){return n[t]||t}))}},Evi4:function(t,e,r){"use strict";var n=r("sDvb").AlertExtra,i=r("0YCj"),o=r("K4L1"),s=r("cBZt").extractStudyId,a=r("TcSq").extractPineId,l=r("xD5v").prepareCallStudyArgs,c=r("e3/o"),u=r("txPx").getLogger("Alerts.Versioning"),d=r("nmnj"),p=r("nXyu"),f=r("YJLw"),h=r("dn9U"),_=r("n5al"),v=r("PjMa").DataSourceDangerReason,m=r("uXxt").AlertExtraUpdateScheduler,g=r("+GxX").isFeatureEnabled;function y(){this._extraUpdateScheduler=new m}y.version_10_tv_6611_1a_refactoring=10,y.version_11_tv_6611_1b_refactoring=11,y.version_12_tv_6888_fix_plot_index=12,y.version_13_tv_4164_source_code_protection=13,y.version_14_tv_4164_source_code_protection_fix=14,y.version_15_tv_8068_fix_main_series_resolution=15,y.version_16_jv_298_remove_callstudy=16,y.version_17_jv_646_fix_mixed_inputs=17,y.version_18_tv_10636_price_format=18,y.version_19_tv_11267_fix_frequency_options=19,y.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string=20,y.version_21_tv_14886_add_alert_dangerous_source_check=21,y.prototype.migrate=function(t,e){var r;if(e=Object.assign({sendExtraUpdate:g("alerts-send-extra-update")},e),
!t||!t.extra)return Promise.resolve(t);if((r=JSON.parse(t.extra))&&!Object.keys(r).length&&r.constructor===Object)return delete t.extra,Promise.resolve(t);var i=Promise.resolve(t),o=null==r.version||r.version<n.VERSION;return o&&(i=this._patchAlert(r,t)),i=i.then(function(t){var r=JSON.parse(t.extra);return r.version<n.VERSION?u.logError("Alert version is less than current"):r.version>n.VERSION?u.logNormal("Alert version is greater than current"):o&&e.sendExtraUpdate&&this._extraUpdateScheduler.scheduleUpdate({id:t.id,instanceId:t.instanceId,extra:t.extra}),t}.bind(this))},y.prototype._patchAlert=function(t,e){var r=this;t.version||(t.version=1);var n=t.version;n<y.version_10_tv_6611_1a_refactoring&&(t.condition.mainSeries=this._patchBand_to10(t.condition.mainSeries,e.symbol),t.condition.options.band&&(t.condition.options.band=this._patchBand_to10(t.condition.options.band,e.symbol)),t.condition.options.upperBand&&(t.condition.options.upperBand=this._patchBand_to10(t.condition.options.upperBand,e.symbol)),t.condition.options.lowerBand&&(t.condition.options.lowerBand=this._patchBand_to10(t.condition.options.lowerBand,e.symbol)),t.version=y.version_10_tv_6611_1a_refactoring),n<y.version_11_tv_6611_1b_refactoring&&(t=this._patchExtra_to11(t)),n<y.version_12_tv_6888_fix_plot_index&&(t=this._patchExtra_to12(t)),n<y.version_13_tv_4164_source_code_protection&&(t=this._patchExtra_to13(t,e)),n<y.version_14_tv_4164_source_code_protection_fix&&(t=this._patchExtra_to14(t,e)),n<y.version_15_tv_8068_fix_main_series_resolution&&(t=this._patchExtra_to15(t,e)),e.extra=JSON.stringify(t);var i=Promise.resolve(e);return n<y.version_16_jv_298_remove_callstudy&&(i=i.then((function(t){return r._patchAlert_to16(t)}))),n<y.version_17_jv_646_fix_mixed_inputs&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to17(e);return t.extra=JSON.stringify(n),t}))),n<y.version_18_tv_10636_price_format&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to18(e);return t.extra=JSON.stringify(n),t}))),n<y.version_19_tv_11267_fix_frequency_options&&(i=i.then((function(t){return r._patchAlert_to19(t)}))),n<y.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to20(e);return t.extra=JSON.stringify(n),t}))),n<y.version_21_tv_14886_add_alert_dangerous_source_check&&(i=i.then((function(t){var e=JSON.parse(t.extra),n=r._patchExtra_to21(e);return t.extra=JSON.stringify(n),t}))),i},y.prototype.cancelPossibleExtraUpdate=function(t){this._extraUpdateScheduler.cancelUpdate(t)},y.prototype.cancelAllPossibleExtraUpdates=function(){this._extraUpdateScheduler.cancelAllUpdates()},y.prototype._patchBand_to10=function(t,e){return t=this._patchBand_to10_callStudyArgs(t),t=this._patchBand_to10_stateForAlert(t,e)},y.prototype._patchBand_to10_callStudyArgs=function(t){var e=t&&"Study"===t.type,r=e&&(t.alertsData||{}).callStudyArgs,n=e&&t.metaInfo&&t.state&&t.state.inputs;return e&&!r&&n?(t.alertsData||(t.alertsData={}),
t.alertsData.callStudyArgs=l(t.state.inputs,t.metaInfo),t):t},y.prototype._patchBand_to10_stateForAlert=function(t,e){var r,n;if(!t)return t;if(n=!t.state,"MainSeries"!==(r=t.type)||n){if("Study"!==r&&!/^study_\w+/.test(r)||n)return t;var i=t.metaInfo.plots.map((function(e){var r={id:e.id,type:e.type,offset:t.data.completePlotOffsets[e.id]};return t.metaInfo.styles&&void 0!==t.metaInfo.styles[e.id]&&(r.title=t.metaInfo.styles[e.id].title||""),e.target&&t.metaInfo.ohlcPlots&&t.metaInfo.ohlcPlots[e.target]&&(r.ohlcTitle=t.metaInfo.ohlcPlots[e.target].title),r}));return{id:t.id,uniqueId:t.uniqueId,type:t.type,title:"",shortDescription:t.state.shortDescription||"Study",fullId:t.metaInfo.fullId,isTVScript:!!t.metaInfo.isTVScript,plots:i,inputs:t.state.inputs,alerts:t.metaInfo.alerts,callStudyArgs:t.alertsData.callStudyArgs,plotIndex:t.plotIndex,plotOffset:t.plotOffset}}return{id:t.id,uniqueId:t.uniqueId,type:t.type,proSymbol:t.state.symbol||e,actualSymbol:e,interval:t.state.interval,style:t.state.style,styleInputs:function(){var e={0:"bar",1:"candle",2:"line",3:"area",4:"renko",5:"kagi",6:"pnf",7:"pb",8:"ha",9:"hollowCandle"}[t.state.style];if(e){var r=t.state[e+"Style"];if(r)return r.inputs}}(),extendedHours:t.state.extendedHours,boxSize:t.boxSize,reversalAmount:t.reversalAmount}},y.prototype._patchExtra_to11=function(t){var e=function(t,e,r){r.id=r.id||c.randomHashN(6),t.condition[e]={id:r.id,plotIndex:r.plotIndex},t.statesForAlert[r.id]=r},r={version:y.version_11_tv_6611_1b_refactoring,condition:{id:t.condition.id,fireInfo:{frequency:t.frequency||"once"},movPeriod:t.condition.options.period,movValue:t.condition.options.value},statesForAlert:{}};e(r,"alertSeries",t.condition.mainSeries);return["band","upperBand","lowerBand"].filter((function(e){return!!t.condition.options[e]})).forEach((function(n){e(r,n,t.condition.options[n])})),r},y.prototype._patchExtra_to12=function(t){return["alertSeries","band","upperBand","lowerBand"].filter((function(e){return!!t.condition[e]&&void 0!==t.condition[e].plotIndex})).map((function(e){var r=t.condition[e];return{state:t.statesForAlert[r.id],plotIndex:r.plotIndex}})).filter((function(t){return!!t.state.plots})).forEach((function(t){var e=t.state.plots[t.plotIndex];null==e||"object"!=typeof e&&"function"!=typeof e||void 0===e.pinePlotIndex&&(e.pinePlotIndex=t.plotIndex)})),t.version=y.version_12_tv_6888_fix_plot_index,t},y.prototype._patchExtra_to13=function(t,e){var r=t;if(!t.condition.mainSeries){if("MainSeries"===t.statesForAlert[t.condition.alertSeries.id].type)r.condition.mainSeries=r.condition.alertSeries;else{var n=c.randomHashN(6);r.condition.mainSeries={id:n},r.statesForAlert[n]={id:n}}r.statesForAlert[r.condition.mainSeries.id].symbolString=e.symbol}for(var o in t.statesForAlert){var s=t.statesForAlert[o];s.fullId&&(s.scriptIdPart=i.parseIdString(s.fullId).shortId.split("$")[1])}return r.version=y.version_13_tv_4164_source_code_protection,r},y.prototype._patchExtra_to14=function(t,e){var r=t
;return t.condition.mainSeries||("MainSeries"===t.statesForAlert[t.condition.alertSeries.id].type?r.condition.mainSeries=r.condition.alertSeries:(r.condition.mainSeries={id:c.randomHashN(6)},r.statesForAlert[r.condition.mainSeries.id]={})),null==r.statesForAlert[r.condition.mainSeries.id].symbolString&&(r.statesForAlert[r.condition.mainSeries.id].symbolString=e.symbol),r.version=y.version_14_tv_4164_source_code_protection_fix,r},y.prototype._patchExtra_to15=function(t,e){var r=t;return null==r.statesForAlert[r.condition.mainSeries.id].interval&&(r.statesForAlert[r.condition.mainSeries.id].interval=e.resolution),r.version=y.version_15_tv_8068_fix_main_series_resolution,r},y.prototype._patchAlert_to16=function(t){var e=JSON.parse(t.extra);function r(t){return t.replace(/tv-scripting-1!?$/,"tv-scripting-88")}function n(e){return(n=e,o=i.cutDollarHash(n.fullId),a=y._recoverFullInputs(n.fullId,n.pineId,n.pineVersion,n.inputs).then((function(t){return{id:p.idForAlert(s(n.fullId),t),study:r(o),inputs:t}})),l=new Promise((function(t,e){var i=JSON.parse(n.callStudyDependencies||"[]").map((function(t){return y._recoverFullInputs(null,t.scriptIdPart,t.scriptVersion,t.inputs).then((function(e){return{id:t.id,study:r(t.study),inputs:e}}))}));Promise.all(i).then((function(e){t(e)}),e)})),a.then((function(t){return l.then((function(e){return[t].concat(e)}))}))).then((function(r){e.studyDependencies=r;var n=r[0];e.id=n.id,e.uniqueId=e.id,t.scriptDeps=t.scriptDeps.concat(r)}));var n,o,a,l}t.scriptDeps=[];var o=[];for(var a in e.statesForAlert)if(e.statesForAlert.hasOwnProperty(a)){var l=e.statesForAlert[a];if("MainSeries"===l.type)l.id=f(l.symbolString+l.interval).toString(),l.uniqueId=l.id;else if(/^LineTool.*/i.test(l.type))l.id=l.uniqueId;else if("Study"===l.type||/^study_\w+/.test(l.type)){var c=n(l);o.push(c)}}return Promise.all(o).then((function(){return function(t){var e={},r={};Object.keys(t.statesForAlert).forEach((function(n){var i=t.statesForAlert[n].id;e[n]=i,r[i]=t.statesForAlert[n]})),Object.keys(t.condition).filter((function(r){return null!=t.condition[r].id&&null!=e[t.condition[r].id]})).forEach((function(r){t.condition[r].id=e[t.condition[r].id]})),t.statesForAlert=r}(e),e.version=y.version_16_jv_298_remove_callstudy,t.extra=JSON.stringify(e),t}))},y.prototype.patchAlert_to16_forTestsOnly=y.prototype._patchAlert_to16,y.prototype._patchExtra_to17=function(t){for(var e in t.statesForAlert)if(t.statesForAlert.hasOwnProperty(e)){var r=t.statesForAlert[e],n=r.inputs;if(null!=n&&(r.inputs=o.splitInputs(n).obj),null!=r.studyDependencies)for(var i=0;i<r.studyDependencies.length;i++){var s=r.studyDependencies[i];s.inputs=o.splitInputs(s.inputs).obj}}return t.version=y.version_17_jv_646_fix_mixed_inputs,t},y.prototype.patchExtra_to17_forTestsOnly=y.prototype._patchExtra_to17,y._recoverFullInputs=function(t,e,r,n){if(e=e||t&&a(t)||n.pineId,r=r||n.pineVersion||"-1",null==e)return Promise.resolve(n);var i=d.translateScriptAsync2(e,r);return new Promise((function(t,e){i.then(t,e)})).catch((function(t){
if("-1"===r&&e.startsWith("USER")){var i=function(t){var e={};return Object.keys(t).forEach((function(r){var n,i=t[r];r.startsWith("in_")?(n=["open","high","low","close","hl2","hlc3","ohlc4"].indexOf(i)>0||/.*\$\d+/.test(i)?"source":"string"==typeof i?"string":"boolean"==typeof i?"bool":"float",e[r]={f:!0,v:i,t:n}):e[r]=i})),e}(n);return u.logNormal("A very rare case: alert on legacy script that was never resaved. Trying to guess input types \n\t"+JSON.stringify(n)+" -> "+JSON.stringify(i)),i}return u.logError("Alert migration failed, inputs cannot be migrated: "+JSON.stringify(t)),Promise.reject(t)})).then((function(t){return TVScript.patchInputs(t.inputs,n)}))},y.prototype._patchExtra_to18=function(t){var e,r={},n=h.getData(t.condition.id);if(n&&"comparison"===n.type)if(n.isChannel){var i=t.statesForAlert[t.condition.upperBand.id],o=t.statesForAlert[t.condition.lowerBand.id];"Value"===i.type?e=i.value:"Value"===o.type&&(e=o.value)}else{var s=t.statesForAlert[t.condition.band.id];"Value"===s.type&&(e=s.value)}if(e&&-1!==(e=e.toString().replace(/^-/,"")).indexOf(".")){var a=e.replace(/^\d+\./,"").length,l=Math.pow(10,a);r.priceScale=l}var c=t.condition.alertSeries.id;return t.statesForAlert[c].formatter={type:"price",state:r},t.version=y.version_18_tv_10636_price_format,t},y.prototype._patchAlert_to19=function(t){var e=JSON.parse(t.extra),r=t.autoDeactivation,n=e.condition.fireInfo.frequency,i=e.statesForAlert[e.condition.mainSeries.id],o=["band","lowerBand","upperBand"].map((function(t){var r=e.condition[t];return r&&e.statesForAlert[r.id]})).filter((function(t){return!!t})).filter((function(t){return"LineToolVertLine"===t.type})).length>0,s=_.hasProjection(i.style),a=t.crossInterval,l=[];function c(t){return-1!==l.indexOf(t)}return o?l.push("once"):(a||s||(l.push("once"),l.push("60"),l.push("on_bar_close")),s?l.push("on_bar_close"):l.push("on_first_fire")),"once_per_bar"===n&&(n="on_first_fire"),"once"!==n||c("once")||(r=!0,n=l[0]),"once"!==n&&r&&(n=l[0]),"once"!==n&&o&&(r=!0,n="once"),"on_bar_close"===n&&!c("on_bar_close")&&c("on_first_fire")&&(n="on_first_fire"),t.autoDeactivation=r,e.condition.fireInfo.frequency=n,e.version=y.version_19_tv_11267_fix_frequency_options,t.extra=JSON.stringify(e),t},y.prototype._patchExtra_to20=function(t){var e=t.condition.mainSeries,r=t.statesForAlert,n=e&&r&&r[e.id];if(n){var i=n.symbolString;if(i&&0===i.indexOf("=")){var o=i.slice(1);"dividends"===(o=JSON.parse(o)).adjustment?n.dividendsAdjustment=!0:"splits"===o.adjustment&&(n.dividendsAdjustment=!1)}}return t.version=y.version_20_tv_14463_extract_dividends_adjustment_from_symbol_string,t},y.prototype.patchExtra_to20_forTestsOnly=y.prototype._patchExtra_to20,y.prototype._patchExtra_to21=function(t){var e=t.statesForAlert;for(var r in e)if(e.hasOwnProperty(r)){var n=e[r];n.isSpread&&(n.dangerReason=v.Spread)}return t.version=y.version_21_tv_14886_add_alert_dangerous_source_check,t},t.exports={AlertVersioning:y}},JZcM:function(t,e,r){"use strict";var n;r.d(e,"a",(function(){return n})),function(t){t.Fired="fired",
t.FireControl="fire_control"}(n||(n={}))},LxhU:function(t,e,r){"use strict";r.r(e),r.d(e,"ResolutionKind",(function(){return o})),r.d(e,"SpecialResolutionKind",(function(){return s})),r.d(e,"Interval",(function(){return u})),r.d(e,"isHour",(function(){return p}));const n=/^(\d*)([TSHDWMR])$/,i=/^(\d+)$/;var o,s;!function(t){t.Ticks="ticks",t.Seconds="seconds",t.Minutes="minutes",t.Days="days",t.Weeks="weeks",t.Months="months",t.Range="range",t.Invalid="invalid"}(o||(o={})),function(t){t.Hours="hours"}(s||(s={}));const a={};a[o.Ticks]=1e3,a[o.Seconds]=1e3,a[o.Minutes]=60*a[o.Seconds],a[o.Days]=1440*a[o.Minutes],a[o.Weeks]=7*a[o.Days];const l={T:o.Ticks,S:o.Seconds,D:o.Days,W:o.Weeks,M:o.Months,R:o.Range},c=new Set([o.Ticks,o.Seconds,o.Minutes]);class u{constructor(t,e){this._kind=o.Invalid,this._multiplier=0,t!==o.Invalid&&e>0&&(this._kind=t,this._multiplier=e)}kind(){return this._kind}multiplier(){return this._multiplier}isValid(){return this.kind()!==o.Invalid&&this.multiplier()>0}isDWM(){return this.isValid()&&!this.isRange()&&!this.isIntraday()&&!this.isTicks()}isIntraday(){const t=c.has(this.kind());return this.isValid()&&t}isSeconds(){return this.kind()===o.Seconds}isMinutes(){return this.kind()===o.Minutes}isMinuteHours(){return this.kind()===o.Minutes&&p(this.multiplier())}isDays(){return this.kind()===o.Days}isWeeks(){return this.kind()===o.Weeks}isMonths(){return this.kind()===o.Months}isRange(){return this.kind()===o.Range}isTicks(){return this.kind()===o.Ticks}isTimeBased(){return!this.isRange()}letter(){return this.isValid()&&this.kind()!==o.Minutes?this.kind()[0].toUpperCase():""}value(){return this.isValid()?this.kind()===o.Minutes?this.multiplier()+"":this.multiplier()+this.letter():""}isEqualTo(t){if(!(t instanceof u))throw new Error("Argument is not an Interval");return!(!this.isValid()||!t.isValid())&&(this.kind()===t.kind()&&this.multiplier()===t.multiplier())}inMilliseconds(t=Date.now()){if(!this.isValid()||this.isRange())return NaN;if(this.isMonths()){const e=new Date(t);e.setUTCMonth(e.getUTCMonth()+(this.multiplier()||1));return+e-t}const e=this.multiplier();return a[this.kind()]*e}static isEqual(t,e){return t===e||u.parse(t).isEqualTo(u.parse(e))}static parse(t){t=(t+"").toUpperCase().split(",")[0];let e=n.exec(t);return null!==e?"H"===e[2]?new u(o.Minutes,60*d(e[1])):new u(l[e[2]],d(e[1])):(e=i.exec(t),null!==e?new u(o.Minutes,d(e[1])):new u(o.Invalid,0))}static kind(t){return u.parse(t).kind()}static isValid(t){return u.parse(t).isValid()}static isDWM(t){return u.parse(t).isDWM()}static isIntraday(t){return u.parse(t).isIntraday()}static isSeconds(t){return u.parse(t).isSeconds()}static isMinutes(t){return u.parse(t).isMinutes()}static isMinuteHours(t){return u.parse(t).isMinuteHours()}static isDays(t){return u.parse(t).isDays()}static isWeeks(t){return u.parse(t).isWeeks()}static isMonths(t){return u.parse(t).isMonths()}static isRange(t){return u.parse(t).isRange()}static isTicks(t){return u.parse(t).isTicks()}static isTimeBased(t){return u.parse(t).isTimeBased()}static normalize(t){
const e=u.parse(t);return e.isValid()?e.value():null}}function d(t){return 0===t.length?1:parseInt(t,10)}function p(t){return t>=60&&!(t%60)}},Zdjc:function(t,e,r){"use strict";r.r(e),r.d(e,"createGoProAlertsTrueSmsDialog",(function(){return i})),r.d(e,"showGoProAlertsTrueSmsDialog",(function(){return o}));r("YFKU");var n=r("oOPW");function i(){return Object(n.createGoProDialog)({feature:"alertsTrueSms",goOnMarkets:!1,isTrialAvailable:!0,upgradeMessage:window.t("Upgrade now"),visitPaymentPage:{billing_cycle:"y",options:{productName:"pro_premium",newWindow:!0}}})}function o(){i()}},brCa:function(t,e,r){"use strict";r.r(e),r.d(e,"createNoticeDialog",(function(){return o})),r.d(e,"showNoticeDialog",(function(){return s}));var n=r("YFKU");const i={width:400,destroyOnClose:!0,title:Object(n.t)("Notification"),content:Object(n.t)("You are notified"),contentWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--no-border"><div class="tv-text"><p></p></div></div>',actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--no-border">',actions:[{name:"ok",type:"primary",text:Object(n.t)("Ok"),method:"close",key:[13,32]}]};async function o(t){return(await Promise.all([r.e("vendors"),r.e(18),r.e("dialogs-core"),r.e(24),r.e(32),r.e(33),r.e(49),r.e(38),r.e(48),r.e("create-dialog")]).then(r.bind(null,"YDhE"))).createDialog(Object.assign(Object.assign({},i),t))}function s(t){o(t).then(t=>t.open())}},dfhE:function(t,e,r){"use strict";r.r(e),r.d(e,"STATUS_OFFLINE",(function(){return n})),r.d(e,"STATUS_RESOLVING",(function(){return i})),r.d(e,"STATUS_LOADING",(function(){return o})),r.d(e,"STATUS_READY",(function(){return s})),r.d(e,"STATUS_INVALID_SYMBOL",(function(){return a})),r.d(e,"STATUS_SNAPSHOT",(function(){return l})),r.d(e,"STATUS_EOD",(function(){return c})),r.d(e,"STATUS_PULSE",(function(){return u})),r.d(e,"STATUS_DELAYED",(function(){return d})),r.d(e,"STATUS_DELAYED_STREAMING",(function(){return p})),r.d(e,"STATUS_NO_BARS",(function(){return f})),r.d(e,"STATUS_REPLAY",(function(){return h})),r.d(e,"SERIES_STATUS_TEXT",(function(){return _})),r.d(e,"STYLE_LINE_TYPE_MARKERS",(function(){return v})),r.d(e,"STYLE_LINE_TYPE_STEP",(function(){return m})),r.d(e,"STYLE_LINE_TYPE_SIMPLE",(function(){return g})),r.d(e,"STYLE_BARS",(function(){return y})),r.d(e,"STYLE_CANDLES",(function(){return S})),r.d(e,"STYLE_LINE",(function(){return A})),r.d(e,"STYLE_AREA",(function(){return b})),r.d(e,"STYLE_RENKO",(function(){return E})),r.d(e,"STYLE_KAGI",(function(){return x})),r.d(e,"STYLE_PNF",(function(){return w})),r.d(e,"STYLE_PB",(function(){return T})),r.d(e,"STYLE_HEIKEN_ASHI",(function(){return I})),r.d(e,"STYLE_HOLLOW_CANDLES",(function(){return P})),r.d(e,"STYLE_BASELINE",(function(){return D})),r.d(e,"STYLE_RANGE",(function(){return k})),r.d(e,"STYLE_HILO",(function(){return O})),r.d(e,"STYLE_SHORT_NAMES",(function(){return C})),r.d(e,"SYMBOL_STRING_DATA",(function(){return N}));const n=0,i=1,o=2,s=3,a=4,l=5,c=6,u=7,d=8,p=9,f=10,h=11,_={[n]:"connecting",[i]:"loading",
[o]:"loading",[s]:"realtime",[a]:"invalid",[l]:"snapshot",[c]:"endofday",[u]:"endofday",[d]:"delayed",[p]:"delayed_streaming",[f]:"forbidden",[h]:"replay"},v=0,m=1,g=2,y=0,S=1,A=2,b=3,E=4,x=5,w=6,T=7,I=8,P=9,D=10,k=11,O=12,C={0:"bar",1:"candle",9:"hollowCandle",2:"line",3:"area",4:"renko",7:"pb",5:"kagi",6:"pnf",8:"ha",10:"baseline",11:"range",12:"hilo"},N={4:{type:"BarSetRenko@tv-prostudies",basicStudyVersion:40},7:{type:"BarSetPriceBreak@tv-prostudies",basicStudyVersion:34},5:{type:"BarSetKagi@tv-prostudies",basicStudyVersion:34},6:{type:"BarSetPnF@tv-prostudies",basicStudyVersion:34},8:{type:"BarSetHeikenAshi@tv-basicstudies",basicStudyVersion:60},11:{type:"BarSetRange@tv-basicstudies",basicStudyVersion:72}}},flg1:function(t,e,r){"use strict";r.r(e),r.d(e,"showAlertsMaintenanceDialog",(function(){return o}));var n=r("1UCy"),i=r("PlME");function o(){Object(i.showAbortExplainingDialog)(n.AlertEditorAbortReason.AlertsMaintenance)}},gdgp:function(t,e,r){"use strict";r.r(e),r.d(e,"showGoProMaxAlertsDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alerts"})}},jA5l:function(t,e,r){"use strict";r.r(e),r.d(e,"showGoProAlertsWebhookDialog",(function(){return i}));var n=r("oOPW");function i(){Object(n.createGoProDialog)({feature:"alertsWebhook"})}},oNDq:function(t,e,r){"use strict";r.r(e),r.d(e,"createConfirmDialog",(function(){return i}));var n=r("YFKU");async function i(t){const e={actions:[{key:13,name:"yes",text:n.t("Yes"),type:"success"},{method:"close",name:"no",text:n.t("No"),type:"default"}],actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--no-border">',content:n.t("Are you sure?"),contentWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--no-border"><div class="tv-text"><p></p></div></div>',destroyOnClose:!0,title:n.t("Confirmation"),width:400,dataset:{"dialog-type":"confirm-dialog"}},{createDialog:i}=await Promise.all([r.e("vendors"),r.e(18),r.e("dialogs-core"),r.e(24),r.e(32),r.e(33),r.e(49),r.e(38),r.e(48),r.e("create-dialog")]).then(r.bind(null,"YDhE"));return i(Object.assign(Object.assign({},e),t))}},sg6D:function(t,e,r){"use strict";var n=r("/ELx").extend({_prepareToSet_fireTime:function(t){return new Date(1e3*t)},_prepareToSet_barTime:function(t){return new Date(1e3*t)},_prepareToSet_alertId:function(t){return parseInt(t)},fireTimeReadable:function(){return this._formatDate(this.get("fireTime"))},fireTimeUnix:function(){return Math.round(this.get("fireTime").getTime()/1e3)}});t.exports=n},"tc+8":function(t,e,r){"use strict";(function(e){var n=r("ogJP").isFunction;function i(t){if(this._listeners=new e,this._childs=[],this._muteChildChanges=!1,void 0!==t)if(this.isPrimitiveType(t))this._value=t;else for(var r in t)this.addProperty(r,t[r])}i.prototype.merge=function(t,e){var r=null;if(e)var n=(r=[]).length;if(void 0===t)return r;if(this.isPrimitiveType(t))return e&&this._value!==t&&r.push(this),this._value=t,r;if(Array.isArray(t))for(var i=0;i<t.length;i++)if(this[i]){var o=this[i].merge(t[i],e)
;e&&(r=r.concat(o))}else this.addProperty(i,t[i]),e&&r.push(this[i]);else for(var s in t)if(this[s]){o=this[s].merge(t[s],e);e&&void 0!==o&&(r=r.concat(o))}else this.addProperty(s,t[s]),e&&r.push(this[s]);return e&&r.length>n&&r.push(this),r},i.prototype.mergeAndFire=function(t){var e=this.merge(t,!0);this._muteChildChanges=!0,e.forEach((function(t){t._muteChildChanges=!0})),e.forEach((function(t){t._muteChildChanges=!1,t.listeners().fire(t)})),this._muteChildChanges=!1,e.length>0&&this.listeners().fire(this)},i.prototype.state=function(t){var e=n(this.value)?this.value():void 0;void 0===e&&(e={});for(var r=0;r<this._childs.length;r++){var i=this._childs[r];if(!t||-1===t.indexOf(i))if(t){for(var o=[],s=0;s<t.length;s++){var a=t[s];a.startsWith(i+".")&&o.push(a.substr(i.length+1))}e[i]=this[i].state(o)}else e[i]=this[i].state()}return e},i.prototype.clone=function(t){return new i(this.state())},i.prototype.isPrimitiveType=function(t){return null===t||(!!isNumber(t)||(!!new TradingView.TypeValidator(String).check(t)||TradingView.isBoolean(t)))},i.prototype.value=function(){return this._value},i.prototype.listeners=function(){return this._listeners},i.prototype.childCount=function(){return this._childs.length},i.prototype.childNames=function(){return this._childs},i.prototype.child=function(t){return this[t]},i.prototype.setValue=function(t,e){(this._value!==t||e)&&(this._value=t,this._listeners.fire(this))},i.prototype.setValueSilently=function(t){this._value=t},i.prototype.addProperty=function(t,e){var r=new i(e);this[t]=r,this._childs.push(t),r.subscribe(this,this.childChanged)},i.prototype.removeProperty=function(t){this[t].unsubscribe(this,this.childChanged),delete this[t],this._childs=this._childs.filter((function(e){return e!==t}))},i.prototype.hasChild=function(t){return this._childs.indexOf(t)>=0},i.prototype.addChild=function(t,e){this[t]&&this[t].unsubscribe(this,this.childChanged),this[t]=e,-1===this._childs.indexOf(t)&&this._childs.push(t),e.subscribe(this,this.childChanged)},i.prototype.childChanged=function(t,e){this._muteChildChanges||this.listeners().fire(this)},i.prototype.subscribe=function(t,e){this.listeners().subscribe(t,e,!1)},i.prototype.unsubscribe=function(t,e){this.listeners().unsubscribe(t,e)},i.prototype.unsubscribeAll=function(t){this.listeners().unsubscribeAll(t)},i.prototype.childs=function(){return this},t.exports=i}).call(this,r("aIyQ"))},uOo4:function(t,e,r){"use strict";function n(t){return!t.isDrawing()}r.r(e),r.d(e,"isAlertCloneable",(function(){return n}))},uXxt:function(t,e,r){"use strict";r.r(e),r.d(e,"AlertExtraUpdateScheduler",(function(){return l}));var n=r("hWRP"),i=r("4BMm"),o=r("txPx");const s=Object(o.getLogger)("Alerts.ExtraUpdateScheduler"),a=clearTimeout;class l{constructor(){this._queue=new Map,this._taskHandle=null}scheduleUpdate(t){this._queue.set(t.id,t),this._maybeScheduleTask()}cancelUpdate(t){this._queue.delete(t),null!==this._taskHandle&&0===this._queue.size&&(a(this._taskHandle),this._taskHandle=null)}cancelAllUpdates(){this._queue.clear(),
null!==this._taskHandle&&(a(this._taskHandle),this._taskHandle=null)}_maybeScheduleTask(){null===this._taskHandle&&0!==this._queue.size&&(this._taskHandle=setTimeout(async()=>{const t=this._queue.values().next().value;t&&(this._queue.delete(t.id),await function(t){return s.logDebug("Sending extra update request for alert "+t.id),Object(n.sendRequest)({method:"update_extra",params:Object(i.client2serverParams)(t)}).then(()=>s.logDebug("Extra has been updated successfully for alert "+t.id),e=>s.logWarn(`Could not update extra for alert ${t.id}: ${e}`))}(t)),this._taskHandle=null,this._maybeScheduleTask()},1e3))}}},zL88:function(t,e,r){"use strict";function n(){Promise.all([r.e("vendors"),r.e(1),r.e(2),r.e(16),r.e(25),r.e(27),r.e(419),r.e(306),r.e("show-warning-alerts-max-total-count-exceeded")]).then(r.bind(null,"MR9f")).then(t=>t.showWarningAlertsMaxTotalCountExceededImpl())}r.r(e),r.d(e,"showWarningAlertsMaxTotalCountExceeded",(function(){return n}))},zNIe:function(t,e,r){"use strict";function n(t){const e=new URL("chart",window.location.origin);return e.searchParams.append("symbol",t),e.toString()}r.d(e,"a",(function(){return n}))}}]);