(window.webpackJsonp=window.webpackJsonp||[]).push([[344],{"0ZwQ":function(t,e,i){"use strict";i.d(e,"a",(function(){return v})),i.d(e,"b",(function(){return W}));var s=i("P5fv"),o=i.n(s),n=(i("EsMY"),i("Eyy1"),i("9uLv")),d=i("Vdly"),r=i("aIyQ"),a=i.n(r),l=i("hY0g"),h=i.n(l),c=i("A6WY"),g=i("69Qn"),p=(i("qFKp"),i("VVxS")),_=i("qAO1");i("PwLo");function u(){return window.innerWidth}function w(){return window.innerHeight}const v="floating-toolbar-react-widgets",m='<div class="tv-floating-toolbar i-closed i-hidden">'+(Modernizr.mobiletouch?'<div class="tv-floating-toolbar__drag-ext js-drag"></div>':"")+'<div class="tv-floating-toolbar__widget-wrapper">'+`<div class="tv-floating-toolbar__drag js-drag">${_}</div><div class="tv-floating-toolbar__content js-content"></div>`+`<div class="${v}"></div></div></div>`;class W{constructor(t){this._widget=document.createElement("div"),this._isVertical=!1,this._hiddingTimeoutId=null,this._visibility=new h.a(!1),this._windowResizeListener=this._onWindowResize.bind(this),this._reorderedDelegate=new a.a,this._responsiveResizeFunction=null,this._showTimeStamp=null,this._preventClickUntilAnimation=t=>{null!==this._showTimeStamp&&performance.now()-this._showTimeStamp<this.hideDuration()&&t.stopPropagation()},W._toolbars.push(this),this._options=t,this._widget=o()(m).get(0),this._content=this._widget.getElementsByClassName("js-content").item(0),this._reactWidgetsContainer=this._widget.getElementsByClassName(v).item(0),this._setZIndex(W._startZIndex+W._toolbars.length-1),this._options.addClass&&(this._widget.className+=" "+this._options.addClass),this._options["data-name"]&&(this._widget.dataset.name=this._options["data-name"]),this._options.layout&&"auto"!==this._options.layout&&(this._isVertical="vertical"===this._options.layout,this._updateLayoutType(),this._updateAxisOption()),this._widget.addEventListener("click",this._preventClickUntilAnimation,!0)}destroy(){this.hide(!0),W._toolbars.splice(W._toolbars.indexOf(this),1),this._widget.removeEventListener("click",this._preventClickUntilAnimation,!0),document.body.contains(this._widget)&&document.body.removeChild(this._widget),this._widget.innerHTML="",this._responsiveResizeFunction=null}setResponsiveResizeFunc(t){this._responsiveResizeFunction=t}isVisible(){return this._visibility.value()}visibility(){return this._visibility.readonly()}isVertical(){return this._isVertical}show(){this.isVisible()||(document.body.contains(this._widget)||(this._init(),document.body.appendChild(this._widget)),this._setHiddingTimeout(null),window.addEventListener("resize",this._windowResizeListener),this.raise(),this._visibility.setValue(!0),this._showTimeStamp=performance.now(),this._widget.classList.contains("i-hidden")?(this._widget.classList.remove("i-hidden"),setTimeout(()=>{this.isVisible()&&this._widget.classList.remove("i-closed")})):this._widget.classList.remove("i-closed"),this._onWindowResize())}hide(t=!1){if(!this.isVisible())return;const e=this._widget.classList.contains("i-closed");if(this._widget.classList.add("i-closed"),
this._visibility.setValue(!1),t||e)this._setHiddingTimeout(null),this._widget.classList.add("i-hidden");else{const t=setTimeout(()=>{this._setHiddingTimeout(null),this._widget.classList.add("i-hidden")},this.hideDuration());this._setHiddingTimeout(t)}window.removeEventListener("resize",this._windowResizeListener)}raise(){W._toolbars.length+W._startZIndex!==this._zIndex()&&(W._toolbars.splice(W._toolbars.indexOf(this),1),W._toolbars.push(this),W._updateAllZIndexes())}hideDuration(){return.75*n.dur}addWidget(t,e={}){const i=this.widgetsCount();if(void 0===e.index&&(e.index=i),e.index<0||e.index>i)throw new Error(`Index must be in [0, ${i}]`);const s=document.createElement("div");s.className="tv-floating-toolbar__widget js-widget",s.appendChild(t);const o=e.index===i?null:this._content.childNodes.item(e.index);this._content.insertBefore(s,o),this._onWindowResize()}getReactWidgetContainer(){return this._reactWidgetsContainer}removeWidget(t){const e=this._findWrapperForWidget(t);e&&(this._content.removeChild(e),this._onWindowResize())}widgetsCount(){return this._content.childNodes.length}showWidget(t){const e=this._findWrapperForWidget(t);e&&e.classList.remove("i-hidden")}hideWidget(t){const e=this._findWrapperForWidget(t);e&&e.classList.add("i-hidden")}removeWidgets(){for(;this._content.firstChild;)this._content.removeChild(this._content.firstChild);this._onWindowResize()}onWidgetsReordered(){return this._reorderedDelegate}onContextMenu(t){if(Modernizr.mobiletouch){(new g.a).load().then(e=>{const i=new e(this._widget);i.get("press").set({time:500}),i.on("press",e=>{this._preventWidgetTouchEndEvent(),t(e.srcEvent)})})}else this._widget.addEventListener("contextmenu",t)}checkPosition(){const t=this._getCorrectedWidgetRect(),e={left:t.left,top:t.top};this._correctPosition(e),t.left===e.left&&t.top===e.top||(this._widget.style.left=e.left+"px",this._widget.style.top=e.top+"px")}_determineCurrentLayoutVertical(t){const e=this._isVertical?t.height:t.width;return u()<e}_getWidget(){return this._widget}_findWrapperForWidget(t){const e=this._content.getElementsByClassName("js-widget");for(let i=0;i<e.length;++i){const s=e.item(i);if(s.contains(t))return s}return null}_onVerticalChanged(t,e){}_setHiddingTimeout(t){null!==this._hiddingTimeoutId&&clearTimeout(this._hiddingTimeoutId),this._hiddingTimeoutId=t}_preventWidgetTouchEndEvent(){const t=e=>{e.preventDefault(),this._widget.removeEventListener("touchend",t)};this._widget.addEventListener("touchend",t)}_updateLayoutType(){this._widget.classList.toggle("i-vertical",this._isVertical)}_updateAxisOption(){if(this._options.dragOnlyInsideToolbar){const t=this._isVertical?"y":"x";Object(c.lazyJqueryUI)(o()(this._content)).sortable("option","axis",t)}}_onWindowResize(){if("auto"===(this._options.layout||"auto")){const t=this._isVertical,e=this._getCorrectedWidgetRect();this._isVertical=this._determineCurrentLayoutVertical(e),this._updateLayoutType(),t!==this._isVertical&&(this._onVerticalChanged(this._isVertical,t),this._updateAxisOption())}this.checkPosition(),this._resizeResponsive()
}_resizeResponsive(){if(null===this._responsiveResizeFunction)return;let t=this._options.layout||"auto";"auto"===t&&(t=this._isVertical?"vertical":"horizontal");const e="vertical"===t?this._widget.clientHeight:this._widget.clientWidth,i=("vertical"===t?w():u())-e;this._responsiveResizeFunction(e,i,t)}_correctPosition(t){const e=this._getCorrectedWidgetRect();t.left+e.width>u()&&(t.left=Math.max(0,u()-e.width)),t.top+e.height>w()&&(t.top=Math.max(0,w()-e.height)),t.left=Math.max(0,t.left),t.top=Math.max(0,t.top)}_setZIndex(t){this._widget.style.zIndex=String(t)}_zIndex(){return Number(this._widget.style.zIndex)}_loadPosition(){let t;if("device"===this._options.positionStorageType){const e=p.TVLocalStorage.getItem(this._options.positionSettingsKey);t=null!==e?JSON.parse(e):this._options.defaultPosition}else t=Object(d.getJSON)(this._options.positionSettingsKey,this._options.defaultPosition);this._widget.style.left=Math.round(t.left)+"px",this._widget.style.top=Math.round(t.top)+"px",this._onWindowResize()}_savePosition(){const t=this._widget.getBoundingClientRect();if("device"===this._options.positionStorageType)try{p.TVLocalStorage.setItem(this._options.positionSettingsKey,JSON.stringify({left:t.left,top:t.top}))}catch(e){}else Object(d.setJSON)(this._options.positionSettingsKey,{left:t.left,top:t.top})}_init(){this._loadPosition(),Object(c.lazyJqueryUI)(o()(this._widget)).draggable({containment:"window",drag:this._onDragEvent.bind(this),handle:".js-drag",stop:this._savePosition.bind(this)}),this._options.allowSortable&&this._initSortable(),this._widget.addEventListener(Modernizr.mobiletouch?"touchstart":"mousedown",this.raise.bind(this))}_onDragEvent(t,e){this._correctPosition(e.position)}_initSortable(){let t=-1;Object(c.lazyJqueryUI)(o()(this._content)).sortable({start:(e,i)=>{t=i.item.index()},stop:(e,i)=>{const s=i.item.index();t!==s&&this._reorderedDelegate.fire(t,s)},tolerance:"pointer",distance:5,containment:!!this._options.dragOnlyInsideToolbar&&"parent",scroll:!1,placeholder:"sortable-placeholder",forcePlaceholderSize:!0}),this._updateAxisOption()}_getCorrectedWidgetRect(){const t=this._widget.getBoundingClientRect();if(this._widget.classList.contains("i-closed")){const e=1/.925-1,i=t.width*e,s=t.height*e;return{bottom:t.bottom+s/2,height:t.height+s,left:t.left-i/2,right:t.right+i/2,top:t.top-s/2,width:t.width+i}}return t}static _updateAllZIndexes(){W._toolbars.forEach((t,e)=>{t._setZIndex(W._startZIndex+e)})}}W._startZIndex=20,W._toolbars=[]},"69Qn":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var s=i("cZRT");class o extends s.a{_startLoading(){return Promise.all([i.e(382),i.e("hammerjs")]).then(i.bind(null,"be1f")).then(t=>t.HammerJS)}}},ADFN:function(t,e,i){},PwLo:function(t,e,i){},"m/4m":function(t,e,i){},my99:function(t,e,i){"use strict";i.d(e,"a",(function(){return r}));var s=i("Eyy1"),o=i("0ZwQ"),n=i("aIyQ"),d=i.n(n);i("m/4m"),i("ADFN");class r extends o.b{constructor(t){super(r._prepareOptions(t)),this._onWidgetStateChangedDelegate=new d.a,this._statedWidgets=[],
this._currentPopup=null,this._onWindowClickedListener=this._onWindowClicked.bind(this)}show(){super.show(),document.addEventListener("mousedown",this._onWindowClickedListener)}hide(t){super.hide(t),document.removeEventListener("mousedown",this._onWindowClickedListener)}destroy(){this._closePopup(),super.destroy()}addGroupedWidget(t,e={}){Object(s.assert)(t.states.length>0&&-1!==r._getStateIndexById(t,t.currentStateId),`Argument is invalid (count: ${t.states.length}, state: ${t.currentStateId})`);const i=document.createElement("div");i.className="tv-grouped-floating-toolbar__widget-wrapper apply-common-tooltip",t.widgetAddClass&&i.classList.add(t.widgetAddClass),i.setAttribute("title",t.tooltip);const o={isEnabled:!0,statedWidget:t,toolbarWidget:i},n=this._onWidgetClicked.bind(this,o);o.clickListener=n,i.addEventListener("click",n),this._updateWidgetPreview(o),this.addWidget(i,e),this._statedWidgets.push(o)}findGroupedWidget(t){const e=this._statedWidgets.length;for(let i=0;i<e;++i){if(this._statedWidgets[i].statedWidget.id===t)return i}return-1}removeGroupedWidget(t){const e=this._statedWidgets.length;for(let i=0;i<e;++i){const e=this._statedWidgets[i];if(e.statedWidget.id===t)return this._isPopupCreatedForWidget(t)&&this._closePopup(),void 0!==e.clickListener&&e.toolbarWidget.removeEventListener("click",e.clickListener),this.removeWidget(e.toolbarWidget),this._statedWidgets.splice(i,1),void this._updatePopupPosition()}Object(s.assert)(!1,`Unknown groupId(${t})`)}updateGroupedWidget(t,e){this._closePopup();const i=this._ensuredGetWidgetDataForId(t);i.statedWidget.currentStateId=e.currentStateId,i.statedWidget.states=e.states,this._updateWidgetPreview(i)}setGroupedWidgetEnabled(t,e){const i=this._ensuredGetWidgetDataForId(t);i.isEnabled=e,i.toolbarWidget.classList.toggle("i-disabled",!e)}setGroupedWidgetState(t,e){const i=this._ensuredGetWidgetDataForId(t);Object(s.assert)(-1!==r._getStateIndexById(i.statedWidget,e),`Unknown stateId (${e})`),i.statedWidget.currentStateId=e,this._updateSubWidgetsState(i.statedWidget),this._updateWidgetPreview(i)}onWidgetStateChanged(){return this._onWidgetStateChangedDelegate}_onVerticalChanged(t,e){this._updatePopupPosition()}_ensuredGetWidgetDataForId(t){for(const e of this._statedWidgets)if(e.statedWidget.id===t)return e;throw new Error(`Unknown groupId(${t})`)}_onWidgetClicked(t,e){const i=this._currentPopup&&this._isPopupCreatedForWidget(t.statedWidget.id);this._closePopup(),!i&&t.isEnabled&&this._createPopup(t)}_createPopup(t){const e={createdFor:t.toolbarWidget,element:document.createElement("div"),stateWidgetId:t.statedWidget.id,widgets:[]};e.element.className+="tv-grouped-floating-toolbar__popup js-popup";const i=t.statedWidget.states.length;t.statedWidget.states.forEach((s,o)=>{const n=this._createSubWidget(t,s),d=this._onSubWidgetClicked.bind(this,t,s.id);n.addEventListener("click",d),e.widgets.push({clickListener:d,stateWidget:s,widget:n}),n.classList.add("tv-grouped-floating-toolbar__sub-widget--slide-right-"+o),
n.classList.add("tv-grouped-floating-toolbar__sub-widget--slide-left-"+(i-o+1)),s.readonly||e.element.appendChild(n)}),this._currentPopup=e,this._updateSubWidgetsState(t.statedWidget),t.toolbarWidget.classList.add("i-dropped"),this._getWidget().appendChild(this._currentPopup.element),Promise.resolve().then(()=>{this._currentPopup&&this._currentPopup.element.classList.add("i-opened")}),this._updatePopupPosition()}_closePopup(){if(this._statedWidgets.forEach(t=>{t.toolbarWidget.classList.remove("i-dropped")}),!this._currentPopup)return;const t=this._currentPopup.widgets,e=this._currentPopup.element;this._currentPopup=null,t.forEach(t=>{t.widget.removeEventListener("click",t.clickListener)}),e.classList.remove("i-opened"),e.addEventListener("transitionend",t=>{t.target===e&&this._getWidget().removeChild(e)})}_updateWidgetPreview(t){const e=r._getStateIndexById(t.statedWidget,t.statedWidget.currentStateId);Object(s.assert)(-1!==e,"Unknown state id: "+t.statedWidget.currentStateId);const i=t.statedWidget.states[e].widget.cloneNode(!0);t.toolbarWidget.firstChild?t.toolbarWidget.replaceChild(i,t.toolbarWidget.firstChild):(t.toolbarWidget.appendChild(i),t.toolbarWidget.appendChild(r._createCaret()))}_updateSubWidgetsState(t){this._currentPopup&&this._isPopupCreatedForWidget(t.id)&&this._currentPopup.widgets.forEach(e=>{e.widget.classList.toggle(r._activeSubWidgetClass,e.stateWidget.id===t.currentStateId)})}_updatePopupPosition(){if(!this._currentPopup)return;const t=this._currentPopup.createdFor,e=this._getWidget().getBoundingClientRect(),i=this._findWrapperForWidget(t);if(!i||!this._currentPopup)throw new Error("Toolbar has no wrapper for preview's widget or there is no popup");const s=i.getBoundingClientRect(),o=this._currentPopup.element.getBoundingClientRect(),n=this._currentPopup.element;if(this.isVertical())n.classList.remove("tv-grouped-floating-toolbar__popup--at-top"),n.style.top=s.top-e.top+1+"px",n.style.left="",e.left>window.innerWidth-e.right?n.classList.add("tv-grouped-floating-toolbar__popup--at-left"):n.classList.remove("tv-grouped-floating-toolbar__popup--at-left");else{n.classList.remove("tv-grouped-floating-toolbar__popup--at-left");let t=0;s.left+o.width>window.innerWidth?e.left+o.width>window.innerWidth&&(t=e.width-o.width):t=s.left-e.left+1,n.style.left=t+"px",e.bottom+o.height>window.innerHeight?n.classList.add("tv-grouped-floating-toolbar__popup--at-top"):(n.classList.remove("tv-grouped-floating-toolbar__popup--at-top"),n.style.top="")}}_isPopupCreatedForWidget(t){return Boolean(this._currentPopup&&this._currentPopup.stateWidgetId===t)}_createSubWidget(t,e){const i=document.createElement("div");return i.className+="tv-grouped-floating-toolbar__sub-widget",t.statedWidget.stateWidgetAddClass&&i.classList.add(t.statedWidget.stateWidgetAddClass),i.appendChild(e.widget),i}_onSubWidgetClicked(t,e){this._closePopup(),t.statedWidget.currentStateId!==e&&(this.setGroupedWidgetState(t.statedWidget.id,e),this._onWidgetStateChangedDelegate.fire(t.statedWidget.id,e))}_onWindowClicked(t){
if(this.isVisible()&&this._currentPopup&&!r._isEventInElement(t,this._currentPopup.element)){for(let e=0;e<this._statedWidgets.length;++e)if(r._isEventInElement(t,this._statedWidgets[e].toolbarWidget))return;this._closePopup()}}static _getStateIndexById(t,e){for(let i=0;i<t.states.length;++i)if(t.states[i].id===e)return i;return-1}static _createCaret(){const t=document.createElement("div");return t.className="tv-caret tv-caret--small tv-caret--colored tv-grouped-floating-toolbar__caret",t}static _prepareOptions(t){return t.addClass?t.addClass+=" tv-grouped-floating-toolbar":t.addClass=" tv-grouped-floating-toolbar",t}static _isEventInElement(t,e){return t.target===e||e.contains(t.target)}}r._activeSubWidgetClass="tv-grouped-floating-toolbar__sub-widget--current"},qAO1:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 12" width="8" height="12" fill="currentColor"><rect width="2" height="2" rx="1"/><rect width="2" height="2" rx="1" y="5"/><rect width="2" height="2" rx="1" y="10"/><rect width="2" height="2" rx="1" x="6"/><rect width="2" height="2" rx="1" x="6" y="5"/><rect width="2" height="2" rx="1" x="6" y="10"/></svg>'}}]);