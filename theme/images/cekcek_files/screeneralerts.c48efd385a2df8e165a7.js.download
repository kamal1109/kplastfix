(window.webpackJsonp=window.webpackJsonp||[]).push([["screeneralerts"],{"4GqO":function(t,e,s){"use strict";s.r(e),function(t){s.d(e,"ScreenerAlertsListDialog",(function(){return h}));s("C66E"),s("P5fv");var i=s("YFKU"),r=s("9uLv"),l=s("tKRU"),n=s("hbEN"),a=s("aIyQ"),o=s.n(a);const d={table:`<table class="tv-screener-alerts-list-dialog__table tv-screener-alerts-list-dialog__table--space-bottom">\n\t\t<colgroup>\n\t\t\t<col span="2">\n\t\t\t<col width="160" class="i-collapsing">\n\t\t\t<col width="50">\n\t\t</colgroup>\n\t\t<thead>\n\t\t\t<tr>\n\t\t\t\t<th class="tv-screener-alerts-list-dialog__table-head">${Object(i.t)("Screen")}</th>\n\t\t\t\t<th class="tv-screener-alerts-list-dialog__table-head">${Object(i.t)("Symbols")}</th>\n\t\t\t\t<th class="tv-screener-alerts-list-dialog__table-head i-collapsing">${Object(i.t)("Fired")}</th>\n\t\t\t\t<th class="tv-screener-alerts-list-dialog__table-head">&nbsp;</th>\n\t\t\t</tr>\n\t\t</thead>\n\t\t<tbody class="js-rows-container"></tbody>\n\t</table>`,row:`<tr data-id="{{id}}" data-alert-id="{{alert_id}}" class="tv-screener-alerts-list-dialog__row js-item-row{{#new_item}} js-new-item{{/new_item}}">\n\t\t<td class="tv-screener-alerts-list-dialog__table-cell">\n\t\t\t<div class="tv-screener-alerts-list-dialog__table-cell-wrap apply-overflow-tooltip apply-overflow-tooltip--allow-text"><span data-filter="{{filter_set_id}}" data-market="{{market}}" class="tv-screener-alerts-list-dialog__link js-filter">{{filter_name}}</span></div>\n\t\t</td>\n\t\t<td class="tv-screener-alerts-list-dialog__table-cell">\n\t\t\t<div class="tv-screener-alerts-list-dialog__table-cell-wrap apply-overflow-tooltip apply-overflow-tooltip--allow-text">{{#symbols}}<span\n\t\t\t\tdata-symbol="{{full}}" class="tv-screener-alerts-list-dialog__link js-symbol">{{short}}</span>{{^last}}, {{/last}}{{/symbols}}\n\t\t\t</div>\n\t\t</td>\n\t\t<td class="tv-screener-alerts-list-dialog__table-cell i-collapsing">\n\t\t\t<div class="tv-screener-alerts-list-dialog__table-cell-wrap">{{fired}}</div>\n\t\t</td>\n\t\t<td class="tv-screener-alerts-list-dialog__table-cell">\n\t\t\t<div class="tv-screener-alerts-list-dialog__alert-controls">\n\t\t\t\t<span class="tv-screener-alerts-list-dialog__alert-controls-icon tv-screener-alerts-list-dialog__alert-controls-icon--settings js-icon-edit apply-common-tooltip" title="${Object(i.t)("Edit Alert Settings")}">\n\t\t\t\t\t${s("f7DG")}\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</td>\n\t</tr>`},c={title:Object(i.t)("Alerts Log"),width:600,contentWrapTemplate:d.table,closeOnOutsideClick:!1,closeOnClickAtOtherDialogs:!1,destroyOnClose:!0};class h extends l.a{constructor(t={}){super(Object.assign(Object.assign({},c),t)),this.symbolClick=new o.a,this.editClick=new o.a,this.filterClick=new o.a,this.$rowsContainer=this.$content.find(".js-rows-container"),this.$rowsContainer.on("click",".js-icon-edit",t=>{const e=$(t.currentTarget).closest(".js-item-row"),s=+e.attr("data-id"),i=e.attr("data-alert-id");this.editClick.fire(s,i,"alerts_log_edit_button")}).on("click",".js-symbol",t=>{
this.symbolClick.fire($(t.currentTarget).data("symbol"))}).on("click",".js-filter",t=>{this.filterClick.fire(String($(t.currentTarget).data("filter")),$(t.currentTarget).data("market"))}),this.updateView=Object(n.default)(()=>{this.calcHeight(),this.fixPos()},0)}clearRows(){this.$rowsContainer.empty()}addRows(t){if(this.removeEmptyStub(),!this.opened&&t.length>100){const e=t.slice(),s=e.splice(100,1/0);return this._appendRows(e),this.updateView(),new Promise(t=>{this.once("afterOpen",()=>{this._appendRows(s),t()})})}return this._appendRows(t),this.updateView(),Promise.resolve()}hasRow(t){return!!this.$rowsContainer.find(`[data-id="${t}"]`).size()}highlightNew(){const t=this.$rowsContainer.find(".js-new-item");t.size()&&(t.removeClass("js-new-item").addClass("tv-screener-alerts-list-dialog__row--highlighted"),setTimeout(()=>t.removeClass("tv-screener-alerts-list-dialog__row--highlighted"),r.dur))}setEmptyStub(){this.$content.addClass("js-hidden"),$('<div class="tv-screener-alerts-list-dialog__empty-stub js-empty-stub">').text(Object(i.t)("No alerts triggered")).insertAfter(this.$content)}removeEmptyStub(){this.$el.find(".js-empty-stub").remove(),this.$content.removeClass("js-hidden")}_appendRows(e){let s="";for(let i=0;i<e.length;++i){const r=Object.assign({},e[i]);Array.isArray(r.symbols)&&(r.symbols=r.symbols.slice(),r.symbols[r.symbols.length-1].last=!0),s+=t.render(d.row,r)}this.$rowsContainer.get(0).insertAdjacentHTML("beforeend",s)}}}.call(this,s("nbsC"))},C66E:function(t,e,s){},"H/u5":function(t,e,s){"use strict";s.r(e),s.d(e,"ALERT_STATUS",(function(){return g})),s.d(e,"ScreenerAlerts",(function(){return _}));var i=s("8V2A"),r=s("j72q"),l=s("7Ut2");const{environment:n}=s("Wt0y"),{ScreenerAlertsView:a}=s("ZkcK"),{ScreenerAlertsDispatcher:o}=s("CoNv"),d=s("aIyQ"),{getLogger:c}=s("txPx"),h=c("Alerts.Screener"),g={NEW:"new",RESTART:"restart"};class _{constructor(t,e){this._bridge=t,this._model=e,this.alertsUpdated=new d,this.eventsUpdated=new d,this.currentAlertStateChange=new d,this.currentAlertLoading=new d,this.alertChanged=new d,this.alertStarted=new d,this._view=new a(t,this),this._view.editAlertTrigger.subscribe(this,this.onEditAlertTrigger),this.initDispatcher(),this.init(),"battle"!==n()&&(window._exposed_screenerAlerts=this)}initDispatcher(){this._dispatcher=new o,this._dispatcher.setFilterTitleGetter(t=>this.getFilterTitle(t)),this._dispatcher.setScannerParamsGetter(t=>this._getFilterScannerParams(t))}init(){const t=()=>{this._screenerReady=new Promise(t=>{this._model.loadingComplete.subscribe(null,()=>t(),!0)})};this._model.loadingStart.subscribe(null,t),t();const e=()=>{this.ready=this._screenerReady.then(()=>this._dispatcher.loading).catch(t=>h.logError(t&&t.message||$.t("Unknown Error")))};window.loginStateChange&&window.loginStateChange.subscribe(null,e),e(),this._model.filterSetChanged.subscribe(this,this.onFilterSetChanged),this.onFilterSetChanged(),this._model.filterSetDeleted.subscribe(this,this.onFilterSetDeleted),this._model.filterSetSaved.subscribe(this,this.onFilterSetSaved),
this._dispatcher.alerts.itemsChanged.subscribe(null,()=>this.onAlertsUpdated()),this._dispatcher.alerts.itemsUpdated.subscribe(null,()=>this.onAlertsUpdated()),this._dispatcher.events.itemsChanged.subscribe(null,()=>this.eventsUpdated.fire())}onAlertsUpdated(){const t=this.getCurrentAlert();this.setCurrentAlertState(t&&t.state||"absent"),this.alertsUpdated.fire()}onFilterSetChanged(t){this.ready.then(()=>{t||(t=this._bridge.getCurrentFilterSetId());const e=this._dispatcher.alerts.getByFilterSetId(t,this._model.market)[0];this.setCurrentAlertState(e&&e.state||"absent"),this.alertChanged.fire()}).catch(t=>h.logError(t&&t.message||$.t("Unknown Error")))}onFilterSetSaved(t,e,s=!1){const i=this._model.getFilterSetById(t),r=this._dispatcher.alerts.getByFilterSetId(t,e);if(r&&r.length){const e=r[0];let l=null;if(i.title!==e.params.filterTitle&&(e.params.filterTitle=i.title,s||(l=this._dispatcher.saveAlert(e.id))),s){const s=this._getFilterScannerParams(t);s?(e.params.scannerParams=s,l=this._dispatcher.cloneAlert(e.id)):h.logError("Unable to get scanner params for filter with id "+t)}l&&l.catch(t=>h.logError(t&&t.message||t||"Unknown Error"))}else this.setCurrentAlertState("absent")&&this.alertChanged.fire()}onFilterSetDeleted(t){const e=this._dispatcher.alerts.getByFilterSetId(t).map(t=>t.id);e.length&&this._dispatcher.deleteAlerts(e).catch(t=>h.logError(t&&t.message||$.t("Unknown Error")))}onEditAlertTrigger(t,e){if(t)this._dispatcher.showEditAlertDialog(t,e);else{const t=this._bridge.getCurrentFilterSetId(),s=t&&this._dispatcher.alerts.getByFilterSetId(t,this._model.market)[0];if(s)this._dispatcher.showEditAlertDialog(s.id,e);else if(!this._model.showNoticeIfNoFilters(t)){const s=this._dispatcher.showCreateAlertDialog(t,e,!0,Object(i.c)(this._model.selectedIntervalId));if(!s)return;s.then(()=>{this._emitAlertStartStatusAfterSubmit(g.NEW),this._emitCurrentAlertLoadingAfterSubmit()})}}}_getFilterScannerParams(t){const e=this._model.getScannerParams(t);return e&&(e.country=this._model.market),e}setCurrentAlertState(t){return this._currentAlertState!==t&&(this.currentAlertStateChange.fire(t),this._currentAlertState=t,!0)}getFilterTitle(t){const e=this._model.getFilterSetById(t);return e&&e.title||null}getFilterSetIdsWithRunningAlerts(){return this._dispatcher.alerts.getRunning().filter(t=>t.filterSetId&&t.params.scannerParams.country===this._model.market).map(t=>t.filterSetId)}getCurrentAlert(){const t=this._bridge.getCurrentFilterSetId();return t&&this._dispatcher.alerts.getByFilterSetId(t,this._model.market)[0]}toggleAlert(t,e){const s=this._bridge.getCurrentFilterSetId()===t,n=this._dispatcher.alerts.getByFilterSetId(t,this._model.market)[0];if(n)if("running"===n.state)this._dispatcher.stopAlert(n.id),Object(r.e)(new l.c(e)),s&&this.currentAlertLoading.fire();else{const t=this._dispatcher.showEditAlertDialog(n.id,e,!0);if(!t)return;t.then(()=>{this._emitAlertStartStatusAfterSubmit(g.RESTART),s&&this._emitCurrentAlertLoadingAfterSubmit()})}else{if(this._model.showNoticeIfNoFilters(t))return
;const r=this._dispatcher.showCreateAlertDialog(t,e,!0,Object(i.c)(this._model.selectedIntervalId));if(!r)return;r.then(()=>{this._emitAlertStartStatusAfterSubmit(g.NEW),s&&this._emitCurrentAlertLoadingAfterSubmit()})}}_emitCurrentAlertLoadingAfterSubmit(){this._dispatcher.getDialogSubmitDelegate().subscribe(null,()=>this.currentAlertLoading.fire(),!0)}_emitAlertStartStatusAfterSubmit(t){this._dispatcher.getDialogSubmitDelegate().subscribe(null,()=>this.alertStarted.fire(t),!0)}get dispatcher(){return this._dispatcher}get view(){return this._view}}},ZkcK:function(t,e,s){"use strict";s.r(e),s.d(e,"ScreenerAlertsView",(function(){return c}));var i=s("hbEN"),r=s("j72q"),l=s("7Ut2");const{ScreenerAlertsListDialog:n}=s("4GqO"),{appendEllipsis:a}=s("2uTr"),o=s("aIyQ"),d={ctl_dropdown:`\n\t\t<div class="tv-dropdown-behavior__item">\n\t\t\t<div class="tv-control-select__option-wrap tv-screener-popup__item js-alert-settings">${a($.t("Edit Alert Settings"))}</div>\n\t\t</div>\n\t\t<div class="tv-dropdown-behavior__item">\n\t\t\t<div class="tv-control-select__option-wrap tv-screener-popup__item js-alerts-log">${a($.t("Alerts Log"))}</div>\n\t\t</div>\n\t`};class c{constructor(t,e){this._bridge=t,this._bridge.getAlertsCtlDropdownContent=()=>this.getCtlDropdownContent(),this._model=e,this.editAlertTrigger=new o,this.setupCtlDropdownContentUpdate(),this._model.eventsUpdated.subscribe(this,this.updateEventsLogDialogContent)}reset(){this._eventsLogDialog&&(this._eventsLogDialog.close(),delete this._eventsLogDialog),delete this.$ctlContent}setupCtlDropdownContentUpdate(){const t=Object(i.default)(()=>this.updateCtlDropdownContent(),300);this._model.currentAlertStateChange.subscribe(this,t),this._model.alertChanged.subscribe(this,t),this._model.alertsUpdated.subscribe(this,t)}getCtlDropdownContent(){return this.$ctlContent||(this.$ctlContent=$(d.ctl_dropdown),this.$ctlContent.on("click",".js-alert-settings",t=>{const e=$(t.currentTarget).attr("data-name");this.editAlertTrigger.fire(void 0,e),this.$ctlContent.trigger("close")}).on("click",".js-alerts-log",t=>{Object(r.e)(new l.e),this.showEventsLogDialog(),this.$ctlContent.trigger("close")})),this.$ctlContent}updateCtlDropdownContent(){const t=this.getCtlDropdownContent().find(".js-alert-settings");this._model.getCurrentAlert()?this.updateDropdownAttributes(t,$.t("Edit Alert Settings"),"edit_alert_selector"):this.updateDropdownAttributes(t,$.t("Enable Alert"),"enable_alert_selector")}updateDropdownAttributes(t,e,s){t.text(a(e)),t.attr({"data-name":s})}showEventsLogDialog(){this._eventsLogDialog=new n,this._eventsLogDialog.editClick.subscribe(null,(t,e,s)=>{this.editAlertTrigger.fire(+e,s),this._eventsLogDialog.close()}),this._eventsLogDialog.symbolClick.subscribe(null,t=>this._bridge.applySymbol(t)),this._eventsLogDialog.filterClick.subscribe(null,(t,e)=>{this._ignoreFilterClick||(this._ignoreFilterClick=!0,this._bridge.applyFilterSet(t,e).then(()=>{delete this._ignoreFilterClick}))}),this.updateEventsLogDialogContent(!0),this._eventsLogDialog.open(),
this._eventsLogDialog.on("beforeClose",()=>{delete this._eventsLogDialog})}updateEventsLogDialogContent(t){if(!this._eventsLogDialog)return;const e=this._model.dispatcher.events.toArray(),s=[];for(let i=e.length;i--;){const r=e[i];s.push({id:r.id,alert_id:r.alertId,market:r.params.scannerParams.country,filter_set_id:r.params.filterSetId,filter_name:r.params.filterTitle||$.t("Screen"),symbols:r.symbols.map(t=>({full:t,short:t.replace(/^[^:]+:/,"")})),fired:`${r.fired.toLocaleDateString()} ${r.fired.toLocaleTimeString()}`,new_item:!0!==t&&!this._eventsLogDialog.hasRow(r.id)})}this._eventsLogDialog.clearRows(),s.length?this._eventsLogDialog.addRows(s).then(()=>{!0!==t&&this._eventsLogDialog.highlightNew()}):this._eventsLogDialog.setEmptyStub()}}},f7DG:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><path fill-rule="evenodd" d="M0 2.006C0 .898.897 0 2.006 0h9.988C13.102 0 14 .897 14 2.006v9.988A2.005 2.005 0 0 1 11.994 14H2.006A2.005 2.005 0 0 1 0 11.994V2.006zm11.119 4.28s-.357 0-.452-.334a3.415 3.415 0 0 0-.334-.81c-.143-.309.096-.547.096-.547l.357-.357c.143-.143.143-.38 0-.548l-.476-.476c-.143-.143-.381-.143-.548 0l-.357.357s-.238.239-.548.096a3.415 3.415 0 0 0-.81-.334c-.333-.095-.333-.452-.333-.452v-.5A.376.376 0 0 0 7.334 2h-.667a.376.376 0 0 0-.381.381v.5s0 .357-.334.452c-.285.072-.547.19-.81.334-.309.143-.547-.096-.547-.096l-.357-.357c-.143-.143-.38-.143-.548 0l-.476.476c-.143.143-.143.381 0 .548l.357.357s.239.238.096.548a3.415 3.415 0 0 0-.334.81c-.095.309-.452.333-.452.333h-.5a.376.376 0 0 0-.381.38v.667c0 .215.167.381.381.381h.5s.357 0 .452.334c.072.285.19.547.334.81.143.309-.096.547-.096.547l-.357.357c-.143.143-.143.38 0 .548l.476.476c.143.143.381.143.548 0l.357-.357s.238-.239.548-.096c.262.143.524.262.81.334.309.095.333.452.333.452v.5c0 .214.166.381.38.381h.667a.376.376 0 0 0 .381-.381v-.5s0-.357.334-.452c.285-.072.547-.19.81-.334.309-.143.547.096.547.096l.357.357c.143.143.38.143.548 0l.476-.476c.143-.143.143-.381 0-.548l-.357-.357s-.239-.238-.096-.548c.143-.262.262-.524.334-.81.095-.309.452-.333.452-.333h.5a.376.376 0 0 0 .381-.38v-.667a.376.376 0 0 0-.381-.381h-.5zM7 9c-1.111 0-2-.889-2-2s.889-2 2-2 2 .889 2 2-.906 2-2 2z"/></svg>'},nec0:function(t,e,s){},uo4K:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 13" width="13" height="13"><path fill="currentColor" d="M5.18 6.6L1.3 2.7.6 2 2 .59l.7.7 3.9 3.9 3.89-3.9.7-.7L12.61 2l-.71.7L8 6.6l3.89 3.89.7.7-1.4 1.42-.71-.71L6.58 8 2.72 11.9l-.71.7-1.41-1.4.7-.71 3.9-3.9z"/></svg>'}}]);