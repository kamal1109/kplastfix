(window.webpackJsonp=window.webpackJsonp||[]).push([["trading","username-hints-list"],{"+xnd":function(e,t,i){"use strict";var r;i.d(t,"a",(function(){return r})),function(e){e.Default="default",e.Success="success",e.Warning="warning",e.Danger="danger"}(r||(r={}))},"/BH3":function(e,t,i){"use strict";i.r(t),i.d(t,"layoutKeyName",(function(){return r})),i.d(t,"getDefaultState",(function(){return s})),i.d(t,"tabsWidth",(function(){return n})),i.d(t,"hiderGapWidth",(function(){return o})),i.d(t,"borderWidth",(function(){return a}));const r="layout-settings";function s(){return{version:2,width:267,pages:[]}}const n=46,o=5,a=1},"02pg":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("q1tI"),s=i("TSYQ"),n=i("XiJV");function o(e){return r.createElement("div",{className:s(n.separator,e.className)})}},"0YJI":function(e,t,i){e.exports={wrapper:"wrapper-2z87uQR_",button:"button-2z87uQR_"}},"0rc0":function(e,t,i){"use strict";i.d(t,"u",(function(){return m})),i.d(t,"h",(function(){return g})),i.d(t,"x",(function(){return v})),i.d(t,"o",(function(){return f})),i.d(t,"j",(function(){return y})),i.d(t,"b",(function(){return w})),i.d(t,"c",(function(){return k})),i.d(t,"d",(function(){return B})),i.d(t,"e",(function(){return P})),i.d(t,"f",(function(){return C})),i.d(t,"k",(function(){return S})),i.d(t,"l",(function(){return T})),i.d(t,"a",(function(){return E})),i.d(t,"s",(function(){return N})),i.d(t,"m",(function(){return L})),i.d(t,"n",(function(){return j})),i.d(t,"p",(function(){return A})),i.d(t,"q",(function(){return I})),i.d(t,"t",(function(){return D})),i.d(t,"g",(function(){return V})),i.d(t,"v",(function(){return M})),i.d(t,"r",(function(){return x})),i.d(t,"i",(function(){return R})),i.d(t,"w",(function(){return q}));var r=i("YFKU"),s=i("PT1i"),n=i("nDsj"),o=i("nc0P"),a=i("ivNn"),l=i("hY0g"),c=i.n(l),d=i("ogJP"),u=i("EBrf"),h=i("nEwK"),p=i("j0sD"),_=i("aIyQ"),b=i.n(_);function m(e){const t=new n.BehaviorSubject(e.value()),i=e=>{t.next(e)};return e.subscribe(i),{subject:t,unsubscribe:()=>e.unsubscribe(i)}}function g(e,t){return Object(d.deepEquals)(e,t)[0]}function v(e){return void 0!==e&&Boolean(e.showTotal)}function f(e){return e<1?Math.abs(Math.floor(Math.log10(e))):2}function y(e,t){if(void 0!==e)return e;if(void 0!==t){const e=Math.round(1/t);return String(e)+":1"}return null}function w(e,t,i){return null!==e?(void 0!==i?e*i:e)*t:0}function k(e,t,i,r,s){return B(e,t,i/r,s)}function B(e,t,i,r){return e*t*i*(r||1)}function P(e,t){return void 0!==t?e*t:0}function C(e,t){const i=0!==t?100*e/t:0;return i>100?100:i}function S(e){if("number"==typeof e){const t=Object(u.splitThousands)((e||0).toFixed(2)," ");return Number.isInteger(e)||e>=1?t:function(e){if(Number.isInteger(e))return e+"";return e<1?function(e){const t=(e+"").split(".")[1]||"";let i=t.length;for(let r=0;r<t.length;r++)if("0"!==t[r]){i=r+1;break}return e.toFixed(i)}(e):e.toFixed(2)}(e)}return Object(u.splitThousands)(e," ")}const O=new h.VolumeFormatter(2);function T(e,t){return null!==e&&null!==t&&e/t>0?O.format(e/t):""}
function E(e,t){const i=Object.assign({},e);return["trade","ask","bid"].forEach(e=>{const r=i[e];void 0!==r&&(i[e]=function(e,t){return t>1?e:Object(a.fixComputationError)(Math.round(e/t)*t)}(r,t))}),i}function N(e,t){if(0===t)return!1;const i=Object(a.fixComputationError)(t),r=new o.Big(e),s=new o.Big(i);return r.mod(s).eq(0)}function L(e){return Object(d.isNumber)(e.ask)?e.ask:Object(d.isNumber)(e.trade)?e.trade:0}function j(e){return Object(d.isNumber)(e.bid)?e.bid:Object(d.isNumber)(e.trade)?e.trade:0}function A(e){return Object(d.isNumber)(e.trade)?e.trade:0}function I(e,t){return 1===e?L(t):j(t)}function D(e){return null===e||void 0===e.ask||void 0===e.bid}function V(e,t,i){return 4===e?null===t||null===i:3===e?null===i:null===t}function M(e,t){switch(t){case p.b.IncDec:return e<0?"-":"+";case p.b.PlusValue:return String(e);case p.b.Clear:return"Clear";default:return"Default"}}const x={buy:{market:(e,t)=>window.t("Buy {qty} {symbol}{whitespaceNoBreak}MKT").format({qty:e,symbol:t,whitespaceNoBreak:" "}),stop:(e,t,i)=>window.t("Buy {qty} {symbol}{whitespaceNoBreak}@ {stopPrice}{whitespaceNoBreak}STP").format({qty:e,symbol:t,stopPrice:i,whitespaceNoBreak:" "}),limit:(e,t,i)=>window.t("Buy {qty} {symbol}{whitespaceNoBreak}@ {limitPrice}{whitespaceNoBreak}LMT").format({qty:e,symbol:t,limitPrice:i,whitespaceNoBreak:" "}),stopLimit:(e,t,i,r)=>window.t("Buy {qty} {symbol}{whitespaceNoBreak}@ {stopPrice}{whitespaceNoBreak}STP {limitPrice}{whitespaceNoBreak}LMT").format({qty:e,symbol:t,stopPrice:i,limitPrice:r,whitespaceNoBreak:" "})},sell:{market:(e,t)=>window.t("Sell {qty} {symbol}{whitespaceNoBreak}MKT").format({qty:e,symbol:t,whitespaceNoBreak:" "}),stop:(e,t,i)=>window.t("Sell {qty} {symbol}{whitespaceNoBreak}@ {stopPrice}{whitespaceNoBreak}STP").format({qty:e,symbol:t,stopPrice:i,whitespaceNoBreak:" "}),limit:(e,t,i)=>window.t("Sell {qty} {symbol}{whitespaceNoBreak}@ {limitPrice}{whitespaceNoBreak}LMT").format({qty:e,symbol:t,limitPrice:i,whitespaceNoBreak:" "}),stopLimit:(e,t,i,r)=>window.t("Sell {qty} {symbol}{whitespaceNoBreak}@ {stopPrice}{whitespaceNoBreak}STP {limitPrice}{whitespaceNoBreak}LMT").format({qty:e,symbol:t,stopPrice:i,limitPrice:r,whitespaceNoBreak:" "})}};function R(e,t,i,r){const s=[];return void 0!==i&&Array.isArray(i.customFields)&&i.customFields.forEach(i=>{if("TextWithCheckBox"===i.inputType&&s.push({id:i.id,type:i.inputType,inputType:i.customInfo.asterix?"password":"text",placeholder:i.placeHolder||"",title:i.title||"",checkboxTitle:i.customInfo.checkboxTitle,text:new c.a(i.value.text),checked:new c.a(i.value.checked),status:t,onControlFocused:new b.a}),"ComboBox"===i.inputType&&Array.isArray(i.items)){let t=i.items[0];const n=i.id;if(r&&n in r){const e=r[n],s=i.items.find(t=>t.value===e);void 0!==s&&(t=s)}s.push({id:i.id,type:i.inputType,title:i.title,items:i.preventModify&&e?[t]:i.items,selectedItem:new c.a(t.value),onControlFocused:new b.a,saveToSettings:i.saveToSettings})}}),s}async function q(e,t){if(void 0!==e.solutions){let i,n;if("changeSymbol"in e.solutions){
const t=e.solutions.changeSymbol;i=Object(r.t)("Switch the symbol"),n=()=>s.linking.symbol.setValue(t)}else{const s=e.solutions.changeAccount,o=(await t.accountsMetainfo()).filter(e=>e.id===s)[0].name;i=Object(r.t)("Switch to {accountName}").replace("{accountName}",o),n=()=>t.setCurrentAccount(s)}return{title:i,apply:n}}}},"29EA":function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var r=i("q1tI"),s=i.n(r),n=i("TSYQ"),o=i.n(n),a=i("Iivm"),l=i("OZBO"),c=i("zztK"),d=i("px1m");function u(e){const{title:t,subtitle:i,showCloseIcon:n=!0,onClose:u,renderBefore:h,renderAfter:p,draggable:_,className:b,unsetAlign:m}=e,[g,v]=Object(r.useState)(!1);return s.a.createElement(l.a.Provider,{value:{setHideClose:v}},s.a.createElement("div",{className:o()(d.container,b,(i||m)&&d.unsetAlign)},h,s.a.createElement("div",{"data-dragg-area":_,className:d.title},s.a.createElement("div",{className:d.ellipsis},t),i&&s.a.createElement("div",{className:o()(d.ellipsis,d.subtitle)},i)),p,n&&!g&&s.a.createElement(a.a,{className:d.close,icon:c,onClick:u,"data-name":"close","data-role":"button"})))}},"2Ekt":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("Eyy1"),s=i("4qhP");async function n(e){const t=e.brokersList().filter(e=>!e.configFlags.isSuspended).length>=2?e.brokersPlans():Promise.resolve(void 0),i=Object(r.ensureNotNull)(e.activeBroker()),n=await t,o=await i.accountsMetainfo(),a=i.accountManagerInfo();if(0===o.length)return;const l=o.map(e=>{var t;return{id:e.id,name:e.name,callBack:async()=>{e.id!==i.currentAccount()&&i.setCurrentAccount(e.id)},currency:""===e.currency?void 0:null!==(t=e.currency)&&void 0!==t?t:void 0}}),c=l.find(e=>e.id===i.currentAccount()),d=i.metainfo();return{brokerDropdownProps:void 0===n?void 0:{title:a.accountTitle,brokerName:d.title,logo:d.logoMiniUrl,logoBlack:d.logoMiniBlackUrl,actions:i.buttonDropdownActions(),trading:e,brokers:Object(s.b)(e.brokersList(),n).filter(e=>!e.metainfo.configFlags.isSuspended)},accountDropdownProps:{currentAccount:Object(r.ensureDefined)(c),accountsList:l,currentAccountUpdate:i.currentAccountUpdate}}}},"2TBc":function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("Eyy1");class s{constructor(e){this._activeBroker=null,this._trading=e,this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange),this._onStatusChange(this._trading.connectStatus())}activeBroker(){return this._activeBroker}trading(){return this._trading}_stopService(){this.stopService(),Object(r.ensureNotNull)(this._activeBroker).currentAccountUpdate.unsubscribeAll(this)}_startService(){this.startService(),Object(r.ensureNotNull)(this._activeBroker).currentAccountUpdate.subscribe(this,this._onCurrentAccountUpdate)}_onStatusChange(e){const t=this._trading.activeBroker();this._activeBroker===t&&1===e||(null!==this._activeBroker&&(this._stopService(),this._activeBroker=null),null!==t&&1===e&&(this._activeBroker=t,this._startService(),this._lastAccountId=t.currentAccount()))}_onCurrentAccountUpdate(){const e=Object(r.ensureNotNull)(this._activeBroker)
;this._lastAccountId!==e.currentAccount()&&(this.stopService(),this.startService(),this._lastAccountId=e.currentAccount())}}},"4hvi":function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var r=i("YFKU"),s=i("zM7N"),n=i("oiZD"),o=i("0rc0"),a=i("dct7"),l=i("D/08");async function c(e){var t;const{isTradableResult:c,activeBroker:d}=e,u=await Object(o.w)(c,d),[{showSimpleDialog:h},{SimpleConfirmDialog:p}]=await Promise.all([Promise.all([i.e("vendors"),i.e(0),i.e(2),i.e(6),i.e(7),i.e(9),i.e(11),i.e(12),i.e(13),i.e(15),i.e(22),i.e(28),i.e(71),i.e(216),i.e(286),i.e(416),i.e(531),i.e(8),i.e(10),i.e(188),i.e(330),i.e("create-confirm-dialog")]).then(i.bind(null,"EcUf")),Promise.all([i.e("vendors"),i.e(0),i.e(2),i.e(6),i.e(7),i.e(9),i.e(11),i.e(12),i.e(13),i.e(15),i.e(22),i.e(28),i.e(71),i.e(216),i.e(286),i.e(416),i.e(531),i.e(8),i.e(10),i.e(188),i.e(330),i.e("create-confirm-dialog")]).then(i.bind(null,"Hc1a"))]);h({text:null!==(t=c.reason)&&void 0!==t?t:Object(r.t)("Symbol cannot be traded"),title:Object(r.t)("Non-tradable symbol"),titleIcon:n.watchedTheme.value()===s.StdTheme.Light?a:l,mainButtonText:void 0!==u?u.title:Object(r.t)("Ok"),mainButtonIntent:"primary",showCancelButton:!1,onConfirm:e=>{void 0!==u&&u.apply(),e.dialogClose()}},p)}},"6aj4":function(e,t,i){e.exports={"trading-panel-content":"trading-panel-content-3q5skKoi","trading-panel-spinner":"trading-panel-spinner-3q5skKoi","trading-panel-handle":"trading-panel-handle-3q5skKoi"}},"79vt":function(e,t,i){e.exports={container:"container-113jHcZc",content:"content-113jHcZc",arrowHolder:"arrowHolder-113jHcZc","arrowHolder--below":"arrowHolder--below-113jHcZc","arrowHolder--above":"arrowHolder--above-113jHcZc","arrowHolder--before":"arrowHolder--before-113jHcZc","arrowHolder--after":"arrowHolder--after-113jHcZc","arrowHolder--above-fix":"arrowHolder--above-fix-113jHcZc","arrowHolder--before-rtl-fix":"arrowHolder--before-rtl-fix-113jHcZc","arrowHolder--after-ltr-fix":"arrowHolder--after-ltr-fix-113jHcZc",label:"label-113jHcZc",closeButton:"closeButton-113jHcZc"}},"8Rai":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("q1tI"),s=i("efOF"),n=i("R5JZ");function o(e){const{click:t,mouseDown:i,touchEnd:o,touchStart:a,handler:l,reference:c,ownerDocument:d=document}=e,u=Object(r.useRef)(null),h=Object(r.useRef)(new s.a("timestamp").timeStamp);return Object(r.useLayoutEffect)(()=>{const e={click:t,mouseDown:i,touchEnd:o,touchStart:a},r=c?c.current:u.current;return Object(n.a)(h.current,r,l,d,e)},[t,i,o,a,l]),c||u}},"9pog":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("zXvd");const s=["","K","M","G","T","Y"];function n(e){if(e<1)return r.NumericFormatter.formatNoE(e);let t=0,i=+e;if(isFinite(i))for(;i>=1e3&&i%100==0;)t++,i/=1e3;return i+(t<s.length?s[t]:"e"+3*t)}},"D/08":function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#363A45" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#1E222D" stroke="#B2B5BE" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#B2B5BE" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#B2B5BE" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#B2B5BE" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},DhHm:function(e,t,i){"use strict";i.r(t);i("YFKU");var r=i("i8i4"),s=i("q1tI"),n=i.n(s),o=i("pB43"),a=i("I7VN");function l(e){const{rootReference:t,onClose:i,placement:r}=e;return n.a.createElement(a.Popper,{placement:r||"top",positionFixed:!0,referenceElement:t,modifiers:{offset:{offset:"0, 5"},preventOverflow:{boundariesElement:"viewport"}}},t=>n.a.createElement(o.b,{popperChildrenProps:t,onClose:i},e.children))}var c,d=i("oj21"),u=i("8Rai"),h=i("0YJI");function p(e){const t=Object(u.a)({mouseDown:!0,touchStart:!0,handler:e.hide});return s.createElement("div",{className:h.wrapper,ref:t},e.text,e.action&&s.createElement(d.a,{className:h.button,onClick:e.action.action},e.action.text))}i.d(t,"TradingWizardHintType",(function(){return c})),i.d(t,"TradingToolipRenderer",(function(){return b})),function(e){e[e.NeedBrokerSignIn=0]="NeedBrokerSignIn",e[e.NeedSignIn=1]="NeedSignIn",e[e.AboutFavoritesBrokers=2]="AboutFavoritesBrokers"}(c||(c={}));const _={loginAttention:window.t("Log into your broker account to start trading"),needSignIn:window.t("To connect your broker account you have to log in TradingView account first or create new account for free"),aboutFavoritesBrokers:window.t("You can easily switch between brokers or logout from this menu")};class b{constructor(){this._wrap=document.createElement("div"),this.hide=()=>{r.unmountComponentAtNode(this._wrap)}}show(e,t,i,n){this.hide();r.render(s.createElement(l,{rootReference:e,onClose:i?void 0:()=>{this.hide()},placement:n},this._generateHintContent(t,i)),this._wrap)}destroy(){this.hide()}
_generateHintContent(e,t){let i="";switch(e){case c.NeedSignIn:i=_.needSignIn;break;case c.NeedBrokerSignIn:i=_.loginAttention;break;case c.AboutFavoritesBrokers:i=_.aboutFavoritesBrokers}return s.createElement(p,{hide:this.hide,text:i,action:t})}}},End0:function(e,t,i){"use strict";i.r(t);i("bSeV");var r=i("YFKU"),s=i("Eyy1"),n=i("ivNn"),o=i("Hgre"),a=i("JES+"),l=i("8wgr"),c=i("U/Is"),d=i("aIyQ"),u=i.n(d),h=i("txPx"),p=i("5kf6");const _=Object(h.getLogger)("Trading.RealtimeProvider");class b{constructor(e){this._results={},this._getter=e}get(e){return this._results[e]||(this._results[e]=this._getter(e)),this._results[e]}}class m{constructor(e,t,i,r,s){this._stopped=!1,this._subscribed=!1,this._provider=null,this._formatters=null,this._symbol=e,this._type=s,this._callback=t,this._providersCache=i,this._formattersCache=r,"Realtime"===this._type?this._handler=(e,i)=>{this._stopped||t(e,i,this._formatters)}:this._handler=(e,i)=>{this._stopped||t(e,i)},this._start().catch(e=>{})}symbol(){return this._symbol}type(){return this._type}callback(){return this._callback}destroy(){this._ensureNotStopped(),this._subscribed&&("Realtime"===this._type?Object(s.ensureNotNull)(this._provider).unsubscribeRealtime(this._symbol,this._handler):Object(s.ensureNotNull)(this._provider).unsubscribeDOME(this._symbol,this._handler)),this._stopped=!0}async _start(){this._provider=await this._providersCache.get(this._symbol),this._ensureNotStopped(),this._formatters=await this._formattersCache.get(this._symbol),Object(s.ensure)(this._formatters),this._ensureNotStopped(),this._subscribed=!0,"Realtime"===this._type?this._provider.subscribeRealtime(this._symbol,this._handler):this._provider.subscribeDOME(this._symbol,this._handler)}_ensureNotStopped(){Object(s.assert)(!this._stopped,"Should not be stopped")}}class g{constructor(e,t,i,r){this.onStatusChanged=new u.a,this._subscriptions=[],this._currentBroker=null,this._activeBrokerGetter=e,this._suggestedQty=r,t.subscribe(this,this._connectionStatusChanged),i.subscribe(this,this._connectionStatusChanged),this._tvProvider=new c.BrokerRealtimeAdapter("RealtimeProvider"),this._connectionStatusChanged()}isTradable(e){return this._tradableCache.get(e)}subscribeRealtime(e,t){this._subscriptions.some(i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type())||this._subscriptions.push(new m(e,t,this._providersCache,this._formattersCache,"Realtime"))}unsubscribeRealtime(e,t){const i=this._subscriptions.findIndex(i=>i.symbol()===e&&i.callback()===t&&"Realtime"===i.type());if(-1===i)return void _.logWarn("Subscription not found");this._subscriptions[i].destroy(),this._subscriptions.splice(i,1)}subscribeDOME(e,t){this._subscriptions.some(i=>i.symbol()===e&&i.callback()===t&&"Dome"===i.type())||this._subscriptions.push(new m(e,t,this._providersCache,this._formattersCache,"Dome"))}unsubscribeDOME(e,t){const i=this._subscriptions.findIndex(i=>i.symbol()===e&&i.callback()===t&&"Dome"===i.type());if(-1===i)return void _.logWarn("Subscription not found");this._subscriptions[i].destroy(),
this._subscriptions.splice(i,1)}formatter(e){return this._formattersCache.get(e).then(e=>e.formatter)}spreadFormatter(e){return this._formattersCache.get(e).then(e=>e.spreadFormatter)}quantityFormatter(e){return this._formattersCache.get(e).then(e=>e.quantityFormatter)}symbolInfo(e){if(!e){const e={minTick:NaN,qty:{min:NaN,max:NaN,step:NaN},pipValue:NaN,pipSize:NaN,description:"no symbol"};return Promise.resolve(e)}return this._providersCache.get(e).then(t=>t!==this._tvProvider?t.symbolInfo(e).then(t=>t||this._tvProvider.symbolInfo(e)).catch(t=>this._tvProvider.symbolInfo(e)):this._tvProvider.symbolInfo(e))}quotesSnapshot(e){return this._providersCache.get(e).then(t=>t.quotesSnapshot(e))}activeBroker(){return null!==this._currentBroker&&this._currentBroker!==this._tvProvider?this._currentBroker:null}_isTradable(e){if(null===this._currentBroker||this._currentBroker===this._tvProvider)return Promise.resolve({tradable:!1});try{return Object(p.a)(this._currentBroker.isTradable(e),6e4,"isTradable Promise Timeout").catch(()=>Promise.resolve({tradable:!1}))}catch(t){return Promise.resolve({tradable:!1})}}_haveRealtime(e){return this._tradableCache.get(e)||Promise.resolve(null===this._currentBroker)}_connectionStatusChanged(){const e=this._activeBrokerGetter(),t=this._currentBroker,i=e&&1===e.connectionStatus()?e:null;if(this._createCaches(),t!==i){const e=this._subscriptions.map(e=>({symbol:e.symbol(),callback:e.callback(),type:e.type()}));this._unsubscribeAll(),this._currentBroker=i,this._subscribeAll(e),this._allSymbols().forEach(e=>{this._suggestedQty.changed.fire(e)}),this.onStatusChanged.fire()}}_allSymbols(){const e=new Set;return this._subscriptions.forEach(t=>e.add(t.symbol())),Array.from(e)}_createCaches(){this._providersCache=new b(e=>this._provider(e)),this._tradableCache=new b(e=>this._isTradable(e)),this._formattersCache=new b(e=>this._providersCache.get(e).then(t=>Promise.all([t.formatter(e,!1),t.spreadFormatter(e),t.quantityFormatter(e)])).then(([e,t,i])=>({formatter:e,spreadFormatter:t,quantityFormatter:i})))}_provider(e){return this._haveRealtime(e).then(e=>e.tradable&&this._currentBroker&&1===this._currentBroker.connectionStatus()?this._currentBroker:this._tvProvider)}_unsubscribeAll(){this._subscriptions.forEach(e=>{e.destroy()}),this._subscriptions=[]}_subscribeAll(e){e.forEach(e=>{this._subscriptions.push(new m(e.symbol,e.callback,this._providersCache,this._formattersCache,e.type))})}}var v=i("0UyP"),f=i("2TBc");class y extends f.a{constructor(e){super(e),this._userId=(window.user.id||"").toString(),window.loginStateChange&&window.loginStateChange.subscribe(this,this._onLoginStateChange)}trackOrderPlaced(e){this._trackOrderEvent("Placed",e)}startService(){Object(s.ensure)(this.activeBroker()).orderUpdate.subscribe(this,this._orderUpdate),this._trackTradingBrokerConnnected()}stopService(){Object(s.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_orderUpdate(e,t){
t||(5===e.status?this._trackOrderEvent("Rejected",e):2===e.status?this._trackOrderEvent("Executed",e):1===e.status&&this._trackOrderEvent("Canceled",e))}_trackOrderEvent(e,t){const i=this.activeBroker();t&&i&&i.symbolInfo(t.symbol).then(i=>{const r={amount:t.qty*(i.lotSize||1),instrumentType:i.type,eventName:"Order "+e,userId:this._userId,symbol:t.symbol};this._trackTradingOrder(r)})}_trackTradingOrder(e){const t=this.activeBroker();if(!t)throw new Error("no active broker");const i=t.metainfo().id,r=t.currentAccountType()||"";Object(v.getTracker)().then(t=>{if(null===t)return;const s=e.instrumentType||"";t.trackTradingOrder({event:e.eventName,broker_id:i,symbol_name:e.symbol,instrument_type:"bitcoin"===s?"crypto":s,amount:Math.min(e.amount,1e15),account_type:r,user_id:e.userId})})}_trackTradingBrokerConnnected(){const e=this.activeBroker(),t=null!==e&&"Paper"===e.metainfo().id;if(!e)throw new Error("no active broker");if(!e.loggedInManually()&&t)return;const i=e.metainfo().id,r=e.currentAccountType()||"",s=this._userId;Object(v.getTracker)().then(e=>{null!==e&&this._lastBrokerId!==i&&(this._lastBrokerId=i,e.trackTradingBrokerConnnected(i,r,s))})}_onLoginStateChange(){this._userId=(window.user.id||"").toString()}}var w=i("Vdly"),k=i("4qhP"),B=i("9pog"),P=i("1AAW"),C=i("hY0g"),S=i.n(C),O=i("PT1i"),T=i("JWMC"),E=i("+xnd"),N=i("3tcu"),L=i("iWVE"),j=i("QloM");function A(e="default"){switch(e){case"danger":return E.a.Danger;case"attention":return E.a.Warning;case"success":return E.a.Success;default:return E.a.Default}}class I{constructor(e){this._chartWidgetCollection=e}proSymbol(){return O.linking.proSymbol.value()}showTradingProperties(){this._chartWidgetCollection.activeChartWidget.value().showGeneralChartProperties(j.TabNames.trading)}async showNotification(e,t,i,r){const s=await this._chartWidgetCollection.getToasts();if(null===s)return;let n="";"string"==typeof t&&(n=t),s.showSimpleToast({text:n,time:r,title:e,intent:A(i)})}showMaintenance(e){N.a.show(e)}showBrokerSideMaintenance(e){L.a.show(e)}trackEvent(e,t,i){Object(T.trackEvent)(e,t,i)}showReplayConfirmationDialog(){return this._chartWidgetCollection.activeChartWidget.value().showReplayOrderConfirmationDialog()}reconnectChartApi(e){this._chartWidgetCollection.reconnectChartApi(e)}setBroker(e){const t=(null==e?void 0:e.metainfo().backendBrokerName)||(null==e?void 0:e.metainfo().id.toLowerCase())||"";this._chartWidgetCollection.setBroker(t)}}var D=i("2uTr"),V=i("Kxc7"),M=i("mrSG"),x=i("3+Gi"),R=(i("HbRj"),i("5det"));async function q(e,t,i){if(!(await Object(R.a)(window.t("Close position"),i,window.t("Close position"),window.t("Cancel"))))return!1;try{return await t()}catch(r){return e(window.t("Failed to close the position"),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(r)),!1}}var F=i("C9TK"),W=i("1rjR"),H=i("QBLL");async function Q(e,t,r){const s=await async function(e){const{PartiallyClosingDialogRenderer:t}=await i.e("partially-closing-dialog-renderer").then(i.bind(null,"+BC+")),r=new t
;return new Promise(t=>{r.open(Object.assign(Object.assign({},e),{dialogActionHandler:t}))})}(e);if(!s.status)return!1;try{return await t(s.qty)}catch(n){return r(window.t("Failed to close the position"),function(e){let t="";null!==e&&"object"==typeof e&&e.message?t=e.message:"string"==typeof e&&(t=e);return t}(n)),!1}}var U=i("q1tI"),z=i.n(U),K=i("EBrf");function G(e){const{symbol:t,side:i,qty:s,price:n,id:o,closePositionCancelsOrders:a}=e,l=Object(K.splitThousands)(s," "),c=Object(K.splitThousands)(n," ");return U.createElement(U.Fragment,null,U.createElement("div",null,void 0!==o?Object(r.t)("Position ID {id}").replace("{id}",o):Object(r.t)("Position")),U.createElement("div",null,U.createElement("b",null,t)),U.createElement("div",null,U.createElement("b",null,`${i} ${l} @ ${c}`)),U.createElement("div",null,a&&" "+Object(r.t)("This will also close all active orders")))}var Z=i("4hvi"),J=i("+GxX"),$=i("0W4x");const Y=Object(h.getLogger)("Trading.BrokerCommandsUI"),X={symbol:1,qty:1,side:1,type:1,seenPrice:1};class ee{constructor(e,t,i,r,s,n){this._isClosePositionDialogLoading=!1,this._isCloseTradeDialogLoading=!1,this._activeBroker=e,this._guiAccessor=t,this._orderViewController=r,this._showErrorNotification=s,this._noConfirmEnabled=i,this._trackEvent=n}async placeOrder(e,t,i){var r;if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);this._makeSureBrokerIsConnected();const s=t&&this._noConfirmEnabled.value(),n=this._guiAccessor&&s?this._guiAccessor.showReplayConfirmationDialog():Promise.resolve(!1);try{await n}catch(a){Promise.resolve(!1)}const o=await this._activeBroker.isTradable(e.symbol);if(s&&o.tradable&&function(e){for(const t in X)if(!(t in e))return!1;return!0}(e)){const t=this._activeBroker.metainfo().durations;return void 0===e.duration&&void 0!==t&&t.length>0&&(e.duration=null!==(r=Object(k.g)(e.type,t))&&void 0!==r?r:{type:t[0].value}),this._activeBroker.placeOrder(e)}return o.tradable?this._orderViewController().then(t=>this._activeBroker?t.showOrderView(this._activeBroker,e,void 0,i):Promise.reject("Broker connection adapter is null")):(Object(Z.a)({isTradableResult:o,activeBroker:this._activeBroker}),!1)}async modifyOrder(e,t,i,s){if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);if(this._makeSureBrokerIsConnected(),e.flags&&e.flags.trailingStop)return Y.logError("Attempt to modify trailing stop loss order"+e.id),this._showErrorNotification(Object(r.t)("Cannot Modify Order"),Object(r.t)("Trailing Stops cannot be modified")),Promise.resolve(!1);const n=await this._activeBroker.symbolInfo(e.symbol)
;e.limitPrice=void 0!==n.limitPriceStep&&void 0!==e.limitPrice?Object($.roundToStepByPriceTypeAndSide)(e.limitPrice,n.limitPriceStep,1,e.side):e.limitPrice,e.stopPrice=void 0!==n.stopPriceStep&&void 0!==e.stopPrice?Object($.roundToStepByPriceTypeAndSide)(e.stopPrice,n.stopPriceStep,2,e.side):e.stopPrice;const o=e.limitPrice,a=e.stopPrice,l=e.stopType,c=t&&this._noConfirmEnabled.value();let d=i||(1===e.type?1:2);if(e.parentId&&!V.enabled("always_pass_called_order_to_modify")){let t,r=this._activeBroker.orderById.bind(this._activeBroker);2===e.parentType&&(r=this._activeBroker.positionById.bind(this._activeBroker)),3===e.parentType&&(r=this._activeBroker.tradeById.bind(this._activeBroker));try{t=await r(e.parentId)}catch(u){t=void 0}if(t){d=i||(1===e.type?3:4);const r={takeProfit:o};if(l===x.a.TrailingStop?r.trailingStopPips=e.trailingStopPips:r.stopLoss=a,c&&(r.takeProfit=r.takeProfit||t.takeProfit,r.stopLoss=r.stopLoss||t.stopLoss,r.trailingStopPips=r.trailingStopPips||t.trailingStopPips),3===e.parentType)return c?this._activeBroker.editTradeBrackets(t.id,r):this._showTradeDialog(t,r,d);if(2===e.parentType&&e.qty===Math.abs(t.qty))return c?this._activeBroker.editPositionBrackets(t.id,r):this._showPositionDialog(t,r,d);const s=t;Object(k.i)(s.status)&&(e=Object.assign({},s),o&&(e.takeProfit=o),a&&(l===x.a.TrailingStop?e.trailingStopPips=r.trailingStopPips||e.trailingStopPips:e.stopLoss=a))}}return c?this._activeBroker.modifyOrder(e):this._orderViewController().then(t=>this._activeBroker?t.showOrderView(this._activeBroker,e,d,s):Promise.reject("Broker connection adapter is null"))}async closePosition(e){if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),!1;if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),!1;if(this._makeSureBrokerIsConnected(),this._noConfirmEnabled.value())return this._activeBroker.closePosition(e);{if(this._isClosePositionDialogLoading)return!1;const t=await this._obtainPositionClosingData(e);if(void 0===t)return!1;const{supportPartialClosePosition:i,position:r}=t,s=Object(M.d)(t,["supportPartialClosePosition","position"]);if(i){const i=i=>(i!==t.position.qty?this._trackEvent("","Close Position Dialog","partial"):this._trackEvent("","Close Position Dialog","full"),this._activeBroker.closePosition(e,i));return Q(Object.assign(Object.assign({},s),{positionOrTrade:r}),i,this._showErrorNotification)}{const i=()=>this._activeBroker.closePosition(e);return q(this._showErrorNotification,i,t.message)}}}async closeTrade(e){if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),!1;if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),!1;if(this._makeSureBrokerIsConnected(),Object(s.assert)(!!this._activeBroker.config.supportTrades,"Broker doesn`t support trades"),this._noConfirmEnabled.value())return this._activeBroker.closeTrade(e);{
if(this._isCloseTradeDialogLoading)return!1;const t=await this._obtainTradeClosingData(e);if(void 0===t)return!1;const{supportPartialCloseTrade:i,trade:r}=t,s=Object(M.d)(t,["supportPartialCloseTrade","trade"]);if(i){const t=async t=>(t!==r.qty?this._trackEvent("","Close Trade Dialog","partial"):this._trackEvent("","Close Trade Dialog","full"),this._activeBroker.closeTrade(e,t));return Q(Object.assign(Object.assign({},s),{positionOrTrade:r}),t,this._showErrorNotification)}{const i=()=>this._activeBroker.closeTrade(e);return q(this._showErrorNotification,i,t.message)}}}editPositionBrackets(e,t,i,r){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),Object(s.assert)(!!this._activeBroker.config.supportPositionBrackets,"Broker doesn`t support brackets on positions"),r?Object(s.ensureDefined)(this._activeBroker.editPositionBrackets)(e,t):this._activeBroker.positionById(e).then(e=>this._activeBroker?this._showPositionDialog(Object(s.ensureDefined)(e),t,i):Promise.reject("Broker connection adapter is null")))}editTradeBrackets(e,t={},i,r){return r&&this._noConfirmEnabled.value()?this._activeBroker.editTradeBrackets(e):this._activeBroker.tradeById(e).then(e=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const r=Object(s.ensureDefined)(e);return this._showTradeDialog(r,t,i)})}reversePosition(e){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),this._activeBroker.metainfo().configFlags.supportMultiposition&&!this._activeBroker.config.supportNativeReversePosition?Promise.reject("Cannot reverse position on multiposition acount"):this._noConfirmEnabled.value()?this._activeBroker.reversePosition(e):this._activeBroker.positionById(e).then(t=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const i=this._activeBroker.reversePosition.bind(this._activeBroker,e);return Object(F.a)(e,this._showErrorNotification,i,this._activeBroker.config.closePositionCancelsOrders)}))}async cancelOrder(e){if(this._isMaintenance())return this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);if(this._isBrokerSideMaintenance())return this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1);this._makeSureBrokerIsConnected();if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrder(e);{const t=await this._activeBroker.orderById(e),i=this._activeBroker.cancelOrder.bind(this._activeBroker,e);if(t){if(t.parentId){const e=(await this._activeBroker.orders()).filter(e=>e.refNumber===t.refNumber)
;return this._activeBroker.metainfo().configFlags.supportCancellingBothBracketsOnly&&e.length>1?this._showCancelMultipleBracketsDialog(t.parentId,i):this._showCancelBracketsDialog(t.id,i)}return this._showCancelOrderDialog(t.id,i)}return Promise.reject("Failed to find order")}}cancelOrders(e,t){return this._isMaintenance()?(this._guiAccessor.showMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):this._isBrokerSideMaintenance()?(this._guiAccessor.showBrokerSideMaintenance(this._activeBroker.metainfo().title),Promise.resolve(!1)):(this._makeSureBrokerIsConnected(),this._activeBroker.orders().then(i=>{if(!this._activeBroker)return Promise.reject("Broker connection adapter is null");const r=i.filter(i=>i.symbol===e&&(!t||i.side===t)&&function(e){return 4===e.status||3===e.status||6===e.status}(i));if(!r.length)return Promise.resolve(!1);if(1===r.length)return this.cancelOrder(r[0].id);const s=r.map(e=>e.id);if(this._noConfirmEnabled.value())return this._activeBroker.cancelOrders(e,t,s);{const i=this._activeBroker.cancelOrders.bind(this._activeBroker);return this._showCancelMultipleOrdersDialog(e,t,s,i)}}))}_makeSureBrokerIsConnected(){Object(s.assert)(1===this._activeBroker.connectionStatus(),"Broker is not connected")}async _showPositionDialog(e,t={},i){const s=await this._activeBroker.isTradable(e.symbol);if(!s.tradable){const t=void 0!==s.reason?s.reason:Object($.makeNonTradableSymbolText)(e.symbol,this._activeBroker.metainfo().title);return this._showErrorNotification(Object(r.t)("Cannot protect position"),t),Promise.resolve(!1)}return this._orderViewController().then(r=>this._activeBroker?r.showPositionView(this._activeBroker,e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips},i||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null"))}_showTradeDialog(e,t={},i){return this._orderViewController().then(r=>this._activeBroker?r.showTradeView(this._activeBroker,e,{stopLoss:t.stopLoss,takeProfit:t.takeProfit,trailingStopPips:t.trailingStopPips},i||e.limitPrice&&3||e.stopPrice&&4):Promise.reject("Broker connection adapter is null"))}_isMaintenance(){return Object(J.isFeatureEnabled)(Object(k.k)(this._activeBroker.metainfo().id))}_isBrokerSideMaintenance(){return Object(J.isFeatureEnabled)(Object(k.j)(this._activeBroker.metainfo().id))}_showCancelOrderDialog(e,t){return W.a.get().open(e).then(i=>i?t(e):Promise.resolve(!1))}_showCancelMultipleOrdersDialog(e,t,i,r){const s=i.length;return W.a.get().multiple(e,t,s).then(s=>s?r(e,t,i):Promise.resolve(!1))}async _showCancelBracketsDialog(e,t){return H.a.get().open(e).then(i=>i?t(e):Promise.resolve(!1))}_showCancelMultipleBracketsDialog(e,t){return H.a.get().multiple(e).then(i=>i?t(e):Promise.resolve(!1))}async _obtainPositionClosingData(e){try{this._isClosePositionDialogLoading=!0
;const t=Object(s.ensureDefined)(await this._activeBroker.positionById(e)),{supportLots:i,qtyStep:n,minQty:o,qtyFormatter:a,priceFormatter:l}=await this._obtainPositionOrTradeClosingCommonData(t),c=this._activeBroker.metainfo().configFlags.supportPartialClosePosition,d=G({symbol:t.symbol,side:1===t.side?Object(r.t)("Long"):Object(r.t)("Short"),qty:a.format(t.qty),price:l.format(t.avgPrice),closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return this._isClosePositionDialogLoading=!1,{position:t,supportLots:i,qtyStep:n,minQty:o,supportPartialClosePosition:c,qtyFormatter:a,message:d}}catch(t){return void(this._isClosePositionDialogLoading=!1)}}async _obtainTradeClosingData(e){try{this._isCloseTradeDialogLoading=!0;const t=Object(s.ensureDefined)(await this._activeBroker.tradeById(e)),{supportLots:i,qtyStep:n,minQty:o,qtyFormatter:a,priceFormatter:l}=await this._obtainPositionOrTradeClosingCommonData(t),c=this._activeBroker.metainfo().configFlags.supportPartialCloseTrade,d=G({symbol:t.symbol,side:1===t.side?Object(r.t)("Long"):Object(r.t)("Short"),qty:a.format(t.qty),price:l.format(t.price),id:e,closePositionCancelsOrders:this._activeBroker.config.closePositionCancelsOrders});return this._isCloseTradeDialogLoading=!1,{trade:t,supportLots:i,qtyStep:n,minQty:o,supportPartialCloseTrade:c,qtyFormatter:a,message:d}}catch(t){return void(this._isCloseTradeDialogLoading=!1)}}async _obtainPositionOrTradeClosingCommonData(e){const t=await this._activeBroker.symbolInfo(e.symbol);return{supportLots:void 0!==t.lotSize,qtyStep:t.qty.step,minQty:t.qty.min,qtyFormatter:await this._activeBroker.quantityFormatter(e.symbol),priceFormatter:await this._activeBroker.formatter(e.symbol,!1)}}}var te=i("N22A");class ie{constructor(e,t){this._domePanel=null,this._resizerBridge=e,this._close=()=>{this.unmount(),t()}}mount(){return this._getDomPanel().then(e=>{e.setVisibility(!0)})}unmount(){this._getDomPanel().then(e=>{e.setVisibility(!1)})}async _getDomPanel(){if(null!==this._domePanel)return Promise.resolve(this._domePanel);const e=await Promise.all([i.e("vendors"),i.e(2),i.e(3),i.e(5),i.e(6),i.e(9),i.e(12),i.e(13),i.e(15),i.e(19),i.e(23),i.e(31),i.e(34),i.e(51),i.e(64),i.e(65),i.e(70),i.e(78),i.e(79),i.e(83),i.e(179),i.e(231),i.e(269),i.e(378),i.e(389),i.e(445),i.e(4),i.e(8),i.e(21),i.e(44),i.e(67),i.e(76),i.e(97),i.e(166),i.e(241),i.e(329),i.e("dome-panel")]).then(i.bind(null,"nr7h")),t=await Object(te.waitTradingService)(),r=new e.DomePanel(t,this._resizerBridge);return r.setCloseHandler(this._close),this._domePanel=r,r}}class re{mount(){return Promise.resolve()}unmount(){}}var se=i("vOQ2"),ne=i("/BH3"),oe=i("6aj4");const ae=V.enabled("show_order_panel_on_start");class le{constructor(e){this.isOpened=new S.a(!1),this.isAvailable=new S.a(!0),this.activePage=new S.a(ae?se.d.OrderPanel:se.d.DomPanel),this.isLoading=new S.a(!1),this._pages={},this._width=se.c,this._onLayoutResizeHandleMousedown=e=>{if(e.defaultPrevented||!e.cancelable)return;e.preventDefault();const t=Math.max(this._resizerBridge.width.value(),0)
;let i;i="touches"in e?e.touches[0].clientX:e.clientX;const r=e=>{let r;e.preventDefault(),r="touches"in e?e.touches[0].clientX:e.clientX;let s=t-(r-i);s<se.c?s=se.c:s>se.a&&(s=se.a),this._requestWidth(s)},s=()=>{document.removeEventListener("mousemove",r),document.removeEventListener("touchmove",r),document.removeEventListener("mouseup",s),document.removeEventListener("touchend",s),w.setValue(l.settingsKeys.PANEL_WIDTH,this._width)};document.addEventListener("mousemove",r),document.addEventListener("touchmove",r,{passive:!1}),document.addEventListener("mouseup",s),document.addEventListener("touchend",s,{passive:!1})},this._resizerBridge=e,this._rootContainer=this._resizerBridge.container.value(),this.container=document.createElement("div"),this.container.classList.add(oe["trading-panel-content"],"trading-panel-content"),this._rootContainer.appendChild(this.container),this._addSpinner(),this._addResizeHandler(),this._updateAvailable({width:this._resizerBridge.availWidth.value(),height:this._resizerBridge.availHeight.value()}),Object(P.combine)((e,t)=>({width:e,height:t}),this._resizerBridge.availWidth,this._resizerBridge.availHeight).subscribe(this._updateAvailable.bind(this)),this.isLoading.subscribe(this._setLoading.bind(this)),this._rootContainer.style.overflow=this.isOpened.value()?"":"hidden"}addPage(e,t){this._pages[e]=t}isPageOpened(e){return this.isOpened.value()&&this.activePage.value()===e}setPage(e){this.isOpened.value()&&this.activePage.value()!==e&&this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this.activePage.setValue(e),w.setValue(l.settingsKeys.TRADING_PANEL_ACTIVE_PAGE,e)}openPage(e){this.setPage(e),this.open()}open(){this._pages[this.activePage.value()]&&(this._togglePanel(!0),this.isOpened.setValue(!0),this._pages[this.activePage.value()].mount())}close(){this.isOpened.setValue(!1),this._pages[this.activePage.value()]&&this._pages[this.activePage.value()].unmount(),this._togglePanel(!1)}_setLoading(e){e?this._rootContainer.appendChild(this._spinnerContainer):this._rootContainer.contains(this._spinnerContainer)&&this._rootContainer.removeChild(this._spinnerContainer)}_addSpinner(){this._spinnerContainer=document.createElement("div"),this._spinnerContainer.classList.add(oe["trading-panel-spinner"]),i.e("spinner-renderer").then(i.bind(null,"lG9f")).then(e=>{e.render(this._spinnerContainer)})}_addResizeHandler(){this._handle=document.createElement("div"),this._handle.classList.add(oe["trading-panel-handle"]),this._rootContainer.appendChild(this._handle),this._handle.addEventListener("mousedown",this._onLayoutResizeHandleMousedown,{passive:!1}),this._handle.addEventListener("touchstart",this._onLayoutResizeHandleMousedown,{passive:!1}),this._width=w.getInt(l.settingsKeys.PANEL_WIDTH)||se.c}_togglePanel(e){this._resizerBridge.negotiateWidth(e?this._width:0),this._resizerBridge.negotiateHeight(e?se.b:0),this._rootContainer.style.overflow=e?"":"hidden",w.setValue(l.settingsKeys.TRADING_PANEL_OPENED,e)}_updateAvailable(e){
this.isAvailable.setValue(e.width>=se.c&&e.height>=se.b)}_requestWidth(e){this._canOpen(e)&&this._resizerBridge.width.value()!==e&&(this._resizerBridge.negotiateWidth([{min:se.c,max:e}]),this._width=e)}_canOpen(e){return e+ne.tabsWidth<=this._resizerBridge.availWidth.value()}}var ce=i("lxNp"),de=i("hbEN"),ue=i("dOnf"),he=i("hp/T"),pe=i("IWXC");const _e=["qty","stopPrice","limitPrice","status","filledQty"];function be(e,t){return e.enabled.value()&&(t.soundName=e.name),t}function me(e){return 6===e||3===e}class ge extends f.a{constructor(e){super(e),this._orders=[],this._playSound=Object(de.default)(this._playSoundImpl,50),he.enableAlertSoundsForMobile()}startService(){const e=Object(s.ensure)(this.activeBroker());e.orders().then(e=>this._orders=Object(ue.deepCopy)(e)),e.orderUpdate.subscribe(this,this._orderUpdate)}stopService(){Object(s.ensure)(this.activeBroker()).orderUpdate.unsubscribe(this,this._orderUpdate)}_showNotification(e,t,i){V.enabled("trading_notifications")&&("error"===i?this.trading().showErrorNotification(e,t):this.trading().showSuccessNotification(e,t))}_formatter(e){return Object(pe.getQuoteSessionInstance)("simple").formatter(e)}_checkOrderModified(e,t){const i=this.activeBroker(),r=i&&i.metainfo().customNotificationFields||[],s=_e.concat(r);let n=!1;return s.forEach(i=>{n||function e(t,i,r){if(void 0===t||void 0===i)return!1;const s=r.indexOf(".");if(-1!==s){const n=r.substring(0,s);return e(t[n],i[n],r.substring(s+1))}return t[r]===i[r]}(e,t,i)||(n=!0)}),n}_generateNotificationsInfo(e,t){const i=[],r=e.statusMessage?": "+e.statusMessage:"",s=(1===e.side?window.t("Bought"):window.t("Sold")).toUpperCase();const n=this.trading().orderExecutedSoundParams;return t?(this._checkOrderModified(e,t)&&(1===e.status?i.push({text:window.t("cancelled"),notificationType:1}):5===e.status?i.push({text:window.t("rejected")+r,type:"error",notificationType:2}):2===e.status?i.push(be(n,{side:s,text:window.t("executed"),notificationType:6})):t.filledQty!==e.filledQty?i.push(be(n,{side:s,text:window.t("executed partially"),notificationType:4})):me(e.status)&&i.push({text:window.t("modified"),notificationType:5})),Object.assign(t,e)):me(e.status)?(this._orders.push(e),i.push({text:window.t("placed"),notificationType:0}),this.trading().trackEvent("","Order placed symbol",e.symbol)):1===e.status?i.push({text:window.t("cancelled"),notificationType:1}):5===e.status?(this._orders.push(e),i.push({text:window.t("rejected")+r,type:"error",notificationType:2})):2===e.status&&(this._orders.push(e),i.push({text:window.t("placed"),notificationType:0},be(n,{side:s,text:window.t("executed"),emptyOrderType:!0,notificationType:6})),this.trading().trackEvent("","Order placed symbol",e.symbol)),i}_orderUpdate(e,t){const i=Object(ue.deepCopy)(e),r=this._orders.find(e=>e.id===i.id);if(t)return void(void 0===r&&this._orders.push(i));if(r&&Object($.isFinalOrderStatus)(r.status))return;const s=this._generateNotificationsInfo(i,r);0!==s.length&&this._formatter(i.symbol).then(e=>{
const t=Object($.sideToText)(i.side,!0),r=i.qty,n=void 0!==i.filledQty&&i.filledQty>0?i.filledQty:void 0;let o="",a="";switch(i.type){case 2:o=i.avgPrice?" ("+Object($.orderTypeToText)(i.type)+")":"",a=i.avgPrice?e.format(i.avgPrice):Object($.orderTypeToText)(i.type);break;case 4:o=" "+window.t("(Limit) after {0} (Stop) crossed").format(e.format(i.stopPrice)),a=e.format(i.avgPrice||i.limitPrice);break;default:o=" ("+Object($.orderTypeToText)(i.type)+")",a=e.format(i.avgPrice||i.limitPrice||i.stopPrice)}const l=void 0!==i.message?`${i.message.text.charAt(0).toUpperCase()}${i.message.text.substr(1)}`:"";s.forEach(({text:e,type:s,side:c,emptyOrderType:d,soundName:u,notificationType:h})=>{const p=4===h&&void 0!==n?n:r,_=Object(K.splitThousands)(Math.abs(p)," ")+" "+(i.brokerSymbol||i.symbol)+" "+window.t("at")+" "+a,b=`${window.t("Order")} ${i.id} ${e}`,m=`${c||t} ${_} ${d?"":o}\n${l}`;void 0!==u&&this._playSound(u),this._showNotification(b,m,s)})})}_playSoundImpl(e){if(this._playingSound){if(this._playingSound===e)return;he.stop(this._playingSound)}this._playingSound=e,he.play(e),he.onStopped(e,()=>{delete this._playingSound})}}var ve=i("fZEr"),fe=i("VBos"),ye=i("pPtI");const we=Object(h.getLogger)("Chart.PointsetManager");let ke=0;class Be{constructor(e,t,i,r,s){this._currentPointsetId=null,this._onUpdate=new u.a,this._requestPoints=[],this._gateway=e,this._pointsetSuffix=t,this._isGatewayConnected=this._gateway.isConnected().spawn(),this._isGatewayConnected.subscribe(this._updateByGatewayConnection.bind(this)),this._addPoints(i,r,s)}onUpdate(){return this._onUpdate}destroy(){this._isGatewayConnected.value()&&null!==this._currentPointsetId&&this._gateway.removePointset(this._currentPointsetId),this._requestPoints=[],this._currentPointsetId=null,this._isGatewayConnected.destroy()}_updateByGatewayConnection(e){e||(this._currentPointsetId=null,this._requestPoints=[])}_addPoints(e,t,i){var r,n;this._isGatewayConnected.value()&&(Object(s.assert)(e.length>0,"Can't possible create point set for empty array of time points"),this._requestPoints=e.map(e=>[e.time_t,e.offset]),this._currentPointsetId=(r=this._pointsetSuffix,n=++ke,`pointset_${r}_${n}`),this._gateway.createPointset(this._currentPointsetId,"turnaround",t,Object(ye.getServerInterval)(i),this._requestPoints,this._onMessage.bind(this)))}_onMessage(e){switch(e.method){case"pointset_error":we.logNormal(`Pointset error with id ${e.params[0]} turnaround ${e.params[1]}`);break;case"data_update":{const t=[];for(const i of e.params.plots)t.push({time_t:this._requestPoints[i.index][0],index:i.value[0],barTime:i.value[1]});this._onUpdate.fire(t);break}}}}var Pe=i("GOhO");function Ce(e){const t=e.mainSeries().data().first();return null===t?null:t.value[0]}async function Se(e,t){const[r,s,n]=await Promise.all([i.e("trading-custom-sources").then(i.bind(null,"fA+p")),i.e("trading-custom-sources").then(i.bind(null,"KSBC")),i.e("trading-custom-sources").then(i.bind(null,"EgV8"))]);e.addCustomSource("executions",(e,i)=>{
const o=i.mainSeries(),a=o.dataEvents(),l=Object(Pe.b)(i.isInReplay.bind(i),i.onInReplayStateChanged()),c=Object(Pe.b)(()=>o.isConvertedToOtherCurrency()||o.isConvertedToOtherUnit(),o.symbolResolved()),d=Object(Pe.a)((e,t,i)=>(i=i&&!e)&&!t,l,c,i.properties().tradingProperties.showExecutions),u=function(e,t,i){return r=>{const s=i.seriesSource().symbolInstanceId(),n=i.interval();return null===s?null:new Be(e,t,r,s,n)}}(i.chartApi(),"executions",o),h=Object(Pe.c)(Ce.bind(null,i),a.barReceived()),p=new r.ExecutionsService(t,a,function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||t.full_name:e.proSymbol()}}(o)),_=new s.ExecutionsPointsManager(p,u,h);return new n.ExecutionsSource(e,i,t,d,_)})}var Oe=i("ogJP");const Te=Object(h.getLogger)("Trading.Positions");function Ee(e){const t=null===e?0:Math.round(100*e)/100;return t>0?"positive":t<0?"negative":"neutral"}class Ne extends f.a{constructor(){super(...arguments),this._positions=new Map,this._positionUpdate=new u.a,this._positionsRemoved=new u.a,this._displayMode=1,this._updatePositionPLHandler=this._updatePositionPL.bind(this)}destroy(){this.stopService()}positions(){return Array.from(this._positions.values())}find(e){return this._positions.get(e)||null}async realIdFromBroker(e){const t=Object(s.ensureNotNull)(this.activeBroker());if(1===this._displayMode){const i=await t.positionById(e);if(void 0!==i)return i.id}else{const i=await t.tradeById(e);if(void 0!==i)return i.id}return null}positionUpdate(){return this._positionUpdate}positionsRemoved(){return this._positionsRemoved}isDisplayModeTrades(){return 0===this._displayMode}async getCurrency(e){const t=Object(s.ensureNotNull)(this.activeBroker());try{const i=await t.symbolInfo(e);if(t.metainfo().configFlags.positionPLInInstrumentCurrency&&void 0!==i.currency)return i.currency;const r=await t.accountMetainfo();return Object(k.f)(i,r,!0)}catch(i){return""}}stopService(){this._clearPositions();const e=Object(s.ensureNotNull)(this.activeBroker());this.isDisplayModeTrades()?e.tradeUpdate.unsubscribeAll(this):e.positionUpdate.unsubscribeAll(this)}startService(){this._clearPositions(),this._displayMode=function(e){if(null===e)return 1;const t=e.metainfo().configFlags;return t.supportTrades?t.supportPositionBrackets?1:t.supportCloseTrade?0:1:1}(this.activeBroker()),this._requestPositions()}_clearPositions(){const e=Object(s.ensureNotNull)(this.activeBroker()),t=Array.from(this._positions.keys());for(const i of t)this.isDisplayModeTrades()?e.unsubscribeTradePL(i,this._updatePositionPLHandler):e.unsubscribePL(i,this._updatePositionPLHandler);this._positions.clear(),this._positionsRemoved.fire(t)}async _requestPositions(){const e=this.activeBroker();if(!e)return;const t=this.isDisplayModeTrades(),i=await(t?e.trades():e.positions());for(const r of i)this._addPosition(r);t?e.tradeUpdate.subscribe(this,this._addPosition):e.positionUpdate.subscribe(this,this._addPosition)}_addPosition(e){const t=e.id,i=this._positions.has(t),r=Object(s.ensureNotNull)(this.activeBroker())
;Te.logDebug("Update position. Symbol:"+e.symbol+" , qty:"+e.qty);const n=this.isDisplayModeTrades();if(!e.qty)return void(i&&(n?r.unsubscribeTradePL(t,this._updatePositionPLHandler):r.unsubscribePL(t,this._updatePositionPLHandler),this._positions.delete(t),this._positionsRemoved.fire([t])));const o=this._getPositionData(e);this._positions.set(t,o),this._positionUpdate.fire(o),i||(n?r.subscribeTradePL(t,this._updatePositionPLHandler):r.subscribePL(t,this._updatePositionPLHandler))}_updatePositionPL(e,t){const i=Object(s.ensureDefined)(this._positions.get(e));i.pl=Object(Oe.isNumber)(t)?t:null,i.profitState=Ee(t),this._positionUpdate.fire(i)}_getPositionData(e){const t=Object(s.ensureNotNull)(this.activeBroker()).metainfo().configFlags,i=this._positions.get(e.id),r=this.isDisplayModeTrades();let n="neutral";const o=e.pl||i&&i.pl||null;return null!==o&&(n=Ee(o)),Object.assign(Object.assign(Object.assign({},void 0!==i?i:{}),e),{pl:o,price:Math.abs(r?e.price:e.avgPrice),qtyBySide:Math.abs(e.qty)*(1===e.side?1:-1),profitState:n,supportClose:Boolean(r?t.supportCloseTrade&&e.canBeClosed:t.supportClosePosition),supportReverse:Boolean(!r&&t.supportReversePosition),supportBrackets:Boolean(r?t.supportTradeBrackets:t.supportPositionBrackets)})}}const Le=Object(h.getLogger)("Trading.OrderSource");class je extends f.a{constructor(){super(...arguments),this._activeOrders=new Map,this._activeOrderUpdate=new u.a,this._activeOrdersRemoved=new u.a}destroy(){this.stopService()}orders(){return Object(s.ensureNotNull)(this.activeBroker()).orders()}find(e){return this._activeOrders.get(e)||null}activeOrders(){return Array.from(this._activeOrders.values())}activeOrdersUpdated(){return this._activeOrderUpdate}activeOrdersRemoved(){return this._activeOrdersRemoved}stopService(){this._clearOrders();Object(s.ensureNotNull)(this.activeBroker()).orderUpdate.unsubscribeAll(this)}startService(){this._clearOrders(),this._requestOrders()}_clearOrders(){const e=Array.from(this._activeOrders.keys());this._activeOrders.clear(),this._activeOrdersRemoved.fire(e)}async _requestOrders(){const e=this.activeBroker();if(!e)return;const t=await e.orders();for(const i of t)this._addActiveOrder(i);e.orderUpdate.unsubscribeAll(this),e.orderUpdate.subscribe(this,this._addActiveOrder)}_addActiveOrder(e){if(2===e.type)return;const t=e.id,i=this._activeOrders.has(t);if(6!==e.status&&3!==e.status)return void(i&&(this._activeOrders.delete(t),this._activeOrdersRemoved.fire([t])));const r=this._getOrderData(e);this._activeOrders.set(t,r),this._activeOrderUpdate.fire(r)}_getOrderData(e){const t=Object(s.ensureNotNull)(this.activeBroker()).metainfo().configFlags,i=this._activeOrders.get(e.id),r=function(e){return 1===e.type?Object(s.ensureDefined)(e.limitPrice):Object(s.ensureDefined)(e.stopPrice)}(e);return Object(Oe.isNumber)(r)||Le.logError("order price is not defined"),Object.assign(Object.assign(Object.assign({},void 0!==i?i:{}),e),{price:r,isActive:6===e.status,considerFilledQty:!0,
supportModify:Boolean(t.supportModifyOrder&&(t.supportTrailingStop&&t.supportModifyTrailingStop||e.stopType!==x.a.TrailingStop))})}}var Ae=i("QfUd"),Ie=i("kcTO");const De=window.t("A broker is not connected"),Ve=window.t("This symbol can't be traded through this broker"),Me=window.t("No bids"),xe=window.t("No asks"),Re=window.t("Buy Market"),qe=window.t("Sell Market"),Fe=window.t("Spread"),We=window.t("Amount"),He=window.t("Quantity"),Qe=Object(J.isFeatureEnabled)("trading_button"),Ue=Object(J.isFeatureEnabled)("trading_button");class ze{constructor(e,t,i,r){this.ask=new S.a(null),this.askTooltip=new S.a(Re),this.bid=new S.a(null),this.bidTooltip=new S.a(qe),this.spread=new S.a(null),this.spreadTooltip=new S.a(Fe),this.qty=new S.a(null),this.qtyTooltip=new S.a(""),this.brokerIconVisible=new S.a(!1),this.brokerIconUrl=new S.a(null),this.isQtyVisible=new S.a(!1),this.hasAskBidAdditionalPrecision=new S.a(!1),this.canTrade=new S.a(!0),this._globalVisibility=null,this._isSymbolTradableResult=new Ae.WatchedObject(null),this._formatter=null,this._spreadFormatter=null,this._symbol=null,this._dataEvents=e,this._getSymbolName=t,this._realtimeProvider=i.realtimeProvider,this._suggestedQty=i.suggestedQty,this._onNeedSelectBroker=i.onNeedSelectBroker,this._toggleTradingWidget=i.toggleTradingWidget,this._toggleTradingPanelPopup=i.toggleTradingPanelPopup,this._brokerCommandsUI=i.brokerCommandsUI,this._updateRealtimeDataHandler=this._updateRealtimeData.bind(this),this._isBrokerConnected=Object(Pe.c)(()=>null!==this._realtimeProvider.activeBroker(),this._realtimeProvider.onStatusChanged),this._isBrokerConnected.subscribe(this._updateIsSymbolTraded.bind(this),{callWithLast:!0}),this._isBrokerConnected.subscribe(this._updateQtyTooltip.bind(this),{callWithLast:!0}),this._isBrokerConnected.subscribe(this._updateBrokerIcon.bind(this)),this.visible=new S.a(!1),this.visible.subscribe(this._toggleState.bind(this),{callWithLast:!0}),this._showSellBuyButtons=r.showSellBuyButtons.spawn(),this._showSellBuyButtons.subscribe(this._updateVisibility.bind(this),{callWithLast:!0}),this._isInstantMode=r.noConfirmEnabled.spawn(),this._themeName=r.themeName.spawn(),this._themeName.subscribe(this._updateBrokerIcon.bind(this),{callWithLast:!0}),this._tradePossibilityComputedWV=Object(P.combine)(()=>({}),this._isBrokerConnected,this._isSymbolTradableResult,this.ask,this.bid),this._tradePossibilityComputedWV.subscribe(this._updateTradePossibilityAndTooltip.bind(this),{callWithLast:!0}),this._isQtyVisibleComputedWV=Object(P.combine)(()=>({}),this.canTrade,this._isInstantMode),this._isQtyVisibleComputedWV.subscribe(this._updateIsQtyVisible.bind(this),{callWithLast:!0})}destroy(){var e;this._stop(),this._isBrokerConnected.destroy(),this._showSellBuyButtons.destroy(),null===(e=this._globalVisibility)||void 0===e||e.destroy(),this._isInstantMode.destroy(),this._tradePossibilityComputedWV.destroy(),this._isQtyVisibleComputedWV.destroy(),this._themeName.destroy()}setGlobalVisibility(e){
Object(s.assert)(null===this._globalVisibility,"GlobalVisibility can be set only once"),this._globalVisibility=e.spawn(),this._globalVisibility.subscribe(this._updateVisibility.bind(this),{callWithLast:!0})}async tryToPlaceSellOrder(){await this._tryToPlaceOrder(parseFloat(Object(s.ensureNotNull)(this.bid.value())),-1)}async tryToPlaceBuyOrder(){await this._tryToPlaceOrder(parseFloat(Object(s.ensureNotNull)(this.ask.value())),1)}async getQtyInfo(){return null!==this._symbol&&this.canTrade.value()?(await this._realtimeProvider.symbolInfo(this._symbol)).qty:null}setQty(e){this.qty.setValue(String(e))}applyQty(){if(null===this._symbol||!this.canTrade.value())return;const e=this.qty.value();null!==e&&this._suggestedQty.setValue(this._symbol,Number(e))}canShowMobileTrading(){var e;return Ue&&!(null===(e=window.TradingView.bottomWidgetBar)||void 0===e?void 0:e.isVisible().value())}_updateVisibility(){const e=(null===this._globalVisibility||this._globalVisibility.value())&&this._showSellBuyButtons.value();this.visible.setValue(e)}async _tryToPlaceOrder(e,t){if(null===this._realtimeProvider.activeBroker())return this.canShowMobileTrading()?this._toggleTradingPanelPopup():await this._toggleTradingWidget(),void this._onNeedSelectBroker.fire();const i=Number(this.qty.value())||1,r=this._isMarketOrderSupported()?2:1,n={symbol:Object(s.ensureNotNull)(this._symbol),qty:i,side:t,type:r,seenPrice:null};1===r&&(n.limitPrice=e),await Object(s.ensureNotNull)(this._brokerCommandsUI()).placeOrder(n,!0)}_toggleState(e){e?this._start():this._stop()}_start(){this._dataEvents.symbolResolved().subscribe(this,this._createTradedSymbol),this._dataEvents.symbolError().subscribe(this,this._createTradedSymbol),this._createTradedSymbol(),this._suggestedQty.changed.subscribe(this,this._updateQty)}_stop(){this._clearTradedSymbol(),this._symbol=null,this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this),this._suggestedQty.changed.unsubscribeAll(this)}_createTradedSymbol(){const e=this._getSymbolName();e!==this._symbol&&(this._clearTradedSymbol(),e.length>0&&this._initTradedSymbol(e))}_initTradedSymbol(e){this._symbol=e,this._updateIsSymbolTraded(),this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler)}_clearTradedSymbol(){this.ask.setValue(null),this.bid.setValue(null),this.spread.setValue(null),this.qty.setValue(null),null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(this._symbol,this._updateRealtimeDataHandler),this._symbol=null,this._updateIsSymbolTraded())}_isMarketOrderSupported(){const e=this._realtimeProvider.activeBroker();return null===e||Boolean(e.metainfo().configFlags.supportMarketOrders)}_updateTradePossibilityAndTooltip(){this._updateCanTrade(),this._updateSellBuyTooltip()}_updateCanTrade(){let e=!1,t=!1;const i=this._isSymbolTradableResult.value();this._isBrokerConnected.value()&&null!==i&&i.tradable&&(t=!0,this.canTrade.value()||(e=!0)),this.canTrade.setValue(t),e&&null!==this._symbol&&this._updateQty(this._symbol)}_updateSellBuyTooltip(){
const e=this._isSymbolTradableResult.value();let t=null,i=null,r=null;const s=null===this.ask.value(),n=null===this.bid.value();null===e||e.tradable?(s||n)&&(s&&(i=xe),n&&(r=Me)):t=e.shortReason?e.shortReason:this._isBrokerConnected.value()?Ve:De,this.askTooltip.setValue(i||t||Re),this.bidTooltip.setValue(r||t||qe)}_updateRealtimeData(e,t,i){this._formatter=i.formatter,this._spreadFormatter=i.spreadFormatter;const r=t.ask,s=t.bid,o=Object(n.isNumber)(r)?this._formatter.format(r):null,a=Object(n.isNumber)(s)?this._formatter.format(s):null;this.ask.setValue(o),this.bid.setValue(a);const l=t.spread||Object(n.isNumber)(r)&&Object(n.isNumber)(s)&&r-s||0,c=Object(n.isNumber)(t.spread)?this._spreadFormatter:this._formatter;this.spread.setValue(c.format(l));let d=!1;Object(Ie.isFormatterHasForexAdditionalPrecision)(this._formatter)&&(d=this._formatter.hasForexAdditionalPrecision()),this.hasAskBidAdditionalPrecision.setValue(d)}async _updateIsSymbolTraded(){if(null===this._symbol)return void this._isSymbolTradableResult.setValue(null);const e=await this._realtimeProvider.isTradable(this._symbol);this._isSymbolTradableResult.setValue(Object(Oe.clone)(e))}async _updateQty(e){if(e!==this._symbol||!this.canTrade.value())return;let t=await this._suggestedQty.value(e);(!isFinite(t)||t<=0)&&(t=1),this.qty.setValue(""+Object(n.fixComputationError)(t))}_updateIsQtyVisible(){const e=this._isInstantMode.value()&&this.canTrade.value();this.isQtyVisible.setValue(e)}_updateQtyTooltip(){this.qtyTooltip.setValue(this._getQtyTooltip())}_getQtyTooltip(){const e=this._realtimeProvider.activeBroker();return null!==e&&e.metainfo().configFlags.showQuantityInsteadOfAmount?He:We}_updateBrokerIcon(){if(!Qe)return;let e;const t=this._realtimeProvider.activeBroker();if(null!==t){const i=t.metainfo();e="dark"===this._themeName.value()&&i.logoMiniBlackUrl?i.logoMiniBlackUrl:i.logoMiniUrl}this.brokerIconVisible.setValue(this._isBrokerConnected.value()),this.brokerIconUrl.setValue(e||null)}}i("LVLx");var Ke=i("MjAr"),Ge=i("UXvI"),Ze=i("EOiv"),Je=i("AvGy"),$e=i("S8UK"),Ye=i("qBrV"),Xe=i("N8pX"),et=i("0jws"),tt=i("F+J5"),it=i("OKVU");const rt=parseInt(tt["css-value-padding"]),st=!Object(J.isFeatureEnabled)("mobile_trading");function nt(e,t,i,r){let n=e.querySelector("."+r);if(!i)return null!==n&&n.remove(),void Object(Ye.a)(e,t);null===n&&(n=document.createElement("span"),n.classList.add(r),e.appendChild(n)),Object(Ye.a)(Object(s.ensureNotNull)(n),t.slice(-1)),Object(Ye.a)(e,t.slice(0,-1))}class ot{constructor(e,t,i,r){this.element=document.createElement("div"),this._sellButtonEl=document.createElement("div"),this._sellButtonTextEl=document.createElement("span"),this._buyButtonEl=document.createElement("div"),this._buyButtonTextEl=document.createElement("span"),this._spreadQtyWrapper=document.createElement("div"),this._spreadEl=document.createElement("div"),this._qtyEl=document.createElement("div"),this._qtyTextEl=document.createElement("span"),this._brokerButtonEl=document.createElement("div"),this._brokerIconWrapEl=document.createElement("div"),
this._isCalcOpened=!1,this._calcContainer=document.createElement("div"),this._sellLoader=new Ze.a(this._sellButtonEl,{className:Xe.loader}),this._buyLoader=new Ze.a(this._buyButtonEl,{className:Xe.loader}),this._windowResizeHandlerThrottle=Object(Ge.default)(this._windowResizeHandler.bind(this),100),this._isHiddenByViewport=!1,this._mode=2,this._height=new S.a(0),this._resizeObserver=null,this._cachedBreakPoints={},this._parentWidth=0,this._getCurrentQty=()=>{const e=this._qty.value();return null!==e?Number(e):null},this._model=e,this._toggleMinimizeBottomWidgetBar=r,this._ask=this._model.ask.spawn(),this._ask.subscribe(this._updateBuyButton.bind(this)),this._bid=this._model.bid.spawn(),this._bid.subscribe(this._updateSellButton.bind(this)),this._spread=this._model.spread.spawn(),this._spread.subscribe(this._updateSpread.bind(this)),this._qty=this._model.qty.spawn(),this._qty.subscribe(this._updateQty.bind(this)),this._brokerIconVisible=this._model.brokerIconVisible.spawn(),this._brokerIconVisible.subscribe(this._updateBrokerIconImage.bind(this)),this._brokerIconUrl=this._model.brokerIconUrl.spawn(),this._brokerIconUrl.subscribe(this._updateBrokerIconImage.bind(this),{callWithLast:!0}),this._trackEvent=i,this._render(),this._askTooltip=this._model.askTooltip.spawn(),this._askTooltip.subscribe(this._updateButtonTooltip.bind(this,this._buyButtonEl),{callWithLast:!0}),this._bidTooltip=this._model.bidTooltip.spawn(),this._bidTooltip.subscribe(this._updateButtonTooltip.bind(this,this._sellButtonEl),{callWithLast:!0}),this._spreadTooltip=this._model.spreadTooltip.spawn(),this._spreadTooltip.subscribe(this._updateButtonTooltip.bind(this,this._spreadEl),{callWithLast:!0}),this._qtyTooltip=this._model.qtyTooltip.spawn(),this._qtyTooltip.subscribe(this._updateButtonTooltip.bind(this,this._qtyEl),{callWithLast:!0}),this._isVisible=this._model.visible.spawn(),this._isVisible.subscribe(this._updateVisibility.bind(this),{callWithLast:!0}),this._isQtyVisible=this._model.isQtyVisible.spawn(),this._isQtyVisible.subscribe(this._updateQtyVisibility.bind(this),{callWithLast:!0}),this._isLastDigitSup=this._model.hasAskBidAdditionalPrecision.spawn(),this._isLastDigitSup.subscribe(this._updateLastDigitSup.bind(this)),this._highButtonsMode=t.spawn(),this._highButtonsMode.subscribe(this._updateHighButtonsMode.bind(this),{callWithLast:!0}),this._canTrade=this._model.canTrade.spawn(),this._canTrade.subscribe(this._updateBgButtonsMode.bind(this),{callWithLast:!0}),this._sellButtonHandler=this._onSellButton.bind(this),this._buyButtonHandler=this._onBuyButton.bind(this),this._qtyHandler=this._toggleCalcVisibility.bind(this),this._brokerButtonHandler=this._onBrokerButton.bind(this),this._sellButtonEl.addEventListener("click",this._sellButtonHandler),this._buyButtonEl.addEventListener("click",this._buyButtonHandler),this._qtyEl.addEventListener("click",this._qtyHandler),this._brokerButtonEl.addEventListener("click",this._brokerButtonHandler),window.addEventListener("resize",this._windowResizeHandlerThrottle),this._windowResizeHandler()}destroy(){
var e;this._ask.destroy(),this._askTooltip.destroy(),this._bid.destroy(),this._bidTooltip.destroy(),this._spread.destroy(),this._spreadTooltip.destroy(),this._qty.destroy(),this._qtyTooltip.destroy(),this._isVisible.destroy(),this._isQtyVisible.destroy(),this._isLastDigitSup.destroy(),this._highButtonsMode.destroy(),this._canTrade.destroy(),this._brokerIconUrl.destroy(),this._sellButtonEl.removeEventListener("click",this._sellButtonHandler),this._buyButtonEl.removeEventListener("click",this._buyButtonHandler),this._qtyEl.removeEventListener("click",this._qtyHandler),this._brokerButtonEl.removeEventListener("click",this._brokerButtonHandler),null===(e=this._resizeObserver)||void 0===e||e.disconnect(),this._resizeObserver=null,this.element.remove(),delete this.element,window.removeEventListener("resize",this._windowResizeHandlerThrottle)}updateModeByWidth(e){const t=this._cachedBreakPoints[0],i=this._cachedBreakPoints[1];this._mode=void 0!==t&&e<t?0:void 0!==i&&e<i?1:2,this._parentWidth=e,this.element.classList.toggle(Xe.column,1===this._mode),this._updateVisibility()}height(){return this._height}renderTo(e,t){void 0!==t?e.insertBefore(this.element,t):e.appendChild(this.element),null===this._resizeObserver&&(this._resizeObserver=new Ke.default(this._updateBreakPointsAndSize.bind(this))),this._resizeObserver.unobserve(this.element),this._resizeObserver.observe(this.element)}isHiddenByViewport(){return this._isHiddenByViewport}_render(){const e=this._bid.value()||"...";this._sellButtonTextEl.appendChild(document.createTextNode(e)),this._sellButtonTextEl.classList.add(Xe.buttonText),this._sellButtonEl.append(this._sellButtonTextEl),this._sellButtonEl.classList.add("apply-common-tooltip",Xe.button,Xe.sellButton);const t=this._spread.value()||"";this._spreadEl.appendChild(document.createTextNode(String(t))),this._spreadEl.classList.add("apply-common-tooltip",Xe.spread);const i=this._qty.value()||"";this._qtyTextEl.appendChild(document.createTextNode(i)),this._qtyEl.append(this._qtyTextEl),this._qtyEl.classList.add("apply-common-tooltip",Xe.button,Xe.qty),this._spreadQtyWrapper.classList.add(Xe.spreadQtyWrapper),this._spreadQtyWrapper.appendChild(this._spreadEl),this._spreadQtyWrapper.appendChild(this._qtyEl);const r=this._ask.value()||"...";this._buyButtonTextEl.appendChild(document.createTextNode(String(r))),this._buyButtonTextEl.classList.add(Xe.buttonText),this._buyButtonEl.append(this._buyButtonTextEl),this._buyButtonEl.classList.add("apply-common-tooltip",Xe.button,Xe.buyButton),this._brokerButtonEl.appendChild(this._brokerIconWrapEl),this._brokerIconWrapEl.classList.add(Xe.brokerButtonIconWrap),this._brokerButtonEl.classList.add(Xe.brokerButton),this.element.appendChild(this._sellButtonEl),this.element.appendChild(this._spreadQtyWrapper),this.element.appendChild(this._buyButtonEl),this.element.appendChild(this._brokerButtonEl),this.element.classList.add(Xe.wrapper),this.element.classList.toggle(Xe.touchMode,Je.a),this.element.classList.toggle(Xe.notAvailableOnMobile,st)}_updateBreakPointsAndSize(e){const t=e[0],i=2*rt
;2===this._mode&&(this._cachedBreakPoints[1]=Math.round(t.contentRect.width)+i),1===this._mode&&(this._cachedBreakPoints[0]=Math.round(t.contentRect.width)+i),this.updateModeByWidth(this._parentWidth);const r=t.contentRect.height>0?Math.round(t.contentRect.height)+i:0;this._height.setValue(r)}_updateBrokerIconImage(){const e=!this._brokerIconVisible.value();if(this._brokerButtonEl.classList.toggle(et.blockHidden,e),e)return;const t=this._brokerIconUrl.value(),i=null===t;this._brokerIconWrapEl.innerHTML=i?it:`<image src="${t}" alt="Account Manager" />`,this._brokerButtonEl.classList.toggle(Xe.brokerButtonDefault,i)}async _onSellButton(){if(null===this._bid.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Sell",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!0),await this._model.tryToPlaceSellOrder(),e&&this._canTrade.value()&&setTimeout(()=>this._toggleLoaderVisibility(this._sellButtonEl,this._sellLoader,!1),300)}async _onBuyButton(){if(null===this._ask.value())return;const e=this._highButtonsMode.value();this._trackEvent("Sell/Buy Buttons","Buy",e?"Instant":"Not Instant"),e&&this._canTrade.value()&&this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!0),await this._model.tryToPlaceBuyOrder(),e&&this._canTrade.value()&&setTimeout(()=>this._toggleLoaderVisibility(this._buyButtonEl,this._buyLoader,!1),300)}_onBrokerButton(){this._model.canShowMobileTrading()?Object($e.a)():this._toggleMinimizeBottomWidgetBar()}_toggleLoaderVisibility(e,t,i){e.classList.toggle(Xe.loading,i),t.toggleVisibility(i)}_updateBuyButton(e){const t=null!==e&&this._isLastDigitSup.value();nt(this._buyButtonTextEl,""+(e||"..."),t,Xe.lastCharSup)}_updateSellButton(e){const t=null!==e&&this._isLastDigitSup.value();nt(this._sellButtonTextEl,""+(e||"..."),t,Xe.lastCharSup)}_updateSpread(e){const t=""+(e||"");Object(Ye.a)(this._spreadEl,t),this._updateVisibilityForSpreadQtyWrapper()}_updateQty(e){let t=""+(e||"");!this._isCalcOpened&&t.length>0&&(t=Object(B.a)(Number(t))),Object(Ye.a)(this._qtyTextEl,t)}_updateHighButtonsMode(e){this.element.classList.toggle(Xe.highButtons,e)}_updateBgButtonsMode(e){this.element.classList.toggle(Xe.withoutBg,!e)}_updateVisibilityForSpreadQtyWrapper(){const e=!this._isQtyVisible.value()&&null===this._spread.value();this._spreadQtyWrapper.classList.toggle(et.blockHidden,e)}_updateQtyVisibility(e){this._qtyEl.classList.toggle(et.blockHidden,!e),this._spreadQtyWrapper.classList.toggle(Xe.withoutQty,!e),this._updateVisibilityForSpreadQtyWrapper()}_updateVisibility(){const e=this._isVisible.value()&&0!==this._mode&&!this._isHiddenByViewport;this.element.classList.toggle(et.blockHidden,!e)}_updateLastDigitSup(){this._updateBuyButton(this._ask.value()),this._updateSellButton(this._bid.value())}_updateButtonTooltip(e,t){e.setAttribute("title",t)}_toggleCalcVisibility(){this._isCalcOpened=!this._isCalcOpened,this._renderCalc()}_closeCalc(){this._isCalcOpened=!1,this._updateQty(this._qty.value()),
this._model.applyQty(),this._renderCalc()}_renderCalc(){Promise.all([i.e(5),i.e(6),i.e(9),i.e(12),i.e(19),i.e(70),i.e(79),i.e(367),i.e(4),i.e(8),i.e(21),i.e(67),i.e(97),i.e("trading-custom-widgets")]).then(i.bind(null,"Hmbi")).then(async e=>{const t=await this._model.getQtyInfo();null!==t&&e.render(this._isCalcOpened,this._calcContainer,Object.assign(Object.assign({},t),{withInput:!0,valueGetter:this._getCurrentQty,position:this._getCalcPosition(),targetEl:this._qtyEl,onClose:this._closeCalc.bind(this),onValueChange:this._model.setQty.bind(this._model),trackEventTarget:"Sell/Buy Buttons",trackEvent:this._trackEvent}))})}_getCalcPosition(){const e=this._qtyEl.getBoundingClientRect();return{x:e.left,y:e.bottom+2}}_windowResizeHandler(){const e=st&&(window.innerWidth<567||window.innerHeight<440);this._isHiddenByViewport!==e&&(this._isHiddenByViewport=e,this._updateVisibility())}}var at=i("7KDR");const lt=window.t("Show Buy/Sell Buttons");class ct{constructor(e,t,i,r){this._showSellBuyButtons=r.showSellBuyButtons,this._trackEvent=i.trackEvent,this._model=new ze(e,t,i,r),this._renderer=new ot(this._model,r.noConfirmEnabled,i.trackEvent,i.toggleMinimizeBottomWidgetBar)}destroy(){this._model.destroy(),this._renderer.destroy()}renderTo(e,t){this._renderer.renderTo(e,t)}setGlobalVisibility(e){this._model.setGlobalVisibility(e)}visibility(){return this._model.visible}updateWidgetModeBySize(e){this._renderer.updateModeByWidth(e.w)}contextMenuActions(){if(this._renderer.isHiddenByViewport())return[];return[new at.Action({checkable:!0,checked:this._showSellBuyButtons.value(),label:lt,onExecute:()=>{const e=!this._showSellBuyButtons.value();this._showSellBuyButtons.setValue(e),this._trackEvent("SellBuyButtonsWidget context menu","Show Sell/Buy Button",e?"Check":"Uncheck")}})]}height(){return this._renderer.height()}}var dt=i("i8i4"),ut=i("sQaR"),ht=i("g89m"),pt=i("T7lC");const _t=z.a.forwardRef((e,t)=>z.a.createElement("div",{ref:t,className:pt.popupWrapper},e.children));var bt=i("+EG+");const mt=new S.a(0),gt=(()=>{let e,t,r=null,s=null;return async(n,o,a)=>{const l=null==n?void 0:n.currentAccount();if(null===r||s!==n||e!==l){null==t||t.remove();const{AccountManager:c}=await Promise.all([i.e("vendors"),i.e(3),i.e(5),i.e(13),i.e(15),i.e(23),i.e(26),i.e(31),i.e(34),i.e(51),i.e(65),i.e(102),i.e(140),i.e(219),i.e(433),i.e(4),i.e(44),i.e(203),i.e("trading-account-manager")]).then(i.bind(null,"zAqB")),d={container:o,height:mt,visible:new S.a(!0)};r=o,s=n,e=l,t=new c(n,d,0,a)}else o.appendChild(r)}})(),vt=new S.a(null);function ft(e){const t=Object(U.useRef)(null),i=Object(U.useContext)(bt.b);return Object(U.useEffect)(()=>{vt.setValue(i)},[i]),Object(U.useEffect)(()=>(null!==t.current&&(window.addEventListener("resize",r),r(),gt(e.broker,t.current,vt.readonly())),()=>{window.removeEventListener("resize",r)}),[]),z.a.createElement(_t,{ref:t});function r(){null!==t.current&&mt.setValue(t.current.clientHeight)}}var yt=i("jPOK"),wt=i("2Ekt");const kt=Object(r.t)("Trading");class Bt extends ut.a{constructor(e){super(),this._title=kt,
this._isSubscribed=!1,this._showSeparator=!0,this._unsetHeaderAlign=!0,this._handleClose=()=>{dt.unmountComponentAtNode(this._container),this._setVisibility(!1)},this._trading=e}show(){this._isSubscribed||(this._isSubscribed=!0,this._onStatusChange(this._trading.connectStatus()),this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange)),this._setVisibility(!0),this._renderComponent()}hide(){this._handleClose()}destroy(){this._isSubscribed=!1,this._trading.onConnectionStatusChange.unsubscribe(this,this._onStatusChange),this._handleClose()}_onStatusChange(e){this._connectStatus!==e&&(this._connectStatus=e,2===e&&this._renderSpinner(),3!==e&&4!==e||this._renderBrokerSelectScreen(),1===e&&this._renderAccountManager())}_renderComponent(){dt.render(U.createElement(ht.a,{dataName:"trading-dialog",isOpened:this.visible().value(),onClose:this._handleClose,showSeparator:this._showSeparator,unsetHeaderAlign:this._unsetHeaderAlign,fullScreen:!0,draggable:!1,title:this._title,render:()=>this._content}),this._container)}_renderSpinner(){this._unsetHeaderAlign=!1,this._showSeparator=!0,this._title=kt,this._changeDialogContent(U.createElement(yt.a,null))}async _renderBrokerSelectScreen(){const{BrokerSelectScreenRenderer:e}=await Promise.all([i.e(2),i.e(220),i.e(529),i.e("broker-select-screen")]).then(i.bind(null,"Azu3")),t=new e(null,null,new S.a(!0),this._trading,new S.a(!1)),r=await t.createComponent();this._showSeparator=!0,this._unsetHeaderAlign=!1,this._title=kt,this._changeDialogContent(r)}async _renderAccountManager(){const e=await Object(wt.a)(this._trading);if(this._showSeparator=!1,this._unsetHeaderAlign=!0,this._title=kt,void 0!==e){const{AccountManagerHeaderDropdowns:t}=await Promise.all([i.e("vendors"),i.e(3),i.e(5),i.e(13),i.e(15),i.e(23),i.e(26),i.e(31),i.e(34),i.e(51),i.e(65),i.e(102),i.e(140),i.e(219),i.e(433),i.e(4),i.e(44),i.e(203),i.e("trading-account-manager")]).then(i.bind(null,"Z4QD"));this._title=U.createElement(t,Object.assign({},e))}this._content=U.createElement(ft,{broker:this._trading.activeBroker()}),this._renderComponent()}_changeDialogContent(e){this._content=U.createElement(_t,null,e),this._renderComponent()}}var Pt=i("cJM1"),Ct=(i("xJkl"),i("bNPh")),St=i("xOeO"),Ot=i("xlbu");class Tt{constructor(e){this._subscribedBroker=null,this._trading=e,this._trading.onConnectionStatusChange.subscribe(this,this._onStatusChange)}_onStatusChange(e){if(null!==this._subscribedBroker&&(this._subscribedBroker.tradingOperationFinished.unsubscribe(this,this._sendOperationReport),this._subscribedBroker=null),1===e){const e=Object(s.ensureNotNull)(this._trading.activeBroker());e.tradingOperationFinished.subscribe(this,this._sendOperationReport),this._subscribedBroker=e,this._sendReport("connection_success")}4===e&&(this._sendReport("connection_fail"),"Paper"===Object(s.ensureNotNull)(this._trading.activeBroker()).metainfo().id&&this._trading.trackEvent("BrokerTelemetry","Paper Connection Error",navigator.onLine.toString()))}_sendOperationReport(e){this._sendReport(e?"operation_success":"operation_fail")}
_sendReport(e){const t=this._subscribedBroker||this._trading.activeBroker();if(null===t)return;const i=(t.metainfo().telemetryId||t.metainfo().id).toLowerCase();Ot.telemetry.sendReport("trading",i+"_"+e)}}var Et=i("8ESU"),Nt=i("DhHm");const Lt={logIn:window.t("Log in"),GotIt:window.t("Got it")};class jt{constructor(){this._hintTooltip=null,this._tooltipRendererModulePromise=null}drawAttention(){const e=document.querySelector("."+k.a);this._loadOrShowHint(e,Nt.TradingWizardHintType.NeedBrokerSignIn)}needSignIn(e,t){this._loadOrShowHint(e,Nt.TradingWizardHintType.NeedSignIn,{action:t,text:Lt.logIn})}showTooltipOverSelectBrokerButton(e){this._loadOrShowHint(e,Nt.TradingWizardHintType.AboutFavoritesBrokers)}destroy(){null!==this._hintTooltip&&this._hintTooltip.destroy()}_loadOrShowHint(e,t,r,s){null!==e&&V.enabled("popup_hints")&&(this._hintTooltip?this._hintTooltip.show(e,t,r,s):null===this._tooltipRendererModulePromise&&(this._tooltipRendererModulePromise=Promise.resolve().then(i.bind(null,"DhHm")).then(i=>{this._hintTooltip=new i.TradingToolipRenderer,this._hintTooltip.show(e,t,r,s)})))}}var At=i("wVAQ"),It=i("Nl/Q"),Dt=i("HjS6"),Vt=i("MZiX"),Mt=i("KuNA"),xt=i("MXV9"),Rt=i("dXtN"),qt=i("hJUO");i.d(t,"showSellBuyButtonsDefault",(function(){return zt})),i.d(t,"Trading",(function(){return Kt}));const Ft=Object(h.getLogger)("Trading.Core"),Wt={1:"Connected",2:"Connecting",3:"Disconnected",4:"Error"};var Ht;!function(e){e[e.Paper=43000516466]="Paper",e[e.CQG=43000516372]="CQG",e[e.OANDA=43000516375]="OANDA",e[e.FOREXCOM=43000516374]="FOREXCOM"}(Ht||(Ht={}));const Qt={enabled:new S.a(!1),name:"alert/alarm_clock"};const Ut=V.enabled("buy_sell_buttons"),zt=!0;class Kt{constructor(e){this.accountType=new S.a,this.onBrokerChange=new u.a,this.onBrokerLoading=new u.a,this.onConnectionStatusChange=new u.a,this.onNewNotification=new u.a,this.onNeedSelectBroker=new u.a,this.onNotificationsChanged=new u.a,this.showSellBuyButtons=new S.a,this.noConfirmEnabled=new S.a,this.showOnlyRejectionNotifications=new S.a,this.showPricesWithZeroVolume=new S.a,this.showSpread=new S.a,this.orderExecutedSoundParams=Qt,this._activeBroker=null,this._orderViewController=null,this._orderControllerPromise=null,this._brokerCommandsUI=null,this._showPricesWithZeroVolume=new S.a,this._showSpread=new S.a,this._offlineListener=this._offlineHandler.bind(this),this._onlineListener=this._onlineHandler.bind(this),this._notifications=[],this._account=null,this._domPanelVisibility=new S.a(!1),this._orderPanelVisibility=new S.a(!1),this._switchingBroker=!1,this._accountVerificationPromise=null,this._chartWidgetCollection=null,this._updateAccountId=()=>{this._account=Object(s.ensureNotNull)(this._activeBroker).currentAccount(),this.onNotificationsChanged.fire(this.getNotifications())},this._resizerBridge=e,this._realtimeProvider=new g(()=>this.activeBroker(),this.onBrokerChange,this.onConnectionStatusChange,this.suggestedQty()),this._positionService=new Ne(this),this._ordersService=new je(this),this._tradingStat=new y(this),new Tt(this),this._tradingWizard=new jt,
this._initPaidBrokersByUserRegion(),this.tradingPanelPopup=new Bt(this),this.tradingPanel=new le(e);const t=new ie(e,()=>this.tradingPanel.close());this.tradingPanel.addPage(se.d.DomPanel,t);const r=new re;this.tradingPanel.addPage(se.d.OrderPanel,r);const n=w.getValue(l.settingsKeys.TRADING_PANEL_ACTIVE_PAGE),o=w.getBool(l.settingsKeys.TRADING_PANEL_OPENED,V.enabled("show_order_panel_on_start"));this._applyCQGTerminalRedirectPatches(),window.is_authenticated?(n&&this.tradingPanel.activePage.setValue(n),o&&this.tradingPanel.open(),this.tradingPanel.isPageOpened(se.d.OrderPanel)&&this.tradingPanel.isAvailable.value()&&this.setOrderPanelVisibility(!0)):this.tradingPanel.close(),Object(P.combine)(()=>({}),this.tradingPanel.activePage,this.tradingPanel.isOpened).subscribe(()=>{this._domPanelVisibility.setValue(this.tradingPanel.isPageOpened(se.d.DomPanel)),this._orderPanelVisibility.setValue(this.tradingPanel.isPageOpened(se.d.OrderPanel))}),this._loginDialogRenderer=Promise.all([i.e("vendors"),i.e(2),i.e(6),i.e(9),i.e(12),i.e(13),i.e(15),i.e(16),i.e(19),i.e(40),i.e(366),i.e(8),i.e(21),i.e("login-dialog")]).then(i.bind(null,"hdTl")).then(e=>new e.LoginDialogRenderer(()=>this.selectBroker(null),this.trackEvent.bind(this),this._checkCQGCredentials.bind(this)))}setChartWidgetCollection(e){Object(s.assert)(null===this._chartWidgetCollection,"ChartWidgetCollection can be set only once"),this._chartWidgetCollection=e,this._guiAccessor=new I(e),new ge(this),this._loadState(),w.onSync.subscribe(this,this._loadState);const t=()=>{this._save()};this.showSellBuyButtons.subscribe(t),this.noConfirmEnabled.subscribe(t),this.showOnlyRejectionNotifications.subscribe(t),this._showPricesWithZeroVolume.subscribe(t),this._showSpread.subscribe(t),this.orderExecutedSoundParams.enabled.subscribe(t),window.addEventListener("offline",this._offlineListener),window.addEventListener("online",this._onlineListener),this.bindShortcuts(),window.loginStateChange.subscribe(null,()=>{window.is_authenticated&&!this._switchingBroker?this.pickDefaultBroker():this.activeBroker()&&this.selectBroker(null)}),setTimeout(()=>{window.is_authenticated&&!this._switchingBroker&&this.pickDefaultBroker()}),this._registerCustomSources(e),this._registerCustomWidgets(e)}showPricesWith(){return{zeroVolume:this._showPricesWithZeroVolume,spread:this._showSpread}}domPanelVisibility(){return this._domPanelVisibility}orderPanelVisibility(){return this._orderPanelVisibility}realtimeProvider(){return this._realtimeProvider}toggleTradingPanelPopup(){this.tradingPanelPopup.visible().value()?this.tradingPanelPopup.hide():this.tradingPanelPopup.show()}toggleTradingWidget(){return window.TradingView.bottomWidgetBar?window.TradingView.bottomWidgetBar.activateTradingTab():Promise.resolve()}toggleMinimizeBottomWidgetBar(){if(window.TradingView.bottomWidgetBar)return window.TradingView.bottomWidgetBar.toggleMinimize()}tradingWizard(){return this._tradingWizard}showTradingProperties(){this._gui()&&this._gui().showTradingProperties()}brokersList(){return o.b()}brokersPlans(){
return this._getBrokerPlans()}activeBroker(){return this._activeBroker}brokerCommandsUI(){return this._brokerCommandsUI}trackEvent(e,t,i){const r=e?`[${e}] ${t}`:t;if(this._gui()){const e=this._activeBroker?this._activeBroker.metainfo().id+" Trading":"Trading No Broker",t=this._activeBroker?this._activeBroker.currentAccountType():void 0;this._gui().trackEvent(e,r,i||t)}}async selectBroker(e,t){await this._selectBrokerInternal(e,!0,t)}pickDefaultBroker(){if(this._activeBroker)return;let e=null;const t=this.brokersList().filter(e=>!e.configFlags.isSuspended);if(1===t.length)e=t[0].id;else{const i=w.getValue(l.settingsKeys.ACTIVE_BROKER);i&&t.some(e=>e.id===i)&&(e=i)}e&&this.selectBroker(e)}async defaultContextMenuActions(e,{onlyMainActions:t=!1,gaOrigin:i="Chart Context Menu"}={}){const s=await this.suggestedQty().value(e.symbol),n=e.value||void 0,{bid:o,ask:a}=await this.realtimeProvider().quotesSnapshot(e.symbol),l=[];if(null!==e.value&&void 0!==a&&void 0!==o&&(e.value>=a||e.value<=o)){const t=(o+a)/2;l.push(...await this._makeSubActions(e,s,t,i))}return l.push({name:"trade-new-order",action:()=>{this.trackEvent(i,"New Order"),this._checkAndOpenOrderDialog({limitPrice:n,qty:s,stopPrice:n,symbol:e.symbol})},text:Object(D.appendEllipsis)(r.t("Create New Order")),statName:"NewOrder"}),!t&&V.enabled("property_pages")&&(l.push({separator:!0}),l.push({name:"trade-properties",action:()=>{this.trackEvent(i,"Trading Properties"),this.showTradingProperties()},text:Object(D.appendEllipsis)(r.t("Trading Settings")),icon:xt,statName:"Properties"})),l}defaultDropdownMenuActions(e){const t="Bottom Panel Dropdown",i=[],s=this.activeBroker(),n=e||{tradingProperties:!0,restoreConfirmations:s&&s.metainfo().configFlags.supportConfirmations,showHowToUse:s&&s.metainfo().configFlags.supportHowToUse};return V.enabled("property_pages")||(n.tradingProperties=!1),n.tradingProperties&&i.push({action:()=>{this.showTradingProperties(),this.trackEvent(t,"Trading Properties")},text:Object(D.appendEllipsis)(r.t("Trading Settings")),icon:xt}),n.restoreConfirmations&&i.push({action:()=>{this._showRestoreConfirmations(),this.trackEvent(t,"Restore confirmations")},text:Object(D.appendEllipsis)(r.t("Restore confirmations"))}),n.showHowToUse&&s&&i.push({action:()=>{this.trackEvent(t,"How to use"),this._showSupportDialog(s.currentBroker())},text:r.t("How to Use {brokerName}").replace("{brokerName}",s.metainfo().title)}),i}chartContextMenuActions(e,t){return(this._activeBroker&&1===this._activeBroker.connectionStatus()?this._activeBroker.chartContextMenuActions(e,t):this.defaultContextMenuActions(e,t)).then(e=>Object(k.c)(e))}connectStatus(){return this._activeBroker?this._activeBroker.connectionStatus():3}bindShortcuts(){if(this._hotkeys)return;this._hotkeys=ce.createGroup({desc:"Trading"});const e=e=>{const t=this._gui().proSymbol();this.suggestedQty().value(t).then(i=>{this.realtimeProvider().quotesSnapshot(t).then(({bid:r,ask:s})=>{const n={price:void 0!==r&&void 0!==s?(r+s)/2:NaN,qty:i,side:e,symbol:t,type:2,seenPrice:null}
;this.trackEvent("Shortcut",-1===e?"Sell":"Buy"),this._checkAndPlaceOrder(n)})})};this._hotkeys.add({desc:"Buy",hotkey:ce.Modifiers.Shift+66,handler:()=>e(1)}),this._hotkeys.add({desc:"Sell",hotkey:ce.Modifiers.Shift+83,handler:()=>e(-1)})}suggestedQty(){if(!this._suggestedQty){const e=new u.a;this._suggestedQty={changed:e,setValue:(t,i)=>{this._setSymbolQty(t,i),e.fire(t)},value:e=>this.realtimeProvider().symbolInfo(e).then(t=>{const i=this._getSymbolQty(e)||this._getOldSymbolQty(e),r=void 0!==t.qty.default?t.qty.default:t.qty.min;return i?Object(n.alignTo)(Math.max(Math.min(t.qty.max,+i),t.qty.min),Math.min(t.qty.step,t.qty.min)):r})}}return this._suggestedQty}formatter(e){return this.realtimeProvider().formatter(e)}showSuccessNotification(e,t,i=1e4){this.showOnlyRejectionNotifications.value()||this._showNotification(e,t,"success",i),V.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,"success",i),this._log(e,t)}showErrorNotification(e,t,i=25e3){this._showNotification(e,t,"danger",i),V.enabled("show_trading_notifications_history")&&this._addNotificationRow(e,t,"danger",i),this._log(e,t)}getNotifications(){return this._notifications.filter(e=>e.account===this._account&&e.broker===(this._activeBroker?this._activeBroker.metainfo().id:null))}setDomPanelVisibility(e){e?this.tradingPanel.openPage(se.d.DomPanel):this.tradingPanel.close()}setOrderPanelVisibility(e){this._getOrderViewController().then(t=>{e?t.openPanel():t.closePanel()})}orderViewController(){return Object(s.ensureNotNull)(this._orderViewController)}tradingStat(){return this._tradingStat}async verifyBrokerLiveAccount(){return this._verifyLiveAccount(),null!==this._accountVerificationPromise?this._accountVerificationPromise:Promise.reject("Account verification is not needed")}_getOrderViewController(){return null===this._orderViewController?this._createOrderController().then(()=>this._getOrderViewController()):Promise.resolve(this._orderViewController)}_getSymbolQty(e){const t=this._getBrokerSymbolsQty();if(t)return t[e]}_getOldSymbolQty(e){const t=w.getFloat(l.settingsKeys.QTY+e);return void 0!==t&&(this._setSymbolQty(e,t),w.remove(l.settingsKeys.QTY+e)),t}_getBrokerSymbolsQty(){if(!this._activeBroker)return;const e=this._activeBroker.metainfo().id;return w.getJSON(l.settingsKeys.BROKERS_QTY,{})[e]}_setSymbolQty(e,t){if(this._activeBroker){const i=this._activeBroker.metainfo().id,r=w.getJSON(l.settingsKeys.BROKERS_QTY,{});r[i]||(r[i]={}),r[i][e]=t,w.setJSON(l.settingsKeys.BROKERS_QTY,r)}}async _selectBrokerInternal(e,t,i=!1,s){if(!0===this._switchingBroker)return void Ft.logWarn(`Broker is already selected, but a new broker id: ${e} was received.`);const n=this._activeBroker?this._activeBroker.metainfo().id:null;if(e!==n)if(e&&Object(J.isFeatureEnabled)(Object(k.k)(e))){const t=o.b().filter(t=>t.id===e)[0];this._gui().showMaintenance(t.title)}else if(e&&Object(J.isFeatureEnabled)(Object(k.j)(e))){const t=o.b().filter(t=>t.id===e)[0];this._gui().showBrokerSideMaintenance(t.title)}else{if(this._activeBroker){
const e=this._activeBroker&&this._activeBroker.disconnectWarningMessage(),n=()=>this._showReviewDialogIfNeeded(3,{disconnectType:a.DisconnectType.LogOut});null===e?(n(),this._logOut(t,i,s)):Object(ve.showConfirm)({title:r.t("Log Out Confirmation"),text:e,mainButtonText:r.t("Log Out"),mainButtonIntent:"danger",cancelButtonText:r.t("Cancel"),onConfirm:({dialogClose:e})=>{n(),this._logOut(t,i,s),e()},onCancel:({dialogClose:e})=>{n(),e()}})}if(null!=e){let t;!function(){if(!window.is_authenticated)throw Ft.logError("User is not logged in"),new Error("Please sign in first.")}(),this._switchingBroker=!0;t=(await this._getBrokerPlans()).filter(t=>t.slug_name===e)[0],window.user.active_broker=t;try{const r=await o.c(this,e,t);this._initBroker(r,i)}catch(c){Ft.logError(c)}}else t&&setTimeout(()=>{w.remove(l.settingsKeys.ACTIVE_BROKER),delete window.user.active_broker}),this.onBrokerChange.fire(null),this._brokerCommandsUI=null,this._accountVerificationPromise=null}}_initBroker(e,t){this._activeBroker&&(Ft.logWarn("Another one connecting broker detected. Disconnect it."),this._activeBroker.disconnect(t),this._activeBroker.destroy()),this._switchingBroker=!1,this._activeBroker=e,e.connectionStatusUpdate.subscribe(this,this._connectionListener),this._brokerCommandsUI=new ee(this._activeBroker,this._guiAccessor,this.noConfirmEnabled,this._getOrderViewController.bind(this),this.showErrorNotification.bind(this),this.trackEvent.bind(this)),e.tryRestoreSession(),w.setValue(l.settingsKeys.ACTIVE_BROKER,e.metainfo().id),this.onBrokerChange.fire(this._activeBroker),this._getOrderViewController(),this._updateConnectionStatus(this.connectStatus())}_gui(){return this._guiAccessor}_addNotificationRow(e,t,i,r){const s={id:this._notifications.length,account:this._account,broker:this._activeBroker?this._activeBroker.metainfo().id:null,time:new Date,title:e,text:t,type:i};this._notifications.push(s),this.onNewNotification.fire(s)}_offlineHandler(){this._selectBrokerInternal(null,!1,!1,{disconnectType:a.DisconnectType.Offline}),Ft.logNormal("The connection to the Internet was interrupted")}_onlineHandler(){const e=w.getValue(l.settingsKeys.ACTIVE_BROKER);e&&(this._selectBrokerInternal(e,!1),Ft.logNormal("The connection to the Internet was restored"))}_showNotification(e,t,i,r){this._gui()&&this._gui().showNotification(e,t,i,r)}_showReviewDialogIfNeeded(e,t){if(null===this._activeBroker)return;const i=this._activeBroker;if(Object(J.isFeatureEnabled)("review_popup_on_chart")&&(1===e||3===e&&t&&t.disconnectType===a.DisconnectType.LogOut)){const t=i.brokerPlan();t&&t.plan_verbose!==Mt.BrokerPlans.Free&&this.verifyBrokerLiveAccount().then(()=>{Vt.BrokerReviewPageData.setBrokerData({brokerId:t.id,brokerName:t.name,brokerUsername:t.username,brokerSlugName:t.slug_name}),window.runOrSignIn(()=>Object(It.b)().then(t=>{const n=l.settingsKeys.LOGIN_COUNTER+"."+i.metainfo().id,o=l.settingsKeys.LOGOUT_COUNTER+"."+i.metainfo().id;if(t===Dt.b.NonExists){const t=w.getInt(n,0),i=w.getInt(o,0);if(1===e&&3===t||3===e&&i>0&&i%5==0){
const t=Object(s.ensureNotNull)(Vt.BrokerReviewPageData.getBrokerData()),i="Chart page — connecting status "+(1===e?"connected":"disconnected"),n={title:r.t("Rate {broker_name}").format({broker_name:t.brokerName})};Object(It.c)(0,!1,{dialogTexts:n,dataForStats:i})}1===e&&w.setValue(n,t+1),3===e&&w.setValue(o,i+1)}else w.remove(n),w.remove(o)}),{source:"Trading panel, leave broker review"})}).catch(e=>Ft.logWarn(e))}}_connectionListener(e,t){const i=this.connectStatus();this._showReviewDialogIfNeeded(e,t),3===e&&t&&t.disconnectType===a.DisconnectType.LogOut&&this._selectBrokerInternal(null,!1,!1,t),this._updateConnectionStatus(i,!0,t)}_updateOrderPanelSpinnerState(){const e=this._orderViewController,t=2===this.connectStatus(),i=null!==e&&e.stateChanging.value();this.tradingPanel.isLoading.setValue(t||i)}_updateConnectionStatus(e,t=!0,i){this._updateOrderPanelSpinnerState(),this.onConnectionStatusChange.fire(e,i),this._log("Connection status",Wt[e]);const r=this._activeBroker;if(t){const e=this._activeBroker?this._activeBroker.metainfo().id:void 0;w.setValue(l.settingsKeys.ACTIVE_BROKER,e,{forceFlush:!0})}this._activeBroker?1===e?(this._account=this._activeBroker.currentAccount(),this._guiAccessor.setBroker(this._activeBroker),this._activeBroker.metainfo().configFlags.supportRealtimeDataCheck&&Object(Et.a)(this._activeBroker.metainfo().id,this._activeBroker.getRealtimeDataCheckParams()).then(e=>{e&&this._guiAccessor.reconnectChartApi(!0)}),this._verifyLiveAccount()):(this._accountVerificationPromise=null,null!==this._account&&this._activeBroker.currentAccountUpdate.unsubscribe(this,this._updateAccountId)):this._guiAccessor.setBroker(null),this._loginDialogRenderer.then(t=>{r===this._activeBroker&&(t.updateStatus(r,e,i),t.isVisible()&&this.tradingPanelPopup.visible().value()&&this.tradingPanelPopup.hide())})}_verifyLiveAccount(){if(null!==this._accountVerificationPromise)return;const e=Object(s.ensureNotNull)(this._activeBroker);e.metainfo().configFlags.supportVerifyLiveAccount&&e.currentAccountType()===a.AccountType.Live&&(this._accountVerificationPromise=Object(Et.b)(e))}_save(){w.setJSON(l.settingsKeys.PROPERTIES,{showSellBuyButtons:+!!this.showSellBuyButtons.value(),noConfirmEnabled:+!!this.noConfirmEnabled.value(),qweqrq:+!!this.showOnlyRejectionNotifications.value(),showPricesWithZeroVolume:+!!this._showPricesWithZeroVolume.value(),showSpread:+!!this._showSpread.value(),orderExecutedSoundParams:JSON.stringify({enabled:+!!this.orderExecutedSoundParams.enabled.value(),name:this.orderExecutedSoundParams.name})})}_loadState(){const e=w.getJSON(l.settingsKeys.PROPERTIES,{});if(this.showSellBuyButtons.setValue(void 0!==e.showSellBuyButtons?!!e.showSellBuyButtons:zt),this.noConfirmEnabled.setValue(!!e.noConfirmEnabled),this.showOnlyRejectionNotifications.setValue(!!e.qweqrq),this._showPricesWithZeroVolume.setValue(!e.hasOwnProperty("showPricesWithZeroVolume")||e.showPricesWithZeroVolume),this._showSpread.setValue(!e.hasOwnProperty("showSpread")||e.showSpread),e.hasOwnProperty("orderExecutedSoundParams")){
const t=JSON.parse(e.orderExecutedSoundParams);this.orderExecutedSoundParams.enabled.setValue(!!t.enabled),this.orderExecutedSoundParams.name=t.name}}_log(e,t){Ft.logNormal(`${this._activeBroker?this._activeBroker.metainfo().id+" Trading: ":""}${e} - ${t}`)}_makeSureCanTrade(){var e;const t=this.activeBroker(),i=this.brokerCommandsUI(),r=Boolean(null===(e=window.TradingView.bottomWidgetBar)||void 0===e?void 0:e.isVisible().value());return t&&i?1===t.connectionStatus()||(r?this.toggleTradingWidget():this.toggleTradingPanelPopup(),!1):(r?this.toggleTradingWidget().then(()=>this.onNeedSelectBroker.fire()):(this.toggleTradingPanelPopup(),this.onNeedSelectBroker.fire()),!1)}_checkAndPlaceOrder(e,t=!0){this._makeSureCanTrade()&&Object(s.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e,t)}_checkAndOpenOrderDialog(e){this._makeSureCanTrade()&&Object(s.ensureNotNull)(this.brokerCommandsUI()).placeOrder(e)}_makeSubAction(e,t,i,s,n,o,a){const l=1===t?qt:Rt,c=1===t?"Buy":"Sell",d=1===i?"Limit":"Stop",u=c+d,h={BuyLimit:r.t("Buy {symbol} Limit {qty} @ {value}").format({symbol:e.displaySymbol,qty:Object(B.a)(o),value:n}),SellStop:r.t("Sell {symbol} Stop {qty} @ {value}").format({symbol:e.displaySymbol,qty:Object(B.a)(o),value:n}),SellLimit:r.t("Sell {symbol} Limit {qty} @ {value}").format({symbol:e.displaySymbol,qty:Object(B.a)(o),value:n}),BuyStop:r.t("Buy {symbol} Stop {qty} @ {value}").format({symbol:e.displaySymbol,qty:Object(B.a)(o),value:n})};return{name:`trade-${c}-${d}`.toLowerCase(),action:()=>{this.trackEvent(a,`${c} ${d}`);const r=1===i?"limitPrice":"stopPrice",n={qty:o,side:t,symbol:e.symbol,type:i,seenPrice:null};null!==s&&(n[r]=s),this._checkAndPlaceOrder(n)},icon:l,text:h[u],statName:u}}_createOrderController(){return null===this._orderControllerPromise&&(this._orderControllerPromise=Promise.all([i.e(301),i.e("order-view-controller")]).then(i.bind(null,"3bpA")).then(({OrderViewController:e})=>new e({resizerBridge:this._resizerBridge,onNeedSelectBroker:this.onNeedSelectBroker,realtimeProvider:this.realtimeProvider(),suggestedQty:this.suggestedQty(),trackEvent:this.trackEvent.bind(this),toggleTradingWidget:this.toggleTradingWidget.bind(this),showErrorNotification:this.showErrorNotification.bind(this)},{container:this.tradingPanel.container,isAvailable:this.tradingPanel.isAvailable,isOpened:this.tradingPanel.isOpened,activePage:this.tradingPanel.activePage,close:this.tradingPanel.close.bind(this.tradingPanel),openPage:this.tradingPanel.openPage.bind(this.tradingPanel)})).then(e=>{this._orderControllerPromise=null,this._orderViewController=e,this._orderViewController.stateChanging.subscribe(()=>this._updateOrderPanelSpinnerState())})),this._orderControllerPromise}async _registerCustomSources(e){!async function(e,t){const r=await i.e("trading-custom-sources").then(i.bind(null,"bydf"));e.addCustomSource("bidask",(i,s)=>new r.BidAsk(i,s,t.realtimeProvider(),()=>{e.activeChartWidget.value().showGeneralChartProperties(j.TabNames.symbol)}))}(e,this),Se(e,this)
;new((await i.e("trading-custom-sources").then(i.bind(null,"ZvFF"))).TradedSourcesManager)(this._ordersService,this._positionService,e,{realtimeProvider:this._realtimeProvider,brokerCommandsUI:this.brokerCommandsUI.bind(this),trackEvent:this.trackEvent.bind(this)})}_registerCustomWidgets(e){Ut&&function(e,t){e.addCustomWidgetToLegend((e,i)=>{const r=e.mainSeries();return new ct(r.dataEvents(),function(e){return()=>{const t=e.symbolInfo();return null!==t?t.pro_name||"":e.proSymbol()}}(r),{onNeedSelectBroker:t.onNeedSelectBroker,realtimeProvider:t.realtimeProvider(),suggestedQty:t.suggestedQty(),trackEvent:t.trackEvent.bind(t),toggleTradingWidget:t.toggleTradingWidget.bind(t),toggleTradingPanelPopup:t.toggleTradingPanelPopup.bind(t),brokerCommandsUI:t.brokerCommandsUI.bind(t),toggleMinimizeBottomWidgetBar:()=>t.toggleMinimizeBottomWidgetBar()},{showSellBuyButtons:t.showSellBuyButtons,noConfirmEnabled:t.noConfirmEnabled,themeName:i})},{block:0,position:0})}(e,this)}async _makeSubActions(e,t,i,r){const s=[],o=this.activeBroker();let a,l,c,d,u,h,p,_,b,m=null===o,g=null===o;if(null!==o&&1===o.connectionStatus()&&(b=await o.isTradable(e.symbol)),null!==o&&b&&b.tradable&&null!==e.value){const t=o.metainfo().configFlags,i=await o.symbolInfo(e.symbol),r=(v=e.value,f=i.minTick,Object(n.fixComputationError)(Math.round(v/f)*f));if(a=r,c=r,d=r,l=r,m=Boolean(t.supportLimitOrders),g=Boolean(t.supportStopOrders),void 0!==i.limitPriceStep){a=Object($.roundToStepByPriceTypeAndSide)(e.value,i.limitPriceStep,1,1),c=Object($.roundToStepByPriceTypeAndSide)(e.value,i.limitPriceStep,1,-1)}if(void 0!==i.stopPriceStep){d=Object($.roundToStepByPriceTypeAndSide)(e.value,i.stopPriceStep,2,1),l=Object($.roundToStepByPriceTypeAndSide)(e.value,i.stopPriceStep,2,-1)}const s=await o.formatter(e.symbol,!1);u=s.format(a),h=s.format(l),p=s.format(c),_=s.format(d)}else a=c=d=l=e.value,u=h=p=_=e.formattedValue;var v,f;return null!==e.value&&e.value<=i?(m&&s.push(this._makeSubAction(e,1,1,a,u,t,r)),g&&s.push(this._makeSubAction(e,-1,3,l,h,t,r))):null!==e.value&&e.value>=i&&(m&&s.push(this._makeSubAction(e,-1,1,c,p,t,r)),g&&s.push(this._makeSubAction(e,1,3,d,_,t,r))),s}_initPaidBrokersByUserRegion(){this._brokersListPromise=Object(At.fetch)("/api/v1/brokers/trading_panel",{method:"GET"}).then(e=>e.json()).catch(e=>{Ft.logWarn("Failed to fetch brokers info: "+e)})}async _getBrokerPlans(){let e=[];try{if(e=await this._brokersListPromise,!Array.isArray(e))throw new Error("Request result is not valid")}catch(t){Ft.logError("Failed to fetch broker list by user region: "+t.message)}return e}async _checkCQGCredentials(e){try{if(this._activeBroker){await Object(Et.a)(this._activeBroker.metainfo().id,e)&&this._guiAccessor.reconnectChartApi(!0)}}catch(t){Ft.logError("Failed to fetch credentials verifier: "+t.message)}}_applyCQGTerminalRedirectPatches(){const e=w.getJSON(l.settingsKeys.FAVORITE_BROKERS,[]);for(const t of["CQG","AMP"])if(document.referrer.includes(t.toLowerCase()+".tradingview.com")&&!e.some(e=>e===t)){e.push(t),
w.setJSON(l.settingsKeys.FAVORITE_BROKERS,e);break}}_showSupportDialog(e){e in Ht?Object(St.showSupportDialog)({initialState:Ct.b.Trading,solutionId:Ht[e]}):Object(St.showSupportDialog)({initialState:Ct.b.Trading})}async _showRestoreConfirmations(){const e=await Object(fe.a)({title:r.t("Restore confirmations"),text:r.t("Are you confirming you'd like to restore order confirmations, which you've previously disabled?"),mainButtonIntent:"primary"});null!==this._activeBroker&&e&&(new Pt.a).clear()}_logOut(e,t,i){const r=Object(s.ensureNotNull)(this._activeBroker);r.connectionStatusUpdate.unsubscribe(this,this._connectionListener),r.disconnect(t||!e),r.destroy(),this._activeBroker=null,this._updateConnectionStatus(3,e,i)}}},"F+J5":function(e,t,i){e.exports={"css-value-padding":"4px"}},HjS6:function(e,t,i){"use strict";var r,s;function n(e){return!e.hasOwnProperty("errors")}function o(e){return e.hasOwnProperty("errors")}function a(e){const t=[];for(const i of e)void 0!==i.detail&&t.push(i.detail);return t}i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return a})),function(e){e[e.Unknown=0]="Unknown",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.RateLimit=429]="RateLimit"}(r||(r={})),function(e){e.Forbidden="forbidden",e.NonExists="non-exists",e.Exists="exists",e.Hidden="hidden"}(s||(s={}))},ItnF:function(e,t,i){e.exports={dialog:"dialog-2cMrvu9r",wrapper:"wrapper-2cMrvu9r",separator:"separator-2cMrvu9r"}},MZiX:function(e,t,i){"use strict";i.r(t);var r,s,n=i("hY0g"),o=i.n(n),a=i("wVAQ"),l=i("HjS6"),c=i("24R9");async function d(e,t){try{const i=await Object(a.fetch)(`/api/v1/brokers/${e}/reviews/${function(e){const t=Object(c.createUrlParams)({rating:(null==e?void 0:e.rating)||null,ordering:(null==e?void 0:e.ordering)||null,page:(null==e?void 0:e.page)||null});return t?"?"+t:""}(t)}`,{method:"GET"});if(!i.ok){return{errors:[{code:l.a.Unknown}]}}const{results:r}=await i.json();return{data:r}}catch(i){return{errors:[{code:l.a.Unknown,detail:i}]}}}!function(e){e.CreatedAsc="created",e.CreatedDesc="-created",e.RatingAsc="rating",e.RatingDesc="-rating"}(r||(r={})),i.d(t,"BrokerReviewPageData",(function(){return s})),function(e){let t=null;const i=new o.a([]);let s=null,n=null;e.setBrokerData=function(e){t=e},e.getBrokerData=function(){return t},e.setReviews=function(e){i.setValue(e)},e.setReviewsFromBackend=async function(){if(null===t)return;const e=await d(t.brokerId,{rating:s||void 0,ordering:r.CreatedDesc,page:n||void 0});Object(l.e)(e)&&i.setValue(e.data)},e.reviewsSubscription=function(){return i},e.setRatingFilter=function(e){s=e},e.setPageNumber=function(e){n=e}}(s||(s={}))},N8pX:function(e,t,i){e.exports={"css-value-padding":"4px",wrapper:"wrapper-3RnThD8T",notAvailableOnMobile:"notAvailableOnMobile-3RnThD8T",column:"column-3RnThD8T",button:"button-3RnThD8T",sellButton:"sellButton-3RnThD8T",buyButton:"buyButton-3RnThD8T",
brokerButton:"brokerButton-3RnThD8T",highButtons:"highButtons-3RnThD8T",withoutBg:"withoutBg-3RnThD8T",lastCharSup:"lastCharSup-3RnThD8T",spreadQtyWrapper:"spreadQtyWrapper-3RnThD8T",spread:"spread-3RnThD8T",withoutQty:"withoutQty-3RnThD8T",qty:"qty-3RnThD8T",loader:"loader-3RnThD8T",loading:"loading-3RnThD8T",buttonText:"buttonText-3RnThD8T",brokerButtonIconWrap:"brokerButtonIconWrap-3RnThD8T",brokerButtonDefault:"brokerButtonDefault-3RnThD8T",touchMode:"touchMode-3RnThD8T",buttons:"buttons-3RnThD8T"}},"Nl/Q":function(e,t,i){"use strict";function r(e,t){c().then(i=>i.signInAndRunReviewWorkflow(e,t))}function s(){return c().then(e=>e.getStatusOrShowError())}function n(){return c().then(e=>e.getReviewOrShowError())}function o(e,t,i){c().then(r=>r.openCreateDialog(e,t,i))}function a(e){c().then(t=>t.openEditDialog(e))}function l(e){c().then(t=>t.openUpdateDialog(e))}function c(){return i.e("broker-review-workflow-impl").then(i.bind(null,"FEMH"))}i.d(t,"f",(function(){return r})),i.d(t,"b",(function(){return s})),i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return l}))},OKVU:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 16" width="20" height="16" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M7.5 2.5C7.5 1.67 8.17 1 9 1h2c.83 0 1.5.67 1.5 1.5v.15h-5V2.5zm6 0v.15H17a2.5 2.5 0 0 1 2.5 2.5v8.35A2.5 2.5 0 0 1 17 16H3a2.5 2.5 0 0 1-2.5-2.5V5.15A2.5 2.5 0 0 1 3 2.65h3.5V2.5A2.5 2.5 0 0 1 9 0h2a2.5 2.5 0 0 1 2.5 2.5zm-12 2.65c0-.83.67-1.5 1.5-1.5h14c.83 0 1.5.67 1.5 1.5v8.35c0 .83-.67 1.5-1.5 1.5H3a1.5 1.5 0 0 1-1.5-1.5V5.15zM9.25 6.5a1.75 1.75 0 1 0 0 3.5h1.5a.75.75 0 0 1 0 1.5h-1.5a.75.75 0 0 1-.75-.75h-1c0 .97.78 1.75 1.75 1.75h.25v1h1v-1h.25a1.75 1.75 0 1 0 0-3.5h-1.5a.75.75 0 0 1 0-1.5h1.5c.41 0 .75.34.75.75h1c0-.97-.78-1.75-1.75-1.75h-.25v-1h-1v1h-.25z"/></svg>'},OZBO:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var r=i("q1tI");const s=i.n(r).a.createContext({setHideClose:()=>{}})},Obn8:function(e,t,i){e.exports={button:"button-2FI8ioay",withPadding:"withPadding-2FI8ioay",hiddenText:"hiddenText-2FI8ioay",text:"text-2FI8ioay",loader:"loader-2FI8ioay",base:"base-2FI8ioay",primary:"primary-2FI8ioay",success:"success-2FI8ioay",danger:"danger-2FI8ioay",warning:"warning-2FI8ioay",secondary:"secondary-2FI8ioay",secondaryScript:"secondaryScript-2FI8ioay",link:"link-2FI8ioay",xsmall:"xsmall-2FI8ioay",rounded:"rounded-2FI8ioay",small:"small-2FI8ioay",large:"large-2FI8ioay",grouped:"grouped-2FI8ioay",growable:"growable-2FI8ioay",active:"active-2FI8ioay",disabled:"disabled-2FI8ioay"}},R5JZ:function(e,t,i){"use strict";function r(e,t,i,r,s){function n(s){if(e>s.timeStamp)return;const n=s.target;void 0!==i&&null!==t&&null!==n&&n.ownerDocument===r&&(t.contains(n)||i(s))}return s.click&&r.addEventListener("click",n,!1),s.mouseDown&&r.addEventListener("mousedown",n,!1),s.touchEnd&&r.addEventListener("touchend",n,!1),s.touchStart&&r.addEventListener("touchstart",n,!1),()=>{
r.removeEventListener("click",n,!1),r.removeEventListener("mousedown",n,!1),r.removeEventListener("touchend",n,!1),r.removeEventListener("touchstart",n,!1)}}i.d(t,"a",(function(){return r}))},RgaO:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("mrSG"),s=i("8Rai");function n(e){const{children:t}=e,i=Object(r.d)(e,["children"]);return t(Object(s.a)(i))}},T7lC:function(e,t,i){e.exports={popupWrapper:"popupWrapper-1kEHryCX"}},To8B:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill="currentColor" d="M9.707 9l4.647-4.646-.707-.708L9 8.293 4.354 3.646l-.708.708L8.293 9l-4.647 4.646.708.708L9 9.707l4.646 4.647.708-.707L9.707 9z"/></svg>'},XiJV:function(e,t,i){e.exports={separator:"separator-3No0pWrk"}},bNPh:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"f",(function(){return a})),i.d(t,"g",(function(){return l})),i.d(t,"h",(function(){return c})),i.d(t,"i",(function(){return d})),i.d(t,"e",(function(){return u})),i.d(t,"d",(function(){return h}));var r,s,n,o=i("YFKU");function a(e){return e.type===n.Category}function l(e){return e.type===n.Folder}function c(e){return e.type===n.Solution}function d(e){return void 0!==e.parent}!function(e){e.Billing="billing",e.Data="data",e.Chart="chart",e.Trading="trading",e.Alerts="alerts",e.Pine="pine",e.Screener="screener",e.SocialNetwork="socialNetwork",e.Watchlist="watchlist",e.MobileApps="mobileApps",e.Desktop="desktop",e.ProfileSettings="profileSettings",e.Financials="financials"}(r||(r={})),function(e){e[e.Billing=43000359310]="Billing",e[e.Data=43000359303]="Data",e[e.Chart=43000359369]="Chart",e[e.Trading=43000359435]="Trading",e[e.Alerts=43000359434]="Alerts",e[e.Pine=43000359313]="Pine",e[e.Screener=43000359433]="Screener",e[e.SocialNetwork=43000359389]="SocialNetwork",e[e.Watchlist=43000359455]="Watchlist",e[e.MobileApps=43000359462]="MobileApps",e[e.Desktop=43000368699]="Desktop",e[e.ProfileSettings=43000363655]="ProfileSettings",e[e.Financials=43000366059]="Financials"}(s||(s={})),function(e){e.Category="category",e.Folder="folder",e.Solution="solution"}(n||(n={}));const u={[r.Data]:s.Data,[r.Billing]:s.Billing,[r.Pine]:s.Pine,[r.Chart]:s.Chart,[r.SocialNetwork]:s.SocialNetwork,[r.Screener]:s.Screener,[r.Alerts]:s.Alerts,[r.Trading]:s.Trading,[r.Watchlist]:s.Watchlist,[r.MobileApps]:s.MobileApps,[r.Desktop]:s.Desktop,[r.ProfileSettings]:s.ProfileSettings,[r.Financials]:s.Financials},h={[s.Data]:()=>o.t("Data",{context:"support"}),[s.Billing]:()=>o.t("Billing"),[s.Pine]:()=>o.t("Pine Script",{context:"support"}),[s.Chart]:()=>o.t("Chart"),[s.SocialNetwork]:()=>o.t("Social network"),[s.Screener]:()=>o.t("Screener"),[s.Alerts]:()=>o.t("Alerts"),[s.Trading]:()=>o.t("Trading"),[s.Watchlist]:()=>o.t("Watchlist"),[s.MobileApps]:()=>o.t("Mobile apps"),[s.Desktop]:()=>o.t("Desktop"),[s.ProfileSettings]:()=>o.t("Profile settings"),[s.Financials]:()=>o.t("Financials")}},dXtN:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.9792 12.2892C19.7396 12.0142 19.3241 11.9812 19.044 12.2149L14.3924 16.098L14.072 16.3655L13.7516 16.098L9.10009 12.2149C8.82008 11.9812 8.40456 12.0142 8.16495 12.2892C7.92467 12.565 7.94981 12.9825 8.22144 13.2275L14.0721 18.504L19.9227 13.2275C20.1943 12.9825 20.2195 12.565 19.9792 12.2892ZM18.4032 11.4472C19.1009 10.8648 20.1362 10.9471 20.7332 11.6323C21.3318 12.3195 21.2692 13.3597 20.5924 13.9701L14.407 19.5486L14.0721 19.8506L13.7373 19.5486L7.55171 13.9701C6.87492 13.3597 6.81229 12.3195 7.41096 11.6323C8.00796 10.9471 9.04326 10.8648 9.74094 11.4473L14.072 15.0628L18.4032 11.4472Z"/></svg>'},dct7:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" width="72" height="72" fill="none"><g clip-path="url(#clip0)"><path fill="#F0F3FA" fill-rule="evenodd" clip-rule="evenodd" d="M62.1259 28.2153C61.4066 28.8157 61.0001 29.7273 61.0858 30.6604C61.6716 37.0347 59.7763 44.3291 55.3181 50.8221C46.9016 63.0797 32.5383 67.839 23.2366 61.4522C13.935 55.0654 13.2174 39.9512 21.6339 27.6935C26.4984 20.6088 33.3496 16.029 40.0619 14.6585C40.9752 14.472 41.731 13.8291 42.1024 12.9741C42.485 12.0934 42.9606 11.2346 43.5313 10.4123C47.906 4.1093 56.2129 2.33004 62.0853 6.4382C67.9578 10.5464 69.172 18.9863 64.7974 25.2892C64.0194 26.4103 63.1169 27.3882 62.1259 28.2153Z"/><rect width="47.2" height="34" fill="#fff" stroke="#1E222D" stroke-width="2" rx="3.8" x="12.4004" y="16"/><path stroke="#1E222D" stroke-linecap="round" stroke-width="2" d="M3.59961 54H67.1996"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M29.1178 31.1324L30.8107 32.8253L32.225 31.4111L30.5321 29.7182L32.225 28.0253L30.8107 26.6111L29.1178 28.304L27.425 26.6111L26.0107 28.0253L27.7036 29.7182L26.0107 31.4111L27.425 32.8253L29.1178 31.1324Z"/><path fill="#000" fill-rule="evenodd" clip-rule="evenodd" d="M43.5182 31.1324L45.2111 32.8253L46.6253 31.4111L44.9325 29.7182L46.6253 28.0253L45.2111 26.6111L43.5182 28.304L41.8253 26.6111L40.4111 28.0253L42.104 29.7182L40.4111 31.4111L41.8253 32.8253L43.5182 31.1324Z"/><path stroke="#000" stroke-width="2" d="M30.5996 38.7H40.7996"/></g></svg>'},g89m:function(e,t,i){"use strict";i.d(t,"a",(function(){return w}));var r=i("q1tI"),s=i.n(r),n=i("Eyy1"),o=i("TSYQ"),a=i.n(o),l=i("/3z9"),c=i("d700"),d=i("WXjp"),u=i("02pg"),h=i("uhCe"),p=i("/KDZ"),_=i("pafz"),b=i("ZjKI"),m=i("FQhm"),g=i("29EA"),v=i("ItnF");const f={vertical:20},y={vertical:0};class w extends s.a.PureComponent{constructor(){super(...arguments),this._controller=null,this._reference=null,this._renderChildren=(e,t)=>(this._controller=e,this.props.render({requestResize:this._requestResize,centerAndFit:this._centerAndFit,isSmallWidth:t})),this._handleReference=e=>this._reference=e,this._handleClose=()=>{this.props.onClose()},this._handleKeyDown=e=>{var t;if(!e.defaultPrevented)switch(this.props.onKeyDown&&this.props.onKeyDown(e),
Object(l.hashFromEvent)(e)){case 27:if(e.defaultPrevented)return;if(this.props.forceCloseOnEsc&&this.props.forceCloseOnEsc())return void this._handleClose();const{activeElement:i}=document,r=Object(n.ensureNotNull)(this._reference);if(null!==i){if(e.preventDefault(),"true"===(t=i).getAttribute("data-haspopup")&&"true"!==t.getAttribute("data-expanded"))return void this._handleClose();if(Object(c.b)(i))return void r.focus();if(r.contains(i))return void this._handleClose()}}},this._requestResize=()=>{null!==this._controller&&this._controller.recalculateBounds()},this._centerAndFit=()=>{null!==this._controller&&this._controller.centerAndFit()}}componentDidMount(){m.subscribe(b.CLOSE_POPUPS_AND_DIALOGS_COMMAND,this._handleClose,null)}componentWillUnmount(){m.unsubscribe(b.CLOSE_POPUPS_AND_DIALOGS_COMMAND,this._handleClose,null)}focus(){Object(n.ensureNotNull)(this._reference).focus()}getElement(){return this._reference}contains(e){var t,i;return null!==(i=null===(t=this._reference)||void 0===t?void 0:t.contains(e))&&void 0!==i&&i}render(){const{className:e,headerClassName:t,isOpened:i,title:r,dataName:n,onClickOutside:o,additionalElementPos:l,additionalHeaderElement:c,backdrop:b,shouldForceFocus:m=!0,showSeparator:w,subtitle:k,draggable:B=!0,fullScreen:P=!1,showCloseIcon:C=!0,rounded:S=!0,isAnimationEnabled:O,growPoint:T,dialogTooltip:E,unsetHeaderAlign:N}=this.props,L="after"!==l?c:void 0,j="after"===l?c:void 0;return s.a.createElement(p.a,{rule:h.a.SmallHeight},l=>s.a.createElement(p.a,{rule:h.a.TabletSmall},c=>s.a.createElement(d.a,{rounded:!(c||P)&&S,className:a()(v.dialog,e),isOpened:i,reference:this._handleReference,onKeyDown:this._handleKeyDown,onClickOutside:o,onClickBackdrop:o,fullscreen:c||P,guard:l?y:f,boundByScreen:c||P,shouldForceFocus:m,backdrop:b,draggable:B,isAnimationEnabled:O,growPoint:T,name:this.props.dataName,dialogTooltip:E},s.a.createElement("div",{className:v.wrapper,"data-name":n,"data-dialog-name":"string"==typeof r?r:""},void 0!==r&&s.a.createElement(g.a,{draggable:B&&!(c||P),onClose:this._handleClose,renderAfter:j,renderBefore:L,subtitle:k,title:r,showCloseIcon:C,className:t,unsetAlign:N}),w&&s.a.createElement(u.a,{className:v.separator}),s.a.createElement(_.a.Consumer,null,e=>this._renderChildren(e,c||P))))))}}},hJUO:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M19.9792 16.6205C19.7396 16.8955 19.3241 16.9285 19.044 16.6948L14.3924 12.8117L14.072 12.5442L13.7516 12.8117L9.10009 16.6947C8.82008 16.9285 8.40456 16.8955 8.16495 16.6205C7.92467 16.3447 7.94981 15.9272 8.22144 15.6822L14.0721 10.4057L19.9227 15.6822C20.1943 15.9272 20.2195 16.3447 19.9792 16.6205ZM18.4032 17.4624C19.1009 18.0448 20.1362 17.9626 20.7332 17.2774C21.3318 16.5902 21.2692 15.55 20.5924 14.9396L14.407 9.36109L14.0721 9.05908L13.7373 9.36109L7.55171 14.9396C6.87492 15.55 6.81229 16.5902 7.41096 17.2774C8.00796 17.9626 9.04326 18.0448 9.74094 17.4624L14.072 13.8468L18.4032 17.4624Z"/></svg>'},j0sD:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return o}));var r,s=i("q1tI"),n=i("wIdT");!function(e){e[e.PlusValue=0]="PlusValue",e[e.IncDec=1]="IncDec",e[e.Clear=2]="Clear",e[e.Default=3]="Default"}(r||(r={}));class o extends s.PureComponent{constructor(e){super(e),this._createClickHandler=(e,t=r.Default)=>()=>{this.props.onClick(e,t)}}render(){let e;switch(this.props.type){case r.PlusValue:case r.IncDec:e=this.props.value;break;case r.Clear:e="clear";break;case r.Default:e="default"}return s.createElement("div",{className:n.button,"data-value":e,onClick:this._createClickHandler(this.props.value,this.props.type)},this.props.icon||this.props.value)}}},jPOK:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var r=i("q1tI"),s=i("TSYQ"),n=i("Owlf");i("SzKR");function o(e){const t=s("tv-spinner","tv-spinner--shown","tv-spinner--size_"+(e.size||n.a));return r.createElement("div",{className:t,style:e.style,role:"progressbar"},r.createElement("div",{className:"tv-spinner__spinner-layer"},r.createElement("div",{className:"tv-spinner__background tv-spinner__width_element"}),r.createElement("div",{className:"tv-spinner__circle-clipper tv-spinner__width_element tv-spinner__circle-clipper--left"}),r.createElement("div",{className:"tv-spinner__circle-clipper tv-spinner__width_element tv-spinner__circle-clipper--right"})))}},oj21:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var r=i("q1tI"),s=i("TSYQ"),n=i("Obn8"),o=i("6KyJ");function a(e){switch(e){case"default":return n.base;case"primary":return n.primary;case"secondary":return n.secondary;case"secondary-script":return n.secondaryScript;case"success":return n.success;case"warning":return n.warning;case"danger":return n.danger;case"link":return n.link;default:return""}}function l(e){switch(e){case"xsmall":return n.xsmall;case"small":return n.small;case"large":return n.large;default:return""}}function c(e){switch(e){case"ghost":return n.ghost;default:return""}}function d(e){const{active:t=!0,children:i,className:d="",disabled:u=!1,grouped:h=!1,growable:p=!1,onClick:_,reference:b,size:m,theme:g,type:v="default",loading:f=!1,withPadding:y=!0,title:w="",disabledClassName:k,tabIndex:B=0,target:P="",href:C="",rounded:S=!1,name:O}=e,T=s({
[d]:Boolean(d),[n.button]:!0,[n.active]:t&&!u,[k||n.disabled]:u,[n.grouped]:h,[n.growable]:p,[n.withPadding]:y,[l(m)]:Boolean(m),[c(g)]:Boolean(g),[a(v)]:!0,[n.rounded]:S}),E="default"===v?"black":"white",N={disabled:u,title:w,target:P,href:C};return r.createElement("button",Object.assign({name:O,className:T,tabIndex:B,onClick:f?void 0:_,ref:b},N),r.createElement("span",{className:n.hiddenText},i),f?r.createElement("span",{className:n.loader},r.createElement(o.a,{color:E})):r.createElement("span",{className:n.text},i))}},pB43:function(e,t,i){"use strict";i.d(t,"b",(function(){return d})),i.d(t,"a",(function(){return u}));var r=i("mrSG"),s=i("q1tI"),n=i("TSYQ"),o=i("Iivm"),a=i("AiMB"),l=i("To8B"),c=i("79vt");class d extends s.PureComponent{render(){const{children:e,popperChildrenProps:t,onClose:i,reference:r,containerClassName:o}=this.props;return s.createElement(a.a,null,s.createElement("div",{ref:r},s.createElement(u,{reference:t.ref,style:t.style,arrowClassName:n(c.arrowHolder,this._getArrowDirectionClass()),arrowReference:t.arrowProps.ref,arrowStyle:t.arrowProps.style,"data-placement":t.placement,onClose:i,containerClassName:o},e)))}_getArrowDirectionClass(){const{popperChildrenProps:e}=this.props;switch(e.placement){case"left":case"left-start":return n(c["arrowHolder--after"],c["arrowHolder--after-ltr-fix"]);case"top":return n(c["arrowHolder--above"],c["arrowHolder--above-fix"]);case"bottom":case"bottom-start":case"bottom-end":return c["arrowHolder--below"];default:return n(c["arrowHolder--before"],c["arrowHolder--before-rtl-fix"])}}}function u(e){const{className:t,containerClassName:i,contentClassName:a,reference:d,style:u,arrow:h=!0,arrowClassName:p,arrowReference:_,onClose:b,arrowStyle:m,children:g}=e,v=Object(r.d)(e,["className","containerClassName","contentClassName","reference","style","arrow","arrowClassName","arrowReference","onClose","arrowStyle","children"]);return s.createElement("div",Object.assign({},v,{className:t,ref:d,style:u}),h&&s.createElement("div",{className:p,ref:_,style:m}),s.createElement("div",{className:n(c.container,i)},s.createElement("div",{className:n(c.content,a)},g),b&&s.createElement(o.a,{className:c.closeButton,icon:l,onClick:b})))}},px1m:function(e,t,i){e.exports={"small-height-breakpoint":"screen and (max-height: 360px)",container:"container-2sL5JydP",unsetAlign:"unsetAlign-2sL5JydP",title:"title-2sL5JydP",subtitle:"subtitle-2sL5JydP",ellipsis:"ellipsis-2sL5JydP",close:"close-2sL5JydP"}},uqKQ:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var r=i("q1tI"),s=i("AiMB");function n(e){return class extends r.PureComponent{render(){const{isOpened:t,root:i}=this.props;if(!t)return null;const n=r.createElement(e,Object.assign({},this.props,{zIndex:150}));return"parent"===i?n:r.createElement(s.a,null,n)}}}},vOQ2:function(e,t,i){"use strict";var r;i.d(t,"d",(function(){return r})),i.d(t,"a",(function(){return s})),i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return o})),function(e){e.DomPanel="domPanel",e.OrderPanel="orderPanel"}(r||(r={}))
;const s=400,n=315,o=451},wIdT:function(e,t,i){e.exports={button:"button-2Rly_LHp"}}}]);