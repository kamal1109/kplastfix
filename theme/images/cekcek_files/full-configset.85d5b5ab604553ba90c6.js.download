(window.webpackJsonp=window.webpackJsonp||[]).push([["full-configset"],{"+P1K":function(e,t,i){},"/+KL":function(e,t,i){"use strict";i("UcaL"),i("Lqq7"),i("f6C+"),i("WqyU");var s=i("7KDR"),n=s.Action,o=s.Separator,r=i("5VQP").ContextMenuManager,a=i("brCa").showNoticeDialog,l=i("Fi0z").PineReferenceDialog,c=i("C8ph").showRenamePineScriptDialog,d=i("fZEr").showConfirm,h=i("oNDq").createConfirmDialog,u=i("0YCj"),p=i("lCO3").Version,_=i("nmnj"),f=i("SNmj"),g=i("25b6").htmlEscape,v=i("CLNU").clean,m=i("xFpA").whenVerified,b=i("TcSq").isPublishedPineId,w=i("gX54"),S=i("txPx"),y=S.getLogger("Chart.TVScriptWidget"),C=S.LOGLEVEL,k=i("oiZD").watchedTheme,x=ace.require("ace/ext/language_tools"),I=i("vZvo"),T=i("rULK"),E=i("hY0g"),O=i("aIyQ"),j=i("QfUd").WatchedObject,F=i("/3z9"),B=F.hashFromEvent,P=F.modifiersFromEvent,R=F.Modifiers,M=window.t("Script '{0}' already exists. Do you really want to replace it?"),D=window.t("Script name"),A=window.t("Untitled Script"),N=window.t("You need to save the script before converting it:"),L=window.t("Pine v4 Compilation Issue"),W=window.t("We have successfully converted your script, but could not compile it, because it has some errors. You can correct the script manually using the information from the console."),V=window.t("Converting script..."),H=window.t("Script '{0}' has been converted"),z=window.t("Compiling script..."),q=window.t("Script '{0}' has been compiled"),U=/[l|L]ines? (\d*)/;function K(e,t){return e===t}function G(e,t){this._chartWidgetCollection=e,this._title=window.t("Script Editor"),this._ui={},this._options=t,this._hasRendered=!1,this._onDialogResizeBinded=this._onDialogResize.bind(this),t&&t.$body&&(this._ui.$body=t.$body),t&&t.height&&(this._heightWV=t.height),t&&t.width&&(this._widthWV=t.width),t&&t.visible&&(this._visibleWV=t.visible),t&&t.trackEvent&&"function"==typeof t.trackEvent?this._trackEvent=t.trackEvent:this._trackEvent=function(){};var i="// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/\n",s="Guest"===window.user.username?"\n":"// Â© "+window.user.username+"\n\n";this._DEFAULT_SCRIPT_TITLE=window.t("My Script"),this._newScriptTemplate=i+s+'//@version=4\nstudy("'+this._DEFAULT_SCRIPT_TITLE+'")\nplot(close)',this._DEFAULT_STRATEGY_SCRIPT_TITLE=window.t("My Strategy"),this._newStrategyScriptTemplate=i+s+'//@version=4\nstrategy("'+this._DEFAULT_STRATEGY_SCRIPT_TITLE+'", overlay=true, margin_long=100, margin_short=100)\n\nlongCondition = crossover(sma(close, 14), sma(close, 28))\nif (longCondition)\n    strategy.entry("My Long Entry Id", strategy.long)\n\nshortCondition = crossunder(sma(close, 14), sma(close, 28))\nif (shortCondition)\n    strategy.entry("My Short Entry Id", strategy.short)',this._currScript={pineVersion:4},this._convertedScript={},this._recentlyUsedQueue=[],this._isVisible=!1,this._currentScriptObject=new j(this._currScript,K),this._authenticated=new E(!1),this._readOnly=new E(!1),this._unsaved=new E(!0),this._renamed=new O,this._modified=new E(!1),this._converted=new E(!1),
this._conversionDisabled=new E(!1),this._forceShowConvert=new E(!1),this._publishingAwaited=new E(!1),this._versions=new j([],K),this._recentlyUsed=new j([],K),this._findReplacePanelVisible=new E(!1),this._findReplacePanelExpanded=new E(!1),this._searchPanelRef=null,loginStateChange.subscribe(this,this._updateOnLoginStateChange)}G.prototype._updateOnLoginStateChange=function(){this._authenticated.setValue(window.is_authenticated)},G.prototype._isNewScript=function(){return TradingView.isAbsent(this._currScript.scriptIdPart)},G.prototype._isLegacyScript=function(){return TradingView.isExistent(this._currScript.version)&&this._currScript.version.isLess(new p(0,0))},G.prototype._isCurrScriptNull=function(){return TradingView.isAbsent(this._currScript.scriptSource)},G.prototype._isBufferModified=function(){function e(e){return e&&e.replace(/(\r\n|\r|\n)/g,"\n")}return e(this._currScript.scriptSource)!==e(this._ui.editor.getValue())},G.prototype._chartModel=function(){return this._chartWidget().model().model()},G.prototype._chartWidget=function(){return this._chartWidgetCollection.activeChartWidget.value()},G.prototype.show=function(e){this._prepareLayoutAndShow(),this._isCurrScriptNull()&&this._newIndicatorScript(),e?this._openScriptWithConfirm(e):this._openScript(this._currScript)},G.prototype.isVisible=function(){return this._isVisible},G.prototype.loadedScriptIdPart=function(){if(this._isVisible)return this._currScript.scriptIdPart},G.prototype._prepareLayoutAndShow=function(){if(!this._hasRendered){this._hasRendered=!0,this._ui.$body.addClass("tv-script-widget"),this._ui.pineReferenceDialog=new l,this._ui.$header=$('<div id="tv-script-pine-editor-header-root">').appendTo(this._ui.$body),this._renderHeader(),this._ui.$findReplacePanel=$('<div class="tv-script-find-replace-panel-container" id="tv-script-find-replace-panel-root">').appendTo(this._ui.$header),this._ui.$editorContainer=$('<div class="tv-script-editor-container"></div>').appendTo(this._ui.$body),$('<div id="editor"></div>').appendTo(this._ui.$editorContainer).text(""),this._ui.editor=ace.edit("editor"),this._ui.editor.setFontSize("13px"),k.subscribe(this._onChangeTheme.bind(this)),this._onChangeTheme(k.value());var e=this;this._ui.editor.commands.addCommand({name:"save",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(t){e._saveButtonHandler()}}),this._ui.editor.commands.addCommand({name:"open",bindKey:{win:"Ctrl-o",mac:"Command-o"},exec:function(t){e._openScriptHandler()}}),this._ui.editor.commands.addCommand({name:"new",bindKey:{win:"Ctrl-i",mac:"Command-i"},exec:function(t){e._newButtonHandler()}}),this._ui.editor.commands.addCommand({name:"add",bindKey:{win:"Ctrl-enter",mac:"Command-enter"},exec:function(t){e._addButtonHandler()}}),this._ui.editor.commands.addCommand({name:"toggleconsole",bindKey:{win:"Ctrl-`",mac:"Command-`"},exec:function(t){e._toggleConsole()}}),this._ui.editor.commands.addCommand({name:"find",bindKey:{win:"Ctrl-f",mac:"Command-f"},exec:function(t){e._findReplacePanelExpanded.setValue(!1),e._toggleFindReplacePanel()}}),
this._ui.editor.commands.addCommand({name:"replace",bindKey:{win:"Ctrl-h",mac:"Command-option-h"},exec:function(t){e._findReplacePanelExpanded.setValue(!0),e._toggleFindReplacePanel()}});var t=this._ui.editor.getSession();t.on("change",function(e,i){var s=this._isBufferModified();this._setScriptModified(s);var n=this._currScript.scriptIdPart!==this._convertedScript.scriptIdPart,o=3===TVScript.extractVersion(t.getValue()),r=t.$undoManager.$fromUndo&&this._convertedScript.scriptSource===t.$undoManager.$lastDelta.lines.join("\n");this._converted.value()&&(n||o||r)&&(this._converted.setValue(!1),this._conversionDisabled.setValue(!1),this._forceShowConvert.setValue(!0))}.bind(this)),t.setUseSoftTabs(!0),t.setTabSize(4),this._ui.$consoleContainer=$('<div class="tv-script-console-container"><div class="tv-script-console-header"><div class="tv-script-console-toggle"><div class="tv-script-console-icon"></div></div><div class="tv-script-console-resize"></div></div><div class="tv-script-console-body"><div class="tv-script-console-text selectable"></div></div></div>').appendTo(this._ui.$body),this._ui.$console=this._ui.$consoleContainer.find(".tv-script-console-text"),this._ui.$consoleHeader=this._ui.$consoleContainer.find(".tv-script-console-header"),this._ui.$consoleBody=this._ui.$consoleContainer.find(".tv-script-console-body"),this._ui.$consoleResize=this._ui.$consoleContainer.find(".tv-script-console-resize"),this._ui.$consoleBody.hide(),this._ui.$consoleContainer.find(".tv-script-console-toggle").click((function(){e._toggleConsole()})),this._ui.$consoleResize.on("mousedown touchstart",(function(t){e._onConsoleResizeHandleMousedown(t)})),this._heightWV&&this._heightWV.subscribe(this._onDialogResizeBinded),this._widthWV&&this._widthWV.subscribe(this._onDialogResizeBinded),$(window).on("resize",this._onDialogResizeBinded),this._isVisible=!0,this._visibleWV.subscribe((function(t){e._isVisible=t,_.scriptUpdater().onScriptOpen(),t&&e._onDialogResize()}),{callWithLast:!0}),this._ui.$body.on("contextmenu",this._onContextMenu.bind(this)),this._updateOnLoginStateChange(),this._ui.$body.on("keydown",(function(e){var t=B(e);P(e)===R.Mod&&70===t&&e.preventDefault()}))}},G.prototype._onChangeTheme=function(e){"dark"===e?this._ui.editor.setTheme("ace/theme/tomorrow_night"):this._ui.editor.setTheme("ace/theme/tomorrow")},G.prototype._onContextMenu=function(e){if(!e.isDefaultPrevented()&&!$(e.target).is("textarea, input")){var t=$(this._ui.$consoleBody),i=$(e.target).parents().andSelf().is(t),s=[],a=new n({label:window.t("Show Console"),checkable:!0,checked:this._ui.$consoleContainer.hasClass("open"),shortcut:"ctrl+`",shortcutHint:"Ctrl + `",onExecute:function(){this._toggleConsole()}.bind(this)});if(s.push(a),i){var l=new n({label:window.t("Clear Console"),onExecute:function(){this._ui.$console.empty()}.bind(this)});s.push(new o),s.push(l)}r.createMenu(s).then((function(t){t.show(e)})),e.preventDefault()}},G.prototype._onDialogResize=function(){if(this._isVisible){var e=this._heightWV.value();if(isFinite(e)){
var t=this._ui,i=e-t.$header.outerHeight()-t.$consoleContainer.outerHeight();i<0?t.$consoleContainer.hasClass("open")&&t.$consoleBody.height(t.$consoleBody.height()+i):t.$editorContainer.height(i),t.editor.resize()}}},G.prototype._initVersionDependentTools=function(){var e=this._currScript.pineVersion;TradingView.Ace.defineMode(e).then(function(){e===this._currScript.pineVersion&&(this._ui.editor.session.setMode(I.getAceMode(e)),this._ui.editor.session.setNewLineMode("windows"),this._ui.editor.setOptions({enableBasicAutocompletion:!0}),this._setupAutocompletion(x,this._ui.editor,e),I.getReferenceDataByVersion(e).then(function(t){this._ui.editor.tokenTooltip||(this._ui.editor.tokenTooltip=new TradingView.Ace.TokenTooltip(this._ui.editor,t,this._ui.pineReferenceDialog,e)),this._ui.editor.tokenTooltip.setPineVersion(e,t)}.bind(this)),this._forceShowConvert.setValue(3===e))}.bind(this))},G.prototype._selectScriptName=function(e){for(var t=this._ui.editor.getSelection(),i=1,s=7,n=this._ui.editor.getValue().split("\n"),o=0;o<n.length;++o){var r=n[o].indexOf(e);if(0<=r){i=o,s=r;break}}var a=i,l=s+e.length,c=new TradingView.Ace.Range(i,s,a,l);this._ui.editor.moveCursorTo(i,s),t.addRange(c),this._ui.editor.focus()},G.prototype._setupAutocompletion=function(e,t,i){I.getBuiltinsDataByVersion(i).then(function(t){var i=this._createAutocompletionList(t.functionsList,"builtin function").concat(this._createAutocompletionList(t.variablesList,"builtin variable")),s={getCompletions:function(e,t,s,n,o){o(null,i)},identifierRegexps:[/[\w.]+/]};e.setCompleters([]),e.addCompleter(s)}.bind(this))},G.prototype._createAutocompletionList=function(e,t){return e.map((function(e){return{name:e,value:e,score:100500,meta:t}}))},G.prototype._showConsole=function(e){if(this._ui.$consoleBody){e="function"==typeof e?e:function(){};this._ui.$consoleBody.is(":visible")?e():(this._ui.$consoleContainer.addClass("open"),this._ui.$consoleBody.show(0,e),this._onDialogResize())}},G.prototype._hideConsole=function(){this._ui.$consoleBody&&this._ui.$consoleBody.is(":visible")&&(this._ui.$consoleContainer.removeClass("open"),this._ui.$consoleBody.hide(),this._onDialogResize())},G.prototype._toggleConsole=function(){this._ui.$consoleBody&&(this._ui.$consoleContainer.hasClass("open")?this._hideConsole():this._showConsole())},G.prototype._onConsoleResizeHandleMousedown=function(e){if(!e.isDefaultPrevented()){e.preventDefault();var t,i=this;t=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY;var s=this._ui.$editorContainer,n=this._ui.$consoleBody,o=s.height(),r=n.height(),a=function(e){var a,l=(a=e.originalEvent.touches?e.originalEvent.touches[0].clientY:e.pageY)-t,c=o+l,d=r-l;d<=0||c<=0||o!==c&&r!==d&&(t=a,o=c,r=d,s.height(o),n.height(r),i._ui.editor.resize())},l=function(e){$(document.documentElement).off("mousemove touchmove",a).off("mouseup touchend",l)};$(document.documentElement).on("mousemove touchmove",a).one("mouseup touchend",l)}},G.prototype._newButtonHandler=function(){this._trackEvent("New"),
runOrSignIn(this._newIndicatorScript.bind(this),{source:"Script create",sourceMeta:"Chart"})},G.prototype._newScript=function(e,t){var i={scriptSource:e},s=function(){this._selectScriptName(t),this._setScriptModified(!0)}.bind(this);this._openScriptWithConfirm(i,s)},G.prototype._newIndicatorScript=function(){this._newScript(this._newScriptTemplate,this._DEFAULT_SCRIPT_TITLE)},G.prototype._newStrategyScript=function(){this._newScript(this._newStrategyScriptTemplate,this._DEFAULT_STRATEGY_SCRIPT_TITLE)},G.prototype._generatePromptName=function(e,t){t=t||[];var i=1,s=e=(e||"").trim(),n=" ",o=0,r=/(.*?)(\s+)(\d*)$/.exec(e);r&&(s=r[1],n=r[2],o=+r[3]);var a=e;for(i=1;-1!==t.indexOf(a);i++)a=s+n+(o+i);return a},G.prototype._openScriptHandler=function(){var e=this;e._trackEvent("Open"),_.requestUserScripts().done((function(t){var s=t.map((function(t){return{id:t.scriptIdPart,name:t.scriptName,scriptTitle:t.scriptTitle,lastVersion:t.version,isStrategy:u.isScriptStrategy(t),modified:t.modified,openAction:function(){return new Promise((function(i){e._tryOpenScriptVersion(t.scriptIdPart,t.version).done(i)}))},deleteAction:function(){return new Promise((function(i){e._deleteScriptHandler(t.scriptName,t.scriptIdPart,i)}))}}}));Promise.all([i.e("vendors"),i.e(1),i.e(7),i.e(11),i.e(22),i.e(28),i.e(29),i.e(50),i.e(55),i.e(59),i.e(66),i.e(168),i.e(177),i.e(284),i.e(537),i.e(10),i.e(41),i.e(47),i.e(54),i.e(324),i.e("open-script-dialog")]).then(i.bind(null,"ncZG")).then(({showOpenScriptDialog:e})=>{e(s)})}))},G.prototype._openDefaultScriptHandler=function(){var e=this;e._trackEvent("Open Default Scripts"),_.requestPineEditorNewTemplateScripts().done((function(t){var s=t.map((function(t){return{id:t.scriptIdPart,name:t.scriptName||"",isStrategy:u.isScriptStrategy(t),openAction:function(){e._trackEvent("New",t.scriptName),_.getPineSourceCode(t.scriptIdPart,t.version).done((function(t){e._openScriptWithConfirm({scriptSource:t.source,scriptName:t.scriptName,scriptTitle:t.scriptTitle},(function(){e._setScriptModified(!0)}))})).fail((function(i){var s="Could not getPineSourceCode for pineId="+t.scriptIdPart+" reason: "+i;y.logError(s),e._writeConsoleError(s)}))}}})).sort((function(e,t){return e.name.localeCompare(t.name)}));Promise.all([i.e("vendors"),i.e(1),i.e(7),i.e(11),i.e(22),i.e(28),i.e(29),i.e(50),i.e(55),i.e(59),i.e(168),i.e(536),i.e(10),i.e(41),i.e(47),i.e(54),i.e(324),i.e("open-default-script-dialog")]).then(i.bind(null,"0N/C")).then(({showOpenDefaultScriptDialog:e})=>{e(s)})}))},G._getPineSourceCode=function(e){var t=$.Deferred();return e.version<0?t.resolve(e):_.getPineSourceCode(e.scriptIdPart,e.version).done((function(i){e.scriptSource=i.source,t.resolve(e)})),t},G.prototype._saveButtonHandler=function(){this._trackEvent("Save"),runOrSignIn(this._saveButtonHandlerSignedIn.bind(this,D+":"),{source:"Script save",sourceMeta:"Chart"})},G.prototype._saveButtonHandlerSignedIn=function(e,t,i){if(this._ui.editor.focus(),this._currScript.isModified||!this._currScript.scriptName){
var s=this._ui.editor.session.getValue(),n=this._convertedScript.scriptSource&&3===TVScript.extractVersion(s)&&s!==this._currScript.scriptSource;this._converted.value()&&(this._converted.setValue(!1),this._conversionDisabled.setValue(!1),this._convertedScript={});var o=this._ui.editor.getValue();_.parseScriptTitleAsync(o).done(function(s){this._saveButtonHandlerGotScriptTitle(o,s,e,n,t,i)}.bind(this)).fail(function(s){this._saveButtonHandlerGotScriptTitle(o,this._DEFAULT_SCRIPT_TITLE,e,n,t,i)}.bind(this))}else this._writeConsoleInfo(window.t("Script text is not modified, nothing to save"))},G.prototype._saveButtonHandlerGotScriptTitle=function(e,t,i,s,n,o){var r=$.Deferred().done(function(t,i){this._saveButtonHandlerSaveNewOrNextOrCurrent(e,t,!!i,n,o)}.bind(this));this._currScript.scriptName&&!s?r.resolve(this._currScript.scriptName):_.requestUserScripts().done(function(e){var n=e.map((function(e){return e.scriptName})),o=this._currScript.scriptName&&s?this._currScript.scriptName:this._generatePromptName(t||this._DEFAULT_SCRIPT_TITLE,n);c({label:i,initValue:o,title:window.t("Save Script"),onSuccess:function(e){r.resolve(e,!0)},scripts:e,currScript:this._currScript})}.bind(this))},G.prototype._saveButtonHandlerSaveNewOrNextOrCurrent=function(e,t,i,s,n){this._writeConsoleInfo(window.t("Processing script...")),this._writeConsoleDebug("Using tv-scripting-"+this._tvScriptingPkgVersion());var o=null,r=this._currScript.version.toString();o=this._isNewScript()?_.saveNew(e,t,i,r):_.saveNext(this._currScript.scriptIdPart,e,t,r,this._isLegacyScript()),this._setScriptModified(!1),o.done(function(i,o){if(o&&this._writeConsoleError(o),void 0!==i.warnings)for(var r=i.warnings.length,a=0;a<r;a++)this._writeConsoleWarn(i.warnings[a]);this._writeConsoleInfo(window.t("Script '{0}' has been saved").format(t));var l={scriptSource:e,scriptIdPart:i.scriptIdPart,version:i.pine.version,scriptName:t,isModified:this._currScript.isModified};n?this._addToRecent(l):this._openScript(l,!0),s&&s()}.bind(this)).fail(function(e){var t=window.t("Save operation failed, reason: {0}").format(e);this._setScriptModified(!0),this._writeConsoleError(t)}.bind(this))},G.prototype._convertScript=function(){if(!this._conversionDisabled.value()){this._conversionDisabled.setValue(!0),this._trackEvent("Convert to v4");var e=this;this._showConsole((function(){e._writeConsoleInfo(V),e._ui.$consoleBody.scrollTop(e._ui.$console.outerHeight())})),_.convertScript(this._ui.editor.getSession().getValue()).done((function(t){t.success?(e._writeConsoleInfo(H.format(e._currScript.scriptName)),"OK"!==t.result.message&&e._writeConsoleWarn(t.result.message),e._convertedScript.scriptIdPart=e._currScript.scriptIdPart,e._convertedScript.scriptSource=t.result.pine,e._showConsole((function(){e._writeConsoleInfo(z),e._ui.$consoleBody.scrollTop(e._ui.$console.outerHeight())})),_.translateScriptAsync(t.result.pine,e._currScript.scriptIdPart).always((function(){e._ui.editor.setValue(t.result.pine),e._ui.editor.clearSelection()})).done((function(){
e._writeConsoleInfo(q.format(e._currScript.scriptName))})).fail((function(t){e._writeConsoleError(window.t("Compilation failed, reason: {0}").format(t)),a({title:L,content:W})})),e._converted.setValue(!0),e._forceShowConvert.setValue(!1)):(e._writeConsoleError(window.t("Conversion failed, reason: {0}").format(t.reason)),e._conversionDisabled.setValue(!1))})).fail((function(){e._conversionDisabled.setValue(!1)}))}},G.prototype._convertButtonHandler=function(){3===this._currScript.pineVersion&&(!this._currScript.scriptName||this._currScript.isModified?runOrSignIn(this._saveButtonHandlerSignedIn.bind(this,N,this._convertScript.bind(this)),{source:"Script conversion",sourceMeta:"Chart"}):this._convertScript())},G.prototype._convertBackButtonHandler=function(){this._ui.editor.setValue(this._currScript.scriptSource),this._converted.setValue(!1),this._conversionDisabled.setValue(!1)},G.prototype._addButtonHandler=function(){this._trackEvent("Add to Chart");var e,t=$.Deferred(),i=this._ui.editor.getValue(),s=this._currScript.version.toString(),n=this._currScript.scriptName||A;this._readOnly.value()?(e=this._chartModel().insertStudyStub(n),t.resolve(_.translateScriptAsync2(this._currScript.scriptIdPart,s))):runOrSignIn(function(){e=this._chartModel().insertStudyStub(n),this._isNewScript()?t.resolve(_.saveNewDraft(i)):this._isBufferModified()?t.resolve(_.saveNextDraft(this._currScript.scriptIdPart,i,this._isLegacyScript())):t.resolve(_.translateScriptAsync2(this._currScript.scriptIdPart,s))}.bind(this),{source:"Script add to chart",sourceMeta:"Chart"});var o=TradingView.bottomWidgetBar;null!==o&&o.turnOffMaximize(),Promise.resolve(t).then(function(t){if(this._chartModel().studyMetaInfoRepository().addPineMetaInfo(t),!this._chartModel().removeStudyStub(e.id()))return this._writeConsoleInfo(window.t("User cancelled operation")),null;if(void 0!==t.warnings)for(var i=t.warnings.length,s=0;s<i;s++)this._writeConsoleWarn(t.warnings[s]);var n=this;return this._chartWidget().insertStudy({type:"pine",pineId:t.scriptIdPart,pineVersion:t.pine.version}).then((function(e){return null===e?null:(n._writeConsoleInfo(window.t("Script study added to the chart")),t)}),(function(e){return e?Promise.reject(e):null}))}.bind(this)).then(function(e){null!==e&&(this._currScript.scriptSource=i,this._currScript.scriptIdPart=e.scriptIdPart,this._currScript.version=e.pine.version,this._openScript(this._currScript,!0))}.bind(this),function(t,s){this._writeConsoleError(window.t("Add to Chart operation failed, reason: {0}").format(t)),this._chartModel().removeStudyStub(e.id()),TradingView.isAbsent(s)||(this._currScript.scriptSource=i,this._currScript.scriptIdPart=s.scriptIdPart,this._currScript.version=s.pine.version,this._openScript(this._currScript,!0))}.bind(this))},G.prototype._deleteButtonHandler=function(){this._deleteScriptHandler(this._currScript.scriptName,this._currScript.scriptIdPart)},G.prototype._deleteScriptHandler=function(e,t,i){var s=this;runOrSignIn(function(){e?this._deleteScript(t).then((function(){s._removeFromRecent(t),i()
})):this._writeConsoleInfo(window.t("Script is not saved. Nothing to delete."))}.bind(this),{source:"Script delete"})},G.prototype._publishToggleHandler=function(e){e.preventDefault(),this._dialog?this._togglePublishFormState():this._showPublishFormDialog()},G.prototype._showPublishFormDialog=function(){var e=this;if(!e._scriptPublishingInProgress){e._scriptPublishingInProgress=!0;var t=e._ui.editor.getValue();this._trackEvent(""),runOrSignIn((function(){var t=Promise.all([Promise.all([i.e(19),i.e(39),i.e(42),i.e(95),i.e(172),i.e(173),i.e(204),i.e(244),i.e(376),i.e(385),i.e(514),i.e(21),i.e(164),i.e(189),i.e(236),i.e(371),i.e("publish-tools")]).then(i.bind(null,"cKo9")),Promise.all([i.e(19),i.e(39),i.e(42),i.e(95),i.e(172),i.e(173),i.e(204),i.e(244),i.e(376),i.e(385),i.e(514),i.e(21),i.e(164),i.e(189),i.e(236),i.e(371),i.e("publish-tools")]).then(i.bind(null,"vKpg")),Promise.all([i.e(19),i.e(39),i.e(42),i.e(95),i.e(172),i.e(173),i.e(204),i.e(244),i.e(376),i.e(385),i.e(514),i.e(21),i.e(164),i.e(189),i.e(236),i.e(371),i.e("publish-tools")]).then(i.bind(null,"fT+7"))]).then(([{ScriptPublisher:e},{ScriptsProvider:t},{CategoriesProvider:i}])=>({ScriptPublisher:e,ScriptsProvider:t,CategoriesProvider:i})),a=new Promise((function(e,t){m({showDialog:!0,source:"Publish script"}).done(e).always(t)}));new Promise((function(t,s){var n=u.isScriptStrategy(e._currScript),o=e._chartWidgetCollection.activeChartWidget.value().model().mainSeries().isRangeBasedStyle();n&&o?Promise.resolve().then(i.t.bind(null,"+GxX",7)).then((function(e){e.isFeatureEnabled("disable_publish_strategy_range_based_chart")?i.e("create-publish-untrusted-strategy-dialog").then(i.bind(null,"J7qW")).then((function(e){return e.getUntrustedStrategyDialog()})).then(s):t()})):t()})).then((function(){return Promise.all([(n=e._currScript,!e._isBufferModified()&&n.scriptIdPart&&n.version&&e._chartWidgetCollection.activeChartWidget.value().containsStudyByPredicate((function(e){return!(!e.scriptIdPart||e.scriptIdPart!==n.scriptIdPart||!p.parse(e.pine.version).isEqual(n.version)||(i=e,0))}))?i.isTVScriptStub?Promise.reject(s({type:"modal",title:window.t("Pine Script Error"),content:window.t("Script cannot be compiled because of errors.")})):i.isTVScriptStrategy&&e._options.backtestingStrategyDispatcher&&e._options.backtestingStrategyDispatcher.strategies().length>1?Promise.reject(s({type:"modal",title:window.t("Publish Strategy"),content:window.t("To publish a strategy, only that strategy should be applied to the chart&nbsp;&mdash; itâs clearer to users that way. Please delete all other strategies and try again.")})):Promise.resolve({source_title:i.description}):o()),t,a]);var i,n})).then((function(e){return new Promise((function(t,s){TVSettings.getBool("publish.showScriptIntroText",!0)?Promise.all([i.e(1),i.e(2),i.e(7),i.e(11),i.e(16),i.e(176),i.e(10),i.e(153),i.e("create-publish-intro-dialog")]).then(i.bind(null,"X8So")).then((function(i){i.renderPublishIntroDialog({type:"scriptPublishing"}).then(i=>{TVSettings.setValue("publish.showScriptIntroText",!i),t(e)
}).catch(()=>{s()})})):t(e)}))})).then(r).catch(n).then((function(){e._scriptPublishingInProgress=!1}))}),{source:"Script publish",sourceMeta:"Chart"})}function s(e){var t=new Error;return t.options=e,t}function n(t){e._scriptPublishingInProgress=!1,t&&t.options&&a(t.options)}function o(){return Promise.reject(s({type:"modal",title:window.t("No showcase"),content:window.t("Active chart doesn't contain the study you are going to publish")}))}function r(i){var s=i[0],n=i[1],o=e._publishingAwaited;return new Promise((function(e){var i={title:v(s.source_title,!0),scriptSource:t,is_public:"1",scriptType:s.script_type,strictCheckPromise:s.strictCheckPromise};window.saver.publishScript(i,{onMinimizeEditor:function(){o.setValue(!0),e()},onCloseEditor:function(){o.setValue(!1),e()}},n)}))}},G.prototype._renameButtonHandler=function(){var e=$.Deferred().done(function(e,t){this._renameScript(this._currScript.scriptIdPart,e,!!t)}.bind(this));runOrSignIn(function(){var t=this._currScript.scriptName;t?_.requestUserScripts().done(function(i){c({initValue:t,label:window.t("Script name")+":",title:window.t("Rename Script"),onSuccess:function(t){e.resolve(t,!0)},currScript:this._currScript,scripts:i})}.bind(this)):this._writeConsoleInfo(window.t("Script is not saved. Nothing to rename."))}.bind(this),{source:"Script rename"})},G.prototype._saveAsButtonHandler=function(){var e=$.Deferred().done(function(e,t){this._saveScriptAs(this._currScript.scriptIdPart,e,t)}.bind(this));runOrSignIn(function(){var t=this._currScript.scriptName,i=t?window.t("{0} copy").format(t):"";_.requestUserScripts().done(function(t){var s=window.t("Save Script As");this._readOnly.value()&&(s=window.t("Make a Copy")),c({title:s,label:window.t("New script name")+":",initValue:i,onSuccess:function(t){e.resolve(t,!0)},scripts:t,currScript:this._currScript,isCopy:!0})}.bind(this))}.bind(this),{source:"Script save as",sourceMeta:"Chart"})},G.prototype._deleteScript=function(e){return _.deletePine(e).done(function(){this._writeConsoleInfo(window.t("Script has been deleted")),this._currScript.scriptIdPart===e&&(this._setScriptName(""),delete this._currScript.scriptIdPart,this._currentScriptObject.setValue(this._currScript))}.bind(this)).fail(function(t){var i=window.t("Could not delete script '{0}', reason: {1}").format(e,t);this._writeConsoleError(i)}.bind(this))},G.prototype._openScriptWithConfirm=function(e,t){var i=()=>{this._openScript(e),t&&t()};this._currScript.isModified&&this._isBufferModified()?d({text:window.t("You have unsaved changes in your current script. Would you like to save them?"),onConfirm:({dialogClose:e})=>{runOrSignIn(this._saveButtonHandlerSignedIn.bind(this,D+":",i,!0),{source:"Script save",sourceMeta:"Chart"}),e()},onCancel:({dialogClose:e})=>{i(),e()}}):i()},G.prototype._openScript=function(e,t=!1){if("string"!=typeof e.scriptSource)throw new TypeError("scriptSource property must be a string");this._currScript!==e&&(this._currScript=e),
this._currScript.version?this._currScript.version=p.parse(this._currScript.version):this._currScript.version=p.ZERO;var i=this._currScript.scriptIdPart&&b(this._currScript.scriptIdPart);if(e.scriptIdPart){var s=e.scriptIdPart,n=this._currScript.version.major()<1;_.getPineSourceCode(e.scriptIdPart,"last",n).done(function(t){e.scriptIdPart===s&&(this._updateVersionLabel(t.version),i||this._setScriptName(t.scriptName))}.bind(this))}else this._setScriptName("");var o=this._currScript.isModified;if(t||this._ui.editor.getSession().setValue(this._currScript.scriptSource),0!==this._currScript.version.minor()&&(o=!0),this._setScriptModified(!!o),TradingView.isExistent(this._currScript.scriptIdPart)?_.isAuthToWritePineScript(this._currScript.scriptIdPart).done(function(e){this._setReadOnly(!e)}.bind(this)).fail(function(e){var t="Could not isAuthToWritePineScript for pineId="+this._currScript.scriptIdPart+" reason: "+e;y.logError(t),this._writeConsoleError(t),this._setReadOnly(!1)}.bind(this)):this._setReadOnly(!1),i){var r=this,a=f.info([this._currScript.scriptIdPart]).pipe((function(e){if(!e||e.length<1)return"";var t=e[0],i=t.scriptName||t.sourceTitle||window.t("Study");return t.author&&t.author.username&&(i+=" "+window.t("by")+" "+t.author.username),i}));r._titleDfd=a,a.done((function(e){a===r._titleDfd&&r._setScriptName(e)}))}this._addToRecent(e),this._currentScriptObject.setValue(this._currScript),this._ui.editor.focus(),_.scriptUpdater().onScriptOpen()},G.prototype._tryOpenScriptVersion=function(e,t){return _.getPineSourceCode(e,t).done(function(i){var s={scriptIdPart:e,version:t,scriptSource:i.source,scriptName:i.scriptName,scriptTitle:i.scriptTitle};this._openScriptWithConfirm(s)}.bind(this)).fail(function(e){var t="Could not getPineSourceCode for pineId="+this._currScript.scriptIdPart+" reason: "+e;y.logError(t),this._writeConsoleError(t)}.bind(this))},G.prototype._updateVersionLabel=function(e){for(var t=p.parse(e).major(),i=[],s=t;s>=1;s--){var n=new p(s,0);i.push({value:n,displayValue:n.toString()})}t<0&&i.push({value:new p(t,0),displayValue:new p(1,0).toString()}),this._versions.setValue(i)},G.prototype._setReadOnly=function(e){e=!!e,this._readOnly.setValue(e),this._ui.$body.toggleClass("readonly",e),this._ui.editor.setReadOnly(e),this._ui.editor.setHighlightActiveLine(!e),this._ui.editor.setHighlightGutterLine(!e),this._ui.editor.setShowPrintMargin(!e)},G.prototype._lineClickHandler=function(e,t){if(this._ui.editor.gotoLine(e,Number.MAX_VALUE,!0),this._ui.editor.focus(),t){for(var i=-1,s=this._ui.editor.getSession(),n=s.getLine(e-1),o=0;o<n.length;++o){var r=s.getTokenAt(e-1,o);r&&r.value===t[1]&&"other"===r.type&&(i=o)}-1!==i&&this._ui.editor.selection.setRange({start:{column:i-t[1].length,row:e-1},end:{column:i,row:e-1}})}},G.prototype._writeClickableLines=function(e,t){var i=this;this._showConsole((function(){for(var s=e.split("\n"),n=0;n<s.length;n++){var o=$('<div class="selectable">').addClass(t);s[n].match(U)?$('<a href="#">').text(s[n]+"\n").on("click",(function(){
var e=this.text.match(U)[1],t=this.text.match(/`(.*)`/);i._lineClickHandler(e,t)})).appendTo(o):o.text(s[n]+"\n"),o.appendTo(i._ui.$console)}i._ui.$consoleBody.scrollTop(i._ui.$console.outerHeight())}))},G.prototype._writeConsoleError=function(e){var t=v(e,!0);y.logError(t),this._writeClickableLines(t,"error")},G.prototype._writeConsoleWarn=function(e){var t=v(e,!0);y.logNormal(t),this._writeClickableLines(t,"warning")},G.prototype._writeConsoleInfo=function(e){var t=v(e,!0);this._ui.$console.append($("<div class='selectable'>").text(t)),this._ui.$consoleBody.scrollTop(this._ui.$console.outerHeight()),y.logNormal(t)},G.prototype._writeConsoleDebug=function(e){if(S.getLogLevel()===C.DEBUG){var t=v(e,!0);this._ui.$console.append($("<div class='debug selectable'>").text(t)),this._ui.$consoleBody.scrollTop(this._ui.$console.outerHeight()),y.logDebug(t)}},G.prototype._tvScriptingPkgVersion=function(){try{return this._chartModel().studyMetaInfoRepository().findByIdSync({type:"java",studyId:"Script@tv-scripting"}).version}catch(e){throw new Error("Metainfo of 'tv-scripting' package is not found")}},G.prototype.onScriptModified=function(e,t){!t&&!this._currScript.isModified&&e.scriptIdPart&&e.scriptSource&&this._currScript.scriptIdPart===e.scriptIdPart&&this._openScript(e)},G.prototype.onScriptDeleted=function(e,t){this._currScript.scriptIdPart===e.scriptIdPart&&(delete this._currScript.scriptIdPart,this._setScriptName(""))},G.prototype.onScriptRenamed=function(e,t){t||this._currScript.isModified||this._currScript.scriptIdPart!==e.scriptIdPart||this._setScriptName(e.scriptName)},G.prototype._setScriptName=function(e){e=TradingView.isAbsent(e)?"":""+e,this._currScript.scriptName=e,e?this._unsaved.setValue(!1):this._unsaved.setValue(!0),this._currentScriptObject.setValue(this._currScript),this._onDialogResize()},G.prototype._setScriptModified=function(e){var t=this._ui.$body;this._currScript.isModified=!!e;var i=TVScript.extractVersion(this._ui.editor.session.getValue());i!==this._currScript.pineVersion&&(this._currScript.pineVersion=i,this._initVersionDependentTools()),e&&!t.hasClass("tv-script-modified")?t.addClass("tv-script-modified"):e||t.removeClass("tv-script-modified"),this._currentScriptObject.setValue(this._currScript),this._modified.setValue(this._currScript.isModified)},G.prototype._renameScript=function(e,t,i){if(t&&t!==this._currScript.scriptName){var s=this._currScript.scriptName;this._setScriptName(t),_.renamePine(e,t,i).done(function(e){this._renamed.fire(),this._writeConsoleInfo(window.t("Script renamed"))}.bind(this)).fail(function(){var n=window.t("Script rename failed, pineId='{0}', newName='{1}', force={2}").format(e,t,i);this._writeConsoleError(n),this._setScriptName(s)}.bind(this))}},G.prototype._saveScriptAs=function(e,t,i,s){if(t){var n=this._ui.editor.getValue();_.saveNew(n,t,i,null).done(function(e,i){i&&this._writeConsoleError(i),this._writeConsoleInfo(window.t("Script '{0}' has been saved").format(t)),this._openScript({scriptSource:n,scriptIdPart:e.scriptIdPart,version:e.pine.version,scriptName:t
},!0)}.bind(this)).fail(function(n){if(s||i||"Conflict"!==n){var o=window.t("SaveAs operation failed, reason: {0}").format(n);this._writeConsoleError(o)}else{var r=M.format(t);r=g(r),h({type:"modal",content:r}).then(function(n){n.on("action:yes",function(n){i=!0,s=!0,this._saveScriptAs(e,t,i,s),n.close()}.bind(this)),n.open()}.bind(this))}}.bind(this))}},G.prototype._addToRecent=function(e){e.scriptIdPart&&""!==e.scriptName&&(0!==this._recentlyUsedQueue.length&&(this._recentlyUsedQueue=this._recentlyUsedQueue.filter((function(t){return t.scriptIdPart!==e.scriptIdPart})),4===this._recentlyUsedQueue.length&&this._recentlyUsedQueue.pop()),this._recentlyUsedQueue.unshift(Object.assign({},e)),this._recentlyUsed.setValue(this._recentlyUsedQueue))},G.prototype._removeFromRecent=function(e){this._recentlyUsedQueue=this._recentlyUsedQueue.slice().filter((function(t){return e!==t.scriptIdPart})),this._recentlyUsed.setValue(this._recentlyUsedQueue)},G.prototype._renderHeader=function(){T.renderHeader(document.getElementById("tv-script-pine-editor-header-root"),{editor:this._ui.editor,currentScript:this._currentScriptObject,versions:this._versions,recentlyUsed:this._recentlyUsed,authenticated:this._authenticated,readOnly:this._readOnly,unsaved:this._unsaved,renamed:this._renamed,modified:this._modified,converted:this._converted,conversionDisabled:this._conversionDisabled,forceShowConvert:this._forceShowConvert,publishingAwaited:this._publishingAwaited,findReplacePanelVisible:this._findReplacePanelVisible,renameHandler:this._renameButtonHandler.bind(this),newIndicatorScriptHandler:this._newIndicatorScript.bind(this),newStrategyScriptHandler:this._newStrategyScript.bind(this),openScriptWithConfirmHandler:this._openScriptWithConfirm.bind(this),openScriptVersionHandler:this._tryOpenScriptVersion.bind(this),openScriptHandler:this._openScriptHandler.bind(this),openDefaultScriptHandler:this._openDefaultScriptHandler.bind(this),saveScriptHandler:this._saveButtonHandler.bind(this),addScriptHandler:this._addButtonHandler.bind(this),publishScriptHandler:this._publishToggleHandler.bind(this),saveAsHandler:this._saveAsButtonHandler.bind(this),convertHandler:this._convertButtonHandler.bind(this),convertBackHandler:this._convertBackButtonHandler.bind(this),searchToolbarOpenHandler:this._toggleFindReplacePanel.bind(this),currentTheme:k})},G.prototype._toggleFindReplacePanel=function(){if(null===this._searchPanelRef)return this._findReplacePanelVisible.setValue(!0),void(this._searchPanelRef=w.showPanel(document.getElementById("tv-script-find-replace-panel-root"),{isVisible:this._findReplacePanelVisible,editor:this._ui.editor,isExpanded:this._findReplacePanelExpanded}));this._findReplacePanelExpanded.value()?w.focusReplaceInputOnUpdate():w.focusSearchInputOnUpdate(),this._findReplacePanelVisible.setValue(!this._findReplacePanelVisible.value())},e.exports=G},"040A":function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 26" width="3" height="13" fill="currentColor"><circle cx="3" cy="3" r="3"/><circle cx="3" cy="13" r="3"/><circle cx="3" cy="23" r="3"/></svg>'},"07JU":function(e,t,i){"use strict";i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){return n})),i.d(t,"d",(function(){return o})),i.d(t,"b",(function(){return r}));class s{constructor(e,t){this.event="open_filters_dialog",this.location="toolbar",this.value="",this.source=e,this.state=t>0?"with_counter":"without_counter"}}class n{constructor(e){this.event="change_filter_dialog_tab",this.source="filter_dialog_tab_button",this.location="filter_dialog",this.value="",this.state=e}}class o{constructor(){this.event="filter_dialog_search_input_click",this.source="filter_dialog_search_input",this.location="filter_dialog",this.state="user_clicked",this.value=""}}class r{constructor(e){this.event="filter_dialog_search_no_terms_found",this.source="filter_dialog_search_input",this.location="filter_dialog",this.state="empty_search_result",this.value="",this.value=e}}},"2B6P":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg"><line x2="100%" y2="100%"/><line x2="100%" y1="100%"/></svg>'},"2iWw":function(e,t,i){},"2ish":function(e,t,i){},"3Wb9":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16"><g fill="none" stroke="currentColor" stroke-width="2" transform="translate(1 1)"><circle cx="6" cy="6" r="6"/><path d="M10 10l4 4"/></g></svg>'},"48P3":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r}));var s=i("MwoA");const n={forex:{top_gainers:$.t("Rising pairs"),top_losers:$.t("Falling pairs")},default:{top_gainers:$.t("Top gainers"),top_losers:$.t("Top losers")}},o=[{id:"general",title:$.t("General"),content:{sort_field:"name",sort_direction:"asc",filters:{}}},{id:"most_capitalized",title:$.t("Most capitalized"),content:{sort_field:"market_cap_basic",sort_direction:"desc",filters:{}}},{id:"volume_leaders",title:$.t("Volume leaders"),adjustFilter:{volume:[1]},content:{sort_field:"volume",sort_direction:"desc",filters:{},options:{active_symbols_only:!0}}},{id:"top_gainers",title:n.default.top_gainers,adjustFilter:{change:[1]},content:{sort_field:"change",sort_direction:"desc",filters:{change:{operator:"greater",value:0}},options:{active_symbols_only:!0}}},{id:"top_losers",title:n.default.top_losers,adjustFilter:{change:[0]},content:{sort_field:"change",sort_direction:"asc",filters:{change:{operator:"less",value:0}},options:{active_symbols_only:!0}}},{id:"ath",title:$.t("All-time high"),content:{sort_field:"name",sort_direction:"asc",filters:{"High.All":{operator:"eless",value:"high"}},options:{active_symbols_only:!0}}},{id:"atl",title:$.t("All-time low"),content:{sort_field:"name",sort_direction:"asc",filters:{"Low.All":{operator:"egreater",value:"low"}},options:{active_symbols_only:!0}}},{id:"high_dividend",title:$.t("High-dividend"),content:{sort_field:"dividend_yield_recent",sort_direction:"desc",filters:{
dividend_yield_recent:{operator:"greater",value:0}},options:{active_symbols_only:!0}}},{id:"above_52wk_high",title:$.t("New 52-week high"),content:{sort_field:"name",sort_direction:"asc",filters:{price_52_week_high:{operator:"eless",value:"high"}},options:{active_symbols_only:!0}}},{id:"below_52wk_low",title:$.t("New 52-week low"),content:{sort_field:"name",sort_direction:"asc",filters:{price_52_week_low:{operator:"egreater",value:"low"}},options:{active_symbols_only:!0}}},{id:"monthly_high",title:$.t("New monthly high"),content:{sort_field:"name",sort_direction:"asc",filters:{"High.1M":{operator:"eless",value:"high"}},options:{active_symbols_only:!0}}},{id:"monthly_low",title:$.t("New monthly low"),content:{sort_field:"name",sort_direction:"asc",filters:{"Low.1M":{operator:"egreater",value:"low"}},options:{active_symbols_only:!0}}},{id:"most_volatile",title:$.t("Most volatile"),adjustFilter:{"Volatility.D":[1]},content:{sort_field:"Volatility.D",sort_direction:"desc",filters:{},options:{active_symbols_only:!0}}},{id:"unusual_volume",title:$.t("Unusual volume"),adjustFilter:{relative_volume_10d_calc:[1]},content:{sort_field:"relative_volume_10d_calc",sort_direction:"desc",filters:{relative_volume_10d_calc:null},options:{active_symbols_only:!0}}},{id:"overbought",title:$.t("Overbought"),content:{sort_field:"name",sort_direction:"asc",filters:{RSI:{operator:"greater",value:70}},options:{active_symbols_only:!0}}},{id:"oversold",title:$.t("Oversold"),content:{sort_field:"name",sort_direction:"asc",filters:{RSI:{operator:"less",value:30}},options:{active_symbols_only:!0}}},{id:"outperforming_SMA50",title:$.t("Outperforming SMA50"),content:{sort_field:"name",sort_direction:"asc",filters:{SMA50:{operator:"less",value:"close"}},options:{active_symbols_only:!0}}},{id:"underperforming_SMA50",title:$.t("Underperforming SMA50"),content:{sort_field:"name",sort_direction:"asc",filters:{SMA50:{operator:"greater",value:"close"}},options:{active_symbols_only:!0}}},{id:"earnings_this_week",title:$.t("Earnings this week"),content:{sort_field:"name",sort_direction:"asc",filters:{earnings_release_next_date:null}}}];function r(e){o.forEach(t=>{if(t.disabled=!1,t.id in s.f.america)for(const e in s.f.america[t.id])t.content.filters[e]=s.f.america[t.id][e];if("forex"!==e&&"crypto"!==e&&"brazil"!==e?t.content.filters.name=["common","dr","etf"]:delete t.content.filters.name,"america"===e?t.content.filters.exchange=["NYSE","NASDAQ","AMEX"]:delete t.content.filters.exchange,s.f[e]&&t.id in s.f[e])if(null===s.f[e][t.id])t.disabled=!0;else for(const i in s.f[e][t.id]){const n=s.f[e][t.id][i];null===n?delete t.content.filters[i]:t.content.filters[i]=n}"forex"===e?n.forex[t.id]&&(t.title=n.forex[t.id]):n.default[t.id]&&(t.title=n.default[t.id]),"general"===t.id&&(t.disabled="forex"!==e&&"crypto"!==e)})}},"49Ex":function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 12" width="14" height="12" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M2.71 1.29H1.3v9.42H2.7V1.3zM1.3 0C.58 0 0 .58 0 1.29v9.42C0 11.42.58 12 1.29 12H2.7C3.42 12 4 11.42 4 10.71V1.3C4 .58 3.42 0 2.71 0H1.3zM7.7 1.29H6.3v9.42H7.7V1.3zM6.3 0C5.58 0 5 .58 5 1.29v9.42c0 .71.58 1.29 1.29 1.29H7.7C8.42 12 9 11.42 9 10.71V1.3C9 .58 8.42 0 7.71 0H6.3zm5 1.29h1.42v9.42H11.3V1.3zm-1.29 0C10 .58 10.58 0 11.29 0h1.42C13.42 0 14 .58 14 1.29v9.42c0 .71-.58 1.29-1.29 1.29H11.3c-.71 0-1.29-.58-1.29-1.29V1.3z"/></svg>'},"4pMH":function(e,t,i){},"4qhP":function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"e",(function(){return a})),i.d(t,"b",(function(){return d})),i.d(t,"h",(function(){return u})),i.d(t,"d",(function(){return p})),i.d(t,"c",(function(){return _})),i.d(t,"i",(function(){return f})),i.d(t,"g",(function(){return g})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return m})),i.d(t,"f",(function(){return b}));var s=i("Eyy1"),n=i("7KDR"),o=i("0W4x");i.d(t,"l",(function(){return o.orderStatusToText}));const r="js-bottom-trading-tab";function a(e){const t=[],i=e.filter(e=>e.brokerPlan&&!e.brokerPlan.hidden&&e.brokerPlan.slug_name),s=c(i);return t.push(...i.map(e=>e.brokerPlan&&e.brokerPlan.slug_name).filter(e=>void 0!==e)),t.splice(s+1,0,...l),t}const l=["Paper"];function c(e){return e.findIndex(e=>e.brokerPlan&&!e.brokerPlan.hidden&&e.brokerPlan.flags&&e.brokerPlan.flags.includes("featured"))}function d(e,t){const i=e.map(e=>e.id),s=t.map(e=>e.slug_name),n=t.filter(e=>i.includes(e.slug_name)).map(t=>({metainfo:h(e,t.slug_name),brokerPlan:t})),o=e.filter(e=>!s.includes(e.id)&&!l.includes(e.id)).map(e=>({metainfo:e})),r=c(n),a=l.map(t=>({metainfo:h(e,t)}));return a.length>0&&n.splice(r+1,0,...a),[...n,...o]}function h(e,t){return Object(s.ensureDefined)(e.find(e=>e.id.toLowerCase()===t.toLowerCase()))}function u(e){return void 0!==e&&["oauth","oauth2-implicit-flow","oauth2-code-flow"].includes(e)}function p(e,t){const i=Object(o.sideToText)(e.side)+" "+e.qty+" @ "+t.format(e.price);return i.substr(0,1).toUpperCase()+i.substr(1).toLowerCase()}function _(e){return e?e.map(e=>"-"===e.text||e.separator?new n.Separator:new n.Action({name:e.name,checkable:e.checkable,checked:e.checked,disabled:void 0!==e.enabled&&!e.enabled,shortcut:e.shortcut,label:e.text,statName:e.statName,icon:e.icon,onExecute:t=>{e.action({checkable:t.isCheckable(),checked:t.isChecked(),enabled:!t.isDisabled(),text:t.getLabel().toString()})}})):[]}function f(e){return 6===e||3===e}function g(e,t){if(void 0!==t&&t.length>0){const i=t.find(t=>"default"in t&&(void 0===t.supportedOrderTypes||t.supportedOrderTypes.includes(e)))||t.find(t=>t.supportedOrderTypes&&t.supportedOrderTypes.includes(e));return i?{type:i.value}:void 0}}function v(e){return(e+"-brokers-side-maintenance").toLowerCase()}function m(e){return(e+"-maintenance").toLowerCase()}function b(e,t,i){if("crypto"===e.type)return e.currency||""
;return!i&&t.currencySign||t.currency||e.currency||""}},"5bCf":function(e,t,i){e.exports={container:"container-1z0p8Gw0",active:"active-1z0p8Gw0",title:"title-1z0p8Gw0",inactive:"inactive-1z0p8Gw0",titleText:"titleText-1z0p8Gw0",indicator:"indicator-1z0p8Gw0",disconnected:"disconnected-1z0p8Gw0",failed:"failed-1z0p8Gw0",connecting:"connecting-1z0p8Gw0",connected:"connected-1z0p8Gw0",loginTooltip:"loginTooltip-1z0p8Gw0"}},"5ijr":function(e){e.exports=JSON.parse('{"switcherWrapper":"switcherWrapper-1wFH-_jm","size-small":"size-small-1gT-kZYO","size-large":"size-large-MOSirnj_","intent-select":"intent-select-2kut8F29","switcherThumbWrapper":"switcherThumbWrapper-2u191lDO","input":"input-J7QIcTTo","switcherTrack":"switcherTrack-2XruDVTa","intent-default":"intent-default-3soo5rvS","switcherThumb":"switcherThumb-2yuEucci","focus":"focus-uZMRkCO0"}')},"5zLk":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 14" width="16" height="14"><g fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15 9v4H1V9M8 9V0"/><path d="M5 6l3 3 3-3"/></g></svg>'},"69Qn":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("cZRT");class n extends s.a{_startLoading(){return Promise.all([i.e(382),i.e("hammerjs")]).then(i.bind(null,"be1f")).then(e=>e.HammerJS)}}},"6aJD":function(e,t,i){"use strict";i.r(t);var s=i("APlX");i.d(t,"TVModal",(function(){return s.TVModal})),i.d(t,"isOpenedModals",(function(){return s.isOpenedModals}))},"7DLB":function(e,t,i){"use strict";function s(e){return{standalone:Boolean(e.standalone),originalStandalone:Boolean(e.originalStandalone),onWidget:Boolean(e.onWidget)}}function n(e){const t=s(e);return t.standalone&&t.originalStandalone&&!t.onWidget}function o(e){return s(e).onWidget}function r(e){return n(e)?"screener":function(e){const t=s(e);return t.standalone&&!t.originalStandalone&&!t.onWidget}(e)?"market":function(e){const t=s(e);return!t.standalone&&t.originalStandalone&&!t.onWidget}(e)?"chart":"widget"}i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return o})),i.d(t,"a",(function(){return r}))},"7FKn":function(e,t,i){"use strict";i.d(t,"a",(function(){return m})),i.d(t,"b",(function(){return b}));var s=i("mrSG"),n=i("q1tI"),o=i.n(n),r=i("TSYQ"),a=i("ijHL"),l=i("3F0O"),c=i("szLm"),d=i("ECWH"),h=i("Bcy+"),u=i("SpAO"),p=i("RG4O"),_=i("ldG2"),f=i("xADF"),g=i("9p+j");i("2ish");function v(e){return!Object(a.d)(e)&&!Object(a.e)(e)}function m(e){
const{id:t,title:i,role:n,tabIndex:l,placeholder:c,name:d,type:h,value:u,defaultValue:p,draggable:m,autoComplete:b,autoFocus:w,maxLength:S,min:y,max:C,step:$,pattern:k,inputMode:x,onSelect:I,onFocus:T,onBlur:E,onKeyDown:O,onKeyUp:j,onKeyPress:F,onChange:B,onDragStart:P,size:R="medium",className:M,inputClassName:D,disabled:A,readonly:N,containerTabIndex:L,startSlot:W,endSlot:V,reference:H,containerReference:z,onContainerFocus:q}=e,U=Object(s.d)(e,["id","title","role","tabIndex","placeholder","name","type","value","defaultValue","draggable","autoComplete","autoFocus","maxLength","min","max","step","pattern","inputMode","onSelect","onFocus","onBlur","onKeyDown","onKeyUp","onKeyPress","onChange","onDragStart","size","className","inputClassName","disabled","readonly","containerTabIndex","startSlot","endSlot","reference","containerReference","onContainerFocus"]),K=Object(a.c)(U,v),G=Object.assign(Object.assign(Object.assign({},Object(a.a)(U)),Object(a.b)(U)),{id:t,title:i,role:n,tabIndex:l,placeholder:c,name:d,type:h,value:u,defaultValue:p,draggable:m,autoComplete:b,autoFocus:w,maxLength:S,min:y,max:C,step:$,pattern:k,inputMode:x,onSelect:I,onFocus:T,onBlur:E,onKeyDown:O,onKeyUp:j,onKeyPress:F,onChange:B,onDragStart:P});return o.a.createElement(_.a,Object.assign({},K,{disabled:A,readonly:N,tabIndex:L,className:r(g.container,M),size:R,ref:z,onFocus:q,startSlot:W,middleSlot:o.a.createElement(f.d,null,o.a.createElement("input",Object.assign({},G,{className:r(g.input,D,W&&g["with-start-slot"],V&&g["with-end-slot"]),disabled:A,readOnly:N,ref:H}))),endSlot:V}))}function b(e){e=Object(h.a)(e);const{disabled:t,autoSelectOnFocus:i,tabIndex:s=0,onFocus:r,onBlur:a,reference:_,containerReference:f=null}=e,g=Object(n.useRef)(null),v=Object(n.useRef)(null),[b,w]=Object(u.a)(),S=t?void 0:b?-1:s,y=t?void 0:b?s:-1,{isMouseDown:C,handleMouseDown:$,handleMouseUp:k}=Object(p.a)(),x=Object(l.a)(w.onFocus,(function(e){i&&!C.current&&Object(c.a)(e.currentTarget)}),r),I=Object(l.a)(w.onBlur,a),T=Object(n.useCallback)(e=>{g.current=e,_&&("function"==typeof _&&_(e),"object"==typeof _&&(_.current=e))},[g,_]);return o.a.createElement(m,Object.assign({},e,{isFocused:b,containerTabIndex:S,tabIndex:y,onContainerFocus:function(e){v.current===e.target&&null!==g.current&&g.current.focus()},onFocus:x,onBlur:I,reference:T,containerReference:Object(d.a)([v,f]),onMouseDown:$,onMouseUp:k}))}},"7lx1":function(e,t,i){},"9Cho":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return o}));i("MwoA");const s={america:"usa",brazil:"brazilia",euronext:"europe",hongkong:"hong-kong",newzealand:"new-zealand",uk:"united-kingdom",rsa:"south-africa"};function n(e,t,i="sector"){return e&&t?(s[t]&&(t=s[t]),`/markets/stocks-${t}/sectorandindustry-${i}/${o(e).toLowerCase()}/`):"/markets/stocks-usa/sectorandindustry-sector/"}function o(e){return e.replace(/[^a-zA-Z0-9]+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}},"9aS1":function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path d="M3.06 6.295C2.37 7.397 2 8.67 2 10c0 3.866 3.134 7 7 7s7-3.134 7-7-3.134-7-7-7V2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8c0-1.556.444-3.007 1.212-4.236l.848.53zm0 0C2.37 7.397 2 8.67 2 10c0 3.866 3.134 7 7 7s7-3.134 7-7-3.134-7-7-7V2c4.418 0 8 3.582 8 8s-3.582 8-8 8-8-3.582-8-8c0-1.556.444-3.007 1.212-4.236l.848.53zM6 2.5L9 0v5L6 2.5z"/></svg>'},"9nb6":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return o}));var s=i("8woN");function n(e){if(e.includes("|")){const[t,i]=e.split("|"),{proName:s,shortName:n}=o(t);return{proName:s,shortName:n,interval:i}}{const{proName:t,shortName:i}=o(e);return{proName:t,shortName:i,interval:void 0}}}function o(e){let t,i;return e.includes(":")?(i=Object(s.shortName)(e),t=e):i=e,{proName:t,shortName:i}}},"9p+j":function(e){e.exports=JSON.parse('{"input":"input-3bEGcMc9","with-start-slot":"with-start-slot-16sVynIv","with-end-slot":"with-end-slot-S5RrC8PC"}')},APlX:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.TVModal=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e};t.isOpenedModals=function(){return 0!==u.length};var n=h(i("9uLv")),o=i("qFKp"),r=i("0YpW"),a=i("KHon"),l=i("c2JX"),c=h(i("6et/")),d=h(i("lxNp"));function h(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}let u=[];const p={ajax:{},closingDuration:n.dur/2,fixBodyState:!0,overlayTemplate:'<div class="tv-dialog__overlay"></div>',containerTemplate:'<div class="tv-dialog__modal-wrap"><div class="tv-dialog__modal-container"><div class="tv-dialog__modal-body"></div></div></div>',ajaxErrorTemplate:`<div class="tv-dialog__error js-dialog__close">${window.t("Error")}</div>`};class _ extends a.TVDialogAbstract{constructor(e={}){if(super(s({},p,e)),this.$overlay=$(this.options.overlayTemplate),this.$modalWrap=$(this.options.containerTemplate),this.$body=this.$modalWrap.find(".tv-dialog__modal-body").append(this.$el),this.options.closeOnOutsideClick&&this.$overlay.add(this.$modalWrap).click(e=>{this.isEventOut(e)&&this.close()}),this.on("change:zIndex",()=>{this.$overlay.css("z-index",this.zIndex),this.$modalWrap.css("z-index",this.zIndex)}),this.on("destroy",()=>{const e=()=>{this.$overlay.remove(),this.$modalWrap.remove()};this.opened?(this.close(),setTimeout(e,this.options.closingDuration)):e()}),this.on("beforeOpen",()=>{u.push(this)}),this.options.ajax.url){const e=this.options.ajax.beforeSend||$.noop,t=this.options.ajax.success||!1,i=this.options.ajax.error||$.noop;$.extend(this.options.ajax,{beforeSend:()=>{this.trigger("beforeLoading",[this]),this.startSpinner(),e(this)},success:e=>{this.trigger("afterLoading",[this]),this.renderContent(t?t(this,e):e).showContent(),this.trigger("afterLoadingShow",[this])},error:()=>{
this.renderContent(this.options.ajaxErrorTemplate),i(this),this.trigger("errorLoading",[this])}})}this.on("error",(e,t)=>{this.$modalWrap[0].getBoundingClientRect().height<this.$content[0].getBoundingClientRect().height&&t.addClass("i-fixed").css({width:this.$el.width()})}),this._keyboardBinderLockId=null}open(){if(this.opened)return;this.opened=!0,this._keyboardBinderLockId=c.disable(),this.options.fixBodyState&&(0,r.setFixedBodyState)(!0),this._hotkeys||(this._hotkeys=d.createGroup({desc:"Modal Dialog",isDisabled:()=>!this.opened,modal:!0}),this.options.closeOnEsc&&this._hotkeys.add({desc:"close",hotkey:27,handler:()=>this.close()}));const e=()=>{this.focus(),this.toTop(),this.trigger("beforeOpen",[this]),$(this.$wrap).append(this.$overlay.addClass("i-hidden i-closed").css("z-index",this.zIndex)).append(this.$modalWrap.addClass("i-hidden i-closed").css("z-index",this.zIndex)),this.$overlay.removeClass("i-hidden"),setTimeout(()=>{this.$overlay.removeClass("i-closed")},20),this.options.ajax.url?this.ajaxRequest=$.ajax(this.options.ajax):this.showContent()};return o.isSafari?setTimeout(()=>e(),50):e(),this}close(){if(this.opened)return this.opened=!1,this._keyboardBinderLockId&&c.enable(this._keyboardBinderLockId),this._hotkeys&&(this._hotkeys.destroy(),this._hotkeys=null),this.trigger("beforeClose",[this]),this.ajaxRequest&&(this.ajaxRequest.abort(),delete this.ajaxRequest),this.hideContent(),this.$overlay.addClass("i-closed"),setTimeout(()=>{this.$modalWrap.addClass("i-hidden").detach(),this.$overlay.addClass("i-hidden").detach(),u=e.without(u,this),this.options.fixBodyState&&(0,r.setFixedBodyState)(!1),this.trigger("afterClose",[this]),this.unfocus(),u.length>0&&u[u.length-1].focus(),this.options.destroyOnClose&&this.destroy()},this.options.closingDuration),this}showContent(){return this.$modalWrap.removeClass("i-hidden"),setTimeout(()=>{this.$modalWrap.removeClass("i-closed")},20),setTimeout(()=>{this.trigger("afterOpen",[this]),this.spinner&&this.stopSpinner()},.75*n.dur+20),this}hideContent(){if(this.$el)return this.$modalWrap.addClass("i-closed"),this.unfocus(),this}startSpinner(){return this.spinner=new l.Spinner("large"),this.spinner.spin(this.$overlay[0]),this}stopSpinner(){if(this.spinner)return this.spinner.stop(),delete this.spinner,this}}t.TVModal=_}).call(this,i("F/us"))},Ald9:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 95.939 95.939" width="95.939" height="95.939"><path d="M62.82 47.97l32.53-32.534a2 2 0 0 0 0-2.828L83.332.586a2 2 0 0 0-2.827 0L47.97 33.12 15.435.587c-.75-.75-2.078-.75-2.828 0L.587 12.607a2 2 0 0 0 0 2.83L33.12 47.97.588 80.504a2 2 0 0 0 0 2.828l12.02 12.02a1.997 1.997 0 0 0 2.83 0L47.97 62.818l32.535 32.535a2 2 0 0 0 2.827 0l12.02-12.02c.78-.783.78-2.05 0-2.83L62.82 47.97z"/></svg>'},BAye:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M7 5.5a2.5 2.5 0 0 1 5 0V7H7V5.5zM6 7V5.5a3.5 3.5 0 1 1 7 0V7a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2zm5 4.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>'},BSSX:function(e,t,i){},"Bcy+":function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("3F0O"),n=i("SpAO");function o(e){const{onFocus:t,onBlur:i,intent:o,highlight:r,disabled:a}=e,[l,c]=Object(n.a)(),d=Object(s.a)(a?void 0:c.onFocus,t),h=Object(s.a)(a?void 0:c.onBlur,i);return Object.assign(Object.assign({},e),{intent:o||(l?"primary":"default"),highlight:null!=r?r:l,onFocus:d,onBlur:h})}},C8ph:function(e,t,i){"use strict";i.r(t),i.d(t,"showRenamePineScriptDialog",(function(){return o}));var s=i("YFKU"),n=i("fZEr");function o(e){const{title:t,label:i,initValue:o,currScript:r,scripts:a,onSuccess:l,isCopy:c}=e;return Object(n.showRename)({title:t,initValue:o,text:i,maxLength:128,onRename:({dialogClose:e,newValue:t,focusInput:i,innerManager:o})=>{const d=t.trim(),h=a.find(e=>e.scriptName===d);(c?Boolean(h):h&&h.scriptIdPart!==r.scriptIdPart)?Object(n.showConfirm)({text:Object(s.t)("Script '{scriptName}' already exists. Do you really want to replace it?").format({scriptName:d}),onConfirm:({dialogClose:t})=>{l(d),t(),e()},onClose:()=>{i()}},o):(l(d),e())}})}},C9Mz:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));class s{constructor(e){this.event="filter_dialog_applied_filters",this.source="unknown",this.location="filter_dialog",this.state="filters_applied",this.value=e}}class n{constructor(e,t,i,s){this.event="filter_use",this.value=e,this.state=t,this.source=i,this.location=s}}},CJuL:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("Q8bc");const n=Object(s.a)()},Cfz7:function(e,t,i){},CgXj:function(e,t,i){},DVxT:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28"><path fill="#ffffff" d="M18 10V0h-8v10H0v8h10v10h8V18h10v-8"/></svg>'},Dy5B:function(e,t,i){"use strict";t.operators={less:$.t("Below"),eless:$.t("Below or Equal"),greater:$.t("Above"),egreater:$.t("Above or Equal"),crosses:$.t("Crosses"),crosses_above:$.t("Crosses Up"),crosses_below:$.t("Crosses Down"),in_range:$.t("Between"),not_in_range:$.t("Outside"),equal:$.t("Equal"),nequal:$.t("Not Equal")}},E1aw:function(e,t,i){"use strict";var s=i("q1tI"),n=i("i8i4"),o=i("TSYQ"),r=i("o3hh"),a=i("ThHR"),l=i("cvc5"),c=i("CSQ5"),d=i("Iivm"),h=i("RgaO");class u extends s.PureComponent{render(){return s.createElement(l,{onMeasure:this.props.onResize},s.createElement("div",{className:this.props.className,onClick:this.props.onClick},this.props.children))}}var p=i("roNk");i.d(t,"a",(function(){return _}));class _ extends s.PureComponent{constructor(e){super(e),this._getDropdownHeight=()=>{if(!this._dropdownParent)return;const e=window.innerHeight-this._dropdownParent.getBoundingClientRect().bottom-20
;return e&&e<50?void 0:e},this._getFirstHiddenItemIndex=()=>{let e;if(this.state.availableWidth&&!this._itemSizes.includes(null)){let t=0;for(e=0;e<this.props.items.length;e++){const i=t+(this._itemSizes[e]||0);if(!((e===this.props.items.length-1?i:i+41)<this.state.availableWidth))break;t=i}}else e=this.state.availableWidth?this.props.items.length:0;return e},this._onElementResize=e=>{this.setState({availableWidth:e.width,isOpened:!1})},this._onSelect=e=>{this.props.onSelect&&this.props.onSelect(e),this.setState({activeItem:e,isOpened:!1})},this._onDropdownSelect=(e,t)=>{this.props.onSelect&&this.props.onSelect(t.actualIndex),this.setState({activeItem:t.actualIndex,isOpened:!1})},this._onOutsideClick=e=>{this.state.isOpened&&(this.state.isOpened&&(e.preventDefault(),e.stopPropagation()),this.setState({isOpened:!1}))},this._onDropdownItemClick=()=>{this.setState({isOpened:!this.state.isOpened})},this._onItemResize=(e,t)=>{this._itemSizes[e]=t.width,this._itemSizes.includes(null)||this.forceUpdate()},this._itemSizes=this.props.items.map(e=>null),this.state={availableWidth:0,activeItem:this.props.activeItem||0,isOpened:!1}}render(){const e=this._getFirstHiddenItemIndex(),t=this.props.items.slice(0,e),i=this.props.items.slice(e),_=t.map((e,t)=>{const i=this.state.activeItem===t,n=o(r.itemContent,{[r.active]:i});return s.createElement(u,{key:e.title,className:o(r.item,{[r.active]:i}),onClick:this._onSelect.bind(this,t),onResize:this._onItemResize.bind(this,t)},s.createElement("div",{className:n},e.title))}),f=i.map((e,i)=>({elem:e.title,actualIndex:i+t.length})),g=this.state.activeItem-e,v=g>=0,m=s.createElement(h.a,{handler:this._onOutsideClick,click:!0},e=>s.createElement("div",{ref:e=>e&&(this._dropdownParent=n.findDOMNode(e))},s.createElement("div",{className:o(r.item,{[r.active]:v}),ref:e,onClick:this._onDropdownItemClick},s.createElement("div",{className:o(r.itemContent,r.dropdownItem,{[r.active]:v})},s.createElement(d.a,{className:o(r.dropdownIcon,{[r.active]:this.state.isOpened}),icon:p}),s.createElement(c.a,{isOpened:this.state.isOpened,items:f,selected:v?g:void 0,onSelect:this._onDropdownSelect,top:27,right:0,itemsClassName:o(a.bluishItem,r.dropdownListItem),maxHeight:this._getDropdownHeight()})))));return s.createElement(l,{onMeasure:this._onElementResize},s.createElement("div",{className:o(r.elementWrap,this.props.className)},s.createElement("div",{className:r.itemsWrap},_,i.length?m:void 0)))}}},E9Pn:function(e,t,i){},EiOp:function(e,t,i){e.exports={title:"title-pQrO4S2E",compact:"compact-pQrO4S2E",active:"active-pQrO4S2E",titleText:"titleText-pQrO4S2E",button:"button-pQrO4S2E",item:"item-pQrO4S2E"}},EulZ:function(e,t,i){},F0Qt:function(e){e.exports=JSON.parse('{"wrapper":"wrapper-21v50zE8","input":"input-24iGIobO","box":"box-3574HVnv","icon":"icon-2jsUbtec","noOutline":"noOutline-3VoWuntz","intent-danger":"intent-danger-1Sr9dowC","check":"check-382c8Fu1","dot":"dot-3gRd-7Qt"}')},Fi0z:function(e,t,i){"use strict";i.r(t),i.d(t,"PineReferenceDialog",(function(){return C}));i("EsMY")
;var s=i("YFKU"),n=i("Vdly"),o=i("YDhE"),r=i("UIZs"),a=i("o6+g"),l=i("SuO3"),c=i("bwY1"),d=i("A6WY"),h=i("wZee"),u=i.n(h),p=i("Eyy1"),_=i("WK2o"),f=i("Opoj"),g=(i("Nzx2"),i("ayyV"),i("IcMm"),i("J1NM"),i("25b6")),v=i("ogJP");const m=s.t("Pine Script language reference manual"),b=s.t("Search"),w=s.t("Version"),S=new a.ReferenceRenderer({tocSectionTemplate:'<div class="tv-accordion__section-header tv-accordion__section-header--small">{{header}}</div><div class="tv-accordion__section-body">{{#items}}{{> tocItemTemplate}}{{/items}}</div>'}),y=`\n\t<div class="tv-pine-reference-dialog__close-button js-dialog__close">\n\t\t${f}\n\t</div>\n`;class C{constructor(e){this.dialog=null,this._referenceController=null,this._scrollPosition=0,this._onV3SelectorClickHandler=e=>{this._unsubscribe(),Object(p.ensureNotNull)(this.dialog).destroy(),this.dialog=null,this.open(3)},this._onV4SelectorClickHandler=e=>{this._unsubscribe(),Object(p.ensureNotNull)(this.dialog).destroy(),this.dialog=null,this.open(4)},this._onSearchKeyDownHandler=e=>{Object(p.ensureNotNull)(this._referenceController).handleKeydown(e)},this._externalOptions=e}async open(e,t){let i;if(await this._createDialog(e),t){const e=t.replace(".","{dot}");i=()=>{this._isInSearchMode&&(this._searchWidget.$input.val(""),this._searchWidget.$input.trigger("input")),this._forceScrollToElement=!0,Object(p.ensureNotNull)(this._referenceController).selectItem(e)},this._isFirstOpen=!1}else i=()=>{this._contentContainerElement.scrollTop=this._scrollPosition};const s=Object(p.ensureNotNull)(this.dialog);this._isFirstOpen&&(this._isFirstOpen=!1,s.once("afterOpen",()=>{this._accordionWidget.setActiveIndex(0),this._onContentScrollHandler()})),s.isOpened()?i():s.once("afterOpen",i),s.open()}async _createDialog(e){if(this.dialog&&this._pineVersion===e)return;this._pineVersion=e,await S.loadReference(e),this._onClickAnchorItemHandler=this._onClickAnchorItemHandler.bind(this),this._onContentScrollHandler=this._onContentScrollHandler.bind(this),this._initResizable=this._initResizable.bind(this),this._disposeResizable=this._disposeResizable.bind(this);const t=Object.assign(Object.assign({},C._defaultOptions),this._externalOptions)
;t.content='<div class="tv-pine-reference-dialog__left-column"><div class="tv-pine-reference-dialog__search-bar js-search-bar"></div><div class="tv-pine-reference-dialog__search-results i-hidden js-search-results"><div style="position: relative"></div></div><div class="tv-pine-reference-dialog__toc js-toc">'+S.getScriptReferenceTocContent()+'</div><div class="tv-pine-reference-dialog__version-switcher"><div class="tv-pine-reference-dialog__version-text">'+Object(g.htmlEscape)(w)+'</div><div class="tv-pine-reference-dialog__version-controls"><div class="tv-pine-reference-dialog__version js-v3-selector">v3</div><div class="tv-pine-reference-dialog__version js-v4-selector">v4</div></div></div></div><div class="tv-pine-reference-dialog__right-column js-reference-content"><div class="js-reference-resize">'+S.getScriptReferenceContentHtml()+'</div></div><div class="js-dialog__scroll-wrap"><div></div></div>';const i=Object(n.getJSON)("pinereference.size",{w:C._defaultWidth,h:C._defaultHeight});i.w=Math.max(C._minWidth,i.w),i.h=Math.max(C._minHeight,i.h);const s=document.documentElement.clientHeight,r=document.documentElement.clientWidth;i.w=Math.min(i.w,r),i.h=Math.min(i.h,s);const a=Object(n.getJSON)("pinereference.position",{top:null,left:null});if(Object(v.isNumber)(a.top)&&a.top>=0&&Object(v.isNumber)(a.left)&&a.left>=0){const e=s-i.h,n=r-i.w;a.top<e&&a.left<n&&(t.position=a)}const d=this.dialog=Object(o.createDialog)(t);d.el.style.width=i.w.toString()+"px",d.el.style.height=i.h.toString()+"px",this._isInSearchMode=!1,this._isFirstOpen=!0,this._forceScrollToElement=!1,this._searchResultsElement=d.el.querySelector(".js-search-results"),this._tocContainerElement=d.el.querySelector(".js-toc"),this._contentContainerElement=d.el.querySelector(".js-reference-content"),d.el.addEventListener("click",e=>{Object(_.copyLinkButtonEvent)(e,this._pineVersion)}),this._accordionWidget=new c.TvAccordion(this._tocContainerElement,{customScroll:!1,collapsible:!0}),this._accordionWidget.onSectionChange.subscribe(null,e=>{const t=this._accordionWidget.getSections();t[t.length-1].header.classList.toggle("tv-accordion__section-header--border-bottom",-1===e)});const h=Array.from(this._contentContainerElement.querySelectorAll(".tv-pine-reference-header"));d.on("dragEnd",()=>{const e=Object(p.ensureNotNull)(this.dialog).el.style,t=parseFloat(e.top),i=parseFloat(e.left);Object(n.setJSON)("pinereference.position",{top:t,left:i},{forceFlush:!0})}),d.on("beforeOpen",this._initResizable),d.on("afterClose",this._disposeResizable),Modernizr.mobiletouch&&d.el.classList.add("tv-pine-reference-dialog--touch"),d.el.addEventListener("click",this._onClickAnchorItemHandler),this._initSearchWidget();const u={container:d.el,contentContainer:this._contentContainerElement,tocContainer:this._tocContainerElement,contentSectionHeaders:h,accordionWidget:this._accordionWidget,searchWidget:this._searchWidget,searchResultsElement:this._searchResultsElement,searchResultsPlaceholder:this._searchResultsElement.firstElementChild,renderer:S}
;this._referenceController=new l.ReferenceController(u),this._searchWidget.inputChangedDelegate.subscribe(null,()=>{Object(p.ensureNotNull)(this._referenceController).handleSearchInputChange()}),this._contentContainerElement.addEventListener("scroll",this._onContentScrollHandler),this._initPrismJS(),this._initSelectable(),this._v3Selector=d.el.querySelector(".js-v3-selector"),this._v4Selector=d.el.querySelector(".js-v4-selector"),4===this._pineVersion?this._v4Selector.classList.add("tv-pine-reference-dialog__version--selected"):this._v3Selector.classList.add("tv-pine-reference-dialog__version--selected"),this._v3Selector.addEventListener("click",this._onV3SelectorClickHandler),this._v4Selector.addEventListener("click",this._onV4SelectorClickHandler)}_unsubscribe(){null!==this.dialog&&(this.dialog.el.removeEventListener("click",this._onClickAnchorItemHandler),this.dialog.removeAllListeners()),this._contentContainerElement.removeEventListener("scroll",this._onContentScrollHandler),this._searchWidget.$input.get(0).removeEventListener("keydown",this._onSearchKeyDownHandler),this._v3Selector.removeEventListener("click",this._onV3SelectorClickHandler),this._v4Selector.removeEventListener("click",this._onV4SelectorClickHandler),this._accordionWidget.onSectionChange.unsubscribeAll(null)}_initSearchWidget(){const e=this._searchWidget=Object(r.createSearchControl)({addClass:"tv-pine-reference-dialog__search-row",placeholder:b});Object(p.ensureNotNull)(this.dialog).el.querySelector(".js-search-bar").appendChild(e.$control.get(0)),e.$input.get(0).addEventListener("keydown",this._onSearchKeyDownHandler)}_initPrismJS(){const e=Array.from(Object(p.ensureNotNull)(this.dialog).el.querySelectorAll(".tv-pine-reference-item__example"));for(const t of e)u.a.highlightElement(t.firstElementChild,!1)}_initSelectable(){const e=Array.from(this._contentContainerElement.querySelectorAll(".tv-pine-reference-item__content *"));for(const t of e)t.classList.add("selectable")}_onClickAnchorItemHandler(e){Object(p.ensureNotNull)(this._referenceController).handleAnchorItemClick(e)}_onContentScrollHandler(){const e=Object(p.ensureNotNull)(this._referenceController).handleContentScroll(this._isInSearchMode,this._forceScrollToElement);this._forceScrollToElement=e.forceScrollToElement,this._scrollPosition=e.scrollPosition}_saveSizeToSettings(){const e=Object(p.ensureNotNull)(this.dialog).el.style,t=parseInt(e.width),i=parseInt(e.height);t&&i&&Object(n.setJSON)("pinereference.size",{w:t,h:i},{forceFlush:!0})}_initResizable(){Object(d.lazyJqueryUI)(Object(p.ensureNotNull)(this.dialog).$el).resizable({handles:"s, se",minHeight:C._minHeight,minWidth:C._minWidth,stop:()=>{const e=Object(p.ensureNotNull)(this._referenceController).getScrolledContentItem().firstElementChild,t=this._contentContainerElement.getBoundingClientRect().top-e.getBoundingClientRect().top,i=Object(p.ensureNotNull)(this.dialog).el.querySelector(".js-reference-resize");i.style.width="",i.style.width=i.offsetWidth+"px",this._saveSizeToSettings(),e.scrollIntoView(),
this._contentContainerElement.scrollTop=this._contentContainerElement.scrollTop+t,this._updateScrolls()}})}_updateScrolls(){if(!this._isInSearchMode){const e=this._accordionWidget.getActiveSection();e&&e.scroll&&e.scroll.resize()}}_disposeResizable(){Object(d.lazyJqueryUI)(Object(p.ensureNotNull)(this.dialog).$el).resizable("destroy")}}C._minWidth=600,C._minHeight=450,C._defaultWidth=840,C._defaultHeight=580,C._defaultOptions={title:m,titleTemplate:'\n\t<div class="tv-pine-reference-dialog__title-section tv-dialog__section tv-dialog__section--title js-dialog__drag">\n\t\t<div class="tv-pine-reference-dialog__title tv-dialog__title js-title-text">{{ title }}</div>\n\t</div>\n',closeButton:!0,closeButtonTemplate:y,closeOnEsc:!1,closeOnOutsideClick:!1,contentWrapTemplate:'<div class="tv-pine-reference-dialog__content">',destroyOnClose:!1,focusFirstControl:!0,template:'<div class="tv-dialog tv-pine-reference-dialog">',type:"popup",withScroll:!1}},FzLb:function(e,t,i){"use strict";var s=i("mrSG"),n=i("q1tI"),o=i("TSYQ"),r=i("5ijr");i("4pMH");function a(e){const{className:t="",intent:i="default",size:s="small",disabled:n}=e;return o(t,r.switcherWrapper,r["size-"+s],!n&&r["intent-"+i])}class l extends n.PureComponent{render(){const e=this.props,{reference:t,size:i,intent:l}=e,c=Object(s.d)(e,["reference","size","intent"]),d=o(r.input,-1!==this.props.tabIndex&&r.focus);return n.createElement("div",{className:a(this.props)},n.createElement("input",Object.assign({},c,{type:"checkbox",className:d,ref:t})),n.createElement("div",{className:r.switcherThumbWrapper},n.createElement("div",{className:r.switcherTrack}),n.createElement("div",{className:r.switcherThumb})))}}i.d(t,"a",(function(){return l}))},"G0+C":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18px" height="18px"><path fill-rule="evenodd" d="M12.5 11h-.79l-.28-.27A6.47 6.47 0 0 0 13 6.5 6.5 6.5 0 1 0 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6 0C4.01 11 2 8.99 2 6.5S4.01 2 6.5 2 11 4.01 11 6.5 8.99 11 6.5 11z"/></svg>'},G1jy:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28"><g fill="currentColor"><path fill-rule="nonzero" d="M15.039 5.969l-.019-.019-2.828 2.828.707.707 2.474-2.474c1.367-1.367 3.582-1.367 4.949 0s1.367 3.582 0 4.949l-2.474 2.474.707.707 2.828-2.828-.019-.019c1.415-1.767 1.304-4.352-.334-5.99-1.638-1.638-4.224-1.749-5.99-.334zM5.97 15.038l-.019-.019 2.828-2.828.707.707-2.475 2.475c-1.367 1.367-1.367 3.582 0 4.949s3.582 1.367 4.949 0l2.474-2.474.707.707-2.828 2.828-.019-.019c-1.767 1.415-4.352 1.304-5.99-.334-1.638-1.638-1.749-4.224-.334-5.99z"/><path d="M10.485 16.141l5.656-5.656.707.707-5.656 5.656z"/></g></svg>'},GWvR:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path d="M9.901 9.639c-.102-.797.218-1.775.77-2.356l1.438-1.527-2.07-.395c-.784-.142-1.615-.742-2.008-1.446L7.003 2.06 5.97 3.917c-.391.702-1.222 1.301-2 1.443l-2.08.396 1.44 1.526c.547.577.866 1.549.77 2.353l-.262 2.086 1.93-.897a2.95 2.95 0 0 1 1.233-.254c.44 0 .87.085 1.233.254l1.93.897-.263-2.082zm.992-.127l.458 3.624c.014.105-.006.16-.02.176-.028.03-.109.005-.182-.03L7.812 11.73a1.973 1.973 0 0 0-.811-.16c-.302 0-.59.057-.81.16l-3.338 1.552c-.118.056-.164.051-.182.03-.014-.016-.034-.07-.02-.178L3.11 9.51c.06-.503-.162-1.18-.505-1.54L.087 5.302c-.085-.091-.09-.148-.086-.158.003-.01.04-.053.16-.077l3.621-.689c.491-.09 1.069-.506 1.315-.948L7.004 0l1.902 3.43c.246.442.824.859 1.312.947l3.617.69c.123.024.162.068.164.077.003.01-.003.066-.089.157L11.4 7.97c-.348.367-.57 1.045-.506 1.543z"/></svg>'},GeUm:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i("q1tI"),n=i("TSYQ"),o=i("sHKj");function r(e){return s.createElement("div",{className:n(e.className,o.title)},e.children)}},Gfy6:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 3" width="8" height="3"><path d="M0 0 L4 3 L8 0 Z"/></svg>'},HARt:function(e,t,i){"use strict";var s=i("/+KL"),n=i("JWMC").trackEvent,o=null,r=null,a=null;function l(e){if(r)return r;r=this,o=e.activate,e.$body.css("overflow","hidden"),this._scriptEditor=new s(e.chartWidgetCollection,{$body:e.$body,height:e.height,width:e.width,visible:e.visible,trackEvent:function(e,t){n("Pine Editor","BP Pine Editor "+e,t)},backtestingStrategyDispatcher:e.backtestingStrategyDispatcher}),a=this._scriptEditor,this._scriptEditor.show()}l.onRegister=function(e){e.activate&&(o=e.activate)},l.open=function(e){o&&o(),a&&a.show(e)},l.loadedScriptIdPart=function(){return!!a&&a.loadedScriptIdPart()},l.onScriptModified=function(e,t){a&&a.onScriptModified(e,t)},l.onScriptDeleted=function(e,t){a&&a.onScriptDeleted(e,t)},l.onScriptRenamed=function(e,t){a&&a.onScriptRenamed(e,t)},l.onScriptLegacyPineProcessed=function(e,t){a&&a.onScriptLegacyPineProcessed(e,t)},e.exports=l},HHbT:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14"><path d="M10.893 9.512l.458 3.624c.014.105-.006.16-.02.176-.028.03-.109.005-.182-.03L7.812 11.73a1.973 1.973 0 0 0-.811-.16c-.302 0-.59.057-.81.16l-3.338 1.552c-.118.056-.164.051-.182.03-.014-.016-.034-.07-.02-.178L3.11 9.51c.06-.503-.162-1.18-.505-1.54L.087 5.302c-.085-.091-.09-.148-.086-.158.003-.01.04-.053.16-.077l3.621-.689c.491-.09 1.069-.506 1.315-.948L7.004 0l1.902 3.43c.246.442.824.859 1.312.947l3.617.69c.123.024.162.068.164.077.003.01-.003.066-.089.157L11.4 7.97c-.348.367-.57 1.045-.506 1.543z"/></svg>'},HTgL:function(e,t,i){},HeqG:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="5 6 21 21" width="16px" height="15px"><path d="M15.5 27c1.2 0 2.2-.9 2.4-2H13c.3 1.1 1.3 2 2.5 2zm6.5-7v-6c-.2-2.9-2.3-5.3-5.1-5.9 0-.2.1-.4.1-.6 0-.8-.7-1.5-1.5-1.5S14 6.7 14 7.5c0 .2.1.4.2.6-2.8.6-4.9 3-5.1 5.9v5.9C9 22.7 7 23 7 23v1h17v-1s-2-.3-2-3z"/></svg>'},"I1z/":function(e,t,i){e.exports={findReplacePanel:"findReplacePanel-28nrIBWq",resizeHandle:"resizeHandle-28nrIBWq",panelContent:"panelContent-28nrIBWq",searchSection:"searchSection-28nrIBWq",replaceSection:"replaceSection-28nrIBWq",rightContainer:"rightContainer-28nrIBWq",button:"button-28nrIBWq",expandButton:"expandButton-28nrIBWq",icon:"icon-28nrIBWq",expanded:"expanded-28nrIBWq",findInput:"findInput-28nrIBWq",replaceInput:"replaceInput-28nrIBWq",selection:"selection-28nrIBWq",filterButton:"filterButton-28nrIBWq",filterHighlighted:"filterHighlighted-28nrIBWq",nextButton:"nextButton-28nrIBWq",dropdown:"dropdown-28nrIBWq",filterOptions:"filterOptions-28nrIBWq",checkbox:"checkbox-28nrIBWq",hidden:"hidden-28nrIBWq"}},IcMm:function(e,t,i){},IcMv:function(e,t,i){},IwoD:function(e,t,i){},J1NM:function(e,t,i){},JlNy:function(e,t,i){e.exports={modeTitle:"modeTitle-3iGYBWzh",modeTitleActive:"modeTitleActive-3iGYBWzh",switcherContainer:"switcherContainer-3iGYBWzh"}},JqBf:function(e,t,i){},KHon:function(e,t,i){"use strict";i.r(t);var s=i("v2PZ");i.d(t,"TVDialogAbstract",(function(){return s.TVDialogAbstract})),i.d(t,"closeAllDialogs",(function(){return s.closeAllDialogs}))},Kmbs:function(e,t,i){},Ksp5:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><circle stroke="currentColor" cx="3" cy="9" r="1.5"/><circle stroke="currentColor" cx="9" cy="9" r="1.5"/><circle stroke="currentColor" cx="15" cy="9" r="1.5"/></svg>'},LKtc:function(e,t,i){e.exports={content:"content-30M86qbG",leftControlsBlock:"leftControlsBlock-30M86qbG",leftControlsButtons:"leftControlsButtons-30M86qbG",leftControlsBlockItem:"leftControlsBlockItem-30M86qbG",pineIcon:"pineIcon-30M86qbG",scriptName:"scriptName-30M86qbG",modifiedIcon:"modifiedIcon-30M86qbG",readonlyIcon:"readonlyIcon-30M86qbG",editIcon:"editIcon-30M86qbG","searchIcon--active":"searchIcon--active-30M86qbG",versionMenu:"versionMenu-30M86qbG",versionMenuTitle:"versionMenuTitle-30M86qbG",rightControlsBlock:"rightControlsBlock-30M86qbG",rightControlsBlock__button:"rightControlsBlock__button-30M86qbG",button:"button-30M86qbG",recentlyUsedTitle:"recentlyUsedTitle-30M86qbG",moreButton:"moreButton-30M86qbG",publishButton:"publishButton-30M86qbG",awaitPublish:"awaitPublish-30M86qbG",hide:"hide-30M86qbG"}},LTRQ:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><g stroke="currentColor" clip-path="url(#aiz0ouy3e)"><path stroke-linecap="square" d="M5.5 15.5v-2M5.5 9.5v-7"/><path d="M7.5 11.5a2 2 0 1 0-4 0 2 2 0 0 0 4 0z"/><path stroke-linecap="square" d="M12.5 2.5v2M12.5 8.5v7"/><path d="M14.5 6.5a2 2 0 1 1-4 0 2 2 0 0 1 4 0z"/></g><defs><clipPath id="aiz0ouy3e"><path fill="#fff" d="M0 0h12v14H0z" transform="translate(3 2)"/></clipPath></defs></svg>'},LiyS:function(e,t,i){"use strict";i.r(t),i.d(t,"FavoriteScriptsModel",(function(){return u}));var s=i("Vdly"),n=i("FBuY"),o=i("cBZt"),r=i("TcSq"),a=i("upcD"),l=i("aIyQ"),c=i.n(l);const d=a;let h=null;class u{constructor(e=s){this._favorites=[],this._favoritesChanged=new c.a,this._settings=e,n.TVXWindowEvents.on("StudyFavoritesChanged",e=>{const t=JSON.parse(e);this._loadFromState(t.favorites||[])}),this._settings.onSync.subscribe(this,this._loadFavs),this._loadFavs()}isFav(e){const t=this.favId(e);return-1!==this._findFavIndex(t)}toggleFavorite(e){this.isFav(e)?this.removeFavorite(e):this.addFavorite(e)}addFavorite(e){const t=this.favId(e);this._favorites.push(_(t)),this._favoritesChanged.fire(),this._saveFavs()}removeFavorite(e){const t=this.favId(e),i=this._findFavIndex(t);-1!==i&&(this._favorites.splice(i,1),this._favoritesChanged.fire()),this._saveFavs()}favId(e){return Object(r.isPineIdString)(e)?e:Object(r.extractPineId)(e)||Object(o.extractStudyId)(e)}favorites(){return this._favorites}favoritePineIds(){return this._favorites.filter(e=>"pine"===e.type).map(e=>e.pineId)}favoritesChanged(){return this._favoritesChanged}static getInstance(){return null===h&&(h=new u),h}static create(e){return new u(e)}_loadFavs(){const e=this._settings.getJSON("studyMarket.favorites",[]);this._loadFromState(e)}_saveFavs(){const e=this._stateToSave();this._settings.setJSON("studyMarket.favorites",e),n.TVXWindowEvents.emit("StudyFavoritesChanged",JSON.stringify({favorites:e}))}_stateToSave(){return this._favorites.map(p)}_loadFromState(e){this._favorites=e.map(e=>_(function(e){return e in d?d[e]:e}(e))),this._favoritesChanged.fire()}_findFavIndex(e){return this._favorites.findIndex(t=>e===p(t))}}function p(e){return"java"===e.type?e.studyId:e.pineId}function _(e){return Object(r.isPineIdString)(e)?{type:"pine",pineId:e}:{type:"java",studyId:e}}},Mhtk:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 10" width="17" height="10" fill="none"><path stroke="currentColor" stroke-width="1.2" d="M1 9l7.5-7.5L16 9"/></svg>'},Nzx2:function(e,t,i){},Opoj:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 17" width="17" height="17"><path fill="none" stroke="currentColor" d="M1 1l15 15M1 16L16 1"/></svg>'},"P4l+":function(e,t,i){},PzOn:function(e,t,i){"use strict";i.r(t),i.d(t,"buttonLoader",(function(){return o})),i.d(t,"ButtonLoader",(function(){return r}));i("IwoD");var s=i("IWoC"),n=i("9uLv");function o(e){return new r($(e))}
$.fn.tvButtonLoader=Object(s.createTvBlockWithInstance)("tv-button-loader",(function(e){return new r(e)}));class r{constructor(e){this.$btn=$(e).addClass("tv-button--loader"),0===this.$btn.find(".tv-button__loader").length&&this.$btn.html('<span class="tv-button__text">'+this.$btn.html()+'</span><span class="tv-button__loader"><span class="tv-button__loader-item"></span><span class="tv-button__loader-item"></span><span class="tv-button__loader-item"></span></span>'),this.loading=this.$btn.hasClass("i-loading")}_start(){this.starting=!0,this.$btn.addClass("i-start-load"),this.$btn.trigger("tv-button-loader:start"),setTimeout(()=>{this.loading=!0,this.starting=!1,this._startPromise=!1,this.$btn.addClass("i-loading"),this.$btn.removeClass("i-start-load"),this._stopPromise&&this._stop()},2*n.dur)}start(){this.starting||(this.stopping?this._startPromise=!0:this._start())}_stop(){this.stopping=!0,this.$btn.addClass("i-stop-load"),this.$btn.trigger("tv-button-loader:stop"),setTimeout(()=>{this.loading=!1,this.stopping=!1,this._stopPromise=!1,this.$btn.removeClass("i-loading i-start-load i-stop-load"),this._startPromise&&this._start()},n.dur)}stop(){this.stopping||(this.starting?this._stopPromise=!0:this._stop())}toggle(){this.loading?this.stop():this.start()}contentHtml(e){return e?(this.$btn.find(".tv-button__text").html(e),e):this.$btn.find(".tv-button__text").html()}contentNojQuery(){return this.$btn.get(0)}disable(){this.stop(),this.$btn.addClass("i-disabled")}enable(){this.$btn.removeClass("i-disabled")}}},Q8bc:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"c",(function(){return o})),i.d(t,"b",(function(){return r}));var s=i("MwoA");function n(){return e=Object(s.d)("stock"),Object.entries(e).map(([e,t])=>{const i=t.group;return{flag:t.flag,name:t.title,desc:t.stocks.join(", "),country:t.country,group:i,value:e}});var e}function o(e){const t=new Map;return e.forEach(e=>{t.has(e.group)?t.get(e.group).push(e):t.set(e.group,[e])}),t}function r(e,t){return e.filter(e=>t.includes(e.value))}},RG4O:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var s=i("q1tI");function n(){const e=Object(s.useRef)(!1),t=Object(s.useCallback)(()=>{e.current=!0},[e]),i=Object(s.useCallback)(()=>{e.current=!1},[e]);return{isMouseDown:e,handleMouseDown:t,handleMouseUp:i}}},RSDG:function(e,t,i){"use strict";i.r(t);i("QBwY"),i("CgXj"),i("7lx1"),i("uEQF"),i("nzny"),i("u6PU"),i("HTgL"),i("SL6B"),i("BSSX"),i("Ravv"),i("IcMv"),i("gh0h"),i("+P1K"),i("sjor");var s=i("9uLv"),n=i("hbEN"),o=i("BI5g");class r{constructor(e){this._coll=e}getItemByIdx(e){return this._coll.item(e)}getItems(){return Array.from(this._coll)}getFirstItem(){return this.getItemByIdx(0)}getLastItem(){const e=this._coll.length;return this.getItemByIdx(e-1)}getItemIdx(e){return Array.prototype.findIndex.call(this._coll,t=>t===e)}getLength(){return this._coll.length}contains(e){return-1!==this.getItemIdx(e)}}var a,l=i("lxNp");!function(e){e[e.Prev=-1]="Prev",e[e.Next=1]="Next"}(a||(a={}));class c{constructor(e){this._list=e.list,
this._items=new r(this._list.getElementsByClassName(e.listItemClass)),this._focused=new r(this._list.getElementsByClassName(e.focusedListItemClass)),this._selected=new r(this._list.getElementsByClassName(e.selectedListItemClass)),this._cursor=new r(this._list.getElementsByClassName("cursor")),this._selectedListItemClass=e.selectedListItemClass,this._focusedListItemClass=e.focusedListItemClass,this._onSelect=e.onSelect,this._onNavigate=e.onNavigate,this._onConfirm=e.onConfirm,this._onDelete=e.onDelete,this._mouseActions=new Map,this.hotkeys=Object(l.createGroup)({desc:"Selectable list"}),e.modes&&e.modes.forEach(t=>new t({selection:this,localHotkeyElement:this._list,globalHotkeyElement:e.globalHotkeys?null:this._list}))}selectItem(e){e.classList.add(this._selectedListItemClass)}unselectItem(e){e.classList.remove(this._selectedListItemClass)}focusItem(e){this.removeFocus(),e.classList.add(this._focusedListItemClass),this.setCursor(e)}getFocusedItemIdx(){const e=this._focused.getFirstItem();return e?this._items.getItemIdx(e):-1}getFocusedItem(){return this._focused.getFirstItem()}isSelected(e){return this._selected.contains(e)}isFocused(e){return this._focused.contains(e)}isListItem(e){return this._items.contains(e)}removeSelections(){this._selected.getItems().forEach(e=>e.classList.remove(this._selectedListItemClass))}removeFocus(){this._focused.getItems().forEach(e=>e.classList.remove(this._focusedListItemClass))}move(e,t,i){const s=e?this._items.getItemIdx(e):-1;let n;n="number"==typeof t?this._items.getItemByIdx(this._calcNextItemIdx(s,t)):t,n&&(i(n,e),this._scrollIfNotVisible(n))}getSelectedItems(){return this._selected.getItems()}getList(){return this._list}getItemsCollection(){return this._items}getSelectedCollection(){return this._selected}setCursor(e){this.removeCursor(),e.classList.add("cursor")}removeCursor(){this._cursor.getItems().forEach(e=>e.classList.remove("cursor"))}getCursorItem(){return this._cursor.getFirstItem()}getCursorItemIdx(){const e=this.getCursorItem();return e?this._items.getItemIdx(e):-1}onSelect(e,t){this._onSelect&&this._onSelect({cursor:t,items:this.getSelectedItems(),action:e})}onNavigate(e,t){this._onNavigate&&this._onNavigate({cursor:e,cursorIdx:this.getCursorItemIdx(),items:[e],action:t})}onConfirm(e,t){this._onConfirm&&this._onConfirm({cursor:e,items:[e],action:t})}onDelete(e,t,i){this._onDelete&&this._onDelete({cursor:i,items:e,action:t})}registerMouseAction(e,t){this._mouseActions.set(e,t)}dispatchMouseEvent(e,t){const i=this._mouseActions.get(e);i&&i(t)}delegateClick(e){return t=>{if(!t.defaultPrevented){const i=this._list.contains(t.target);let s=t.target;for(;i&&s!==this._list;){if(s&&this.isListItem(s))return void e(s);s=s&&s.parentElement}}}}clear(){this.removeSelections(),this.removeFocus(),this.removeCursor()}destroy(){this.hotkeys.destroy(),delete this._list,delete this._items,delete this._selected,delete this._focused,delete this._cursor,delete this._mouseActions}_scrollIfNotVisible(e){
const t=this._list.getBoundingClientRect(),i=e.getBoundingClientRect(),s=t.top,n=t.bottom,o=i.top,r=i.bottom;o<s?this._list.scrollTop-=s-o:r>n&&(this._list.scrollTop+=r-n)}_calcNextItemIdx(e,t){const i=this._items.getLength()-1;let s=e+t;return s<0&&(s=i),s>i&&(s=0),s}}class d{constructor(e){this._focusNext=()=>{if(!this._isValidNavigation())return;const e=this._selection.getCursorItem();this._selection.move(e,a.Next,this._focusItem.bind(this,"down"))},this._focusPrev=()=>{if(!this._isValidNavigation())return;const e=this._selection.getCursorItem();this._selection.move(e,a.Prev,this._focusItem.bind(this,"up"))},this._focusFirst=()=>{if(!this._isValidNavigation())return;const e=this._selection.getItemsCollection().getFirstItem(),t=this._selection.getFocusedItem();this._selection.move(t,e,this._focusItem.bind(this,"home"))},this._focusLast=()=>{if(!this._isValidNavigation())return;const e=this._selection.getItemsCollection().getLastItem(),t=this._selection.getFocusedItem();this._selection.move(t,e,this._focusItem.bind(this,"end"))},this._selection=e.selection,this._selection.registerMouseAction("click",this._selection.delegateClick(this._focusItem.bind(this,"click"))),this._selection.hotkeys.add({desc:"Focus Previous",hotkey:38,handler:this._focusPrev,element:e.globalHotkeyElement}),this._selection.hotkeys.add({desc:"Focus Next",hotkey:40,handler:this._focusNext,element:e.globalHotkeyElement}),this._selection.hotkeys.add({desc:"Focus Previous",hotkey:l.Modifiers.Shift+32,handler:this._focusPrev,element:e.globalHotkeyElement}),this._selection.hotkeys.add({desc:"Focus Next",hotkey:32,handler:this._focusNext,element:e.globalHotkeyElement}),this._selection.hotkeys.add({desc:"Focus First",hotkey:36,handler:this._focusFirst,element:e.globalHotkeyElement}),this._selection.hotkeys.add({desc:"Focus Last",hotkey:35,handler:this._focusLast,element:e.globalHotkeyElement})}_focusItem(e,t){this._selection.removeSelections(),this._selection.focusItem(t),this._selection.setCursor(t),this._selection.onNavigate(t,e)}_isValidNavigation(){return document.activeElement===document.body||this._selection.getList().contains(document.activeElement)}}class h{constructor(e){this._selection=e.selection,this._selection.hotkeys.add({hotkey:l.Modifiers.Alt+13,handler:this._onItemKeyDown.bind(this,"alt+return"),element:e.localHotkeyElement}),this._selection.hotkeys.add({hotkey:l.Modifiers.Alt+l.Modifiers.Shift+13,handler:this._onItemKeyDown.bind(this,"alt+return"),element:e.localHotkeyElement})}_onItemKeyDown(e,t){const i=this._selection.getCursorItem();i&&this._selection.onConfirm(i,e)}}class u{constructor(e){this._selection=e.selection,this._selection.registerMouseAction("shift+click",this._selection.delegateClick(this._onItemClick.bind(this,"shift+click"))),this._selection.hotkeys.add({desc:"Extend Selection Down",hotkey:l.Modifiers.Shift+40,handler:this._nextRangeItem.bind(this,"shift+down"),element:e.localHotkeyElement}),this._selection.hotkeys.add({desc:"Extend Selection Up",hotkey:l.Modifiers.Shift+38,
handler:this._prevRangeItem.bind(this,"shift+up"),element:e.localHotkeyElement})}_nextRangeItem(e){const t=this._selection.getItemsCollection(),i=this._selection.getCursorItem();this._selection.getCursorItemIdx()!==t.getLength()-1&&this._selection.move(i,a.Next,this._addItemToRange(e,(e,t)=>e<t))}_prevRangeItem(e){const t=this._selection.getCursorItem();0!==this._selection.getCursorItemIdx()&&this._selection.move(t,a.Prev,this._addItemToRange(e,(e,t)=>e>t))}_onItemClick(e,t){const i=this._selection.getItemsCollection().getItems(),s=this._getRangeInfo(t);this._selection.removeSelections();for(let n=s.start;n<=s.end;n++)this._selection.isSelected(i[n])||this._selection.selectItem(i[n]);this._selection.setCursor(t),this._selection.onSelect(e,t)}_getRangeInfo(e){const t=this._selection.getItemsCollection().getItemIdx(e),i=this._selection.getFocusedItemIdx(),s=-1!==i?i:0;return t>s?{start:s,end:t}:{start:t,end:s}}_addItemToRange(e,t){return(i,s)=>{const n=this._selection.getItemsCollection().getItemIdx(i),o=this._selection.getFocusedItemIdx();0===this._selection.getSelectedCollection().getLength()&&s&&this._selection.selectItem(s),t(o,n)?this._selection.selectItem(i):s&&this._selection.unselectItem(s),this._selection.setCursor(i),this._selection.onSelect(e,i)}}}class p{constructor(e){this._selection=e.selection,this._selection.registerMouseAction("ctrl+click",this._selection.delegateClick(this._onItemClick.bind(this,"ctrl+click"))),this._selection.registerMouseAction("meta+click",this._selection.delegateClick(this._onItemClick.bind(this,"meta+click"))),this._selection.hotkeys.add({hotkey:l.Modifiers.Mod+65,handler:this._selectAll.bind(this,"ctrl+a"),element:e.localHotkeyElement}),this._selection.hotkeys.add({hotkey:27,handler:this._unselectAll.bind(this,"esc"),element:e.localHotkeyElement})}_onItemClick(e,t){const i=this._selection.getFocusedItem(),s=this._selection.getSelectedCollection().getLength();i&&0===s&&this._selection.selectItem(i),this._toggleSelection(t),this._selection.onSelect(e,t)}_toggleSelection(e){this._selection.isSelected(e)?this._selection.unselectItem(e):this._selection.selectItem(e),this._selection.setCursor(e)}_selectAll(e){this._selection.getItemsCollection().getItems().forEach(e=>this._selection.selectItem(e)),this._selection.onSelect(e)}_unselectAll(e){this._selection.removeSelections();const t=this._selection.getFocusedItem();t&&this._selection.setCursor(t),this._selection.onSelect(e)}}class _{constructor(e){this._selection=e.selection,this._selection.hotkeys.add({desc:"Delete",hotkey:46,handler:this._delete.bind(this,"del"),element:e.globalHotkeyElement})}_delete(e){const t=this._selection.getSelectedItems(),i=this._selection.getCursorItem();i&&t.length>0?this._selection.onDelete(t,e,i):i&&this._selection.onDelete([i],e,i)}}var f=i("qFKp");class g{constructor(e){this._dispatchClick=e=>{
e.ctrlKey&&!Object(f.isMac)()?this._selection.dispatchMouseEvent("ctrl+click",e):e.shiftKey?this._selection.dispatchMouseEvent("shift+click",e):e.metaKey&&Object(f.isMac)()?this._selection.dispatchMouseEvent("meta+click",e):this._selection.dispatchMouseEvent("click",e)},this._onSelect=e=>{this._collectKeys(),this._opts.onSelect&&this._opts.onSelect(e)},this._onNavigate=e=>{this._collectKeys(),this._opts.onNavigate&&this._opts.onNavigate(e)},this._disableSelection=()=>{this._list.onselectstart=()=>!1},this._enableSelection=()=>{this._list.onselectstart=()=>null},this._opts=e,this._list=e.list,this._selection=new c({list:e.list,listItemClass:e.listItemClass,selectedListItemClass:e.selectedListItemClass,focusedListItemClass:e.focusedListItemClass,onSelect:this._onSelect,onNavigate:this._onNavigate,onConfirm:e.onConfirm,onDelete:e.onDelete,modes:e.modes,globalHotkeys:Boolean(e.globalHotkeys)}),this._selectedKeys=[],this._focusedKey=null,this._cursorKey=null,this.activate(),this._collectKeys()}activate(){this._list.addEventListener("click",this._dispatchClick),this._list.addEventListener("keydown",this._disableSelection),this._list.addEventListener("keyup",this._enableSelection),this._selection.hotkeys.promote()}deactivate(){this._list.removeEventListener("click",this._dispatchClick),this._list.removeEventListener("keydown",this._disableSelection),this._list.removeEventListener("keyup",this._enableSelection)}focusItem(e){this._selection.isSelected(e)||this._selection.isFocused(e)||(this._selection.removeSelections(),this._selection.focusItem(e))}removeFocus(){this._selection.removeFocus()}restore(){if(this._opts.getNodeKey){const e=this._selection.getItemsCollection().getItems(),t=this._opts.getNodeKey;e.forEach(e=>{const i=t(e);this._focusedKey===i&&this._selection.focusItem(e),this._cursorKey===i&&this._selection.setCursor(e),this._selectedKeys.includes(i)&&this._selection.selectItem(e)})}}getSelectedKeys(){return this._collectKeys(),this._selectedKeys}getFocusedKey(){return this._collectKeys(),this._focusedKey||null}clear(){this._selection.clear()}destroy(){this.deactivate(),this._selection.destroy(),delete this._selection,delete this._list,delete this._opts}_collectKeys(){if(this._opts.getNodeKey){const e=this._opts.getNodeKey,t=this._selection.getSelectedItems(),i=this._selection.getFocusedItem(),s=this._selection.getCursorItem();this._selectedKeys=t.map(t=>e(t)),this._focusedKey=i?e(i):null,this._cursorKey=s?e(s):null}}}var v=i("489C"),m=i("aIyQ"),b=i.n(m),w=i("hY0g"),S=i.n(w),y=i("rm87"),C=i("Ialn"),k=i("oraB"),x=i("YYdM"),I=i("Rjzw"),T=i("7DLB"),E=i("8V2A");function O(e,t,i){return e.get(Object(E.d)(t,i))}class j{constructor(e){this._setOptions(e),this._fields={},this._fieldsOrder=Array.isArray(e.fieldsOrder)&&e.fieldsOrder||[],this.fieldsOrderChange=new b.a,this._columnsMap=new Map,this.afterFixCols=new b.a,this._additionalColumns=[],this._hiddenColumns=0,this._debouncedFixCols=Object(n.default)(()=>{this._unhideColumns(),this._unhideCells(),this._fixCols()},50),this.dragStarted=new S.a,this._fieldsOrderChange=!1
}_setOptions(e){this._options=e||{},this._model=this._options.model,this._defaultFormatter=this._options.defaultFormatter||((e,t,i,s)=>e),this._nullFormatter=this._options.nullFormatter||(()=>"&mdash;"),this._widthChange=this._options.widthChange,this._visibilityChange=this._options.visibilityChange,this._noDataString=this._options.noDataString,this._disableStickyHeader=e.disableStickyHeader}_createTable(){if(this._table)return;const e=document.createElement("table"),t=["tv-data-table"];this._options.addTableClasses&&t.push(...this._options.addTableClasses),e.classList.add(...t);const i=document.createElement("colgroup"),s=document.createElement("thead"),n=["tv-data-table__thead"];this._options.addTheadClasses&&n.push(...this._options.addTheadClasses),s.classList.add(...n);const o=document.createElement("tr"),r=["tv-data-table__thead-row"];this._options.addTheadRowClasses&&r.push(...this._options.addTheadRowClasses),o.classList.add(...r);const a=document.createElement("tbody");a.classList.add("tv-data-table__tbody"),e.appendChild(i),e.appendChild(s),s.appendChild(o),e.appendChild(a),this._table=e,this._colgroup=i,this._theadRow=o,this._tbody=a,window.addEventListener("resize",()=>this._debouncedFixCols()),this._widthChange.subscribe(this,()=>this._debouncedFixCols()),this._visibilityChange&&this._visibilityChange.subscribe(e=>{e&&this._debouncedFixCols()})}_createStickyWrapper(){if(this._stickyWrapper)return;const e=["tv-data-table-sticky-wrapper"];this._options.addStickyHeaderWrapperClasses&&e.push(...this._options.addStickyHeaderWrapperClasses);const t=document.createElement("div");t.classList.add(...e);const i=this._table.cloneNode(!0);t.append(i),this._stickyWrapper=t}_createHeader(){const e=document.createDocumentFragment(),t=document.createDocumentFragment();this._disableStickyHeader||this._createStickyWrapper();for(let n=0;n<this._columnsOrder.length;++n){const s=this._columnsOrder[n];if(!this._fields[s])continue;const o=document.createElement("th");o.setAttribute("data-field",s);const r=["tv-data-table__th","tv-data-table__cell","js-tv-data-table-th","js-tv-data-table-th-"+this._esc(s)];if(this._options.addThClasses){const e="function"==typeof this._options.addThClasses?this._options.addThClasses(s,this._fields[s]):this._options.addThClasses;r.push(...e)}o.classList.add(...(i=r,i.filter(Boolean)));const a="function"==typeof this._options.titleFormatter?this._options.titleFormatter(s,this._fields[s]):this._fields[s]&&(this._fields[s].content||this._fields[s].title)||s;a instanceof jQuery?o.append(a[0]):o.innerHtml=a,this._setDraggable(o),t.append(o);const l=document.createElement("col");l.classList.add("js-tv-data-table-col","js-tv-data-table-col-"+this._esc(s)),e.append(l)}var i;F(this._colgroup),F(this._theadRow);const s=this._fields[this._model.searchField]?this._fields[this._model.searchField].searchValue:void 0;if(this._disableStickyHeader)this._colgroup.append(e),this._theadRow.append(t),this._setSearchInput(this._theadRow,s);else{
const i=this._stickyWrapper.querySelector("table"),n=i.querySelector("colgroup"),o=i.querySelector("thead tr");F(n),F(o);const r=e.cloneNode(!0);n.append(e),this._colgroup.append(r);const a=t.cloneNode(!0);o.append(t),this._theadRow.append(a),this._theadRowSticky=o,i.classList.add("tv-screener-table--fixed"),$(this._theadRow).find(".js-table-sort").remove(),this._setSearchInput(this._theadRowSticky,s)}}_setDraggable(e){const t=$(e);if(t.is(".js-draggable"))return;const s=$(this._theadRow);let n=!1;t.addClass("js-draggable").on("mousedown touchstart",e=>{if(t.data("field")===this._model.searchField)return;e.preventDefault(),t.css({position:"relative",left:0});const o=t.offset().left;let r=o;const a=e.pageX||e.originalEvent.touches[0].pageX,l=e=>{const c=(e.pageX||e.originalEvent.touches[0].pageX)-a;if(!n){if(Math.abs(c)<10)return;i.e("context-menu").then(i.bind(null,"5VQP")).then(({ContextMenuManager:e})=>{null!==e.getShown()&&(n=!1,t.css("left","auto"),$(window).off("mousemove touchmove",l),this._onDragStop(t))}),this._onDragStart(t),t.one("click",e=>{n&&e.stopPropagation()})}n=!0;const d=s.offset().left,h=s.outerWidth(),u=t.outerWidth(),p=Math.max(d,Math.min(d+h-u,o+c)),_=p+u/2;let f=$(),g=!1;const v=t.prev();if(v.size()&&(Object(C.isRtl)()?_>v.offset().left+v.outerWidth()/2:p<=d||_<v.offset().left+v.outerWidth()/2))f=v;else{const e=t.next();if(e.size()&&!e.is(".i-hidden")){(p+u>=d+h||(Object(C.isRtl)()?_<e.offset().left+e.outerWidth()/2:_>e.offset().left+e.outerWidth()/2))&&(f=e,g=!0)}}const m=f.data("field");if(f.size()&&"name"!==m){const e=t.data("field"),i=$(this._colgroup).find(".js-tv-data-table-col-"+this._esc(e)),s=$(this._colgroup).find(".js-tv-data-table-col-"+this._esc(m));let n=$(),o=$();this._stickyWrapper&&(n=$(this._stickyWrapper).find(".js-tv-data-table-col-"+this._esc(e)),o=$(this._stickyWrapper).find(".js-tv-data-table-col-"+this._esc(m))),g?(i.insertAfter(s),n.size()&&o.size()&&n.insertAfter(o)):(i.insertBefore(s),n.size()&&o.size()&&n.insertBefore(o));let a=$(),l=$();this._stickyWrapper&&(a=$(this._stickyWrapper).find(".js-tv-data-table-th-"+this._esc(e)),l=$(this._stickyWrapper).find(".js-tv-data-table-th-"+this._esc(m))),g?(t.insertAfter(f),r=t.offset().left-f[0].offsetWidth,a.size()&&l.size()&&a.insertAfter(l)):(t.insertBefore(f),r=t.offset().left+f[0].offsetWidth,a.size()&&l.size()&&a.insertBefore(l)),this._swapCols(e,m)}t.css("left",p-r)};$(window).on("mousemove touchmove",l).one("mouseup touchend",e=>{setTimeout(()=>{n=!1},0),t.css("left","auto"),$(window).off("mousemove touchmove",l),n&&this._onDragStop(t)})})}_setSearchInput(e,t){const i=e.querySelector(".js-search-query");if(!i)return;const s=i.querySelector(".js-search-input"),o=i.querySelector(".js-input-reset");Object(T.c)(this._model._bridge)&&s.focus();const r=Boolean(t);o.classList.toggle("i-hidden",!r),r&&(s.value=t),s.addEventListener("input",()=>{o.classList.toggle("i-hidden",0===s.value.length)});const a=Object(n.default)(()=>{this._fields[this._model.searchField].searchValue=s.value,this._model.loading||this._model.update()
},400);s.addEventListener("input",()=>a())}_onDragStart(e){this._model.preventPrevScanRequest(),this.dragStarted.setValue(!0);const t=e.data("field"),i=this._getColByField(t);i&&(this._options.addDraggingThClasses&&e[0].classList.add(...this._options.addDraggingThClasses),this._options.addDraggingColClasses&&i.classList.add(...this._options.addDraggingColClasses))}_swapCols(e,t){const i=this._columnsOrder.indexOf(e),s=this._columnsOrder.indexOf(t);this._columnsOrder[i]=this._columnsOrder.splice(s,1,this._columnsOrder[i])[0],this._fieldsOrderChanged=!0;const n=Math.min(i,s),o=Math.max(i,s),r=this._tbody.children;for(let c=0;c<r.length;c++){const e=r[c].children,t=e[n];e[o].after(t)}const a=this._fieldsOrder.indexOf(e),l=this._fieldsOrder.indexOf(t);this._fieldsOrder[a]=this._fieldsOrder.splice(l,1,this._fieldsOrder[a])[0]}_onDragStop(e){this.dragStarted.setValue(!1);const t=e.data("field"),i=this._getColByField(t);i&&(this._options.addDraggingThClasses&&e[0].classList.remove(...this._options.addDraggingThClasses),this._options.addDraggingColClasses&&i.classList.remove(...this._options.addDraggingColClasses),this._fieldsOrderChanged&&(this.fieldsOrderChange.fire(),this._fieldsOrderChanged=!1,this._model.trackEvent(`Drag and drop ${"big"===this._options.table_style?"quotes":"non-quotes"} column`)))}_getColByField(e){return this._colgroup.querySelector(".js-tv-data-table-col-"+this._esc(e))}_fixCols(){const e=Array.from(this._theadRow.children);if(0===e.length)return;this._table.classList.remove("tv-screener-table--fixed");const t=this._table.querySelectorAll("col");let i=e.map(e=>Math.floor(e.getBoundingClientRect().width));const s="big"===this._options.table_style,n=window.innerWidth>o.breakpoints.tablet,r=this._table.parentNode.offsetWidth;let a=B(i);if(s&&n&&a>r){do{a>r&&(i.pop(),this._hideColumn()),a=B(i)}while(a>r);const e=Math.floor((r-a)/i.length);i=i.map(t=>t+e);const t=i.length-1,s=i[t],n=r-B(i);i[t]=s+n}if(t.forEach((e,t)=>{const s=i[t];s?e.style.width=s+"px":e.classList.add("i-hidden")}),this._stickyWrapper){const e=this._stickyWrapper,t=e.querySelector("colgroup"),i=e.querySelector("table"),s=this._colgroup.cloneNode(!0);t.replaceWith(s),i.classList.add("tv-screener-table--fixed"),this._stickyWrapper.style.width=a+"px"}this._table.classList.add("tv-screener-table--fixed"),this.afterFixCols.fire()}_hideColumn(){const e=this._theadRow.children;for(let t=e.length-1;t>=0;t--){const i=e[t];if(!i.classList.contains("i-hidden")){i.classList.add("i-hidden");break}}this._hiddenColumns++}_unhideColumns(){const e=this._table.querySelectorAll("col"),t=this._theadRow.querySelectorAll("th");e.forEach((e,i)=>{e.style.width="",e.classList.remove("i-hidden"),t[i].classList.remove("i-hidden")}),this._hiddenColumns=0}_unhideCells(){if(!this._tbody)return;this._tbody.querySelectorAll("td.i-hidden").forEach(e=>{e.classList.remove("i-hidden")})}toggleSignals(e){const t=this._fields[e];t.displaySignal=!t.displaySignal;const i=this._columnsOrder.indexOf(e);if(-1===i)return
;const s=this._tbody.querySelectorAll(`.tv-data-table__row .tv-data-table__cell:nth-child(${i+1}) .tv-screener-table__signal`);0!==s.length&&s.forEach(e=>e.classList.toggle("i-hidden",!t.displaySignal))}get $element(){return this._createTable(),$(this._table)}get $tbody(){return this._createTable(),$(this._tbody)}get $stickyHeader(){return this._createTable(),this._createStickyWrapper(),$(this._stickyWrapper)}get $theadRow(){return this._disableStickyHeader?$(this._theadRow):$(this._theadRowSticky)}get additionalColumns(){return this._additionalColumns}get fieldsOrder(){return this._fieldsOrder}get columnsOrder(){return this._columnsOrder}setColumnsMap(e){this._columnsMap=e}setFields(e){this._fieldsOrder=[],this._columnsOrder=[];for(const[t,i]of Object.entries(e))this._fieldsOrder.push(t),i.skipField||this._columnsOrder.push(t);this._fields={},this._additionalColumns=[],this._fieldsOrder.forEach(t=>{this._fields[t]=e[t],e[t]&&e[t].additionalColumns&&e[t].additionalColumns.forEach(e=>{this._additionalColumns.includes(e)||this._additionalColumns.push(e)})}),this.fieldsOrderChange.fire(),this._fieldsOrderChange=!0}update(e){this._fieldsOrderChange&&(this._unhideColumns(),this._createTable(),this._createHeader()),this.clearData(),this.append(e),this._fieldsOrderChange&&(this._fixCols(),this._fieldsOrderChange=!1)}append(e){if(!Array.isArray(e))return;this._$emptyMessage&&this._$emptyMessage.remove(),!e.length&&this._noDataString&&(this._$emptyMessage=$(`<div class="tv-screener-table__empty-message">${this._noDataString}</div>`).insertAfter($(this._table)));const t=document.createDocumentFragment();for(let i=0;i<e.length;i++){const s=e[i];if(!Array.isArray(s.d))continue;const n=["tv-data-table__row"];if(this._options.addRowClasses){const e="function"==typeof this._options.addRowClasses?this._options.addRowClasses(s):this._options.addRowClasses;n.push(...e)}const o=[];if(this._options.addRowAttrs){const e="function"==typeof this._options.addRowAttrs?this._options.addRowAttrs(s):this._options.addRowAttrs;for(const[t,i]of Object.entries(e))o.push([t,i])}const r=document.createDocumentFragment();let a=this._hiddenColumns;for(let e=this._fieldsOrder.length-1;e>=0;--e){const t=this._fieldsOrder[e],i=this._fields[t];if(!i||i.skipField)continue;const n=O(this._columnsMap,t,this._model.selectedIntervalId),o=i.additionalColumns?i.additionalColumns.map(e=>P(s.d,O(this._columnsMap,e,this._model.selectedIntervalId))):[];let l="";const c=["tv-data-table__cell"];let d;if(i.tooltip&&("function"==typeof i.tooltip?l=i.tooltip(...o,i):"string"==typeof i.tooltip&&(l=i.tooltip),c.push("apply-common-tooltip")),"price"===i.type&&o.length>=4){const e=o.slice(-4);e[2]="true"===e[2],d=Object(y.j)(...e)}else d=Object(y.h)(i,this._model.screener_type,!1);"name"===t&&o.push(s.s);const h=P(s.d,n);let u=null===h?this._nullFormatter():d&&d.format(h)||this._defaultFormatter(h,t,i,s,this._fieldsOrder,l);if(this._options.addCellClasses){
const e="function"==typeof this._options.addCellClasses?this._options.addCellClasses(h,t,i,s):this._options.addCellClasses;c.push(...e)}const p=i.additionalFormatter?i.additionalFormatter(...o):"";i.mutateDisplayValue&&(u=i.mutateDisplayValue(u,...o,i)),this._model.hasMarkedSymbols()&&c.push("tv-screener-table__cell--with-marker"),a>0&&(c.push("i-hidden"),a--);let _=u+p;(t===k.a.Name||t===k.a.Sector&&this._model.screener_type===x.a.CryptoMkt)&&(_=Object(I.b)({symbolHtml:_,fieldsOrder:this._fieldsOrder,rowData:s.d,proSymbol:s.s}));const f=document.createElement("td");f.classList.add(...c),f.title=l&&"name"!==t?l:"",f.setAttribute("data-field-key",t),f.innerHTML=_,r.prepend(f)}const l=document.createElement("tr");l.classList.add(...n),o.forEach(e=>l.setAttribute(...e)),l.append(r),this._options.onRowBuild&&this._options.onRowBuild(l,s),t.appendChild(l)}this._tbody.appendChild(t),this._options.onUpdate&&this._options.onUpdate()}clearData(e){if(this._tbody)if(e){const t=this._tbody.children,i=t.length;for(let s=e;s<i;s++){const i=t[e];this._tbody.removeChild(i)}}else this._tbody.innerHTML=""}setThContent(e,t){const i=this.getTh(e);i.size()&&(i.empty(),t instanceof jQuery?i.append(t):i.html(t),"name"===e&&this._setSearchInput(this.$theadRow[0],this._fields[e].searchValue))}setColumnTitle(e,t){const i=this.getTh(e);i.size()&&i.find(".js-head-title").text(t)}setSearchText(e){const t=this.getTh(this._model.searchField);t.size()&&t.find(".js-field-total").text(e)}getTh(e){const t=this.$theadRow;return t&&t.find(".js-tv-data-table-th-"+this._esc(e))||$()}_esc(e){return e.replace(/\./g,"_")}}function F(e){const t=e.children;0!==t.length&&Array.from(t).forEach(t=>e.removeChild(t))}function B(e){return e.reduce((e,t)=>e+t)}function P(e,t){return e[t]}i("Lqq7"),i("xZmJ"),i("UJOg");var R,M=i("brCa"),D=(i("dSdn"),i("oOPW")),A=i("fZEr");!function(e){e[e.None=0]="None",e[e.Widget=1]="Widget",e[e.Site=2]="Site"}(R||(R={}));var N=i("2uTr"),L=i("bKsZ"),W=i("j72q");class V{constructor(e){this.event="change_timeframe",this.source="timeframe_selector",this.location="toolbar",this.state="",this.value=e}}class H{constructor(e,t){this.event="change_columnset",this.source="columset_selector",this.location="toolbar",this.state="",this.value=Object(W.a)(t),this.source=e}}class z{constructor(e,t){this.event="change_favorite_columnsets",this.source="columnset_star_button",this.location="toolbar",this.value=Object(W.a)(t),this.state=e}}class q{constructor(){this.event="rename_custom_columnset",this.source="columnset_pen_button",this.location="toolbar",this.state="",this.value=""}}class U{constructor(e){this.event="change_filterset",this.source="filterset_selector",this.location="toolbar",this.state="",this.value=Object(W.b)(e)}}class K{constructor(){this.event="rename_custom_filterset",this.source="filterset_pen_button",this.location="toolbar",this.state="",this.value=""}}class G{constructor(e,t,i){this.event="change_columns",this.source="column_selector",this.location="header_fields_popup"===e?"header":"toolbar",this.state=t?"added":"removed",
this.value=i}}class X{constructor(){this.event="refresh_screener_data",this.source="refresh_button",this.location="toolbar",this.state="",this.value=""}}class Y{constructor(e){this.event="change_refresh_interval",this.source="refresh_interval_selector",this.location="toolbar",this.state="",this.value=Object(W.c)(e)}}const J=i("txPx").getLogger("Screener.Popups");class Q{constructor(e,t,i){this._model=e,this._view=t,this._bridge=i,this._markets=null,this._model.fieldSetSaved.subscribe(null,()=>this._view.$fieldSetsButton.removeClass("tv-screener-toolbar__button--unsaved")),this._model.filterSetSaved.subscribe(null,()=>this._view.$filterSetsButton.removeClass("tv-screener-toolbar__button--unsaved")),this._fieldsPopupCache={}}showPromptDialog(e,t){return new Promise(i=>{Object(A.showRename)({title:e.title,text:e.label,initValue:t,mainButtonText:$.t("Save"),maxLength:128,onRename:({newValue:e,dialogClose:t})=>{i(e),t()},onClose:i})})}showMaintenanceDialog(){Object(M.showNoticeDialog)({type:"modal",title:$.t("Screener maintenance"),content:$.t("We are doing some brief daily maintenance. Screener will be back really soon, thanks for your patience!")})}showConfirmDialog(e){return new Promise(t=>{Object(A.showConfirm)({text:e,onConfirm:({dialogClose:e})=>{t(!0),e()},onClose:()=>t(!1)})})}showNotice(e,t){Object(M.showNoticeDialog)({content:e,title:t})}setFieldsPopup(e,t,i){e.addClass("tv-dropdown-behavior__button");const s=$(`<div class="${t||""}">`);s.insertAfter(e).append(e);const n=$('<div class="tv-dropdown__body tv-dropdown__body--over-trigger tv-dropdown-behavior__body tv-screener-fields-popup i-hidden">').appendTo(s);i&&n.addClass(i);const o=$('<div class="tv-screener-fields-popup__search-wrap">').appendTo(n),r=$(`<input type="text" placeholder="${$.t("Search column")}" class="tv-screener-fields-popup__search-input">`).appendTo(o),a=$('<div class="tv-dropdown-behavior__scroll">').appendTo(n),l=$('<div class="tv-screener-fields-popup__items-wrap tv-dropdown-behavior__inscroll">').appendTo(a);"header_fields-button"===e.attr("data-name")&&l.attr({"data-name":"header_fields_popup"});const c=$('<div class="tv-screener-fields-popup__item tv-screener-fields-popup__item--no-matches js-hidden">No matches</div>').appendTo(n);r.on("change input",e=>{const t=r.val().trim().toLowerCase();t?l.find(".js-fields-item").each((function(){const e=$(this);e.toggleClass("js-hidden",!~e.text().toLowerCase().indexOf(t))})):l.find(".js-fields-item").removeClass("js-hidden"),c.toggleClass("js-hidden",!!l.find(".js-fields-item:not(.js-hidden)").size()),s.tvDropdown("updateScroll")}),s.on("beforeOpenMenu",()=>{r.val(""),l.find(".js-fields-item").removeClass("js-hidden"),c.addClass("js-hidden"),this.resetFieldsPopup(l),a.css("maxHeight",$(window).height()-e.offset().top+$(window).scrollTop()-e.outerHeight()-o.outerHeight()-20)}).on("afterOpenMenu",()=>{r.focus()}).tvDropdown({scroll:!0,noAnimation:!0}),setTimeout(()=>this.resetFieldsPopup(l),0)}resetFieldsPopup(e){e.empty();const t=e=>{if(e in this._fieldsPopupCache){
const t=this._fieldsPopupCache[e];return t.checkbox.prop("checked",y.f[e].checked),t.item}const t=$('<div class="tv-dropdown-behavior__item">');$(`<label data-field="${e}" class="tv-control-select__option-wrap tv-screener-fields-popup__item js-fields-item">\n\t\t\t\t<input type="checkbox" name="${e}" class="js-field-checkbox"${y.f[e].checked?" checked":""}>\n\t\t\t\t<span class="tv-control-checkbox__label">${$.t(y.f[e].title)}</span>\n\t\t\t</label>`).appendTo(t);const i=t.find(".js-field-checkbox").tvControlCheckbox();return this._fieldsPopupCache[e]={item:t,checkbox:i},t},i=this._view.sortedFields.filter(y.k).sort((e,t)=>y.f[e].title.localeCompare(y.f[t].title,void 0,{ignorePunctuation:!0,numeric:!0})),s=i.filter(e=>y.f[e].checked),n=i.filter(e=>!y.f[e].checked);s.concat(n).forEach(i=>t(i).appendTo(e)),e.find(".js-field-checkbox").off("change"),e.find(".js-field-checkbox").on("change",t=>{const i=$(t.currentTarget),s=i.attr("name");y.f[s].checked=i.prop("checked");const n=e.attr("data-name"),o=y.f[s].checked;Object(W.e)(new G(n,o,s));const r=y.f[s].checked?this._view._table.fieldsOrder.concat(s):this._view._table.fieldsOrder.filter(e=>e!==s);this._model.preventPrevScanRequest(),this._model.fieldSetChanged.fire(r.filter(e=>y.f[e]&&!0!==y.f[e].disabled&&!0!==y.f[e].hiddenColumn)),this._model.update(),this._view.$fieldSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFieldSetChanged())})}setPopup(e,t,i){e.addClass("tv-dropdown-behavior__button");const s=$(`<div class="${t||""}">`);s.insertAfter(e).append(e);const n=$('<div class="tv-dropdown__body tv-dropdown__body--over-trigger tv-dropdown-behavior__body tv-screener-popup i-hidden">').appendTo(s);i&&n.addClass(i);const o=$('<div class="tv-dropdown-behavior__scroll js-container">').appendTo(n);return $('<div class="tv-screener-popup__items-wrap tv-dropdown-behavior__inscroll js-content">').appendTo(o),s.on("beforeOpenMenu",()=>{o.css("maxHeight",$(window).height()-e.offset().top+$(window).scrollTop()-45)}).tvDropdown({scroll:!0,noAnimation:!0})}setFieldSetsPopup(e){const t=this.setPopup(e,"tv-screener-toolbar__button-wrap");t.tvDropdown("disable");const i=t.find(".js-content");i.on("click",".js-set",e=>{const s=$(e.currentTarget);i.find(".js-item-active").removeClass("tv-screener-popup__item--active js-item-active"),s.addClass("tv-screener-popup__item--active js-item-active");const n=s.attr("data-set");this._model.applyFieldSet(n),this._view.adjustToolbarWidth(),t.tvDropdown("close"),Object(W.e)(new H("columnset_selector",n))}).on("click",".js-set-delete",e=>{const i=$(e.currentTarget),s=this._model.getFieldSetById(i.parent().attr("data-set")),n=this._model.currentFieldSetId()===s.id;this.showConfirmDialog($.t("Do you really want to delete Column Set '{name}' ?").format({name:s.title})).then(e=>{e&&this._model.saveFieldSet({id:s.id,delete:1},"Delete field set").then(()=>{this._model.removeFavoriteFieldSet(s.id),n&&this._model.applyFieldSet(this._model.defaultFieldSets[0].id,null,!0),this._view.adjustToolbarWidth()})}),t.tvDropdown("close"),
e.stopPropagation()}).on("click",".js-set-star",e=>{const t=$(e.currentTarget),i=t.parent().attr("data-set");t.parent().toggleClass("tv-screener-popup__item--favorite"),this._model.addFavoriteFieldSet(i),e.stopPropagation(),Object(W.e)(new z("added",i))}).on("click",".js-set-star-active",e=>{const t=$(e.currentTarget),i=t.parent().attr("data-set");t.parent().toggleClass("tv-screener-popup__item--favorite"),this._model.removeFavoriteFieldSet(i),e.stopPropagation(),Object(W.e)(new z("removed",i))}).on("click",".js-set-rename",e=>{const i=$(e.currentTarget).parent().attr("data-set"),s=this._model.getFieldSetById(i);this.showPromptDialog({title:$.t("Rename Column Set"),label:$.t("Enter a new column set name:")},s.title).then(e=>{e&&e!==s.title&&(this._model.saveFieldSet({id:s.id,title:e},"Rename field set"),this._view.$fieldSetsButton.removeClass("tv-screener-toolbar__button--active js-no-pointer-events"),this._model.currentFieldSetId()==s.id&&this._view.$fieldSetsButton.text(e),Object(W.e)(new q))}),t.tvDropdown("close"),e.stopPropagation()}).on("click",".js-save",e=>{this.confirmAndSaveCurrentFieldSet().then(e=>{const t=this._model.getFieldSetById(e.id);this._model.settingsSaver.setValue(this._model.settingKey+".fieldSetId",e.id,{forceFlush:!0}),this._view.$fieldSetsButton.text(t.title);const i=this.$favoritesBar&&this.$favoritesBar.find(`.js-favorite-item[data-set=${e.id}]`)||$();i.size()&&i.removeClass("tv-screener-toolbar__favorites-item--active")}).catch(e=>{e&&J.logError(e)}),t.tvDropdown("close")}),this._model.loadingComplete.subscribe(null,()=>{t.tvDropdown("enable")},!0),t.on("beforeOpenMenu",()=>this.setFieldSetsPopupContent(i))}setFieldSetsPopupContent(e){e.empty(),this._bridge.onWidget||$(`<div class="tv-control-select__option-wrap tv-screener-popup__item tv-screener-popup__item--save js-save">${Object(N.appendEllipsis)($.t("Save Columns As"))}</div>`).prepend($(i("YGaR")).attr({class:"tv-screener-toolbar__button-icon",width:"20",height:"14",style:"top: -2px; margin-right: 10px;"})).appendTo(e);const t=$('<div class="tv-screener-popup__item--presets"></div>').appendTo(e);this._model.settings.fieldSets.forEach(e=>{
const s=$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<div data-set="${e.id}"  class="tv-control-select__option-wrap tv-screener-popup__item tv-screener-popup__item--preset js-set" title="${TradingView.clean(e.title)}">\n\t\t\t\t\t<span class="js-field-set-name"></span>\n\t\t\t\t\t<span class="tv-screener-popup__item-delete js-set-delete" title="${$.t("Delete")}">\n\t\t\t\t\t\t${i("Ze6a")}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tv-screener-popup__item-rename js-set-rename" title="${$.t("Rename")}">\n\t\t\t\t\t\t${i("xW9g")}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tv-screener-popup__item-star-active js-set-star-active" title="${$.t("Remove from favorites")}">\n\t\t\t\t\t\t${i("HHbT")}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tv-screener-popup__item-star js-set-star" title="${$.t("Add to favorites")}">\n\t\t\t\t\t\t${i("GWvR")}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>`).appendTo(t);s.find(".js-field-set-name").text(Z(e.title)),s.find(".js-set").toggleClass("tv-screener-popup__item--favorite",-1!==this._model.favoriteFieldSets.indexOf(e.id))}),this._model.defaultFieldSets.forEach(t=>{$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<div data-set="${t.id}" class="tv-control-select__option-wrap tv-screener-popup__item js-set">\n\t\t\t\t\t${t.title}\n\t\t\t\t\t${this._bridge.onWidget?"":`<span class="tv-screener-popup__item-star-active js-set-star-active" title="${$.t("Remove from favorites")}">\n\t\t\t\t\t\t\t${i("HHbT")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class="tv-screener-popup__item-star js-set-star" title="${$.t("Add to favorites")}">\n\t\t\t\t\t\t\t${i("GWvR")}\n\t\t\t\t\t\t</span>`}\n\t\t\t\t</div>\n\t\t\t</div>`).appendTo(e).find(".js-set").toggleClass("tv-screener-popup__item--favorite",-1!==this._model.favoriteFieldSets.indexOf(t.id))}),e.find(`[data-set="${this._model.currentFieldSetId()}"]`).addClass("tv-screener-popup__item--active js-item-active")}confirmAndSaveCurrentFieldSet(){const e=this._model.getFieldSetById(this._model.currentFieldSetId()),t=this._view._table.fieldsOrder.slice(0);if(!y.f.type.disabled&&y.f.type.checked){const e=t.indexOf("name");-1!==e&&t.splice(e+1,0,"type")}if(!y.f.description.disabled&&y.f.description.checked){const e=t.indexOf("name");-1!==e&&t.splice(e+1,0,"description")}const i=JSON.stringify(t),s=e&&!this._model.defaultFieldSets.find(t=>t.id===e.id);return new Promise((t,n)=>runOrSignIn(()=>this.showPromptDialog({title:$.t("Save Columns As"),label:$.t("Enter a new column set name:")},e&&e.title||"").then(o=>{if(void 0===o)return void n();const r={title:TradingView.clean(o),content:i};let a="Create field set";s&&e.title===o&&(r.id=e.id,a="Update field set"),this._model.saveFieldSet(r,a).then(t,n)})))}setFilterSetsPopup(e,t){const i=this.setPopup(e,"tv-screener-toolbar__button-wrap","tv-dropdown__body--position_right");i.tvDropdown("disable");const s=i.find(".js-content"),n=this._bridge.$body;function o(e){if(Object(C.isRtl)())e.toggleClass("tv-dropdown__body--position_right",!0);else{
const t=i.width(),s=n.find(".tv-screener-toolbar").width(),o=i.position().left,r=s-(t+o);e.toggleClass("tv-dropdown__body--position_right",o>r)}}s.on("click",".js-set",e=>{const t=$(e.currentTarget);s.find(".js-item-active").removeClass("tv-screener-popup__item--active js-item-active"),t.addClass("tv-screener-popup__item--active js-item-active"),this._view.$filterSetsButton.toggleClass("i-disabled",!0),new Promise(e=>{this._bridge.onWidget?e():this._model.isFilterSetChanged()?this.showConfirmDialog($.t("You have unsaved changes in your current screen. Would you like to save them?")).then(t=>{t?this.confirmAndSaveCurrentFilterSet().then(e,t=>{t&&J.logError(t),e()}):e()}):e()}).then(()=>{const e=Z(t.attr("data-set"));this._model.applyFilterSet(e),this._model.trackEvent("Apply filter set "+e),this._view.$filterSetsButton.toggleClass("i-disabled",!1),Object(W.e)(new U(e))}),setTimeout(()=>i.tvDropdown("close"),200)}).on("click",".js-set-delete",e=>{const t=$(e.currentTarget),s=this._model.getFilterSetById(t.parent().attr("data-set")),n=this._model.currentFilterSetId()===s.id;this.showConfirmDialog($.t("Do you really want to delete Screen '{name}' ?").format({name:s.title})).then(e=>{e&&this._model.saveFilterSet({id:s.id,delete:1},"Delete filter set").then(()=>{if(n){const e=this._model.defaultFilterSets.find(e=>!0!==e.disabled)||this._model.defaultFilterSets[0];this._model.applyFilterSet(e.id)}})}),i.tvDropdown("close"),e.stopPropagation()}).on("click",".js-set-rename",e=>{const t=$(e.currentTarget).parent().attr("data-set"),s=this._model.getFilterSetById(t);this.showPromptDialog({title:$.t("Rename Screens"),label:$.t("Enter a new screen name:")},s.title).then(e=>{e&&e!==s.title&&(this._model.saveFilterSet({id:s.id,title:e},"Rename filter set"),this._view.$filterSetsButton.removeClass("tv-screener-toolbar__button--active js-no-pointer-events"),this._model.currentFilterSetId()==s.id&&this._view.$filterSetsButtonTitle.text(e),Object(W.e)(new K))}),i.tvDropdown("close"),e.stopPropagation()}).on("click",".js-save",e=>{this.confirmAndSaveCurrentFilterSet().then(e=>{void 0!==e.id?(this._model.settingsSaver.setValue(this._model.settingKey+".filterSetId",e.id,{forceFlush:!0}),this._view.$filterSetsButtonTitle.text(this._model.getFilterSetById(e.id).title)):J.logError("Unable to get id of created set")}).catch(e=>{e&&J.logError(e)}),i.tvDropdown("close")}).on("click",".js-set-alert",e=>{const t=$(e.currentTarget),s=t.parent().attr("data-set");this._view.toggleAlert.fire(s,"toggle_alert_bell"),t.is(".js-active")||i.tvDropdown("close"),e.stopPropagation()}),this.$filterSetsPopupContent=s,this._bridge.width?(o(s.parent().parent()),this._bridge.width.subscribe(()=>{o(s.parent().parent())})):$(window).on("resize",()=>{o(s.parent().parent())}),this._model.loadingComplete.subscribe(null,()=>{i.tvDropdown("enable")},!0),i.on("beforeOpenMenu",()=>{this.setFilterSetsPopupContent(t),t&&this.updateFilterSetsPopupAlerts(this._model.alerts.getFilterSetIdsWithRunningAlerts())})}updateFilterSetsPopupAlerts(e){
this.$filterSetsPopupContent&&this.$filterSetsPopupContent.find(".js-set").each((function(){const t=$(this),i=t.attr("data-set"),s=e.indexOf(i)>-1;t.find(".js-set-alert").toggleClass("tv-screener-popup__item-alert-toggle--active js-active",s).attr("title",s?$.t("Disable Alert"):$.t("Enable Alert"))}))}setFilterSetsPopupContent(e){const t=this.$filterSetsPopupContent;t.empty(),this._bridge.onWidget||$(`<div class="tv-control-select__option-wrap tv-screener-popup__item tv-screener-popup__item--save tv-screener-popup__item--space-left js-save">${Object(N.appendEllipsis)($.t("Save Screens As"))}</div>`).prepend($(i("YGaR")).attr({class:"tv-screener-toolbar__button-icon",width:"20",height:"14",style:"top: -2px; margin-right: 10px;"})).appendTo(t);const s=$('<div class="tv-screener-popup__item--presets"></div>').appendTo(t);this._model.settings.filterSets.forEach(t=>{const n=$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<div data-set="${t.id}" class="tv-control-select__option-wrap tv-screener-popup__item tv-screener-popup__item--preset tv-screener-popup__item--space-left js-set">\n\t\t\t\t\t<span class="js-filter-set-name"></span>\n\t\t\t\t\t<span class="tv-screener-popup__item-rename js-set-rename" title="${$.t("Rename")}">\n\t\t\t\t\t\t${i("xW9g")}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tv-screener-popup__item-delete tv-screener-popup__item-delete--right js-set-delete" title="${$.t("Delete")}">\n\t\t\t\t\t\t${i("Ze6a")}\n\t\t\t\t\t</span>\n\t\t\t\t\t${e?`<span class="tv-screener-popup__item-alert-toggle apply-common-tooltip js-set-alert">${i("HeqG")}</span>`:""}\n\t\t\t\t</div>\n\t\t\t</div>`);n.find(".js-filter-set-name").text(Z(t.title)),n.appendTo(s)}),this._model.defaultFilterSets.forEach(s=>{s.disabled||$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<div data-set="${s.id}" class="tv-control-select__option-wrap tv-screener-popup__item tv-screener-popup__item--space-left js-set">\n\t\t\t\t\t${s.title}\n\t\t\t\t\t${e?`<span class="tv-screener-popup__item-alert-toggle apply-common-tooltip js-set-alert">${i("HeqG")}</span>`:""}\n\t\t\t\t</div>\n\t\t\t</div>`).appendTo(t)}),t.find(`[data-set="${this._model.currentFilterSetId()}"]`).addClass("tv-screener-popup__item--active js-item-active")}confirmAndSaveCurrentFilterSet(){const e=this._model.getFilterSetById(this._model.currentFilterSetId()),t=JSON.stringify(this._model.currentFilterState()),i=e&&!this._model.defaultFilterSets.find(t=>t.id===e.id);return new Promise((s,n)=>runOrSignIn(()=>this.showPromptDialog({title:$.t("Save Screens As"),label:$.t("Enter a new screen name:")},e.title).then(o=>{if(void 0===o)return void n();const r={title:TradingView.clean(o),content:t};let a="Create filter set";i&&e.title===o&&(r.id=e.id,a="Update filter set"),this._model.saveFilterSet(r,a).then(s,n)})))}setHiddenFavoritesPopup(e,t,i,s){e.addClass("tv-dropdown-behavior__button");const n=$('<div class="tv-screener-toolbar__favorites-more-wrap">');n.insertAfter(e).append(e)
;const o=$('<div class="tv-dropdown__body tv-dropdown__body--over-trigger tv-dropdown-behavior__body tv-dropdown__body--position_right i-hidden">').appendTo(n),r=$('<div class="tv-dropdown-behavior__scroll js-container">').appendTo(o),a=$('<div class="tv-screener-popup__items-wrap tv-dropdown-behavior__inscroll js-content">').appendTo(r);a.on("click",".js-set",e=>{const t=$(e.currentTarget).attr("data-set");s(t),Object(W.e)(new H("columnset_favorites_picker",t)),n.tvDropdown("close")});const l=()=>{a.empty(),t().forEach(e=>{$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t\t<div data-set="${e.id}" class="tv-control-select__option-wrap tv-screener-popup__item js-set">\n\t\t\t\t\t\t${TradingView.clean(e.title)}\n\t\t\t\t\t</div>\n\t\t\t\t</div>`).toggleClass("tv-screener-popup__item--active",i(e.id)).appendTo(a)}),n.tvDropdown("updateScroll")};return n.on("beforeOpenMenu",()=>{l(),r.css("maxHeight",$(window).height()-e.offset().top+$(window).scrollTop()-45)}).on("resetContent",()=>l()).on("forceClose",()=>n.tvDropdown("close")).tvDropdown({scroll:!0,noAnimation:!0})}setSelectPopup(e,t){const{wrapClass:i,buttonClass:s,dropdownClass:n}=e,{buttonTitle:o}=t,r=$(`<div class="${i} tv-dropdown tv-dropdown--inline tv-dropdown-behavior">`),a=$(`<div class="tv-dropdown__button tv-dropdown-behavior__button ${s}" title="${o}">`).appendTo(r),l=$(`<div class="tv-dropdown__body tv-dropdown-behavior__body tv-dropdown__body--over-trigger tv-dropdown__body--position_right i-hidden ${n}">`).appendTo(r),c=$('<div class="tv-dropdown-behavior__scroll js-container">').appendTo(l),d=$('<div class="tv-dropdown-behavior__inscroll js-content">').appendTo(c);return r.on("beforeOpenMenu",()=>{c.css("maxHeight",$(window).height()-a.offset().top+$(window).scrollTop()-45)}).on("forceClose",()=>r.tvDropdown("close")).tvDropdown({scroll:!0,$wrap:a,$body:l,noAnimation:!0}),{$wrap:r,$button:a,$dropdownBody:l,$dropdownContent:d}}setMarketsList(e){this._markets=e}updateRefreshIntervalsPopupContent(){if(!this.$filterRefreshIntervalsPopup||!this.$filterRefreshIntervalsPopup.length)return;this.$filterRefreshIntervalsPopup.empty();const e=this._view.refreshIntervals;for(let t=0;t<e.length;++t){const i=e[t];let s=null;if(-1===i)s=$.t("Manual Refresh");else{const e=i/60|0;s=1===e?$.t("Refresh every minute"):e<1?this._model.isFastRefresh?$.t("Auto Refresh"):$.t("Refresh every second",{plural:"Refresh every {0} seconds",count:i}).format(i):$.t("Refresh every minutes",{plural:"Refresh every {0} minutes",count:e}).format(e)}
$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<label class="tv-control-select__option-wrap tv-screener-popup__item js-interval">\n\t\t\t\t\t<span class="tv-control-radio">\n\t\t\t\t\t\t<input type="radio" name="interval" value="${i}" class="tv-control-radio__input">\n\t\t\t\t\t\t<span class="tv-control-radio__box"></span>\n\t\t\t\t\t\t<span class="tv-control-radio__ripple js-ripple"></span>\n\t\t\t\t\t</span>\n\t\t\t\t\t<span class="tv-control-radio__label tv-screener-popup__refresh-interval-label">${s}</span>\n\t\t\t\t</label>\n\t\t\t</div>`).appendTo(this.$filterRefreshIntervalsPopup)}}setRefreshIntervalsPopup(e){const t=this.setPopup(e,"tv-screener-toolbar__button-wrap","tv-screener-popup__refresh-intervals"),i=t.find(".js-content");this.$filterRefreshIntervalsPopup=i,this.updateRefreshIntervalsPopupContent(),t.on("beforeOpenMenu",()=>{i.find(`input[value=${this._model.refreshInterval}]`).prop("checked",!0)}),i.on("click",".js-interval",e=>{e.preventDefault();const n=+$(e.currentTarget).find("input").val();setTimeout(()=>t.tvDropdown("close"),s.dur/2),n!==this._model.refreshInterval&&(this._model.isFastRefresh?(i.find(`input[value=${n}]`).prop("checked",!0),this._model.refreshInterval=n):Object(v.a)(()=>{i.find(`input[value=${n}]`).prop("checked",!0),this._model.refreshInterval=n},L.ProductFeatures.SCREENER_AUTO_REFRESH,{feature:"screenerAutoRefresh"},{value:-1===n}),Object(W.e)(new Y(n)))})}setSelectIntervalContent(e,t,i=(()=>{})){t.empty();const n=this._model.selectedIntervalId;for(const s of E.b)$(`<div class="tv-dropdown-behavior__item">\n\t\t\t\t<div data-interval="${s.id}" title="${s.title}" class="tv-control-select__option-wrap tv-screener-popup__item js-select-interval ${s.id===n?"tv-screener-popup__select-interval-active":""}">\n\t\t\t\t\t${s.shortTitle}\n\t\t\t\t</div>\n\t\t\t</div>`).appendTo(t);e.on("afterOpenMenu",()=>{t.on("click",".js-select-interval",n=>{n.preventDefault();const o=this._model.selectedIntervalId,r=$(n.currentTarget);let a=Object(E.e)(r.data("interval"));if(!a||o===a.id)return;const l=this._model.eodRestriction.value();Object(v.a)(()=>{l!==R.None&&"1d"!==a.id?(Object(D.createGoProDialog)({feature:"screenerIntervalsEod"}),a=Object(E.e)("1d")):(t.find(".tv-screener-popup__select-interval-active").removeClass("tv-screener-popup__select-interval-active"),t.find(`[data-interval='${a.id}']`).addClass("tv-screener-popup__select-interval-active"),i(a))},L.ProductFeatures.SCREENER_INTERVALS,{feature:"screenerIntervals"},{interval:a.id}),setTimeout(()=>{e.tvDropdown("close"),t.off("click")},s.dur/2),Object(W.e)(new V(a.id))})})}setAlertsPopup(e,t){e.removeClass("tv-screener-toolbar__button--space_right").addClass("tv-dropdown-behavior__button js-prevent-dropdown");const i=$('<div class="tv-screener-toolbar__button-wrap tv-screener-toolbar__button-wrap--space-right">');i.insertAfter(e).append(e);const s=$('<div class="tv-dropdown__body tv-dropdown__body--over-trigger tv-dropdown-behavior__body tv-dropdown__body--position_right i-hidden">').appendTo(i);let n=i.position().left
;const o=i.width(),r=$(".tv-screener-toolbar");let a=r.width(),l=a-(o+n);return this._bridge.width?(s.toggleClass("tv-dropdown__body--position_right",n>l),this._bridge.width.subscribe(()=>{n=i.position().left,a=r.width(),l=a-(o+n);const e=n>l;s.toggleClass("tv-dropdown__body--position_right",e)})):$(window).on("resize",()=>{n=i.position().left,a=r.width(),l=a-(o+n);const e=n>l;s.toggleClass("tv-dropdown__body--position_right",e)}),t.on("click",()=>i.tvDropdown("close")).appendTo(s),e.on("click",()=>runOrSignIn(()=>{this._model.alerts.ready.then(()=>i.tvDropdown("open"))})),i.tvDropdown({noAnimation:!0})}}function Z(e){return TradingView.clean(e,!0)}var ee=i("n/vg"),te=i("LEAS"),ie=i("MwoA"),se=i("9Cho"),ne=i("c2JX"),oe=i("25b6"),re=i("U+7v"),ae=i("X19y"),le=i("FKlR"),ce=i("hcRQ"),de=i("eYFQ"),he=i("AXL+");class ue{constructor(){this._handlers=[]}registerHandlers(e){this._handlers.push(e)}beforeAppendSymbol(e,t){this._handlers.forEach(i=>{i.beforeAppendSymbol&&i.beforeAppendSymbol(e,t)})}beforeAppendContextMenuItems(e){return this._handlers.reduce((t,i)=>i.beforeAppendContextMenuItems?t.concat(i.beforeAppendContextMenuItems(e)):t,[])}afterSymbolConfirm(e,t){this._handlers.forEach(i=>{i.afterSymbolConfirm&&i.afterSymbolConfirm(e,t)})}beforeAppendSymbolsHeader(e){this._handlers.forEach(t=>{t.beforeAppendSymbolsHeader&&t.beforeAppendSymbolsHeader(e)})}}var pe=i("+6II"),_e=i("+9Gp"),fe=(i("EsMY"),i("YFKU")),ge=i("FQhm"),ve=i("69Qn"),me=i("q1tI"),be=i.n(me),we=i("i8i4"),Se=i.n(we),ye=i("TSYQ"),Ce=i.n(ye),$e=i("FzLb"),ke=i("JlNy");function xe(e){const t=Object.keys(e.modes),i=Object.values(e.modes),[s,n]=be.a.useState(t[0]);return be.a.createElement(be.a.Fragment,null,be.a.createElement(Ie,{isActive:s===t[0],title:i[0]}),be.a.createElement("span",{className:ke.switcherContainer},be.a.createElement($e.a,{onChange:function(i){const s=i.currentTarget.checked?t[1]:t[0];n(s),e.onChange(s)}})),be.a.createElement(Ie,{isActive:s===t[1],title:i[1]}))}function Ie(e){return be.a.createElement("span",{className:Ce()(ke.modeTitle,e.isActive&&ke.modeTitleActive)},e.title)}var Te=i("E1aw");function Ee(e,t){Se.a.render(be.a.createElement(Te.a,Object.assign({},t)),e)}var Oe=i("pwhM");const je=["country","sector","industry","description"],Fe=["close","bid","ask","candlestick"],Be=["Recommend.All","Recommend.MA","Recommend.Other"];function Pe(e,t){return e.indexOf(t)}function Re(e){return e.map(e=>Object(he.escapeCSVValue)(e)).join(",")}function Me(e){return e.map((e,t)=>Boolean(e)?t:void 0).filter(Boolean)}function De(e){return Oe.a.find(t=>t.key===e)}var Ae=i("e1ZQ"),Ne=i("07JU");class Le{constructor(e){this.event="change_market",this.source="market_selector",this.location="toolbar",this.state="",this.value=e}}class We{constructor(){this.event="export_screener_data",this.source="export_button",this.location="toolbar",this.state="",this.value=""}}class Ve{constructor(e,t){this.event="change_forex_group",this.source="forex_group_selector",this.location="toolbar",this.state=e,this.value=t}}var He=i("IoBF"),ze=i("C9Mz")
;var qe=i("Q8bc"),Ue=i("CJuL");const Ke=i("PT1i").linking;i("Lqq7");const Ge=i("aIyQ"),Xe=i("txPx").getLogger("Screener.View"),{operators:Ye,fields:Je}=i("Dy5B"),Qe=$.t("All"),Ze=$.t("Any"),et=i("ivrk"),tt=i("Gfy6"),it=[-1,10,60],st=[-1,1],nt={bonds:{yields:window.t("Yields",{context:"Bonds"}),prices:window.t("Prices",{context:"Bonds"})},crypto_mkt:{USD:"USD",BTC:"BTC"}},ot=`<div class="tv-screener-table__search-query js-search-query ${y.f.description.disabled||!y.f.description.checked?"tv-screener-table__search-query--without-description":""}">\n\t\t<input\n\t\t\ttype="text"\n\t\t\tautocomplete="off"\n\t\t\tclass="tv-screener-table__search-input js-search-input"\n\t\t/>\n\t\t<span class="tv-search-bar__search-icon tv-screener-table__search-icon">${i("3Wb9")}</span>\n\t\t<span class="tv-search-bar__input-reset tv-screener-table__input-reset i-hidden js-input-reset">${i("r01Z")}</span>\n\t</div>`;class rt{constructor(e,t){this._bridge=e,this._model=t,this._onWidget=e.onWidget,this._activeElem=null,this._changeSymbol=Object(n.default)(this._changeSymbol,500),this._lifecycle=new ue,this.sortedFields=Object.keys(y.f).filter(e=>Boolean(Object(y.i)(y.f[e]))),this._popups=new Q(t,this,e),this._dialog=new ee.a(t,this,e),this._disableStickyHeader=this._bridge.disableStickyHeader,this._periodPicker=e.period_picker,this._noDataString=e.no_data_string,this._periodPickerButtons=[{id:"yesterday",title:$.t("Yesterday")},{id:"today",title:$.t("Today")},{id:"tomorrow",title:$.t("Tomorrow")},{id:"this_week",title:$.t("This Week")},{id:"next_week",title:$.t("Next Week")}],this.toggleAlert=new Ge;const i="undefined"===this._model.settingKey?this._model.screener_type:this._model.settingKey;this._fields_order=this._model.settingsSaver.getJSON(i+".fields_order",[]),this._data=[],this._lastSetId=null,this.widthChange=new Ge,this._bridge.width&&this._bridge.width.subscribe(()=>{this.widthChange.fire()}),this._$groupSelect=null,this._preventHighlightChanges=!1,this._table=new j({model:t,fieldsOrder:this._fields_order,sortable:!0,titleFormatter:(e,t)=>{const i=this._getThContent(e,t);return"name"===e&&this._lifecycle.beforeAppendSymbolsHeader(i.get(0)),i},defaultFormatter:(e,t,i,s,n,o)=>{const r=this._onWidget&&window.locale_domains?Object(le.a)(window.locale_domains):this._model._bridge.baseUrl||"";if("name"===t){const t={proName:s.s,type:this._model.screener_type};let i;return i=this._onWidget&&this._model.largeChartUrl?Object(de.makeTemplateSymbolUrl)(this._model.largeChartUrl,t):"continuous_futures"===this._model.screener_type?Object(de.makeSymbolChartUrl)(t):Object(de.makeSymbolPageUrl)(t,this._model.utm),this._bridge.standalone||this._bridge.onWidget?`<a class="tv-screener__symbol apply-common-tooltip" title="${Object(oe.htmlEscape)(o)}" href="${Object(oe.htmlEscape)(i)}" ${this._bridge.open_chart_on_same_tab?"":'target="_blank" rel="noopener"'}>${e}</a>`:`<div class="tv-screener__symbol tv-screener__symbol--text apply-common-tooltip" title="${o}">${e}</div>`}
if("description"===t&&("sector"===this._model.screener_type||"industry"===this._model.screener_type)){const t=window.t(e);return`<a class="tv-screener__symbol" target="_blank" rel="noopener" href="${Object(se.b)(e,this._model.market,this._model.screener_type)}">\n\t\t\t\t\t\t${t}\n\t\t\t\t\t</a>`}if(("sector"===t||"industry"===t)&&"big"===this._bridge.table_style&&"crypto_mkt"!==this._model.screener_type){const i=window.t(e);return`<a class="tv-screener__symbol" target="_blank" rel="noopener" href="${Object(se.b)(e,this._model.market,t)}">\n\t\t\t\t\t\t<span class="tv-screener__symbol--secondary">${i}</span>\n\t\t\t\t\t</a>`}if(-1!==["description","industry"].indexOf(t)){const t=window.t(e);return`<span class="tv-screener-table__cell--fix-width" title="${t}">${t}</span>`}if("sector"===t&&"crypto_mkt"===this._model.screener_type){const t=`${r}/markets/cryptocurrencies/prices-${e.replace(/\s/g,"-").replace(/\.|\//g,"").toLowerCase()}/`;return`<a class="tv-screener__symbol" href="${Object(oe.htmlEscape)(Object(ce.a)(t,this._model.utm))}" ${this._bridge.open_chart_on_same_tab?"":'target="_blank" rel="noopener"'}>\n\t\t\t\t\t\t${e}\n\t\t\t\t\t</a>`}return"country"===t?window.t(e):e},addTableClasses:["tv-screener-table"],addTheadClasses:["tv-screener-table__thead",this._disableStickyHeader?"tv-screener-table__thead--sticky":"tv-screener-table__thead--regular"],addTheadRowClasses:["tv-data-table__stroke","tv-screener-table__head"],addThClasses:["tv-data-table__sortable","tv-screener-table__sortable","tv-screener-table__th",this._bridge.table_style?"tv-screener-table__th--"+this._bridge.table_style:"",this._onWidget&&this._bridge.hide_controls?"tv-screener-table__th--no-toolbar":""],addRowClasses:()=>["tv-data-table__stroke","tv-screener-table__result-row"],addCellClasses:(e,t,i,s)=>{const n=["tv-screener-table__cell"];return"right"===i.align||"center"===i.align||i.control&&"select"!==i.control||n.push("tv-screener-table__cell--left"),"center"!==i.align||i.control||n.push("tv-screener-table__cell--center"),i.highlightChange&&e&&n.push(e>=0?"tv-screener-table__cell--up":"tv-screener-table__cell--down"),"name"!==t||!y.f.description.disabled&&y.f.description.checked||n.push(this._onWidget?"tv-screener-table__cell--widget-without-description":"tv-screener-table__cell--without-description"),this._bridge.table_style&&n.push("tv-screener-table__cell--"+this._bridge.table_style),this._onWidget&&this._bridge.hide_controls&&n.push("tv-screener-table__cell--no-toolbar"),this._onWidget&&"crypto_mkt"===this._model.screener_type&&n.push("tv-screener-table__cell--crypto_mkt"),n},addRowAttrs:e=>({"data-symbol":e.s}),addStickyHeaderWrapperClasses:["tv-screener-sticky-header-wrapper"],addDraggingThClasses:["tv-screener-table__th--dragging"],addDraggingColClasses:["tv-screener-table__col--dragging"],widthChange:this.widthChange,visibilityChange:this._bridge.visible,table_style:this._bridge.table_style,noDataString:this._noDataString,disableStickyHeader:this._disableStickyHeader,onRowBuild:(e,t)=>{
TradingView.onChartPage&&Ke.proSymbol.value()===t.s&&this._selectableList&&(this._setActiveElem(e),this._selectableList.focusItem(e)),this._lifecycle.beforeAppendSymbol(t.s,e)},onUpdate:()=>{this._selectableList&&this._selectableList.restore()}}),this._table.setFields({name:{title:$.t("Ticker")}}),this._model.fieldSetChanged.subscribe(null,e=>{const t={};e.forEach(e=>{t[e]=y.f[e]}),this._table.setFields(t)}),this._model.filterSetChanged.subscribe(null,()=>{this.$filterSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFilterSetChanged())}),this._table.fieldsOrderChange.subscribe(null,()=>{this._model.fieldsOrder.setValue(this._table.fieldsOrder),this.$fieldSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFieldSetChanged()),this._model.settingsSaver.setJSON(i+".fields_order",this._table.fieldsOrder,{forceFlush:!0})});let s=0,o=!1;this._model.loadingStart.subscribe(null,e=>{e?(o=!0,this._bridge.standalone&&(s=$(document).scrollTop()),this._showSpinner(this.$bottomLoadingScreen)):(s=0,this._model.isFastRefresh||this._showSpinner())}),this._model.loadingStart.subscribe(null,()=>this.resetRefreshCounter(!0)),this._model.loadingComplete.subscribe(null,()=>{o&&this._bridge.standalone&&0!==s&&$(document).scrollTop()!==s?(o=!1,$(document).scrollTop(s),s=0):this._bridge.standalone&&this._isScrollBottom()&&$(document).scrollTop($(document).scrollTop()/2),this._hideSpinner(),this.resetRefreshCounter()}),this._model.eodRestriction.subscribe(()=>this.updateIntervalButton(),{callWithLast:!0}),window.loginStateChange&&window.loginStateChange.subscribe(null,()=>{if(this.resetRefreshCounter(),"forex"===this._model.screener_type){const e=this._model.selectedGroups;y.f.sector.value=e,this._$groupSelectButton&&(this._$groupSelectButton.empty(),this.updateGroupsButton(this._$groupSelectButton,e))}}),this._bridge.standalone&&$(window).on("scroll",()=>{$(".js-dropdown-toggle.i-opened").trigger("resetPosition")});const r=Object(n.default)(()=>{this._tempBusy=!1},250),a=()=>{this._tempBusy||(this._tempBusy=!0),r()};this._bridge.standalone&&$(window).on("scroll",a),$(window).on("resize",a),this.widthChange.subscribe(this,a),this._bridge.standalone||this._model.loadingComplete.subscribe(null,()=>{this.isEndReached()?(this.$content.addClass("tv-screener__content-pane--fully-loaded"),this._table.$element.css("margin-bottom",-this._contentPadding)):(this.$content.removeClass("tv-screener__content-pane--fully-loaded"),this._table.$element.css("margin-bottom",""))}),TradingView.onChartPage&&ge.subscribe("screener.selected_type_on_chart",e=>{this._model.changeScreenerType(e).then(()=>{this._lastSetId=null,this._popups.setMarketsList(Object(ie.d)(this._model.screener_type)),"forex"===this._model.screener_type?this._$groupSelect.removeClass("i-hidden"):this._$groupSelect.addClass("i-hidden"),this.updateIntervalButton(this._$selectIntervalButton,this._model.selectedIntervalId),this._popups.updateRefreshIntervalsPopupContent()}).then(()=>this.updateMarketButton(this._model.market)).catch(e=>{
e&&Xe.logError(e)})})}getSelectedSymbols(){return this._selectableList?this._selectableList.getSelectedKeys():[]}getFocusedSymbol(){if(this._selectableList)return this._selectableList.getFocusedKey()}registerHooksHandlers(e){this._lifecycle.registerHandlers(e)}_isScrollBottom(){return $(window).scrollTop()+$(window).height()===$(document).height()}_initSelectableList(){var e;this._selectableList=(e={list:this.$content.get(0),listItemClass:"tv-screener-table__result-row",selectedListItemClass:"tv-screener-table__result-row--selected",focusedListItemClass:"tv-screener-table__result-row--focused",onNavigate:this._onSymbolsNavigate.bind(this),onConfirm:this._onSymbolConfirm.bind(this),getNodeKey:e=>e.dataset.symbol},new g(Object.assign({},{modes:[d,h,_,p,u]},e)))}_getThContent(e,t){t||(t=y.f[e]);const s=t.title&&t.title.toLowerCase()!==t.shortTitle.toLowerCase()?$(`<div class="tv-screener-table__head-wrap js-head-wrap apply-common-tooltip common-tooltip-fixed" title="${t.title}" data-field="${e}">`):$(`<div class="tv-screener-table__head-wrap js-head-wrap" data-field="${e}">`);t.disableHeaderControl&&s.addClass("tv-screener-table__head-wrap--disable-interaction");const n=$('<div class="tv-screener-table__head-left js-head-left"></div>').appendTo(s),o=$('<div class="tv-screener-table__head-left--text"></div>').appendTo(n),r=$(`<div class="js-head-title">${t.shortTitle||t.title}</div>`).appendTo(o);e===this._model.searchField&&n.addClass(!y.f.description.disabled&&y.f.description.checked?"tv-screener-table__head-left--name-col":this._onWidget?"tv-screener-table__head-left--widget-name-col-without-description":"tv-screener-table__head-left--name-col-without-description");const a=$(`<span class="tv-screener-table__sort js-table-sort ${this._model._sortField.value()===e?"tv-screener-table__sort--"+this._model._sortDirection.value():""}">${"asc"===this._model._sortDirection.value()?et:tt}</span>`);if(e===this._model.searchField){let e;e=this._totalCount?this._bridge.hide_load_more&&this._bridge.page_size&&this._totalCount>=this._bridge.page_size?$.t("{0} matches").format(this._bridge.page_size):$.t("{0} match",{plural:"{0} matches",count:this._totalCount}).format(this._totalCount):$.t("No matches"),$(`<div class="js-field-total tv-screener-table__field-value--total">${e}</div>`).appendTo(n),this._onWidget||$(ot).appendTo(n)}let l=!1;if(t.control&&!this._bridge.hide_controls){const t=$(`<i data-field="${e}" class="js-filter-button tv-screener-table__filter-button">${i("W0m6")}</i>`);t.appendTo(s);if(this.fieldValueString(e)){t.addClass("tv-screener-table__filter-button--active");const i=$(`<span class="js-field-value tv-screener-table__field-value apply-overflow-tooltip${"name"===e?" tv-screener-table__field-value--name":""}">${window.t(this.fieldValueString(e))}</span>`);n.append(i),l=!0}}return a.appendTo(s),r.addClass(l?"tv-screener-table__head-left--title-two-lines":"tv-screener-table__head-left--title-three-lines"),s}_updateTableSortField(){
const e=this._model._sortField.value(),t=this._model._sortDirection.value(),i=this._table.getTh(e);e&&t&&i.size()&&(this._table.$theadRow.find(".tv-screener-table__sort--desc,.tv-screener-table__sort--asc").removeClass("tv-screener-table__sort--desc tv-screener-table__sort--asc"),i.find(".js-table-sort").empty().addClass("tv-screener-table__sort--"+t).append("asc"===t?et:tt))}setFieldActive(e,t,i){this._dialog.$filtersPopup&&(i||(i=this._dialog.$filtersPopup.find(".js-filter-field-"+e.replace(/\W/g,""))),i&&i.size()&&i.toggleClass("tv-screener-dialog__filter-field--active",t))}_resetSearchCount(){const e=this._getThContent(this._model.searchField).find(".js-field-total").text();this._table.setSearchText(e)}_resetField(e){this.setFieldActive(e,this._model.fieldActive(e));const t=this._getThContent(e);if("name"===e&&this._lifecycle.beforeAppendSymbolsHeader(t.get(0)),this._table.setThContent(e,t),!this._dialog.$filtersPopup&&this.$inplaceEditor&&e===this._inplaceEditorField){const t=!this._isFilterValueEmpty(e),i=this.$inplaceEditor.find(".js-reset"),s=this.$inplaceEditor.find(".js-wrap");t?(i.removeClass("i-hidden"),s.removeClass("tv-screener-inplace-editor__filter-without-reset"),this.$inplaceEditor.removeClass("tv-screener-inplace-editor__without-reset")):(i.addClass("i-hidden"),s.addClass("tv-screener-inplace-editor__filter-without-reset"),this.$inplaceEditor.addClass("tv-screener-inplace-editor__without-reset"))}}_setupStickyHeader(){if(this._disableStickyHeader)return;const e=this._table.$stickyHeader;e.insertBefore(this.$content);const t=$('<span class="tv-screener-sticky-header-wrapper__right-substrate"></span>').prependTo(this.$content);let s=Math.round(this.$toolbar.outerHeight());if(this._bridge.width&&this._bridge.width.subscribe(()=>this.onResizeToolbar()),this._bridge.visible&&this._bridge.visible.subscribe(()=>this.onResizeToolbar()),this._bridge.standalone){const i=196;let n;this.$toolbar.toggleClass("tv-screener-toolbar--standalone_sticky",!0).css({top:i}),this._bridge.$body.css({"padding-top":s}),e.css({top:s});const o=(n,o)=>{o||(o=$(document).scrollTop()),this._bridge.$body.css({"padding-top":s}),this.$toolbar.css({top:n?0:i-o}),e.css({top:s}),t.css({top:n?s:0})},r=e=>$(document).scrollTop()-(this.$content.offset().top-e)>0;$(document).on("scroll",()=>{s=Math.round(this.$toolbar.outerHeight());const i=$(document).scrollTop(),a=$(document).scrollLeft();let l;this._onWidget||(l=r(s),o(l,i),this._$mainContainer.css("top",-i)),e.toggleClass("tv-screener-sticky-header-wrapper--standalone_sticky",l);const c=Object(C.isRtl)()?document.body.clientWidth-this.$content[0].getBoundingClientRect().right:-a;e.css({[Object(C.isRtl)()?"right":"left"]:l?c:"auto"}),t.toggleClass("tv-screener-sticky-header-wrapper__right-substrate--standalone_sticky",l),n!==l&&this.updateToolbarButtons(),n=l,this.$bottomLoadingScreen.css({left:a}),this.$bottomWatermarkSvg.css({left:a})}),$(window).on("resize",()=>{this.fixStandaloneWidth(),s=Math.round(this.$toolbar.outerHeight());const e=r(s);o(e),this.onResizeToolbar()}),
this.fixStandaloneWidth(),this._table.afterFixCols.subscribe(null,()=>{this.fixStandaloneHorizontalScroll()})}else{this._bridge.$body.css({overflow:"hidden"});let i=!1,s=!1;this.onResizeToolbar();const n=()=>{const i=Math.round(e.outerHeight());t.css({top:-i}),this.$content.css({top:i}),this._table.$element.css({top:-i,position:"relative"})};(TradingView.onChartPage||this._onWidget)&&n(),this.$content.on("scroll",()=>{Object(pe.hide)(),_e.a.hide(),Object(C.isRtl)()?e.css("right",-(this.$content[0].scrollWidth-this.$content[0].clientWidth-Object(C.getLTRScrollLeft)(this.$content[0]))):e.css("left",-this.$content.scrollLeft()),this._onWidget&&this._bridge.hide_controls&&e.css({top:0})}),TradingView.onChartPage&&$(document).on("scroll",()=>{window.innerWidth<=o.breakpoints.tablet&&(i=this.$content.get(0).getBoundingClientRect().top<0),e.toggleClass("tv-screener-sticky-header-wrapper--standalone_sticky",i),s!==i&&e.css({left:i?-this.$content.scrollLeft():0}),s=i})}this._bridge.hide_controls||(this.$headerFieldsButton=$(`<div class="tv-screener-sticky-header-wrapper__fields-button apply-common-tooltip common-tooltip-vertical common-tooltip-otl" title="${$.t("Column setup")}">\n\t\t\t\t${i("040A")}\n\t\t\t</div>`).appendTo(e),this.$headerFieldsButton.attr({"data-name":"header_fields-button"}),this._popups.setFieldsPopup(this.$headerFieldsButton,"tv-screener-sticky-header-wrapper__fields-button-wrap","tv-dropdown__body--position_right")),this._model.loadingComplete.subscribe(null,()=>{t.show()},!0)}_showSpinner(e=this.$loadingScreen){e.removeClass("js-hidden"),clearTimeout(this._spinnerTimeoutId),this._spinner||(this._spinnerTimeoutId=setTimeout(()=>{this._spinner=(new ne.Spinner).spin(e.get(0))},100))}_hideSpinner(){this.$loadingScreen.addClass("js-hidden"),this.$bottomLoadingScreen.addClass("js-hidden"),clearTimeout(this._spinnerTimeoutId),this._spinner&&(this._spinner.stop(),delete this._spinner)}_getResizerBridgeWidth(){return window.widgetbar?Object(He.a)(window.widgetbar.resizerBridge.width.value()):Object(He.a)(0)}fixStandaloneWidth(){if(this._bridge.standalone){this._bridge.$body.css({"padding-right":"","padding-left":""});const e=this._getResizerBridgeWidth(),t=Object(C.isRtl)()?"padding-left":"padding-right";this.$toolbar.width($(window).width()-e),this._$mainHeader.css({[t]:e}),this.updateToolbarButtons(),this.widthChange.fire()}}fixStandaloneHorizontalScroll(){if(this._bridge.standalone){const e=this._getResizerBridgeWidth(),t=this._table.$element.width()+(Object(C.isRtl)()?0:e),i=$(window).width()<t,s=Object(C.isRtl)()?"padding-left":"padding-right";this._bridge.$body.css({[s]:i?t:""}),this.$toolbar.width($(window).width()-e),this.updateToolbarButtons()}}prepareLayout(){this._bridge.$body.addClass("tv-screener"+(this._bridge.standalone?" tv-screener--standalone":"")),this.$loadingScreen=$(`<div class="tv-screener__loading-screen${this._bridge.standalone&&!this._bridge.table_loading_screen?" tv-screener__loading-screen--standalone":""}">`).appendTo(this._bridge.$body),
this.$bottomWatermarkSvg=$(".tv-footer__inner--screener-watermark svg"),this.$toolbar=$(`<div class="tv-screener-toolbar${this._bridge.standalone?" tv-screener-toolbar--standalone":""} ${this._disableStickyHeader?"tv-screener-toolbar--markets":""}">`).appendTo(this._bridge.$body),this.$toolbar.on("contextmenu",(function(e){e.preventDefault()})),$(".tv-screener__content-pane").remove(),this.$content=$('<div class="tv-screener__content-pane" tabindex="100">').data({localScroll:!this._bridge.standalone}).appendTo(this._bridge.$body),this.$content.on("contextmenu",(function(e){e.target.classList.contains("tv-screener__content-pane")&&e.preventDefault()})),this.$bottomLoadingScreen=$('<div class="tv-screener__bottom-loading-screen">').appendTo(this._bridge.$body),this._$mainContainer=$(".tv-screener__standalone-main-container"),this._$mainHeader=this._$mainContainer.find(".tv-header"),this._onWidget||(this.$refreshButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--with-options tv-screener-toolbar__button--refresh apply-common-tooltip common-tooltip-fixed" title="${$.t("Refresh")}"></div>`).attr({"data-name":"screener-refresh","data-role":"button"}).append($(i("wHhB")).attr({class:"tv-screener-toolbar__button-icon tv-screener-toolbar__button-icon--standalone-refresh",width:"18",height:"18"})).appendTo(this.$toolbar),this.$refreshCounter=$('<span class="tv-screener-toolbar__refresh-counter">').text("00:00").appendTo(this.$refreshButton),this.$refreshIntervalButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--options tv-screener-toolbar__button--space_right apply-common-tooltip common-tooltip-fixed" title="${$.t("Refresh interval")}"></div>`).attr({"data-name":"screener-refresh-interval","data-role":"button"}).append($(i("040A")).attr({width:3,height:13,class:"tv-screener-toolbar__button-icon",style:"top: -1px"})).appendTo(this.$toolbar));const e=this._model.currentFieldSetId(),t=this._model.getFieldSetById(e);this.$fieldSetsButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--animated\n\t\t\ttv-screener-toolbar__button--with-options tv-screener-toolbar__button--arrow-down\n\t\t\ttv-screener-toolbar__button--with-state apply-common-tooltip common-tooltip-fixed js-field-sets"  title=" ${$.t("Column sets")}">\n\t\t\t\t${t?t.title:""}\n\t\t\t</div>`).attr({"data-name":"screener-field-sets","data-role":"button","data-field-set":e}).appendTo(this.$toolbar),this.$fieldsButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--options\n\t\t\ttv-screener-toolbar__button--square apply-common-tooltip common-tooltip-fixed\n\t\t\ttv-screener-toolbar__button--space_right" title=" ${$.t("Column setup")}">`).attr({"data-name":"screener-fields","data-role":"button"}).append($(i("49Ex")).attr({class:"tv-screener-toolbar__button-icon"})).appendTo(this.$toolbar),this.$favoritesBar=$('<div class="tv-screener-toolbar__favorites">').appendTo(this.$toolbar),
this.$periodPicker=$('<div class="tv-screener-toolbar__period-picker">').appendTo(this.$toolbar);const s=nt[this._model.screener_type];s&&(this._createSwitch(s),this.$toolbar.addClass("tv-screener-toolbar--one-line")),this._bridge.hide_controls||this._periodPicker||this._bridge.onWidget||this.createAlertButtons();const n=this._model.currentFilterSetId(),o=this._model.getFilterSetById(n);this.$filterSetsButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--with-options\n\t\t\ttv-screener-toolbar__button--arrow-down tv-screener-toolbar__button--with-state\n\t\t\tapply-common-tooltip common-tooltip-fixed js-filter-sets" title="${$.t("Screens")}">`).attr({"data-name":"screener-filter-sets","data-role":"button","data-filter-set":n}).appendTo(this.$toolbar),this.$filterSetsButtonTitle=$(`<span>${o?o.title:""}</span>`).appendTo(this.$filterSetsButton),this.$filtersButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--options tv-screener-toolbar__button--filters apply-common-tooltip i-disabled common-tooltip-fixed" title="${$.t("Adjust filters")}">${$.t("Filters")}</div>`).attr({"data-name":"screener-filter","data-role":"button"}).append($(i("W0m6")).attr({class:"tv-screener-toolbar__button-icon tv-screener-toolbar__button-icon--filters"})).appendTo(this.$toolbar),this._model.loadingComplete.subscribe(null,()=>{this.$filtersButton.removeClass("i-disabled")},!0);const r=$('<div class="tv-screener-toolbar__filter-count-wrap">').on("click",()=>{this.showActiveFilters(),Object(W.e)(new Ne.c("filter_counter_button",this._getFiltersCounterValue()))}).appendTo(this.$toolbar);this.$filterCount=$(`<span class="tv-screener-toolbar__filter-count js-hidden apply-common-tooltip common-tooltip-vertical common-tooltip-otl" title="${$.t("Applied filters count")}">`).attr({"data-name":"screener-filter-count","data-role":"button"}).appendTo(r),this._table.$element.appendTo(this.$content),this.initHandlers(),this._bridge.selection_disabled||this._initSelectableList(),this._onWidget&&this._bridge.hide_controls&&(this._contentPadding=this.$content.innerHeight()-this.$content.height(),this.$content.css("height",`calc(100% - ${this._contentPadding}px)`),this.$toolbar.hide()),this._bridge.hide_controls?([this.$refreshButton,this.$refreshIntervalButton,this.$fieldSetsButton,this.$fieldsButton,this.$filterSetsButton,this.$filtersButton,this.$filterCount].forEach(e=>{e&&e.hide()}),this._onWidget&&(this._bridge.$body.addClass("tv-screener--hidden-toolbar"),this.$loadingScreen.addClass("tv-screener__loading-screen--hidden-toolbar"))):(this._onWidget||(this._$selectIntervalButton=this.addIntervalSelect({$before:this.$createAlertButton||this.$filterSetsButton}).attr({"data-name":"screener-time-interval","data-role":"button"}),this._$downloadButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--space_right tv-screener-toolbar__button--export apply-common-tooltip common-tooltip-fixed i-disabled" title="${$.t("Export screener data to a CSV file")}"></div>`).attr({
"data-name":"screener-export-data","data-role":"button"}).append($(i("5zLk")).attr({class:"tv-screener-toolbar__button-icon tv-screener-toolbar__button-icon--export"})),this._$downloadButton.insertBefore(this._$selectIntervalButton),this._$downloadButton.on("click",e=>{Object(v.a)(()=>{this._$downloadButton.toggleClass("i-loading",!0),this._model.getDownloadData().then(e=>{const[t,...i]=this._table.columnsOrder,s=[t,"description",...i];try{const t=function(e,t,i,s){const n=new Map,o=[];for(const a of t)o.push(y.f[a].title),n.set(a,Pe(i,a));const r=[o];for(const a of e){const e=[];for(const[t,o]of Array.from(n.entries())){const n=y.f[t],r=a.d[o];if(null===r)e.push("");else if(je.includes(t))e.push(Object(fe.t)(r));else if("earnings_release_date"===t||"earnings_release_next_date"===t){const t=Object(y.h)(n,s,!1);e.push(t.format(r))}else if(n.signalComputation)Be.includes(t)?e.push(n.signalComputation(r).title):e.push(r.toString());else{const s=n.additionalColumns?n.additionalColumns.map(e=>a.d[Pe(i,e)]):[];if(n.mutateDisplayValue&&!Fe.includes(t))e.push(n.mutateDisplayValue(r,...s,t));else if("candlestick"===t&&n.additionalColumns){const{additionalColumns:t}=n,i=Me(s);if(0===i.length)e.push("");else{const s=i.map(e=>t[e]).map(De).filter(Boolean).map(e=>e.name).join(", ");e.push(s)}}else e.push(r.toString())}}r.push(e)}return r}(e.data,s,this._model.getRequestColumns(),this._model.screener_type),i=t.map(Re).join("\r\n"),n=Ae.dateFormatFunctions["yyyy-MM-dd"](new Date,!0),o=`${this._model.market}_${n}.csv`;Object(he.saveTextFile)(o,i,"text/csv")}catch(n){Xe.logError(n.toString())}this._$downloadButton.toggleClass("i-loading",!1),this._model.trackEvent("Export screener data")})},L.ProductFeatures.SCREENER_EXPORT_DATA,{feature:"screenerExportData"}),Object(W.e)(new We)}),this._model.loadingComplete.subscribe(null,()=>{this._$downloadButton.removeClass("i-disabled")},!0)),this.addMarketSelect({$before:this.$createAlertButton||this.$filterSetsButton}),this._$groupSelectButton=this.addGroupSelect({$before:this.$createAlertButton||this.$filterSetsButton}),this._popups.setFieldsPopup(this.$fieldsButton,"tv-screener-toolbar__button-wrap"),this._popups.setFieldSetsPopup(this.$fieldSetsButton),this._popups.setFilterSetsPopup(this.$filterSetsButton,!this._bridge.onWidget),this._onWidget||this._popups.setRefreshIntervalsPopup(this.$refreshIntervalButton)),this._periodPicker?(Object(y.c)(),Object(te.c)(this._model.timezone),this._selectedPeriodId="today",this._setNewEarningsPeriod(this._selectedPeriodId),this.updatePeriodPicker(),this.$favoritesBar.hide(),y.f.earnings_release_next_date.onFilterChange=e=>{const t=this._periodPickerButtons.find(t=>t.title===e);this.changeEarningsPeriod(t?t.id:"",!0)}):this.$periodPicker.hide(),this._showSpinner(),this.updateToolbarButtons(),this.onResizeToolbar()}onResizeToolbar(){if(!this._disableStickyHeader&&this._table.$stickyHeader.position().top<0)return;const e=Math.round(this.$toolbar.outerHeight())
;!this._disableStickyHeader&&this._onWidget&&this._bridge.hide_controls?this._table.$stickyHeader.css({top:0}):this._disableStickyHeader||this._table.$stickyHeader.css({top:e})}showMaintenance(){this._bridge.$body.html(`<div class="tv-screener__maintenance">${$.t("We are doing some brief daily maintenance. Screener will be back really soon, thanks for your patience!")}</div>`)}createAlertButtons(){this.$createAlertButton=$(`<div class="tv-screener-toolbar__button tv-screener-toolbar__button--with-options tv-screener-toolbar__button--create-alert js-create-alert-button apply-common-tooltip common-tooltip-fixed" title="${$.t("Enable Alert")}">`).attr({"data-name":"screener-alert","data-role":"button"}).append($('<i class="js-alert-icon-plus">').append($(i("TWhw")).attr({width:20,height:21,class:"tv-screener-toolbar__button-icon",style:"top: -2px; margin-right: -4px"}))).append($('<i class="i-hidden js-alert-icon">').append($(i("Rx1T")).attr({width:16,height:17,class:"tv-screener-toolbar__button-icon",style:"top: -2px"}))).appendTo(this.$toolbar),this.$alertsButton=$('<div class="tv-screener-toolbar__button tv-screener-toolbar__button--space_right tv-screener-toolbar__button--options js-alerts-button apply-common-tooltip common-tooltip-fixed">').attr({title:$.t("Options"),"data-name":"screener-alerts-options","data-role":"button"}).append($(i("040A")).attr({width:3,height:13,class:"tv-screener-toolbar__button-icon",style:"top: -1px"})).appendTo(this.$toolbar)}setAlertButtonsDisabledState(e){this.$createAlertButton&&this.$createAlertButton.toggleClass("i-disabled",e),this.$alertsButton&&this.$alertsButton.toggleClass("i-disabled",e)}setCreateAlertButtonLoading(){this.$createAlertButton&&(this.$createAlertButton.addClass("tv-screener-toolbar__button--alert-loading"),"running"===this.$createAlertButton.data("state")&&this.$createAlertButton.addClass("tv-screener-toolbar__button--enabled-alert-loading"))}setAlertButtonState(e){if(!this.$createAlertButton||this.$createAlertButton.is("i-disabled"))return;"created"!==e&&"pending"!==e&&(clearTimeout(this._alertButtonLoadingTimeoutId),this.$createAlertButton.removeClass("tv-screener-toolbar__button--alert-loading tv-screener-toolbar__button--enabled-alert-loading"));const t="running"===e;this.$createAlertButton.data("state",e).toggleClass("tv-screener-toolbar__button--enabled",t).attr({title:t?$.t("Disable Alert"):$.t("Enable Alert"),"data-alert-state":e}),this.$createAlertButton.find(".js-alert-icon-plus").toggleClass("i-hidden",t),this.$createAlertButton.find(".js-alert-icon").toggleClass("i-hidden",!t)}initHandlers(){this.$toolbar.on("hover",this.adjustToolbarWidth.bind(this)),this.$fieldSetsButton.on("transitionend",this.updateToolbarButtons.bind(this));const e=e=>{const t=e.data("field");if(!1===y.f[t].sortableColumn)return;const i=this._model._sortField.value(),s=this._model._sortDirection.value();y.f[t].disableHeaderControl||(i===t&&this._model._sortDirection.setValue("asc"===s?"desc":"asc"),this._model._sortField.setValue(t),this._model.update())}
;if(Modernizr.mobiletouch){(new ve.a).load().then(t=>{const i=new t($(".tv-screener")[0],{touchAction:"auto"});i.get("press").set({time:500}),i.on("press",e=>{const t=$(e.target).closest(".js-head-wrap");if(t.length){const i=$(t).data("field");this.showHeaderContextMenu(i,e.srcEvent)}e.preventDefault()}),i.on("tap",t=>{if($(t.target).closest(".js-search-input").length)return;const i=$(t.target).closest(".js-head-wrap");i.length&&e(i)})})}else $(".tv-screener").on("click",".js-head-wrap",t=>{const i=$(t.currentTarget);e(i),t.stopPropagation()}).on("contextmenu",".js-head-wrap",e=>{const t=$(e.currentTarget).data("field");this.showHeaderContextMenu(t,e),e.preventDefault()}),$(".tv-screener").on("click",".js-filter-button",e=>{const t=$(e.currentTarget).closest("th"),i=t.data("field");this.showInplaceEditor(i,t),e.stopPropagation()});$(".tv-screener").on("click",".js-search-input",e=>{e.stopPropagation()}),$(".tv-screener").on("click",".js-input-reset",e=>{$(e.currentTarget).addClass("i-hidden"),$(".tv-screener").find(".js-search-input").val(""),y.f[this._model.searchField].searchValue="",this._model.update(),e.stopPropagation()}),$(".tv-screener").on("click",".js-filter-button",e=>{const t=$(e.currentTarget).closest("th"),i=t.data("field");this.showInplaceEditor(i,t),e.stopPropagation()}),this._bridge.table_context_menu_disabled||this._initTableContextMenu(),this.$content.on("scrolltoend",e=>{this._model.loading||this._model.update(null,!0)}),this.$refreshButton&&this.$refreshButton.click(e=>{this._model.loading||this.refresh(),Object(W.e)(new X)}),this.$filtersButton.click(()=>{this._dialog.showFiltersDialog(),Object(W.e)(new Ne.c("filter_button",this._getFiltersCounterValue()))}),Ke.proSymbol.subscribe(e=>{const t=this.$content.find(`[data-symbol="${e}"]`).get(0);this._setActiveElem(t),this._selectableList&&(t?this._selectableList.focusItem(t):this._selectableList.clear())}),this.$fieldSetsButton.on("click",()=>{this._lastSetId=null}),this.$toolbar.on("click",".js-favorite-item",e=>{const t=$(e.currentTarget).attr("data-set");this._lastSetId!==t&&(this._model.preventPrevScanRequest(),this.updateSetId(t,!1,this._bridge.hide_controls)),Object(W.e)(new H("columnset_favorites_picker",t))}),this.$toolbar.on("click",".js-period-picker-item",e=>{const t=$(e.currentTarget).attr("data-period");this.changeEarningsPeriod(t)}),this.$toolbar.on("click",".js-create-alert-button",e=>{this.toggleAlert.fire(void 0,"toggle_alert_button")}),this.$alertsButton&&"function"==typeof this._bridge.getAlertsCtlDropdownContent&&this._popups.setAlertsPopup(this.$alertsButton,this._bridge.getAlertsCtlDropdownContent()),$(window).resize(e=>this.updateToolbarButtons()),this._bridge.width&&this._bridge.width.subscribe(()=>this.updateToolbarButtons()),this._bridge.visible&&this._bridge.visible.subscribe(e=>{e&&(this.updateToolbarButtons(),this.adjustToolbarWidth())}),this.updateFavoritesToolbar()}_initTableContextMenu(){this.$content.on("contextmenu",".tv-screener-table__result-row",e=>{const t=$(e.currentTarget).data("symbol")
;this._selectableList&&this._selectableList.focusItem(e.currentTarget),this.showContextMenu(t,e),e.preventDefault()})}_onSymbolsNavigate(e){const t=e.cursor;if(t){const e=t.dataset.symbol;TradingView.onChartPage&&this._setActiveElem(t),this._changeSymbol(e)}}_changeSymbol(e){const t=Ke.preventFeedBySymbol;Ke.setPreventFeedBySymbol(!0),Ke.symbol.setValue(e),Ke.setPreventFeedBySymbol(t),this._model.trackEvent("Change symbol from table")}_setActiveElem(e){this._activeElem&&this._activeElem.classList.remove("tv-screener-table__result-row--active"),e?(e.classList.add("tv-screener-table__result-row--active"),this._activeElem=e):this._activeElem=null}_onSymbolConfirm(e){e.items.forEach(t=>{const i=t.dataset.symbol;i&&this._lifecycle.afterSymbolConfirm(i,e.action)})}changeEarningsPeriod(e,t=!1){if(this._selectedPeriodId===e)return;this._selectedPeriodId=e,this.updatePeriodPicker(),this._model.applyFieldSetContent(k.b);"tomorrow"===e||"next_week"===e?Object(y.a)():Object(y.b)(),t||this._setNewEarningsPeriod(e,()=>{this._resetField("earnings_release_next_date"),this._model.preventPrevScanRequest(),this._model.update()})}_setNewEarningsPeriod(e,t=(()=>{})){const i=y.f.earnings_release_next_date.sourceRange.find(t=>t.key===e);i&&(y.f.earnings_release_next_date.value=i.name,t())}get totalCount(){return this._totalCount}get itemsCount(){return this._itemsCount}set itemsCount(e){this._itemsCount=+e}set lastSetId(e){this._lastSetId=e}get popups(){return this._popups}isEndReached(){return 0===this._data.length||"number"==typeof this._totalCount&&this._data.length>=this._totalCount}display(e,t,i){if(this._hideSpinner(),this._setFiltersCount(),this.$filterSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFilterSetChanged()),!e||e.error||!e.data&&!e.symbols)"abort"!==i&&(this.resetItems(),this._table.setColumnsMap(t),this._table.update([]),this._resetField("name"),"error"===i?Xe.logError(e.responseText||i):e&&e.error&&Xe.logError(e.error));else{let i=e.data||e.symbols;for(let e=0;e<i.length;++e)i[e].f&&(i[e].d=i[e].f);if(void 0===this._totalCount)this._bridge.table_style||this.fixStandaloneWidth(),this._table.setColumnsMap(t),this._table.update(i),this._data=i;else{const e=this._getInvalidatedFrom(i);0===e?(this._data=i,this._table.setColumnsMap(t),this._table.update(i)):(e>0?(i=i.slice(e),this._data=this._data.slice(0,e),this._table.clearData(e)):i=i.slice(this._data.length),this._data=this._data.concat(i),this._table.append(i))}setTimeout(()=>this.highlightChanges(),0),this._totalCount=e.totalCount,this._resetSearchCount(),this._model._initialSortField&&(this._model._sortField.setValue(this._model._initialSortField,!0),this._model._sortDirection.setValue(this._model._initialSortDirection,!0),delete this._model._initialSortField,delete this._model._initialSortDirection)}}_getInvalidatedFrom(e){for(let t=0;t<this._data.length;++t){if(!e[t]||this._data[t].s!==e[t].s||!e[t].d)return t;for(let i=0;i<this._data[t].d.length;++i)if(this._data[t].d[i]!==e[t].d[i])return t}return-1}get table(){return this._table}
resetItems(){delete this._totalCount,this._data=[]}_getFiltersCounterValue(){const e=this._model.currentFilterState();return e.filters&&Object.keys(e.filters).length||0}_setFiltersCount(){const e=this._getFiltersCounterValue();this.$filterCount.text(""+e).toggleClass("js-hidden",!e)}_concatFieldValues(e,t){var i=[];return e.forEach(e=>{i.push(this._getFieldValueFromRangeTitles(e,t))}),i.join(", ")}_getFieldValueFromRangeTitles(e,t,i=!1){return y.f[t].rangeTitles&&y.f[t].rangeTitles[e]?y.f[t].rangeTitles[e][i?1:0]:"string"!=typeof e?"":e}fieldValueString(e){const t=y.f[e].value;if(Object(y.l)(t)||!1===t)return"";if("select"===y.f[e].control){const i=$.t("{0} item",{plural:"{0} items",count:t.length,context:"combobox_input"}).format(t.length);return Array.isArray(t)?`<span title="${this._concatFieldValues(t,e)}" class="apply-common-tooltip">${i}</span>`:this._getFieldValueFromRangeTitles(t,e,"dr"===t&&"name"===e)}return"range"===y.f[e].control?Array.isArray(t)?this._rangeLeftValue(e)+" â "+this._rangeRightValue(e):"":"toggle"===y.f[e].control?-1!==e.toLowerCase().indexOf("high")?$.t("New High"):$.t("New Low"):"condition"!==y.f[e].control||Object(y.l)(t.operator)||Object(y.l)(t.value)?"":"in_range"===t.operator?t.value[0]===t.value[1]?Ye.equal+" "+t.value[0]:-1e100===t.value[0]||this._isLessThenMin(t.value[0],e)?Ye.less+" "+t.value[1]:1e100===t.value[1]||this._isGreaterThenMax(t.value[1],e)?Ye.greater+" "+t.value[0]:this._rangeLeftValue(e)+" â "+this._rangeRightValue(e):"not_in_range"===t.operator?t.value[0]===t.value[1]?Ye.nequal+" "+t.value[0]:-1e100===t.value[0]||this._isLessThenMin(t.value[0],e)?Ye.greater+" "+t.value[1]:1e100===t.value[1]||this._isGreaterThenMax(t.value[1],e)?Ye.less+" "+t.value[0]:`${Ye.not_in_range} ${this._rangeLeftValue(e)} â ${this._rangeRightValue(e)}`:Ye[t.operator]+" "+("number"==typeof t.value?t.value:y.f[t.value].title)}updateToolbarButtons(){this._bridge.period_picker?this.updatePeriodPicker():this._bridge.originalStandalone&&this.updateOldFavoritesToolbar()}updateOldFavoritesToolbar(){this.$hiddenFavoritesButtonWrap&&this.$hiddenFavoritesButtonWrap.hide(),this.$favoritesBar.find(".js-favorite-item").remove();let e=0;this.hiddenFavorites=[];const t=this.$favoritesBar.width(),i="forex"!==this._model.screener_type||this._bridge.hide_controls?40:160,s=e=>e===this._model.currentFieldSetId();if(this._model.favoriteFieldSets){let n=null;for(let o=0;o<this._model.favoriteFieldSets.length;++o){const r=this._model.favoriteFieldSets[o],a=this._model.getFieldSetById(r);if(!a)return;const l=$(`<div class="tv-screener-toolbar__favorites-item js-favorite-item" data-set="${a.id}">\n\t\t\t\t\t${Object(oe.htmlEscape)(a.title)}\n\t\t\t\t</div>`).toggleClass("tv-screener-toolbar__favorites-item--active",s(a.id));n?l.insertAfter(n):l.prependTo(this.$favoritesBar);let c=l.outerWidth();l[0].scrollWidth>c&&l.addClass("apply-common-tooltip").attr("title",a.title),c+=9,e+=c,e+i>t?(e-=c,l.remove(),this.hiddenFavorites.push({id:a.id,title:a.title})):n=l}}
if(this.hiddenFavorites.length)if(this.$hiddenFavoritesButtonWrap)this.$hiddenFavoritesButtonWrap.trigger("resetContent").show();else{const e=$(`<div class="tv-screener-toolbar__favorites-item tv-screener-toolbar__favorites-more apply-common-tooltip common-tooltip-fixed" title="${$.t("Favorite sets")}">`).appendTo(this.$favoritesBar);this.$hiddenFavoritesButtonWrap=this._popups.setHiddenFavoritesPopup(e,()=>this.hiddenFavorites,s,e=>this.updateSetId(e,!1,this._bridge.hide_controls))}}updateSetId(e,t,i){this._lastSetId=e,this._model.applyFieldSet(e,t,i)}updateNewFavoritesToolbar(){if(!this._model.favoriteFieldSets)return;const e={items:this._model.favoriteFieldSets.map(e=>({title:this._model.getFieldSetById(e).title})),activeItem:this._model.favoriteFieldSets.indexOf(this._model.currentFieldSetId()),onSelect:e=>{const t=this._model.favoriteFieldSets[e];this._lastSetId!==t&&(this._model.preventPrevScanRequest(),this.updateSetId(t,!1,this._bridge.hide_controls))},className:"tv-screener-toolbar__no-scroll-choicer-react-root"};Ee(this.$favoritesBar.get(0),e)}updateFavoritesToolbar(){this._onWidget||(this._bridge.originalStandalone?this.updateOldFavoritesToolbar():this.updateNewFavoritesToolbar())}updatePeriodPicker(){const e={items:this._periodPickerButtons.map(e=>({title:e.title})),activeItem:this._periodPickerButtons.findIndex(e=>e.id===this._selectedPeriodId),onSelect:e=>{const t=this._periodPickerButtons[e].id;this.changeEarningsPeriod(t)},className:"tv-screener-toolbar__no-scroll-choicer-react-root"};Ee(this.$periodPicker.get(0),e)}showHeaderContextMenu(e,t){this._bridge.hide_controls||Promise.all([i.e("context-menu").then(i.bind(null,"7KDR")),i.e("context-menu").then(i.bind(null,"5VQP"))]).then(([{Action:i},{ContextMenuManager:s}])=>{const n=y.f[e],o=[];if("name"===e){const e=new i({label:window.t("Show symbols for the last session"),onExecute:()=>{const e=this._model.currentFilterState().options;e.active_symbols_only=!e.active_symbols_only,this._model.update(),this.$filterSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFilterSetChanged())},checkable:!0,checked:!!this._model.currentFilterState().options.active_symbols_only});o.push(e);const t=new i({label:!y.f.description.disabled&&y.f.description.checked?window.t("Hide description"):window.t("Show description"),disabled:y.f.description.disabled,onExecute:()=>{y.f.description.checked=!y.f.description.checked,this.table.update(this._data),this.$fieldSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFieldSetChanged())}});o.push(t);const s=new i({label:!y.f.type.disabled&&y.f.type.checked?window.t("Hide symbol type"):window.t("Show symbol type"),disabled:y.f.type.disabled,onExecute:()=>{y.f.type.checked=!y.f.type.checked,this.table.update(this._data),this.$fieldSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFieldSetChanged())}});o.push(s)}else{const t=new i({label:window.t("Remove column"),onExecute:()=>{n.checked=!1;const t=this._table.fieldsOrder.filter(t=>t!==e)
;this._model.fieldSetChanged.fire(t.filter(e=>y.f[e]&&!0!==y.f[e].disabled&&!0!==y.f[e].hiddenColumn)),this._model.update(),this.$fieldSetsButton.toggleClass("tv-screener-toolbar__button--unsaved",this._model.isFieldSetChanged())}});o.push(t)}const r=new i({label:window.t("Reset filter"),onExecute:()=>{this.resetFilter(e)}}),a=new i({label:window.t("Change filter"),onExecute:()=>{const i=$(t.currentTarget||t.target).closest("th");this.showInplaceEditor(e,i),t.stopPropagation()}});if(o.push(r),o.push(a),n.hasOwnProperty("displaySignal"))if(n.displaySignal){const t=new i({label:window.t("Hide rating"),onExecute:()=>{this._table.toggleSignals(e)}});o.push(t)}else{const t=new i({label:window.t("Show rating"),onExecute:()=>{this._table.toggleSignals(e)}});o.push(t)}if(n.control){this.fieldValueString(e)||r.update({disabled:!0})}else r.update({disabled:!0}),a.update({disabled:!0});s.createMenu(o).then(e=>{e.show(t)}),this._model.trackEvent("Open header context menu")})}showContextMenu(e,t){Promise.all([i.e("context-menu").then(i.bind(null,"7KDR")),i.e("context-menu").then(i.bind(null,"5VQP")),Promise.resolve().then(i.t.bind(null,"8woN",7))]).then(([{Action:i},{ContextMenuManager:s},{default:n}])=>{let o=[];const r=n.ticker(e),a=this._selectableList?this._selectableList.getSelectedKeys().length:1,l=new i({label:window.t("Add {0} to Watchlist").format(r),onExecute:()=>{window.runOrSignIn(()=>{const t=this._getWatchlist();t&&t.addSymbols([e])},{source:"add symbol to watchlist"})}});if(this._bridge.standalone&&0===a||this._onWidget){if("sector"===this._model.screener_type||"industry"===this._model.screener_type){const e=$(t.target).closest(".tv-screener-table__result-row").find(".tv-screener__symbol"),s=new i({label:window.t("Open {0} Page...").format(e.text()),onExecute:()=>{window.open(e.attr("href"),"_blank")}});o.push(s)}else{const t=new i({label:window.t("Open {0} Chart...").format(r),onExecute:()=>{this._bridge.applySymbol(e,!0)}});o.push(t)}0===a&&o.push(l)}else{if(0===a&&o.push(l),0===a){const t=new i({label:window.t("Add {0} to Compare").format(r),onExecute:()=>{this._bridge.chartWidgetCollection.activeChartWidget.value().addCompareStudy(e)}});o.push(t)}if(a>0){const e=new i({label:window.t("Add Selected Symbols to Watchlist").format(r),onExecute:()=>{window.runOrSignIn(()=>{const e=this._getWatchlist(),t=this._selectableList?this._selectableList.getSelectedKeys().slice(0):[];e&&e.addSymbols(t)},{source:"add symbol to watchlist"})}});o.push(e)}if(0===a){const t=new i({label:window.t("Add Text Note for {0}").format(r),onExecute:()=>{runOrSignIn((function(){TradingView.bottomWidgetBar&&(TradingView.bottomWidgetBar.toggleWidget("text_notes",!0),TradingView.bottomWidgetBar._widgets.text_notes.addNote(null,r,e))}),{source:"Add text note in screener"})}});o.push(t)}}o=this._lifecycle.beforeAppendContextMenuItems(o.length>0?"bottom":void 0).concat(o),s.createMenu(o).then(e=>{e.show(t)}),this._model.trackEvent("Open context menu")})}_getWatchlist(){if(window.widgetbar){const t=window.widgetbar.setPage("base");let i
;for(var e=0;e<t.widgets.length;e++)if("watchlist"===t.widgets[e].type){i=t.widgets[e].widgetObject;break}return i}return null}adjustToolbarWidth(e){const t=this.$fieldSetsButton[0].getBoundingClientRect();if(e&&"mouseenter"===e.type)this.$fieldSetsButton.css("width",t.width);else{this.$fieldSetsButton.css("width","auto");const e=this.$fieldSetsButton[0].getBoundingClientRect();this.$fieldSetsButton.css("width",t.width),this.$fieldSetsButton[0].offsetWidth,this.$fieldSetsButton.css("width",e.width)}}initFilterHandlers(e){const t={},i=(e,i,s,n)=>{t.hasOwnProperty(e)&&("typed"===t[e].state&&(s="typed"),clearTimeout(t[e].sender),"clicked"===s&&!1===i)||(t[e]={state:s,sender:setTimeout(()=>Object(W.e)(new ze.b(i,s,e,n)),1e4)})},s=(e,t)=>t.reduce((t,i)=>(i===e&&(i-=1),t+=Math.floor(i/e/(1/4))),"");e.off("change.op").on("change.op","select.js-filter-operator",t=>{const s=$(t.target),n=s.attr("name");y.f[n].value||(y.f[n].value={}),y.f[n].value.operator=s.val(),this._resetField(n),this._model.update();const{operator:o}=y.f[n].value,r=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns";i(n,o,"clicked",r)}),e.off("change.op-val").on("change.op-val","select.js-filter-operator-value",t=>{const s=$(t.target),{value:n}=t.target,o=s.attr("name");y.f[o].value||(y.f[o].value={}),y.f[o].value.value=s.val(),this._resetField(o),this._model.update();let{operator:r}=y.f[o].value;const a=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns";""!==n&&(r+="."+n),i(o,r,"clicked",a)}),e.off("update.op-arb-val").on("update.op-arb-val","input.js-filter-operator-arb-value",t=>{const s=$(t.target),n=s.attr("name");y.f[n].value||(y.f[n].value={});let o=+s.val();isFinite(o)&&!Object(y.l)(s.val())||(o=null),y.f[n].value.value=o,this._resetField(n),this._model.update();const{operator:r}=y.f[n].value,a=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns";i(n,r,"clicked",a)});const n=e.find("input.js-filter-operator-between-left"),o=e.find("input.js-filter-operator-between-right"),r=e=>{const t=$(e.target).attr("name");y.f[t].value||(y.f[t].value={});let i=+n.val();(!isFinite(i)||Object(y.l)(n.val())||this._isLessThenMin(i,t)||this._isGreaterThenMax(i,t))&&(i=-1e100);let s=+o.val();if((!isFinite(s)||Object(y.l)(o.val())||this._isLessThenMin(s,t)||this._isGreaterThenMax(s,t))&&(s=1e100),i>s){const e=i;i=s,s=e}y.f[t].value.value=[i,s],-1e100===y.f[t].value.value[0]&&1e100===y.f[t].value.value[1]&&(y.f[t].value.value=""),this._resetField(t),this._model.update()};e.off("update.op-between-left-val").on("update.op-between-left-val","input.js-filter-operator-between-left",r),e.off("update.op-between-right-val").on("update.op-between-right-val","input.js-filter-operator-between-right",r),e.off("change.toggle-val").on("change.toggle-val","input.js-filter-toggle",t=>{const s=$(t.target),n=s.attr("name");y.f[n].value=s.prop("checked"),this._resetField(n),this._model.update();const o=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns";i(n,s.prop("checked"),"clicked",o)}),
e.off("click.reset").on("click.reset",".js-reset",e=>{const t=$(e.currentTarget).data("field");this.resetFilter(t)});let a="";e.off("keydown.filterInput").on("keydown.filterInput","input:not(.js-search-input):not(.js-filter-operator-arb-value)",e=>{const t=$(e.currentTarget);a=t.val()}),e.off("keyup.filterInput").on("keyup.filterInput","input:not(.js-search-input):not(.js-filter-operator-arb-value)",t=>{const n=$(t.currentTarget),o=n.data("field"),r=n.data("bound");if(void 0===o||void 0===r||a===n.val())return;const l=[this.parseRangeValue(o,n.val(),r),y.f[o].value?y.f[o].value[1-r]:y.f[o].range[1-r]].sort(this._model.numericSorter),c=this.approximateSliderValues(o,l);if(e.find(`.tv-slider[data-field="${o}"]`).slider("values",c),y.f[o].value=l,this._resetField(o),this._model.update(),y.f[o].values){const t=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns",n=s(y.f[o].values.length+1,c);i(o,n,"typed",t)}});e.find(".tv-slider").off("slidechange").on("slidechange",(e,t)=>{const i=$(e.currentTarget).data("field");y.f[i].values?0===t.values[0]&&t.values[1]===y.f[i].values.length+1?y.f[i].value=null:y.f[i].value=[0===t.values[0]?-1e100:parseInt(y.f[i].values[t.values[0]-1],10),t.values[1]===y.f[i].values.length+1?1e100:parseInt(y.f[i].values[t.values[1]-1],10)]:t.values[0]===y.f[i].range[0]&&t.values[1]===y.f[i].range[1]?y.f[i].value=null:y.f[i].value=t.values,this._resetField(i),this._model.update()}).off("slide").on("slide",(e,t)=>{const i=$(e.currentTarget),s=i.data("field");let n=t.values[0],o=t.values[1];if(n===o)return!1;y.f[s].values&&(n=0===t.values[0]?this._rangeMinValue(s):Object(y.h)(y.f[s],this._model.screener_type).format(y.f[s].values[t.values[0]-1]),o=t.values[1]===y.f[s].values.length+1?this._rangeMaxValue(s):Object(y.h)(y.f[s],this._model.screener_type).format(y.f[s].values[t.values[1]-1])),t.value===t.values[0]?i.find(".tv-slider__label--left").val(n):(t.value===t.values[1]||i.find(".tv-slider__label--left").val(n),i.find(".tv-slider__label--right").val(o))}).on("slidechange",(t,n)=>{const o=$(t.currentTarget).data("field");if(y.f[o].values){const t=e.hasClass("tv-screener-dialog__filter-field")?"filter_dialog":"columns",r=s(y.f[o].values.length+1,n.values);i(o,r,"slided",t)}})}parseRangeValue(e,t,i){if(-1!==t.indexOf("<"))return y.f[e].range[0];if(-1!==t.indexOf(">"))return y.f[e].range[1];t=t.replace(/%/g,"");let s=Object(y.h)(y.f[e],this._model.screener_type).parse(t);if(!s.res)return y.f[e].range[i];const n=s.value||0===s.value?s.value:s.price;return s=Math.min(y.f[e].range[1],Math.max(y.f[e].range[0],n)),s}approximateSliderValues(e,t){const i=[0,0],s=[].concat(-1e100,y.f[e].values,1e100);for(let n=0;n<2;n++)for(let e=0;e<s.length;e++)Math.abs(t[n]-s[e])<Math.abs(t[n]-s[i[n]])&&(i[n]=e);return i}updateFilterSearch(){const e=this._dialog.$fieldSearchInput.val().trim().replace(/^,\s*|\s*,$/,"").toLowerCase().split(/\s*,\s*/);this._dialog.$filtersPopup.find(".js-filter-field").removeClass("js-found");const t=this._dialog.$filtersPopup.find(".js-filters-wrap").get(0);e.forEach(e=>{
let i=!1;for(const s in y.f){const n=Array.from(t.querySelectorAll(`.js-filter-field-${s.replace(/\W/g,"")}:not(.js-found)`)),o=Object(y.i)(y.f[s]),r=-1!==s.toLowerCase().indexOf(e)||Boolean(o)&&-1!==o.toLowerCase().indexOf(e);r&&(i=!0),n.forEach(e=>{e.classList.toggle("js-hidden",!r),e.classList.toggle("js-found",r)})}i||0===e.length||Object(W.e)(new Ne.b(e))})}showActiveFilters(){if(this._dialog.$filtersPopup)return;const e=this._dialog._getActiveFilters();this._dialog.showFiltersDialog(!0).then(()=>{this._dialog.$dialogContainer.find(".js-search-input").val(e.join(", ")),this.updateFilterSearch()})}resetAllFilters(){this._resetAllFilters=!0;for(const e in y.f)this._isFilterValueEmpty(e)||this.resetFilter(e);this._dialog.$dialogContainer.find(".js-search-input").val(""),this.updateFilterSearch(),this._resetAllFilters=!1}resetFilter(e){if(!y.f[e].value||!1===y.f[e].resettableFilter)return;y.f[e].value=null;const t=this._dialog.$filtersPopup||this.$inplaceEditor;if(t)if("select"===y.f[e].control)t.find(".js-filter-field-"+e.replace(/\W/g,"")).trigger("reset");else if("condition"===y.f[e].control)t.find(`[name="${e}"]`).val("").trigger("change");else if("toggle"===y.f[e].control)t.find(`[name="${e}"]`).prop("checked",!1);else if("range"===y.f[e].control){let i=y.f[e].range;y.f[e].values&&(i=[0,y.f[e].values.length+1]),t.find(`.ui-slider[data-field="${e}"]`).slider("values",i).trigger("slide",{values:i})}this._resetField(e),this._model.update()}_rangeLeftValue(e){let t=y.f[e].value;return"in_range"!==t.operator&&"not_in_range"!==t.operator||(t=t.value),this._isLessThenMin(t[0],e)?this._rangeMinValue(e):Object(y.h)(y.f[e],this._model.screener_type).format(t[0])}_rangeRightValue(e){let t=y.f[e].value;return"in_range"!==t.operator&&"not_in_range"!==t.operator||(t=t.value),this._isGreaterThenMax(t[1],e)?this._rangeMaxValue(e):Object(y.h)(y.f[e],this._model.screener_type).format(t[1])}_isGreaterThenMax(e,t){return y.f[t].range&&e>=y.f[t].range[1]}_isLessThenMin(e,t){return y.f[t].range&&e<=y.f[t].range[0]}_rangeMinValue(e){return"<"+Object(y.h)(y.f[e],this._model.screener_type).format(y.f[e].values[0])}_rangeMaxValue(e){return">"+Object(y.h)(y.f[e],this._model.screener_type).format(y.f[e].values[y.f[e].values.length-1])}_highlightActiveItems(e){if(!e.find(".js-filter-checkbox:checked").size())return e.find(".tv-control-select__option-wrap").removeClass("i-active"),void e.find(".js-item-wrap-any .tv-control-select__option-wrap").addClass("i-active");e.find(".js-filter-checkbox:checked, .js-filter-checkbox-any:checked").each((function(){e.find(".tv-control-select__option-wrap").removeClass("i-active"),$(this).closest(".tv-control-select__option-wrap").addClass("i-active")}))}_closeDropdown(e){e.tvDropdown("close"),this.$inplaceEditor&&this.$inplaceEditor.focus()}_createMultiSelectItems(e,t,i,s,n){const o=(y.f[e].useDefaultRange?y.f[e].defaultRange:y.f[e].range).slice().sort((t,i)=>{if(!1!==y.f[e].sortSelectedFirst){
const s=y.f[e].value===t||Array.isArray(y.f[e].value)&&~y.f[e].value.indexOf(t),n=y.f[e].value===i||Array.isArray(y.f[e].value)&&~y.f[e].value.indexOf(i);if(s&&!n)return-1;if(n&&!s)return 1}return!1===y.f[e].sortable?0:t>i?1:-1});for(let r=null===i?0:-1;r<o.length;++r){let a=-1===r?Ze:o[r];const l=$(`<input type="checkbox" name="${a}" class="js-filter-checkbox${-1===r?"-any":""}"${y.f[e].value===a||Array.isArray(y.f[e].value)&&~y.f[e].value.indexOf(a)?"checked":""}>`);-1===r&&(i=l),-1===r&&n&&(a=n);const c=y.f[e].rangeTitles,d=c&&c[a]&&c[a][2],h=this._getFieldValueFromRangeTitles(a,e),u=d&&!0===d.nowrap?`<span class="tv-control-checkbox__label--nowrap">${$.t(h)}</span>`:$.t(h),p=$(`<div class="tv-dropdown-behavior__item js-item-wrap${-1===r?"-any":""}">`).appendTo(t);$(`<label data-field="${e}" class="tv-control-select__option-wrap ${s}__dropdown-checkbox-item">`).append(l).append(`<span class="tv-control-checkbox__label">${u}</span>`).appendTo(p),l.tvControlCheckbox()}return i}_createMultiSelectItemsElement(e,t,i,s,n=!1,o=(()=>{}),r=!1,a){const l={changed:!1,resetOptions:null};let c=$(),d=$();const h="forex-group"===i.attr("data-select-name"),u=i=>{const s=!t.find(".js-filter-checkbox:checked").size();r?c&&c.prop("checked",!0):d.prop("checked",s),n&&this._highlightActiveItems(t),i||this._resetField(e),this._model.update(),l.changed=!i,o(t,s)};let p=$();return l.resetOptions=i=>{t.empty(),d=this._createMultiSelectItems(e,t,r?null:d,s,a),!0!==i&&(this._tryExecuteFilterChangeHandler(e),u(!0)),p=$()},l.resetOptions(),t.on("change",".js-filter-checkbox",s=>{const o=$(s.target),a=o.attr("name");if(n&&y.f[e].value===a)return o.prop("checked",!0),void this._closeDropdown(i);c=$(),o.prop("checked")?(y.f[e].value?n?(t.find(".js-filter-checkbox").not(o).prop("checked",!1),y.f[e].value=a):(Array.isArray(y.f[e].value)||(y.f[e].value=[y.f[e].value]),y.f[e].value.push(a)):y.f[e].value=a,h&&Object(W.e)(new Ve("added",a))):(Array.isArray(y.f[e].value)?(y.f[e].value.splice(y.f[e].value.indexOf(a),1),1===y.f[e].value.length?y.f[e].value=y.f[e].value[0]:y.f[e].value.length||(r?(c=o,y.f[e].value=a):y.f[e].value=null)):r?(c=o,y.f[e].value=a):y.f[e].value=null,h&&Object(W.e)(new Ve("removed",a))),this._tryExecuteFilterChangeHandler(e),u(),n&&this._closeDropdown(i)}),r||t.on("click touchend",".js-filter-checkbox-any",s=>{const o=$(s.target).attr("name");s.preventDefault(),setTimeout(()=>{if(!y.f[e].value)return d.prop("checked",!0),void this._closeDropdown(i);d.prop("checked")?(p.prop("checked",!0),y.f[e].value=p.toArray().map(e=>e.name),y.f[e].value.length?1===y.f[e].value.length&&(y.f[e].value=y.f[e].value[0]):y.f[e].value=null):(p=t.find(".js-filter-checkbox:checked"),t.find(".js-filter-checkbox").prop("checked",!1),y.f[e].value=null,h&&Object(W.e)(new Ve("added",o))),this._tryExecuteFilterChangeHandler(e),u(),n&&this._closeDropdown(i)},0)}),l}_tryExecuteFilterChangeHandler(e){y.f[e].onFilterChange&&y.f[e].onFilterChange(y.f[e].value)}_createMultiselectFilter(e,t,s,n,o=!1){
const r=$(`<div class="${n}__selectbox-container js-filter-field-${e.replace(/\W/g,"")} js-dropdown-toggle">`).appendTo(t),a=$(`<i class="${n}__selectbox-dropdown-toggle">`).append($(i("h1Xg")).attr({width:12,height:7})),l=$(`<span class="${n}__selectbox-caption ${n}__selectbox-caption--text-overflow">\n\t\t\t<span class="${n}__selectbox-caption-label js-label"></span>\n\t\t</span>`).append(a).appendTo(r),c=l.find(".js-label"),d=$('<div class="tv-dropdown__body tv-dropdown-behavior__body">');let h=$();if((y.f[e].useDefaultRange?y.f[e].defaultRange:y.f[e].range).length>=16){const e=$(`<div class="${n}__search-wrap">`).appendTo(d);h=$(`<input type="text" placeholder="${$.t("Search")}" class="${n}__search-input">`).appendTo(e);const t=$(`<div class="tv-control-select__option-wrap ${n}__search-no-matches js-hidden">No matches</div>`).appendTo(d);h.on("change input",e=>{const i=h.val().trim().toLowerCase();i?p.find(".js-item-wrap").each((function(){const e=$(this);e.toggleClass("js-hidden",!~e.text().toLowerCase().indexOf(i))})):p.find(".js-item-wrap").removeClass("js-hidden"),p.find(".js-item-wrap-any").toggleClass("js-hidden",!!p.find(".js-item-wrap.js-hidden").size()),t.toggleClass("js-hidden",!!p.find(".js-item-wrap:not(.js-hidden)").size()),r.tvDropdown("updateScroll")})}const u=$('<div class="tv-dropdown-behavior__scroll">').appendTo(d),p=$('<div class="tv-screener-fields-popup__items-wrap tv-dropdown-behavior__inscroll">').appendTo(u),_=this._createMultiSelectItemsElement(e,p,r,n,o,()=>{c.empty(),p.find(".js-filter-checkbox:checked, .js-filter-checkbox-any:checked").each((t,i)=>{c.append($('<span class="tv-screener-dialog__filter-field-content-value">').text(window.t(this._getFieldValueFromRangeTitles($(i).attr("name"),e))))}),r.focus()},y.f[e].noAny),f=e=>{if(!0!==e&&!r.is(".i-opened"))return;const t=r.closest(".i-scrollable");if(t.size()&&(r.offset().top+r.height()<t.offset().top||r.offset().top>t.offset().top+t.height()))return void r.tvDropdown("close");const i=s.offset(),n=r.offset();let o=$(window).height()-n.top+$(window).scrollTop()-35;h.size()&&(o-=45);const a=Math.max(s.height()-(n.top-i.top),60);if(u.css("maxHeight",Math.min(a,o)),this._setDropdownPosition(d,r,s),d.parent().is(s)){const e=r.tvDropdown("getInstance").scroll;e.updateScrollBar(),e.updateScroll()}else d.appendTo(s)};let g;r.tvDropdown({$wrap:l,$body:d,scroll:!0,closeWithEsc:!0,noAnimation:!0}).on("resetPosition",f).on("beforeOpenMenu",()=>{_.changed&&(_.resetOptions(!0),_.changed=!1),f(!0),o&&(p.find(".tv-control-checkbox__box, .js-filter-checkbox, .js-filter-checkbox-any").hide(),this._highlightActiveItems(p),p.find(".tv-control-checkbox__label").css("margin-right",0)),a.addClass(n+"__selectbox-dropdown-toggle--open")}).on("afterOpenMenu",()=>{g=p.find(".js-filter-checkbox:checked"),h.size()&&setTimeout(()=>{h.focus().on("focusout",(function(){h.focus(),setTimeout((function(){h.focus()}),10)})),h.add(".tv-screener-inplace-editor__dropdown-checkbox-item").on("keypress keyup",e=>{e.keyCode===re.ESC&&this._closeDropdown(r)})},0)
}).on("beforeCloseMenu",()=>{a.removeClass(n+"__selectbox-dropdown-toggle--open"),h.off("focusout keypress keyup")}).on("afterCloseMenu",()=>{r.tvDropdown("updateScroll"),d.detach();const t=p.find(".js-filter-checkbox:checked"),i="tv-screener-dialog"===n?"filter_dialog":"columns",s=Array.from(t).map(e=>e.name).join(",");s!==Array.from(g).map(e=>e.name).join(",")&&Object(W.e)(new ze.b(s,"clicked",e,i))}).on("reset",_.resetOptions).on("mousedownoutside",()=>{r.tvDropdown("close")}),d.on("mousedown touchstart",e=>e.stopPropagation())}_applySelectbox(e,t,s={}){const n=s.classPrefix||"tv-screener-dialog",o=$(`<label class="${n}__selectbox-container js-dropdown-toggle">`);s.addClass&&o.addClass(s.addClass),o.insertAfter(e),e.appendTo(o);const r=$(`<i class="${n}__selectbox-dropdown-toggle">`).append($(i("h1Xg")).attr({width:12,height:7})),a=$(`<span class="${n}__selectbox-caption">\n\t\t\t<span class="${n}__selectbox-caption-label js-label"></span>\n\t\t</span>`).append(r).appendTo(o),l=$('<div class="tv-dropdown__body tv-dropdown-behavior__body">'),c=$('<div class="tv-dropdown-behavior__scroll">').appendTo(l),d=$('<div class="tv-screener-fields-popup__items-wrap tv-dropdown-behavior__inscroll">').appendTo(c),h=()=>{l.find(".js-option-selected").removeClass("i-active js-option-selected");const t=l.find(`[data-value="${e.val()}"]`),i=!t.data("value");t.addClass("i-active js-option-selected").toggleClass(n+"__selectbox-option--no-value",i),a.find(".js-label").toggleClass(n+"__selectbox-caption--no-value",i).text(t.text())},u=()=>{d.empty();const t=e.get(0).childNodes;for(let e=0;e<t.length;++e)$(`<span data-value="${t[e].value}" class="tv-dropdown-behavior__item tv-control-select__option js-option">\n\t\t\t\t\t<span class="tv-control-select__option-wrap ${n}__selectbox-option-wrap">${t[e].textContent}</span>\n\t\t\t\t</span>`).appendTo(d);h()};u(),e.on("change",h);const p=e=>{if(!0!==e&&!o.is(".i-opened"))return;const i=o.closest(".i-scrollable");if(i.size()&&(o.offset().top+o.height()<i.offset().top||o.offset().top>i.offset().top+i.height()))return void o.tvDropdown("close");const s=t.offset(),n=o.offset(),r=Math.max(t.height()-(n.top-s.top),60),a=$(window).height()-n.top+$(window).scrollTop()-35;c.css("maxHeight",Math.min(r,a)),this._setDropdownPosition(l,o,t),l.appendTo(t)};return o.on("resetPosition",p).on("beforeOpenMenu",()=>{p(!0),r.addClass(n+"__selectbox-dropdown-toggle--open")}).on("beforeCloseMenu",()=>r.removeClass(n+"__selectbox-dropdown-toggle--open")).on("afterCloseMenu",()=>{o.tvDropdown("updateScroll"),l.detach()}).tvDropdown({$wrap:a,$body:l,scroll:!0,closeWithEsc:!0,noAnimation:!0}),d.on("click",".js-option",t=>{const i=$(t.currentTarget).data("value");e.val()!==i&&(e.val(i),e.trigger("change")),o.tvDropdown("close")}),l.on("mousedown touchstart",e=>e.stopPropagation()),e.on("reset",u),o}_setDropdownPosition(e,t,i){const s=i.offset(),n=t.offset();e.css("top",n.top-s.top-15),
Object(C.isRtl)()?e.css("right",i[0].scrollWidth-(n.left+t.width())+s.left-Object(C.getLTRScrollLeft)(i[0])):e.css("left",n.left-s.left)}_isFilterValueEmpty(e){const t=y.f[e].value;return t&&"condition"===y.f[e].control?""===t.value||null==t.value:!(t&&(!Array.isArray(t)||t.length)&&("object"!=typeof t||Object.keys(t).find(e=>!!t[e])))}addFieldFilter(e,t,o="tv-screener-dialog",r){const a=$('<div class="'+o+"__filter-field js-filter-field js-filter-field-"+e.replace(/\W/g,"")+" "+o+"__filter-field--cat"+y.f[e].category+' js-wrap">'),l=!this._isFilterValueEmpty(e);if(l){const e=t.find(".tv-screener-dialog__filter-field--active");e.length>0?a.insertAfter(e.last()):t.prepend(a)}else a.appendTo(t);r&&(l?t.removeClass("tv-screener-inplace-editor__without-reset"):(a.addClass("tv-screener-inplace-editor__filter-without-reset"),t.addClass("tv-screener-inplace-editor__without-reset")));let c=y.f[e].filterTitle||y.f[e].title;"toggle"===y.f[e].control&&(c=$.t("New {0}").format(c)),$(`<div class="${o}__filter-field-title js-filter-field-title-${e.replace(/\W/g,"")}">${$.t(c)}</div>`).appendTo(a),this.setFieldActive(e,l,a);const d=$(`<div class="${o}__filter-field-content ${o}__filter-field-content--${y.f[e].control} js-filter-field-_content">`).appendTo(a);return $(`<div class="${o}__filter-field-reset ${l||!r?"":"i-hidden "}apply-common-tooltip js-reset" data-field="${e}" title="${$.t("Reset")}">`).append($(i("9aS1"))).appendTo(a),new Promise(t=>{setTimeout(()=>{if("select"===y.f[e].control)this._createMultiselectFilter(e,d,r?this._bridge.$body:this._dialog.$dialogContainer,o,y.f[e].isSingle);else if("range"===y.f[e].control){const t={range:!0};let i=y.f[e].range[0],s=y.f[e].range[1];y.f[e].values?(t.min=0,t.max=y.f[e].values.length+1,y.f[e].value&&Array.isArray(y.f[e].value)?(t.values=this.approximateSliderValues(e,y.f[e].value),i=this._rangeLeftValue(e),s=this._rangeRightValue(e)):(t.values=[0,y.f[e].values.length+1],i=this._rangeMinValue(e),s=this._rangeMaxValue(e))):(t.min=y.f[e].range[0],t.max=y.f[e].range[1],t.values=y.f[e].value||[y.f[e].range[0],y.f[e].range[1]]),$(`<div class="tv-slider" data-field="${e}">\n\t\t\t\t\t\t<div class="tv-slider__labels">\n\t\t\t\t\t\t\t<input type="text" data-field="${e}" data-bound="0" class="tv-slider__label tv-slider__label--left" value="${i}"/>\n\t\t\t\t\t\t\t<input type="text" data-field="${e}" data-bound="1" class="tv-slider__label tv-slider__label--right" value="${s}"/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>`).slider(t).appendTo(d)}else if("condition"===y.f[e].control){const t=$(`<select name="${e}" class="js-filter-operator js-hidden">`).appendTo(d);let i,s=!0;for(const n in Ye)y.f[e].hiddenOperators&&-1!==y.f[e].hiddenOperators.indexOf(n)||(s&&!y.f[e].value&&(s=!1,y.f[e].value={operator:n}),$(`<option value="${n}"${n===(y.f[e].value&&y.f[e].value.operator)?" selected":""}>${Ye[n]}</option>`).appendTo(t));this._applySelectbox(t,r?this._bridge.$body:this._dialog.$dialogContainer,{classPrefix:o,addClass:o+"__filter-field-content--left"}),
i=y.f[e].conditionFields?Array.isArray(y.f[e].conditionFields)?y.f[e].conditionFields:y.f[e].conditionFields[this._model.screener_type]||y.f[e].conditionFields.default||Je:Je;const a=$(`<select name="${e}" class="js-filter-operator-value js-hidden">`).appendTo(d);let l;if($(`<option value="">${$.t("Value")}</option>`).appendTo(a),0===i.length)l=$(`<label class="${o}__selectbox-container js-dropdown-toggle ${o}__filter-field-content--middle js-hidden" tabindex="0">\n\t\t\t\t\t\t\t<span class="${o}__selectbox-caption-label js-label ${o}__selectbox-caption--no-value">${$.t("Value")}</span>\n\t\t\t\t\t\t</label>`).appendTo(d);else{for(let t=0;t<i.length;++t){const s=i[t];$(`<option value="${s}"${s===(y.f[e].value&&y.f[e].value.operator&&y.f[e].value.value)?" selected":""}>${y.f[s].title}</option>`).appendTo(a)}l=this._applySelectbox(a,r?this._bridge.$body:this._dialog.$dialogContainer,{classPrefix:o,addClass:o+"__filter-field-content--middle js-hidden"})}const c=$(`<input type="text" name="${e}" class="${o}__filter-field-content--right ${o}__filter-field-text js-filter-operator-arb-value">`).appendTo(d);y.f[e].value&&"number"==typeof y.f[e].value.value&&c.val(""+y.f[e].value.value);const h=e=>{e.ctrlKey||e.metaKey||!e.charCode||!e.which||e.which<32||/[\d.-]/.test(String.fromCharCode(e.charCode))||e.preventDefault()},u=e=>{const t={value:e.val()};return e.on("keypress",h).on("change input",Object(n.default)(i=>{e.val()!==t.value&&(e.trigger("update",i),t.value=e.val())},500)),t},p=$(`<input type="text" name="${e}" class="${o}__filter-field-content--right ${o}__filter-between-input js-filter-operator-between-left js-hidden">`).appendTo(d);!y.f[e].value||"in_range"!==y.f[e].value.operator&&"not_in_range"!==y.f[e].value.operator||p.val(""+(-1e100===y.f[e].value.value[0]||this._isLessThenMin(y.f[e].value.value[0],e)?"":y.f[e].value.value[0]));const _=u(p),f=$(`<span class="${o}__filter-between-separator js-hidden">â</span>`).appendTo(d),g=$(`<input type="text" name="${e}" class="${o}__filter-field-content--right ${o}__filter-between-input js-filter-operator-between-right js-hidden">`).appendTo(d);!y.f[e].value||"in_range"!==y.f[e].value.operator&&"not_in_range"!==y.f[e].value.operator||g.val(""+(1e100===y.f[e].value.value[1]||this._isGreaterThenMax(y.f[e].value.value[1],e)?"":y.f[e].value.value[1]));const v=u(g),m=u(c),b=()=>{const e=t.val(),i=e&&"in_range"!==e&&"not_in_range"!==e;l.toggleClass("js-hidden",!i),i||(m.value="",c.val(""),a.val("").trigger("change"))},w=e=>{const i=t.val(),s=i&&"in_range"!==i&&"not_in_range"!==i&&!a.val();c.toggleClass("js-hidden",!s),s&&!0!==e&&!this._resetAllFilters&&setTimeout(()=>{c.focus()},50)},S=e=>{const i="in_range"===t.val()||"not_in_range"===t.val();p.toggleClass("js-hidden",!i),f.toggleClass("js-hidden",!i),g.toggleClass("js-hidden",!i),i&&!0!==e&&!this._resetAllFilters&&setTimeout(()=>{p.focus()},50),i||!0===e||(_.value="",v.value="",p.val(""),g.val(""),a.val("").trigger("change"))};"in_range"===t.val()||"not_in_range"===t.val()?S(!0):b(),w(!0),
t.on("change",b).on("change",w).on("change",S),a.on("change",w)}else if("toggle"===y.f[e].control){$(`<label class="${o}__filter-toggle">\n\t\t\t\t\t\t<input type="checkbox" name="${e}" class="${o}__filter-dropdown-item-input tv-screener-filter-rollup__item-input js-filter-toggle" ${y.f[e].value?"checked":""}>\n\t\t\t\t\t\t<span class="${o}__filter-toggle-checkbox-title tv-control-checkbox__label">\n\t\t\t\t\t\t\t${-1!==e.toLowerCase().indexOf("high")?$.t("New High"):$.t("New Low")}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</label>`).appendTo(d).find(".js-filter-toggle").tvControlCheckbox()}t()},r?0:s.dur/3.5)})}showInplaceEditor(e,t){if(!y.f[e])return;this._inplaceEditorField=e,this.$inplaceEditorTarget=t,this.$inplaceEditor||(this.$inplaceEditor=$('<div class="tv-screener-inplace-editor tv-screener-inplace-editor--hidden">').on("mousedownoutside",e=>{const t=y.f[this._inplaceEditorField];"condition"===t.control&&t.value&&(Object(y.l)(t.value.value)||Object(y.l)(t.value.operator))&&(this.$inplaceEditor.hasClass("js-hidden")||(t.value=null));const i=this.$inplaceEditor.find(".js-dropdown-toggle.i-opened");i.size()?i.one("afterCloseMenu",()=>{this.$inplaceEditor.addClass("tv-screener-inplace-editor--hidden js-hidden")}):this.$inplaceEditor.addClass("tv-screener-inplace-editor--hidden js-hidden")}).on("keypress keyup",e=>{e.keyCode!==re.ESC||$(".tv-dropdown__body.i-opened").length||this.$inplaceEditor.trigger("mousedownoutside")}).attr("tabIndex","0").appendTo(this._bridge.$body),this._bridge.standalone&&(this.$inplaceEditor.addClass("tv-screener-inplace-editor--standalone"),$(document).on("scroll",()=>{this.$inplaceEditor.is(".js-hidden")||this.$inplaceEditor.css("top",this.$inplaceEditorTarget.offset().top-this._bridge.$body.offset().top)}))),this.$inplaceEditor.empty().removeClass("tv-screener-inplace-editor__without-reset").removeClass("js-hidden").toggleClass("tv-screener-inplace-editor--slim","toggle"===y.f[e].control).toggleClass("tv-screener-inplace-editor--wide","condition"===y.f[e].control),this.addFieldFilter(e,this.$inplaceEditor,"tv-screener-inplace-editor",!0).then(()=>{this.initFilterHandlers(this.$inplaceEditor)});const i=this.$inplaceEditor.find(".js-reset"),s=y.f[e].inplaceEditorLeftOffset||0,n=this._getInplaceEditorBound(),o=t.position().left;if(this.$inplaceEditor.css("top",t.offset().top-this._bridge.$body.offset().top),Object(C.isRtl)()){const e=o+t.width(),r=s+Math.min(this.$content.width()-e,n)-i.width();this.$inplaceEditor.css("right",Math.max(r,0))}else this.$inplaceEditor.css("left",Math.max(s+Math.min(o,n)-i.width(),0));this.$inplaceEditor.removeClass("tv-screener-inplace-editor--hidden").focus(),this._model.trackEvent("Open inplace editor")}_getInplaceEditorBound(){let e=this._bridge.$body.width()-this.$inplaceEditor.outerWidth()+$(document).scrollLeft();if(this._bridge.standalone){const t=this._getResizerBridgeWidth(),i=this._table.$element.width()+t
;$(window).width()<i&&(e=Object(C.isRtl)()?$(window).width()-t-this.$inplaceEditor.outerWidth()-$(document).scrollLeft():$(window).width()-t-this.$inplaceEditor.outerWidth()+$(document).scrollLeft())}return e}setFilterSet(e){const t=this._model.getFilterSetById(e);this.$filterSetsButton.removeClass("tv-screener-toolbar__button--unsaved").attr("data-filter-set",e),this.$filterSetsButtonTitle.text(t.title),this._popups.$filterSetsPopup&&(this._popups.$filterSetsPopup.find(".tv-screener-popup__item").removeClass("tv-screener-popup__item--active"),this._popups.$filterSetsPopup.find(`[data-set="${e}"]`).addClass("tv-screener-popup__item--active"))}setFieldSet(e){const t=this._model.getFieldSetById(e);this.$fieldSetsButton.removeClass("tv-screener-toolbar__button--unsaved").text(t.title).attr("data-field-set",e)}addSelect({$before:e=null,$appendTo:t=null,$dropdownContainer:i=null,beforeMakingSelectPopup:s=(()=>{}),makeSelectPopup:n=(()=>{}),afterMakingSelectPopup:o=(()=>{}),afterSelectPopupAppend:r=(()=>{})}){const a={$dropdownContainer:i};s();const{$wrap:l,$button:c,$dropdownContent:d}=n(a);return o(l,c,d),(e||t)&&(e?l.insertBefore(e):l.appendTo(t),r(l,c,d)),c}updateIntervalButton(e=this._$selectIntervalButton,t=this._model.selectedIntervalId){if(!e)return;const i=Object(E.e)(t);i&&e.html(i.shortTitle);const s=this._model.eodRestriction.value();e.toggleClass("i-hidden",s===R.Widget)}addIntervalSelect({$before:e=null,$appendTo:t=null,$dropdownContainer:i=null}){return this.addSelect({$before:e,$appendTo:t,$dropdownContainer:i,makeSelectPopup:e=>{const t=Object.assign({buttonTitle:$.t("Time Interval")},e);return this._popups.setSelectPopup({wrapClass:"tv-screener-toolbar__interval-select",buttonClass:"tv-screener-toolbar__button tv-screener-toolbar__button--arrow-down tv-screener-toolbar__button--with-state apply-common-tooltip common-tooltip-fixed i-disabled"},t)},afterMakingSelectPopup:(e,t,i)=>{this._popups.setSelectIntervalContent(e,i,e=>{this._model.setSelectedIntervalId(e.id),this.updateIntervalButton(t,e.id),this.updateToolbarButtons(),this.preventHighlightChanges(),this.refresh()})},afterSelectPopupAppend:(e,t)=>{this._model.loadingComplete.subscribe(null,()=>{t.removeClass("i-disabled"),this.updateIntervalButton(t,this._model.selectedIntervalId)},!0)}})}updateGroupsButton(e,t){t.sort((e,t)=>y.f.sector.sourceRange.indexOf(e)>y.f.sector.sourceRange.indexOf(t)?1:-1);for(let i=0;i<t.length;i++){const s=t[i]===Ze?Qe:t[i];e.append($('<span class="tv-screener-dialog__filter-field-content-value">').text(`${s}${i===t.length-1?" "+$.t("Pairs"):""}`))}e.attr("data-groups",t)}addGroupSelect({$before:e=null,$appendTo:t=null,$dropdownContainer:i=null}){return this.addSelect({$before:e,$appendTo:t,$dropdownContainer:i,beforeMakingSelectPopup:()=>{if("forex"===this._model.screener_type){const e=this._model.selectedGroups;-1===e.indexOf(Ze)&&(y.f.sector.value=e)}},makeSelectPopup:e=>{const t={wrapClass:"",
buttonClass:"tv-screener-toolbar__button tv-screener-toolbar__button--space_right tv-screener-toolbar__button--arrow-down tv-screener-toolbar__button--with-state apply-common-tooltip common-tooltip-fixed i-disabled"};"forex"!==this._model.screener_type&&(t.wrapClass+=" i-hidden");const i=Object.assign({buttonTitle:$.t("Groups")},e);return this._popups.setSelectPopup(t,i)},afterMakingSelectPopup:(e,t,i)=>{t.on("click",()=>{i.off("change click touchend"),e.attr({"data-select-name":"forex-group"}),this._createMultiSelectItemsElement("sector",i,e,"tv-screener-inplace-editor",!1,e=>{t.empty();const i=[];e.find(".js-filter-checkbox:checked, .js-filter-checkbox-any:checked").each((e,t)=>{const s=$(t).attr("name");i.push(s)}),this._model.setSelectedGroups(i),this.updateGroupsButton(t,i),this.updateToolbarButtons()},!1,Qe)})},afterSelectPopupAppend:(e,t)=>{this._$groupSelect=e,this._model.loadingComplete.subscribe(null,()=>{t.removeClass("i-disabled"),t.attr({"data-name":"screener-forex-pairs","data-role":"button"}),this.updateGroupsButton(t,this._model.selectedGroups)},!0)}})}updateMarketButton(e,t){e||(e=this._model.market);const i=Object(ie.d)(this._model.screener_type),s=$(".js-screener-market-button");s.attr({"data-name":"screener-markets","data-role":"button","data-market":e}),s.html(i[e].flag?Object(ae.a)(i[e].flag):i[e].icon),s.parent().toggleClass("tv-screener-market-select--hidden","stock"!==this._model.screener_type),t&&t.append(`<span class="tv-screener-market-select__button-title">\n\t\t\t\t${i[e].title}\n\t\t\t</span><span class="tv-caret">`)}addMarketSelect({$before:e=null,$appendTo:t=null,$dropdownContainer:s=null,caption:n=!1,classSuffix:o=null}){if(this._onWidget)return;const r=this.addSelect({$before:e,$appendTo:t,$dropdownContainer:s,makeSelectPopup:()=>{const e={wrapClass:o?"tv-screener-market-select tv-screener-market-select"+o:"tv-screener-market-select",buttonClass:"tv-screener-market-select__button js-screener-market-button apply-common-tooltip common-tooltip-fixed"},{wrapClass:t,buttonClass:i}=e,s=$(`<div class="${t} tv-dropdown tv-dropdown--inline tv-dropdown-behavior">`);return{$wrap:s,$button:$(`<div class="tv-dropdown__button tv-dropdown-behavior__button ${i}" title="${$.t("Markets")}">`).appendTo(s)}}});r.on("click",()=>{const e={title:$.t("Select market"),initialSelectedMarkets:Object(qe.b)(Ue.a,[this._model.market]),autofocus:!0,onSelectComplete:e=>{const t=e.markets[0].value;this.$filterSetsButton.toggleClass("i-disabled",!0),this.$fieldSetsButton.toggleClass("i-disabled",!0),this.$filtersButton.toggleClass("i-disabled",!0),this._model.setMarket(t).then(()=>{this.$filterSetsButton.toggleClass("i-disabled",!1),this.$fieldSetsButton.toggleClass("i-disabled",!1),this.$filtersButton.toggleClass("i-disabled",!1),this.updateMarketButton(t,n&&r||null)}).catch(e=>{e&&Xe.logError(e)}),Object(W.e)(new Le(t))},onClose:()=>{}};var t;t=e,
Promise.all([i.e("vendors"),i.e(0),i.e(1),i.e(7),i.e(11),i.e(22),i.e(28),i.e(29),i.e(55),i.e(59),i.e(122),i.e(465),i.e(10),i.e(17),i.e(30),i.e(54),i.e(109),i.e("screener-market-dialog-impl")]).then(i.bind(null,"4Y4W")).then(e=>e.showScreenerMarketDialog(t))}),this.updateMarketButton(this._model.market,n&&r||null)}refresh(){$.tabvisible&&!this._tempBusy&&(this._data&&(this._prevData=this._data.slice()),this._model.invalidateRequest(),this._model.update(null,!1,!1,!1,!0))}get refreshIntervals(){return this._model.isFastRefresh?st:it}resetRefreshCounter(e){if(clearInterval(this._refreshCounterIntervalId),!0===e)return;let t=this._model.refreshInterval;const i=-1===t||!user.is_pro&&!this._model.isFastRefresh;if(this.$refreshButton&&this.$refreshButton.toggleClass("tv-screener-toolbar__button--with-counter",!i&&!this._model.isFastRefresh).toggleClass("tv-screener-toolbar__button--active",!i),i)return;const s=()=>{if(!this._model.isFastRefresh){const e=t/60|0,i=t%60;this.$refreshCounter.text(`${("00"+e).slice(-2)}:${("00"+i).slice(-2)}`)}t<=0?this.refresh():--t};s(),t>=0&&(this._refreshCounterIntervalId=setInterval(s,1e3))}preventHighlightChanges(){this._preventHighlightChanges=!0}highlightChanges(){if(this._preventHighlightChanges)return void(this._preventHighlightChanges=!1);if(!this._prevData||!this._data||this._model.marketChangeProcess)return;const e={};for(let i=0;i<(this._prevData||[]).length;++i)e[this._prevData[i].s]=this._prevData[i].d;if(delete this._prevData,this._model.isFastRefresh){const t=["bid","ask","close"];for(let i=0;i<this._data.length;++i){const s=this._data[i].s,n=this._data[i].d,o=e[s];if(o){for(let e=0;e<t.length;e++){const i=t[e],r=this._table.fieldsOrder.indexOf(i);if(n[r]!==o[r]){const e=this._table.$tbody[0].querySelector(`tr[data-symbol="${s}"] td[data-field-key="${i}"]`);if(e){e.classList.add("tv-screener-table__cell--highlighted");const t=e.querySelector("span");if(t){const e=n[r]>o[r]?"tv-screener-table__cell--growing":"tv-screener-table__cell--falling";t.classList.add(e)}}}}setTimeout(()=>{this._table.$tbody[0].querySelectorAll(`tr[data-symbol="${s}"] td`).forEach(e=>{const t=e.querySelector("span");t&&t.classList.remove("tv-screener-table__cell--growing","tv-screener-table__cell--falling")})},1e3)}}return}const t=[];for(let i=0;i<this._data.length;++i){const s=this._data[i].s,n=this._data[i].d,o=e[s];if(!o)continue;let r=!1;for(let e=0;e<n.length;++e)if(n[e]!==o[e]){r=!0;break}r&&t.push(s)}t.length&&this._table.$tbody.find(`tr[data-symbol="${t.join('"],tr[data-symbol="')}"]`).addClass("tv-screener-table__result-row--flick")}_createSwitch(e){this.$switch=$('<div class="tv-screener-toolbar__switch">').appendTo(this.$toolbar);const t={modes:e,onChange:e=>this._model.applySwitch(e)};!function(e,t){Se.a.render(be.a.createElement(xe,Object.assign({},t)),e)}(this.$switch[0],t)}get conditionOperators(){return Ye}}var at=i("48P3"),lt=i("wjmC"),ct=i("fgbt"),dt=i("Muja"),ht=i("JWMC"),ut=i("FBuY"),pt=i("+GxX"),_t=i("Kxc7"),ft=i("kSsr"),gt=i("ogJP"),vt=i("e45J"),mt=i("xlbu");class bt{constructor(){
this._localSettings={}}getValue(e,t){return this._localSettings.hasOwnProperty(e)?this._localSettings[e]:t}setValue(e,t){this._localSettings[e]=t}getInt(e,t){return this.getValue(e,t)}setInt(e,t){this.setValue(e,t)}getJSON(e,t){return this.getValue(e,t)}setJSON(e,t){this.setValue(e,t)}remove(e){this._localSettings.hasOwnProperty(e)&&delete this._localSettings[e]}}var wt=i("Vdly"),St=i.n(wt),yt=i("NP3r"),Ct=i("9nb6"),$t=i("WWj8");i.d(t,"ScreenerWidget",(function(){return Rt}));const kt=i("PT1i").linking,xt=i("aIyQ"),It=i("hY0g"),Tt=i("Wt0y"),Et=i("txPx").getLogger("Screener.Widget"),Ot=window.locale||"en";let jt=150;const Ft=e=>y.f[e]&&!0!==y.f[e].disabled&&!0!==y.f[e].hiddenColumn,Bt={forex:"screener-forex",crypto:"screener-crypto",stock:"screener"},Pt=["pricescale","minmov","fractional","minmove2"];class Rt{constructor(e){if(this._bridge=e,this._bridge.onWidget||"big"===this._bridge.table_style?this.settingsSaver=new bt:this.settingsSaver=St.a,this._bridge.page_size&&(jt=this._bridge.page_size),this._bridge.onWidget){let t;if(e.widgetSettings.largeChartUrl){t=e.widgetSettings.largeChartUrl;t.match(/^https?:\/\//)||(t="http://"+t)}if(this.largeChartUrl=t,this.utm=Object(vt.filterUtmInfo)(e.widgetSettings),this.screener_type=e.widgetSettings.screener_type,"crypto_mkt"===this.screener_type){const t="BTC"===e.widgetSettings.displayCurrency?"BTC":"USD";this.switchFilter={left:"name",operation:"match",right:t+"$"},at.b.unshift({id:"crypto_mkt",title:"crypto_mkt",content:{sort_field:"market_cap_calc",sort_direction:"desc",filters:{sector:{operator:"nempty"},market_cap_calc:{operator:"nempty"}}}})}}else this._bridge.standalone?this.screener_type=e.screener_type||"stock":this.screener_type=this.settingsSaver.getValue("screener.selected_type_on_chart","stock");this.settingKey=Bt[this.screener_type]||Bt.stock,this._bridge.onWidget&&this.settingsSaver.setValue(`${Ot}.${this.settingKey}.market`,e.widgetSettings.market,{forceFlush:!0}),this.defaultFieldSets=Object(k.c)({screenerType:this.screener_type,market:this.market,isCompact:this.isServerRender(),subtype:this._screenerSubtype(),isOnWidget:this._bridge.onWidget}),this._bridge.onWidget&&(this._widgetInitColumn=e.widgetSettings.defaultColumn||this.defaultFieldSets[0].id,this._widgetInitScreen=e.widgetSettings.defaultScreen||at.b[0].id),Object(y.d)(this.screener_type,this._screenerSubtype()),"forex"===this.screener_type&&Object(at.a)("forex"),this._bridge.getCurrentFilterSetId=()=>this.currentFilterSetId(),this._bridge.applySymbol=(e,t=!1)=>{if(!0===t||this._bridge.standalone){let t="";const i=Object(Ct.a)(e);t=this._bridge.onWidget&&this.largeChartUrl?Object(de.makeTemplateSymbolUrl)(this.largeChartUrl,i):Object(de.makeSymbolChartUrl)(i,this.utm),window.open(t)}else kt.symbol.setValue(e)},this._bridge.applyFilterSet=(e,t)=>{const i=t&&this.market!==t,s=i||e!==this.currentFilterSetId();let n=i?this.setMarket(t).then(()=>this._view.updateMarketButton()):Promise.resolve();return s&&(n=n.then(()=>this.applyFilterSet(e))),n},this.disabled=new It,this.fieldsOrder=new It,
this._sortField=new It,this._sortDirection=new It,this.eodRestriction=new It(R.None),this._options={},this._initialSortField=e.sort_field||this.settingsSaver.getValue(this.settingKey+".sort_field","market_cap_basic"),this._initialSortDirection=e.sort_direction||this.settingsSaver.getValue(this.settingKey+".sort_direction","desc"),this.update=Object(n.default)(this.updateImpl.bind(this),100),this._sortField.subscribe(e=>{this._view._updateTableSortField(),this.saveFiltersSettings(),delete this._initialSortField}),this._sortDirection.subscribe(e=>{this._view._updateTableSortField(),this.saveFiltersSettings(),delete this._initialSortDirection}),this.scanRequest=null,this.loadingStart=new xt,this.loadingComplete=new xt,this.fieldSetChanged=new xt,this.fieldSetSaved=new xt,this.filterSetChanged=new xt,this.filterSetSaved=new xt,this.filterSetDeleted=new xt,this.maxSafeInteger=Number.MAX_SAFE_INTEGER||Math.pow(2,53)-1,this.minSafeInteger=Number.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),this._tickers=[],"continuous_futures"===this.screener_type&&(this._bridge.open_chart_on_same_tab=!1),this._bridge.hide_controls||this._initXWindowHandlers(),this._view=new rt(e,this);const t=[this._initMarkedSymbols(this._view),this._initAlerts()];!this._bridge._onWidget&&window.pro&&t.push(window.pro.ensureValidShopConf()),Promise.all(t).then(()=>{if(Object(pt.isFeatureEnabled)("screener-maintenance"))return void this._view.showMaintenance();this._view.prepareLayout(),this._initAlertsReset(),this._initAlertToggle();const e=()=>{this._checkCurrentSets(),this._view._selectedPeriodId&&"today"===this._view._selectedPeriodId?(this.applyFieldSetContent(k.b),this._sortField.setValue("name"),this._sortDirection.setValue("asc")):this.applyFieldSet(this._widgetInitColumn||this.currentFieldSetId(),!0),this.applyFilterSet(this._widgetInitScreen||this.currentFilterSetId(),!0),this._updateEodRestriction(),this._bridge.disableStickyHeader?this.updateImpl():this.updateImpl(this._view._setupStickyHeader.bind(this._view))};if(this.isServerRender())this.getMetaInfo(),this.getUserSettings(),e();else{const t=[this.getMetaInfo(),this.getUserSettings()];Promise.all(t).then(e)}window.loginStateChange&&window.loginStateChange.subscribe(null,e=>this.onLoginStateChange(e)),this._bridge.onWidget||i.e("ticket-data").then(i.bind(null,"ZOL7")).then(({SupportTicketData:e})=>{e.setScreener(this)}),Tt.isProd()||(window._exposed_screenerWidget=this),this.isServerRender()&&delete this._bridge.server_data}),Object(W.d)(this)}async _initMarkedSymbols(e){if(!this.hasMarkedSymbols())return;const t=await Promise.all([i.e(215),i.e(62),i.e(197),i.e("marked-symbols")]).then(i.bind(null,"ZmaV")),s=await Promise.all([i.e(215),i.e(62),i.e(197),i.e("marked-symbols")]).then(i.bind(null,"G2US"));new t.MarkableSymbols({symbolsView:e,markerContainerSelector:".tv-screener-table__symbol-addition",activeMarkerClass:"tv-screener-table__marker--active",additionalMarkerClass:"tv-screener-table__marker"}),this._markedSymbolsFilter=new s.MarkedSymbolsFilter({symbolsView:e,
containerSelector:".tv-screener-table__head-left--text",className:"tv-screener-table__head-left--marker",disableSaveState:this._bridge.disableSaveMarkedSymbolsFilter});const n=this._markedSymbolsFilter.getStream();this._tickers=this._markedSymbolsFilter.getSymbolsForScan(),this._markedSymbolsFilter.isActive()&&(this._bridge.server_data=null),n.on(s.FilterEvents.Init,()=>{this._tickers=this._markedSymbolsFilter.getSymbolsForScan()}),n.on(s.FilterEvents.FilterByMarkedSymbols,e=>{this._tickers=e,this._prevScanData=null,this._prevRequestData=null,this.invalidateRequest(),this.update()}),n.on(s.FilterEvents.Disable,()=>{this._tickers=this._initTickers||[],this.invalidateRequest(),this.update()})}async _initAlerts(){if(this._bridge.onWidget)return;const e=await Promise.all([i.e(18),i.e("dialogs-core"),i.e(559),i.e(73),i.e(328),i.e("screeneralerts")]).then(i.bind(null,"H/u5")),t=e.ScreenerAlerts,s=e.ALERT_STATUS;this._alerts=new t(this._bridge,this),this._alerts.currentAlertStateChange.subscribe(null,e=>this._view.setAlertButtonState(e)),this._alerts.alertsUpdated.subscribe(null,()=>this._view.popups.updateFilterSetsPopupAlerts(this._alerts.getFilterSetIdsWithRunningAlerts())),this._alerts.currentAlertLoading.subscribe(null,()=>this._view.setCreateAlertButtonLoading()),this._alerts.alertStarted.subscribe(null,e=>{e===s.NEW?this.trackEvent("New alert"):e===s.RESTART&&this.trackEvent("Restart alert")})}_initAlertsReset(){const e=()=>{window.is_authenticated&&(this._view.setAlertButtonsDisabledState(!0),this._alerts.ready.then(()=>this._view.setAlertButtonsDisabledState(!1)).catch(e=>Et.logError(String(e))))};window.loginStateChange&&window.loginStateChange.subscribe(null,e),e()}_initAlertToggle(){this._view.toggleAlert.subscribe(null,(e,t)=>runOrSignIn(()=>{this._alerts.ready.then(()=>this._alerts.toggleAlert(e||this.currentFilterSetId(),t))}))}_initXWindowHandlers(){this._bridge.onWidget||(this._registerXWindowHandler("screener.market-changed",()=>{Object(at.a)(this.market);let e=this.currentFilterSetId();const t=this.defaultFilterSets.find(t=>t.id===e);if(t&&t.disabled){const t=this.defaultFilterSets.find(e=>!e.disabled);e=t?t.id:""}this.getUserSettings().then(()=>{this.applyFilterSet(e,!0),this._view.updateMarketButton(),this.invalidateRequest(),this.updateImpl()})}),this._registerXWindowHandler("screener.save-field-set",e=>{const t=e.setId;this.getUserSettings().then(()=>{t&&t===this.currentFieldSetId()&&this._view.$fieldSetsButton.text(this.getFieldSetById(t).title)})}),this._registerXWindowHandler("screener.save-filter-set",e=>{const t=e.setId;this.getUserSettings().then(()=>{t&&t===this.currentFilterSetId()&&this._view.$filterSetsButtonTitle.text(this.getFilterSetById(t).title)})}),this._registerXWindowHandler("screener.add-field-set-to-favorites",()=>{this.getUserSettings()}),this._registerXWindowHandler("screener.remove-field-set-from-favorites",()=>{this.getUserSettings()}),this._registerXWindowHandler("screener.apply-field-set",e=>{this.applyFieldSetImpl(e.setId,e.initial,!1),this._view.lastSetId=e.setId}),
this._registerXWindowHandler("screener.apply-filter-set",e=>{this.applyFilterSet(e.setId,e.doNotUpdate,!1)}),this._registerXWindowHandler("screener.change-selected-interval-id",e=>{this._view.updateIntervalButton(null,e.id),this.invalidateRequest(),this.updateImpl()}))}_registerXWindowHandler(e,t){ut.TVXWindowEvents.on(e,e=>{const i=JSON.parse(e);this.settingKey===i.settingKey&&t(i)})}_sendXWindowEvent(e,t){this._bridge.onWidget||"big"===this._bridge.table_style||ut.TVXWindowEvents.emit(e,t)}_checkCurrentSets(){const e=this.currentFieldSetId();e&&!this.getFieldSetById(e)&&this.settingsSaver.remove(this.settingKey+".fieldSetId");const t=this.currentFilterSetId();t&&!this.getFilterSetById(t)&&this.settingsSaver.remove(this.settingKey+".filterSetId")}isServerRender(){return window.initData.screener_metainfo&&window.initData.screener_data&&this._bridge.server_data}updateMetaInfo(e){y.f.index.disabled=!0;const t=Object(ie.b)(this.screener_type),i=Object(ie.b)("stock").america;e.fields.forEach(e=>{if(e.n in y.f){if("index"===e.n)return y.f.index.disabled=!1,y.f.index.sourceRange=e.r,void(y.f.index.range=y.f.index.sourceRange?y.f.index.sourceRange.map(e=>e.name):[]);if(!y.f[e.n].range&&y.f[e.n].useDefaultRange?y.f[e.n].range=y.f[e.n].defaultRange:y.f[e.n].useDefaultRange||(y.f[e.n].range=e.r),y.f[e.n].type=e.t,t[this.market]){const s=t[this.market][e.n]||i[e.n];y.f[e.n].values=s}if(!1===y.f[e.n].sortable)return;"price"===e.t&&(y.f[e.n].additionalColumns?y.f[e.n].additionalColumns=y.f[e.n].additionalColumns.concat(Pt):y.f[e.n].additionalColumns=Pt),"text"===e.t&&(y.f[e.n].range=y.f[e.n].range.sort()),"number"===e.t&&y.f[e.n].range&&!y.f[e.n].useDefaultRange&&(y.f[e.n].range=y.f[e.n].range.map(e=>Math.min(Math.max(e,this.minSafeInteger),this.maxSafeInteger)).sort(this.numericSorter)),y.f[e.n].values&&!y.f[e.n].range&&(y.f[e.n].range=[this.minSafeInteger,this.maxSafeInteger]),y.f[e.n].values&&y.f[e.n].range&&(y.f[e.n].range[0]>y.f[e.n].values[0]&&(y.f[e.n].range[0]=y.f[e.n].values[0]),y.f[e.n].range[1]<y.f[e.n].values[y.f[e.n].values.length-1]&&(y.f[e.n].range[1]=y.f[e.n].values[y.f[e.n].values.length-1])),"range"!==y.f[e.n].control||y.f[e.n].values||y.f[e.n].range||(y.f[e.n].range=[this.minSafeInteger,this.maxSafeInteger],y.f[e.n].values=[this.minSafeInteger,0,this.maxSafeInteger])}else if(-1!==e.n.indexOf("|")){const t=e.n.split("|");y.f[t[0]]||(y.f[t[0]]={}),y.f[t[0]].customResolutions||(y.f[t[0]].customResolutions=[]),y.f[t[0]].customResolutions.push(t[1])}}),Object(at.a)(this.market),this.defaultFilterSets=at.b}getMetaInfo(){return this.isServerRender()?(this.updateMetaInfo(JSON.parse(window.initData.screener_metainfo)),Promise.resolve()):new Promise(e=>{this.loadingStart.fire(),$.ajax({type:"GET",url:this.backendUrl()+"metainfo",success:t=>{this.updateMetaInfo(t),e()},dataType:"json",xhrFields:{withCredentials:!0}}).fail(()=>{Et.logError("Failed to load screener metainfo")}).always(()=>{this.loadingComplete.fire()})})}fieldActive(e){
return!(!y.f[e]||!y.f[e].value||"condition"!==y.f[e].control||"in_range"!==y.f[e].value.operator||2!==y.f[e].value.value.length)||!(!y.f[e]||!y.f[e].value||"condition"===y.f[e].control&&(!y.f[e].value.operator||"number"!=typeof y.f[e].value.value&&!y.f[e].value.value)||"range"===y.f[e].control&&y.f[e].value[0]===y.f[e].range[0]&&y.f[e].value[1]===y.f[e].range[1])}getScannerParams(e,t=!1){let i=null,s=null,n=null,o={};if(e){const t=this.getFilterSetById(e);i=t.content.sort_field,s=t.content.filters||{},n=Object.keys(t.content.filters||{}),o=t.content.options}else n=Object.keys(y.f).filter(e=>this.fieldActive(e)),o=this._options;i||(i=this._sortField.value()||this._initialSortField);const r={filter:[],_groups:[],options:o};if(!0!==t){const e=Object(E.d)(i,this.selectedIntervalId);r.filter.push({left:e,operation:"nempty"})}for(let a=0;a<n.length;++a){const e=n[a];if("condition"===y.f[e].control&&!y.f[e].value)continue;if("name"===e&&Array.isArray(y.f[e].value)){let t=!1;const i=y.f[e].value;for(let e=0;e<i.length;++e)if("nequal"===i[e].operator){t=!0;break}if(t)continue}const o=y.f[e].groupFilter?r._groups:r.filter;let l=Object(y.e)(e,y.f[e].value,s,this.selectedIntervalId);if(e!==i||"nempty"!==l.operation||!0===t)if(l.filter2Flag&&(l.filter2AndPart.length&&(r.filter2||(r.filter2={operator:"and",operands:[]}),r.filter2.operands.push({operation:{operator:"or",operands:l.filter2AndPart.map(e=>({expression:e}))}})),l=l.filter),Array.isArray(l))for(let t=0;t<l.length;++t)o.push(l[t]);else o.push(l)}return this.filterSetChanged.fire(),this.eodRestriction.value()!==R.None&&(r.options.data_restrictions="PREV_BAR"),r}updateImpl(e,t,i,s=!0,n=!1,o=!1){if(t&&this._view.isEndReached())return;if(this._view.table.dragStarted.value())return;if(Object(pt.isFeatureEnabled)("screener-maintenance"))return void this._view._popups.showMaintenanceDialog();const r=this.generateScanRequest(),a=[0,jt];r.range=a.slice(),s?(t&&this._currentItemsRange?(a[0]=this._currentItemsRange[1],a[1]=a[0]+jt,r.range[1]=a[1]):this._view.resetItems(),this._currentItemsRange=a):this._currentItemsRange?r.range[1]=this._currentItemsRange[1]:this._view.resetItems(),!t&&this._prevRequest&&Object(dt.a)(r,this._prevRequest)?"function"==typeof e&&!0===i&&e():(this._prevRequest=Object(gt.clone)(r),"function"==typeof e&&e(),this.scan(r,t,n,o))}generateScanRequest(){let e=this._bridge.types||[];switch(this.screener_type){case"forex":e=["forex"];break;case"sector":e=["sector"];break;case"industry":e=["industry"];break;case"continuous_futures":e=["futures"]}const t=Object.assign({},this.getScannerParams());if(t.symbols={query:{types:e},tickers:this._tickers},t.columns=this.getRequestColumns(),t.sort={sortBy:Object(E.d)(this._sortField.value()||this._initialSortField,this.selectedIntervalId),sortOrder:this._sortDirection.value()||this._initialSortDirection},window.language&&(t.options||(t.options={}),t.options.lang=window.language),this._bridge.onWidget&&"forex"!==this.market){const e=Object(ie.d)(this.screener_type)[this.market]
;e&&e.stocks&&e.stocks.length&&(t.symbols.query.exchanges=e.stocks.map(e=>"NYSE ARCA"===e?"AMEX":e))}if(t._groups.length>0&&(t.symbols.groups=t._groups),delete t._groups,"predefined_filter"===this.currentFilterSetId()){const e=this.getFilterSetById("predefined_filter");if(t.symbols||(t.symbols={}),Object(gt.merge)(t.symbols,e.symbols),e.content&&e.content.filters)for(const[i,s]of Object.entries(e.content.filters))if(Array.isArray(s))for(let e=0;e<s.length;++e){const n=s[e];n.operator&&"nequal"===n.operator&&t.filter.push({left:i,operation:n.operator,right:n.value})}else{let e={};void 0!==s.operator&&void 0!==s.value?e={left:i,operation:s.operator,right:s.value}:void 0!==s&&void 0!==s.operator?e={left:i,operation:s.operator}:void 0!==s&&(e={left:i,operation:"equal",right:s});t.filter.some(t=>Object(dt.a)(e,t))||t.filter.push(e)}}for(let i=0;i<t.columns.length;++i)t.columns[i]=Object(E.d)(t.columns[i],this.selectedIntervalId);if(y.f[this.searchField].searchValue){const e={left:!y.f.description.disabled&&y.f.description.checked?this.searchField+",description":this.searchField,operation:"match",right:y.f[this.searchField].searchValue};t.filter.push(e)}return this._bridge.screener_field_match&&t.filter.push({left:this._bridge.screener_field_match.field,operation:"match",right:this._bridge.screener_field_match.pattern}),this._bridge.hidden_filter&&(this._bridge.hidden_filter.filter&&(t.filter=t.filter.concat(this._bridge.hidden_filter.filter)),this._bridge.hidden_filter.options&&(t.options=Object.assign(t.options||{},this._bridge.hidden_filter.options))),this.switchFilter&&t.filter.push(this.switchFilter),t}getRequestColumns(){return Array.from(new Set([...this.fieldsOrder.value(),...this._view.table.additionalColumns]))}getDownloadData(){const e=this._prevRequest?Object(gt.clone)(this._prevRequest):this.generateScanRequest();delete e.range;const t=this.fieldsOrder.value().slice(0);for(let i=0;i<t.length;++i){const s=t[i];e.columns[i]=Object(E.d)(s,this.selectedIntervalId)}return new Promise(t=>{this._sendScanRequest(JSON.stringify(e),e=>{t(JSON.parse(e))})})}scan(e,t,i,s=!1){if(!s&&this._bridge.visible&&!0!==this._bridge.visible.value())return;const n=JSON.stringify(e);this.loading=!0,this.loadingStart.fire(t&&!i);const o=Date.now(),r=function(e){const t=e.map((e,t)=>[e,t]);return new Map(t)}(e.columns),a=(t,i)=>{this.loading=!1;const s=Date.now()-o,n=JSON.parse(t);this._shouldRerender(t,e)&&(this._view.display(n,r,i),this._prevScanData=t,this._prevRequestData=Object(gt.clone)(e)),this.isServerRender()&&n.request&&(n.request.symbols&&n.request.symbols.tickers&&(this._initTickers=n.request.symbols.tickers,this._tickers=this._initTickers),this._options=n.request.options),this.loadingComplete.fire();if(null!==location.pathname.match(/earnings\/{0,1}$/i)&&!this.isServerRender()){const e="error"===i?"error":"ok",t=void 0!==n.status&&0!==n.status?n.status:"error"===e?400:200;mt.telemetry.sendReport("calendars","earnings_http_status",{value:t,additional:{source:"ScreenerWidget"}}),
mt.telemetry.sendReport("calendars","earnings_response_time_frame",{value:s,additional:{source:"ScreenerWidget"}}),mt.telemetry.sendReport("calendars","earnings_"+e)}},l=(e,t)=>{const i=Date.now()-o;this.loading=!1,this._view.display(e,r,t),this.loadingComplete.fire();if(null!==location.pathname.match(/earnings\/{0,1}$/i)&&!this.isServerRender()){const s="error"===t?"error":"ok",n=void 0!==e.status&&0!==e.status?e.status:"error"===s?400:200;mt.telemetry.sendReport("calendars","earnings_http_status",{value:n,additional:{source:"ScreenerWidget"}}),mt.telemetry.sendReport("calendars","earnings_response_time_frame",{value:i,additional:{source:"ScreenerWidget"}}),mt.telemetry.sendReport("calendars","earnings_"+s)}};this.isServerRender()?a(window.initData.screener_data):this._markedSymbolsFilter&&this._markedSymbolsFilter.isActive()&&!this._tickers.length?this._view.display({data:[]},r):(this.scanRequest&&4!==this.scanRequest.readyState&&this.scanRequest.abort(),this.scanRequest=this._sendScanRequest(n,a),this.scanRequest.fail(l),this.trackEvent("Scan request"),window.initData.filter_id&&delete window.initData.filter_id)}preventPrevScanRequest(){this.loading&&this.scanRequest&&(this.scanRequest.abort(),this.scanRequest=null)}_shouldRerender(e,t){return!this._isPrevScanDataEqual(e)||!this._isPrevRequestDataEqual(t)}_isPrevScanDataEqual(e){return this._prevScanData===e}_isPrevRequestDataEqual(e){return Object(dt.a)(e,this._prevRequestData)}isFieldSetChanged(){if(this._bridge.onWidget)return!1;const e=this.currentFieldSetId(),t=e&&this.getFieldSetById(e);if(!e||!t)return!0;const i=t.content.slice().filter(Ft),s=this.fieldsOrder.value().slice().filter(Ft),n=!y.f.type.disabled&&-1!==t.content.indexOf("type")!==y.f.type.checked,o=!y.f.description.disabled&&-1!==t.content.indexOf("description")!==y.f.description.checked;return i.join()!==s.join()||n||o}applyFieldSetContent(e){for(const t in y.f)y.f[t].checked=-1!==e.indexOf(t);this.fieldSetChanged.fire(e.filter(e=>!0!==y.f[e].hiddenColumn))}applyFieldSetImpl(e,t,i=!0){const s=this.getFieldSetById(e),n=s.content.filter(e=>y.f[e]&&!y.f[e].disabled);if(this.applyFieldSetContent(n),t||this.update(),this._view.setFieldSet(e),this.settingsSaver.setValue(this.settingKey+".fieldSetId",s.id,{forceFlush:!0}),this._view.updateFavoritesToolbar(),!t){const t=this.defaultFieldSets.find(t=>t.id===e)?e:"custom";this.trackEvent("Apply field set "+t)}i&&this._sendXWindowEvent("screener.apply-field-set",JSON.stringify({setId:e,initial:t,settingKey:this.settingKey}))}applyFieldSet(e,t,i){t||i||!this.isFieldSetChanged()?this.applyFieldSetImpl(e,t):new Promise(e=>{this._bridge.onWidget?e():this._view._popups.showConfirmDialog($.t("You have unsaved changes in your current column set. Would you like to save them?")).then(t=>{t?this._view.popups.confirmAndSaveCurrentFieldSet().then(e,t=>{t&&Et.logError(t),e()}):e()})}).then(()=>{this.applyFieldSetImpl(e,t)})}isFilterSetChanged(){if(this._bridge.onWidget)return!1;const e=this.currentFilterSetId(),t=e&&this.getFilterSetById(e);if(!e||!t)return!0
;const i=this.currentFilterState(),s={};if(t.content.filters)for(const r of Object.keys(t.content.filters)){const e=t.content.filters[r],i=Object(y.l)(e.operator),n=Object(y.l)(e.value);(i&&n||!i&&!n)&&(s[r]=e)}if(t.content.options&&i.options){if(!!i.options.active_symbols_only!==!!t.content.options.active_symbols_only)return!0}const n=i.filters,o=Object.keys(s).concat(Object.keys(n)).filter((e,t,i)=>i.indexOf(e)===t);for(let r=0;r<o.length;++r){const e=o[r];if(!s.hasOwnProperty(e)||!n.hasOwnProperty(e))return!0;if(Array.isArray(s[e])^Array.isArray(n[e]))return!0;if(Array.isArray(s[e])&&Array.isArray(n[e])&&s[e].sort(this.numericSorter).join()!==n[e].sort(this.numericSorter).join()||!Array.isArray(s[e])&&!Object(dt.a)(s[e],n[e]))return!0}return!!(t.content.sort_direction&&t.content.sort_direction!==i.sort_direction||t.content.sort_field&&t.content.sort_field!==i.sort_field)}currentFilterState(){const e={};for(const t in y.f){const i=y.f[t].value;y.f[t].control&&i&&("object"==typeof i?"condition"===y.f[t].control?Object(y.l)(i.operator)||Object(y.l)(i.value)||(e[t]=i):Object.keys(i).some(e=>!!i[e])&&(e[t]=i):e[t]=i)}return{filters:e,sort_field:this._sortField.value()||this._initialSortField,sort_direction:this._sortDirection.value()||this._initialSortDirection,options:this._options}}saveFieldSet(e,t){return this._view.$fieldSetsButton.toggleClass("i-disabled",!0),e.type="fieldSet",e.screener_type=this.screener_type,this.saveSet(e,t).then(t=>{this._view.$fieldSetsButton.toggleClass("i-disabled",!1);const i=t&&t.id&&""+t.id;return e.delete||this.fieldSetSaved.fire(),this._sendXWindowEvent("screener.save-field-set",JSON.stringify({setId:e.delete?"":i,settingKey:this.settingKey})),this.applyFieldSetImpl(i),t})}saveFilterSet(e,t){return this._view.$filterSetsButton.toggleClass("i-disabled",!0),e.type="filterSet",e.screener_type=this.screener_type,e.market=this.market,this.saveSet(e,t).then(t=>(this._view.$filterSetsButton.toggleClass("i-disabled",!1),e.setId=t&&t.id&&""+t.id,e.delete?this.filterSetDeleted.fire(e.setId):this.filterSetSaved.fire(e.setId,e.market,!!e.content),this._sendXWindowEvent("screener.save-filter-set",JSON.stringify({setId:e.delete?"":e.setId,settingKey:this.settingKey})),this.applyFilterSet(t.id),t))}saveSet(e,t){return Promise.resolve({type:"POST",url:"/screener/save/",data:e}).then($.ajax).then(e=>(e.error?Et.logError(e.error):t&&this.trackEvent(t),this.getUserSettings().then(()=>e)))}_isExchangeRelevant(e){return Array.isArray(e.value)?e.value.every(t=>e.range.includes(t)):e.range.includes(e.value)}applyFilterSet(e,t,i=!0){const s=this.getFilterSetById(e);if(s){s.content.sort_field&&this._sortField.setValue(s.content.sort_field),s.content.sort_direction&&this._sortDirection.setValue(s.content.sort_direction),this._options=Object.assign({},s.content.options);for(const e in y.f)s.content.filters&&e in s.content.filters?("condition"===y.f[e].control&&Array.isArray(s.content.filters[e])&&2===s.content.filters[e].length&&(s.content.filters[e]={operator:"in_range",value:s.content.filters[e]}),
y.f[e].value=Object(gt.clone)(s.content.filters[e]),"condition"===y.f[e].control&&y.f[e].value&&(Object(y.l)(y.f[e].value.value)||Object(y.l)(y.f[e].value.operator))&&(y.f[e].value=null),"exchange"!==e||this._isExchangeRelevant(y.f[e])||(y.f[e].value=null)):!1!==y.f[e].resettableFilter&&(y.f[e].value=null),this._view._resetField(e,!1,!0);this.saveFiltersSettings(),!0===t?(this._view.setFilterSet(e),this.filterSetChanged.fire(e)):this.updateImpl(()=>{this._view.setFilterSet(e),this.filterSetChanged.fire(e)},null,!0),this.settingsSaver.setValue(this.settingKey+".filterSetId",s.id,{forceFlush:!0}),this.trackEvent("Apply filter set"),i&&this._sendXWindowEvent("screener.apply-filter-set",JSON.stringify({setId:e,doNotUpdate:t,settingKey:this.settingKey}))}}saveFiltersSettings(){this.settingsSaver.setValue(this.settingKey+".sort_direction",this._sortDirection.value()||this._initialSortDirection),this.settingsSaver.setValue(this.settingKey+".sort_field",this._sortField.value()||this._initialSortField)}getUserSettings(){const e={filterSets:[],fieldSets:[]};return this.isServerRender()?this.favoriteFieldSets=this.defaultFieldSets.map(e=>e.id):this.favoriteFieldSets=this.settingsSaver.getJSON(this.settingKey+".favoriteFieldSets",this.defaultFieldSets.map(e=>e.id)),window.is_authenticated?new Promise(t=>{$.get("/screener/settings/",{screener_type:this.screener_type}).done(i=>{(i=i||e).filterSets=i.filterSets.map(e=>({id:e.id+"",title:e.title,content:JSON.parse(e.content)})),i.fieldSets=i.fieldSets.map(e=>({id:e.id+"",title:e.title,content:JSON.parse(e.content)})),this.settings=i,t()})}):(this.settings=e,Promise.resolve())}getFieldSetById(e){const t=t=>t.id==e,i=this.defaultFieldSets.find(t)||(this.settings?this.settings.fieldSets.find(t):null);return i?Object.assign({},i,{title:TradingView.clean(i.title,!0)}):null}getFilterSetById(e){if("predefined_filter"===e)return this._bridge.predefined_filter;const t=t=>t.id==e,i=at.b.find(t)||(this.settings?this.settings.filterSets.find(t):null);return i?Object.assign({},i,{title:TradingView.clean(i.title,!0)}):null}addFavoriteFieldSet(e){-1===this.favoriteFieldSets.indexOf(e)&&this.favoriteFieldSets.push(e),this.settingsSaver.setJSON(this.settingKey+".favoriteFieldSets",this.favoriteFieldSets,{forceFlush:!0}),this._view.updateFavoritesToolbar(),this.trackEvent("Add field set to favorites"),this._sendXWindowEvent("screener.add-field-set-to-favorites",JSON.stringify({settingKey:this.settingKey,date:Date.now()}))}removeFavoriteFieldSet(e){this.favoriteFieldSets=this.favoriteFieldSets.filter(t=>t!==e),this.settingsSaver.setJSON(this.settingKey+".favoriteFieldSets",this.favoriteFieldSets,{forceFlush:!0}),this._view.updateFavoritesToolbar(),this._sendXWindowEvent("screener.remove-field-set-from-favorites",JSON.stringify({settingKey:this.settingKey,date:Date.now()}))}currentFieldSetId(){return this.isServerRender()?window.initData.fieldset_id:this.settingsSaver.getValue(this.settingKey+".fieldSetId",this.defaultFieldSets[0].id)}currentFilterSetId(){
const e=at.b.find(e=>e.hasOwnProperty("disabled")&&!e.disabled)||at.b[0];return window.initData.filter_id||this.settingsSaver.getValue(this.settingKey+".filterSetId",e.id)}getCurrentState(){return{requestParams:this._prevRequest||"none",fieldSet:this.currentFieldSetId(),filterSet:this.currentFilterSetId()}}trackEvent(e){Object(ht.trackEvent)("Screener",e,this.market+" "+(this._bridge.standalone?"standalone":"on chart"))}numericSorter(e,t){return e>t?1:-1}invalidateRequest(){delete this._prevRequest}get selectedIntervalId(){if(!this._bridge.hide_controls){if(this.eodRestriction.value()!==R.None)return"1D";const e=this.settingsSaver.getValue(this.settingKey+".interval-id",E.a);return(this._bridge.onWidget||Object(yt.enabled)(L.ProductFeatures.SCREENER_INTERVALS)&&-1!==Object(yt.getConfig)(L.ProductFeatures.SCREENER_INTERVALS).interval.indexOf(e))&&Object(E.e)(e)?e:E.a}}setSelectedIntervalId(e){this.settingsSaver.setValue(this.settingKey+".interval-id",e,{forceFlush:!0}),this._sendXWindowEvent("screener.change-selected-interval-id",JSON.stringify({settingKey:this.settingKey,id:e}));const t=Object(E.e)(e);t&&this.trackEvent("Apply timeframe "+t.id)}get selectedGroups(){return JSON.parse(this.settingsSaver.getValue(Ot+".screener-forex.groups",'["Major","Minor"]')).map(e=>y.m[e]||e)}setSelectedGroups(e){const t=Object.keys(y.m),i=e.map(e=>t.find(t=>y.m[t]===e)||e);this.settingsSaver.setValue(Ot+".screener-forex.groups",JSON.stringify(i),{forceFlush:!0}),this.trackEvent("Change selected groups")}get market(){const e=Object(ie.a)(Ot,this.screener_type),t=this.settingsSaver.getValue(`${Ot}.${this.settingKey}.market`,e),i=Object(ie.b)(this.screener_type);return window.initData.screener_market?window.initData.screener_market:i[t]?t:e}get timezone(){return Object(te.b)(this.market)}_verifyAllSetsChanges(e){return(!0===e?Promise.resolve():new Promise((e,t)=>{this._bridge.onWidget?e():this.isFieldSetChanged()?this._view.popups.showConfirmDialog($.t("You have unsaved changes in your current column set. Would you like to save them?")).then(t=>{t?this._view.popups.confirmAndSaveCurrentFieldSet().then(e,t=>{t&&Et.logError(t),e()}):e()}):e()})).then(()=>!0===e?Promise.resolve():new Promise((e,t)=>{this._bridge.onWidget?e():this.isFilterSetChanged()?this._view.popups.showConfirmDialog($.t("You have unsaved changes in your current filter set. Would you like to save them?")).then(t=>{t?this._view.popups.confirmAndSaveCurrentFilterSet().then(e,t=>{t&&Et.logError(t),e()}):e()}):e()}))}setMarket(e,t,i){return!0!==t&&e===this.market?Promise.reject():(this.settingsSaver.setValue(`${Ot}.${this.settingKey}.market`,e,{forceFlush:!0}),this.trackEvent("Change market"),this._sendXWindowEvent("screener.market-changed",JSON.stringify({settingKey:this.settingKey,date:Date.now()})),this._verifyAllSetsChanges(i).then(()=>this.loadingStart.fire()).then(()=>this.getMetaInfo()).then(()=>{this.defaultFieldSets=Object(k.c)({screenerType:this.screener_type,market:this.market,isCompact:this.isServerRender(),subtype:"",isOnWidget:this._bridge.onWidget})
;let e=this.currentFilterSetId();const t=this.defaultFilterSets.find(t=>t.id===e);if(t&&t.disabled){const t=this.defaultFilterSets.find(e=>!e.disabled);e=t?t.id:""}this.applyFieldSet(this.currentFieldSetId(),!0),this.applyFilterSet(e,!0),this.invalidateRequest(),this._updateEodRestriction(),this.update()}))}_getEodRestrictionType(){if("stock"!==this.screener_type)return R.None;const e=Object(ie.e)(this.market);if(this._bridge.onWidget)return e.every(lt.c)?R.None:R.Widget;if(window.pro&&window.pro.isPro())return R.None;const t=e.map(lt.a),i=t.some(e=>Object(ct.a)(e,!0)),s=!window.is_authenticated;return i&&(s||t.some($t.b))?R.Site:R.None}_updateEodRestriction(){this.eodRestriction.setValue(this._getEodRestrictionType())}changeScreenerType(e){return e===this.screener_type?Promise.reject():(this.trackEvent("Change screener type"),this._verifyAllSetsChanges().then(()=>{this.disabled.setValue(!0),this.marketChangeProcess=!0,this.screener_type=e,this.settingsSaver.setValue("screener.selected_type_on_chart",e,{forceFlush:!0}),this.settingKey=Bt[this.screener_type]||Bt.stock,this.defaultFieldSets=Object(k.c)({screenerType:this.screener_type,market:this.market,isCompact:this.isServerRender(),subtype:"",isOnWidget:this._bridge.onWidget}),Object(y.d)(this.screener_type),Object(at.a)(this.market);const t=this.selectedGroups;y.f.sector.value=Array.isArray(t)&&t[0]===$.t("Any")?null:t}).then(()=>this.loadingStart.fire()).then(()=>this.getMetaInfo()).then(()=>this.getUserSettings()).then(()=>{this._checkCurrentSets(),this.applyFieldSet(this.currentFieldSetId(),!0),this.applyFilterSet(this.currentFilterSetId(),!0)}).then(()=>{let e=this.currentFilterSetId();const t=this.defaultFilterSets.find(t=>t.id===e);if(t&&t.disabled){const t=this.defaultFilterSets.find(e=>!e.disabled);e=t?t.id:""}this.applyFilterSet(e,!0),this.invalidateRequest(),this._updateEodRestriction(),this.updateImpl(void 0,void 0,void 0,void 0,void 0,!0),this.marketChangeProcess=!1,this.loadingComplete.subscribe(null,()=>{this.disabled.setValue(!1)},!0)}))}backendUrl(e){return Object(ft.a)(this.market,e)}onLoginStateChange(e){e||this.getUserSettings().then(()=>this.applyFieldSet(this.currentFieldSetId(),!0)).then(()=>this.setMarket(this.market,!0,!0)).then(()=>this._view.updateMarketButton())}showNoticeIfNoFilters(e){let t;if(e){const i=this.getFilterSetById(e);t=i&&i.content}else t=this.currentFilterState();return(!t||!Object.keys(t.filters||{}).length)&&(this._view.popups.showNotice($.t("Looks like you are trying to set up a screener alert with no saved filters. Please select your preferred filter & save your screen to create an alert."),$.t("The alert can't be enabled")),!0)}bindScrollToBottom(e){const t=()=>{this.loading||this.update(null,!0)},i=()=>{$(window).bind("scrollto",{to:"bottom",tolerance:e},t),this.loadingComplete.unsubscribe(null,i)};this.loadingComplete.subscribe(null,i)}get isFastRefresh(){return["forex","crypto"].includes(this.screener_type)}get refreshInterval(){
return this.isFastRefresh&&!this._bridge.onWidget?this._bridge.hide_controls?1:this.settingsSaver.getInt(this.settingKey+".refreshInterval",1)||1:window.user&&window.user.is_pro&&this.settingsSaver.getInt(this.settingKey+".refreshInterval",-1)||-1}set refreshInterval(e){this.settingsSaver.setValue(this.settingKey+".refreshInterval",e,{forceFlush:!0}),this._view.resetRefreshCounter(),-1!==e&&this.trackEvent("Set refresh interval")}get alerts(){return this._alerts}get view(){return this._view}get searchField(){return"sector"===this.screener_type||"industry"===this.screener_type?"description":"crypto_mkt"===this.screener_type?"sector":"name"}get screenerType(){return this.screener_type}get screenerBridge(){return this._bridge}applySwitch(e){if(delete this._bridge.screener_field_match,"crypto_mkt"===this.screener_type)this.switchFilter={left:"name",operation:"match",right:e+"$"};else if("bonds"===this.screener_type){this.switchFilter={left:"description",operation:"yields"===e?"match":"nmatch",right:"YIELD$"};const t="yields"===e?window.t("Yield",{context:"Bonds"}):window.t("Close");y.f.close.title=t,y.f.close.shortTitle=t,this._view.table.setColumnTitle("close",t)}this.update()}hasMarkedSymbols(){return Object(pt.isFeatureEnabled)("marked_symbols_enabled")&&_t.enabled("marked_symbols")&&!this._bridge.marked_symbols_disabled}_screenerSubtype(){return this._bridge.screener_subtype||""}_sendScanRequest(e,t){return $.ajax({type:"POST",url:this.backendUrl(Object(ft.b)(this.market,this._bridge.onWidget))+"scan",data:e,success:t,dataType:"text",xhrFields:{withCredentials:!Boolean(this._bridge.onWidget)}})}}},Ravv:function(e,t,i){},RwqP:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n}));const s="###";function n(e){return e.startsWith(s)}},Rx1T:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 17" width="16" height="17"><path d="M15.944 3.997L12.29.93l-1.025 1.215 3.654 3.067 1.024-1.215zM4.727 2.147L3.71.93.056 3.99 1.08 5.205l3.647-3.06zm3.67 3.66H7.205v4.768l3.774 2.264.595-.978L8.397 9.98V5.807zM8 2.63a7.15 7.15 0 0 0 0 14.3 7.15 7.15 0 0 0 0-14.3zm0 12.71a5.557 5.557 0 0 1-5.56-5.56A5.557 5.557 0 0 1 8 4.22a5.557 5.557 0 0 1 5.56 5.56A5.557 5.557 0 0 1 8 15.34z"/></svg>'},SL6B:function(e,t,i){},SawH:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 9" width="6" height="9" fill="none"><path stroke="currentColor" d="M1 1l3.5 3.5L1 8"/></svg>'},SuO3:function(e,t,i){"use strict";i.r(t);var s=i("/3z9");class n{constructor(e,t,i){this._searchWidget=e,this._searchResultsElement=t,this._searchResultsPlaceholder=i}handleKeyDown(e,t){const i=Object(s.hashFromEvent)(e);if(27===i)return this._searchWidget.$input.val(""),this._searchWidget.$input.trigger("input"),e.preventDefault(),void e.stopPropagation();if(9===i)return;if(13===i)return e.preventDefault(),void e.stopPropagation();if(!this._shouldHighlight(i))return
;const n=this._searchResultsPlaceholder.querySelector(".tv-pine-reference-toc-item--selected"),o=this._getNextSelectedElementByKey(i,n);null!==o&&this._processSelectedElement(n,o),t&&t(o),e.preventDefault(),e.stopPropagation()}_shouldHighlight(e){return!![40,38].includes(e)&&0!==this._searchResultsPlaceholder.children.length}_processSelectedElement(e,t){if(!e)return void t.scrollIntoView();const i=this._searchResultsElement.getBoundingClientRect(),s=t.getBoundingClientRect();(i.top>s.top||i.bottom<s.bottom)&&t.scrollIntoView()}_getNextSelectedElementByKey(e,t){let i=null;return 40!==e&&9!==e||(i=this._getNextElement(t)),38===e&&(i=this._getNextElement(t,!0)),i}_getNextElement(e,t=!1){if(!e)return this._searchResultsPlaceholder.children[0];const i=this._searchResultsPlaceholder.querySelector(".js-reference-separator"),s=t?e.previousElementSibling:e.nextElementSibling;return s?s!==i?s:t?s.previousElementSibling?s.previousElementSibling:e:s.nextElementSibling?s.nextElementSibling:e:e}}var o=i("b5Gw");class r{constructor(e,t,i){this._searchThrottleTimeout=null,this._searchRequestPromiseCancelable=null,this._tocElementRoot=e,this._referenceRenderer=t,this._searchResultsPlaceholder=i}search(e){this._searchThrottleTimeout&&clearTimeout(this._searchThrottleTimeout),null!==this._searchRequestPromiseCancelable&&(this._searchRequestPromiseCancelable.cancel(),this._searchRequestPromiseCancelable=null);const t=new Promise(t=>{this._searchThrottleTimeout=setTimeout(()=>{this._searchThrottleTimeout=null;const i=this._search(e);t(i)},200)});return this._searchRequestPromiseCancelable=Object(o.makeCancelable)(t),this._searchRequestPromiseCancelable.promise}_search(e){const t=e.trim().toLowerCase();if(t){const{titleMatches:e,textMatches:i}=this._referenceRenderer.searchInDocumentation(t);this._appendMatchesToPlaceholder(e);const s=i.filter(t=>!e.includes(t));if(s.length>0){if(e.length>0){const e=document.createElement("div");e.classList.add("tv-script-reference__separator","js-reference-separator"),this._searchResultsPlaceholder.appendChild(e)}this._appendMatchesToPlaceholder(s)}}return t}_appendMatchesToPlaceholder(e){e.forEach(e=>{const t=this._getTocItemByID(e);if(null!==t){const e=t.cloneNode(!0);e.classList.remove("tv-pine-reference-toc-item--selected"),e.classList.remove("tv-pine-reference-toc-item--scroll-position"),this._searchResultsPlaceholder.appendChild(e)}})}_getTocItemByID(e){return this._tocElementRoot.querySelector(`.tv-pine-reference-toc-item[data-href="${e}"]`)}}i.d(t,"ReferenceController",(function(){return a}));class a{constructor(e){this._previousSearchValue="",this._selectedItemId=null,this._selectedContentItem=null,this._scrollPositionTocItemId=null,this.handleKeydown=e=>new Promise(t=>{this._keydownHandler.handleKeyDown(e,e=>{null!==e&&(this._selectedItemId=e?e.getAttribute("data-href"):null,this._clearSelectedTocItems(),this.selectItem(this._selectedItemId)),this._searchWidget.$input.focus(),t(e)})}),this.handleAnchorItemClick=e=>{const t=e.target;if(t.classList&&t.classList.contains("js-reference")){
e.preventDefault(),e.stopPropagation();const i=t.getAttribute("data-href");this.selectItem(i),this._searchWidget.$input.focus()}},this._container=e.container,this._contentContainerElement=e.contentContainer,this._tocContainerElement=e.tocContainer,this._contentSectionHeaders=e.contentSectionHeaders,this._accordionWidget=e.accordionWidget,this._searchWidget=e.searchWidget,this._searchResultsElement=e.searchResultsElement,this._searchResultsPlaceholder=e.searchResultsPlaceholder,this._keydownHandler=new n(this._searchWidget,this._searchResultsElement,this._searchResultsPlaceholder),this._searchHelper=new r(this._container,e.renderer,this._searchResultsPlaceholder)}getScrolledContentItem(){return this._getContentItemById(this._scrollPositionTocItemId)}getSelectedTocItem(){return this._getTocItemById(this._selectedItemId)}handleContentScroll(e,t=!1){const i=this._contentContainerElement.scrollTop;let s=t,n=this._contentSectionHeaders[0],o=null;const r=this._contentContainerElement.getBoundingClientRect();for(const a of this._contentSectionHeaders)a.getBoundingClientRect().top<r.top&&(n=a);if(n){const e=Array.from(n.nextElementSibling.children);for(const t of e){if(t.firstElementChild.getBoundingClientRect().bottom>r.top+10){o=t;break}}}if(o){const t=this._tocContainerElement.querySelector(`[data-href$="${o.id}"]`);t&&!e&&(this._accordionWidget.makeContentElementVisible(t,s),s=!1,this._markTocElementScrollPosition(o.id))}return{forceScrollToElement:s,scrollPosition:i}}selectItem(e){if(e){if(this._clearSelectedTocItems(),this._selectedContentItem&&this._selectedContentItem.classList.remove("tv-pine-reference-item--selected"),this._selectedContentItem=this._getContentItemById(e),null!==this._selectedContentItem){this._selectedContentItem.classList.add("tv-pine-reference-item--selected");this._selectedContentItem.firstElementChild.scrollIntoView()}this._selectTocItemsById(e),this._selectedItemId=e}}handleSearchInputChange(e){const t=this._searchWidget.$input.val().trim();this._previousSearchValue!==t&&(this._searchResultsPlaceholder.innerHTML="",this._previousSearchValue=t,this._searchHelper.search(t).then(t=>{if(t)this._searchResultsElement.classList.remove("i-hidden"),this._tocContainerElement.classList.add("i-hidden");else{this._searchResultsElement.classList.add("i-hidden"),this._tocContainerElement.classList.remove("i-hidden");const e=this.getSelectedTocItem();null!==e&&this._accordionWidget.makeContentElementVisible(e)}e&&e(t)}))}_markTocElementScrollPosition(e){const t=this._getTocItemById(this._scrollPositionTocItemId);t&&t.classList.remove("tv-pine-reference-toc-item--scroll-position"),this._scrollPositionTocItemId=e;const i=this._getTocItemById(this._scrollPositionTocItemId);i&&i.classList.add("tv-pine-reference-toc-item--scroll-position")}_selectTocItemsById(e){for(const t of this._getTocItemsById(e))t.classList.add("tv-pine-reference-toc-item--selected")}_clearSelectedTocItems(){const e=Array.from(this._container.querySelectorAll(".tv-pine-reference-toc-item--selected"))
;for(const t of e)t.classList.remove("tv-pine-reference-toc-item--selected")}_getTocItemById(e){return null===e?null:this._container.querySelector(`.tv-pine-reference-toc-item[data-href="${e}"]`)}_getTocItemsById(e){return Array.from(this._container.querySelectorAll(`.tv-pine-reference-toc-item[data-href="${e}"]`))}_getContentItemById(e){return null===e?null:this._container.querySelector(`.tv-pine-reference-item[id="${e}"]`)}}},UIZs:function(e,t,i){"use strict";i.r(t),i.d(t,"createSearchControl",(function(){return c}));i("P5fv");var s=i("aIyQ"),n=i.n(s),o=i("Ald9"),r=i("G0+C");i("EulZ");const a='<div class="tv-search-row"><input class="tv-search-row__input js-input-control" type="text" name="q" value="" autocomplete="off" data-role="search"><span class="tv-search-row__input-reset i-hidden js-reset-button">'+o+'</span><span class="tv-search-row__search-icon">'+r+"</span></div>";function l(e,t,i){t.toggleClass("i-hidden",""===e.val()),i.fire(e.val())}function c(e){const t=$(a);e.addClass&&t.addClass(e.addClass),e.withoutControls&&t.addClass("tv-search-row--without-controls");const i=t.find(".js-input-control"),s=t.find(".js-reset-button");e.placeholder&&i.attr("placeholder",e.placeholder),e.dataName&&i.attr("data-name",e.dataName),s[0].addEventListener("click",()=>{i.val("").trigger("input").focus()});const o=new n.a;return i.on("input propertychange",l.bind(null,i,s,o)),l(i,s,o),{$control:t,$input:i,inputChangedDelegate:o}}},VET0:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o}));var s=i("q1tI");const n={bottom:{attachment:{horizontal:"left",vertical:"top"},targetAttachment:{horizontal:"left",vertical:"bottom"}},top:{attachment:{horizontal:"left",vertical:"bottom"},targetAttachment:{horizontal:"left",vertical:"top"}},topRight:{attachment:{horizontal:"right",vertical:"bottom"},targetAttachment:{horizontal:"right",vertical:"top"}},bottomRight:{attachment:{horizontal:"right",vertical:"top"},targetAttachment:{horizontal:"right",vertical:"bottom"}}};function o(e){var t;return(t=class extends s.PureComponent{render(){const{anchor:t="bottom"}=this.props;return s.createElement(e,Object.assign({},this.props,{attachment:n[t].attachment,targetAttachment:n[t].targetAttachment}))}}).displayName="Anchorable Component",t}},VzPW:function(e){
e.exports=JSON.parse('{"NASDAQ":"exchange-nasdaq","NYSE":"exchange-nyse","NYSE ARCA":"exchange-amex","AMEX":"exchange-amex","OTC":"exchange-otc","DFM":"exchange-dfm","BCBA":"exchange-bcba","ASX":"exchange-asx","EURONEXT":"exchange-euronext_stocks","EURONEXTBRU":"exchange-euronext_stocks","EURONEXTPAR":"exchange-euronext_stocks","EURONEXTLIS":"exchange-euronext_stocks","EURONEXTAMS":"exchange-euronext_stocks","BAHRAIN":"exchange-bahrain","BMFBOVESPA":"exchange-bovespa_stocks","TSX":"exchange-tsx","TSXV":"exchange-tsxv","CSE":"exchange-cse","SIX":"exchange-six","BCS":"exchange-bcs","SSE":"exchange-sse","SZSE":"exchange-szse","BVC":"exchange-bvc","FWB":"exchange-fwb","SWB":"exchange-swb","XETR":"exchange-xetr","OMXCOP":"exchange-omxcop","OMXTSE":"exchange-omxtse","EGX":"exchange-egx","BME":"exchange-bme","OMXHEX":"exchange-omxhex","HKEX":"exchange-hkex","IDX":"exchange-idx","TASE":"exchange-tase","BSE":"exchange-bse","NSE":"exchange-nse","OMXICE":"exchange-omxice","MIL":"exchange-mil","MILSEDEX":"exchange-mil","FSE":"exchange-fse","NAG":"exchange-nag","SAPSE":"exchange-sapse","TSE":"exchange-omxtse","KRX":"exchange-krx_stocks","OMXVSE":"exchange-omxvse","OMXRSE":"exchange-omxrse","BMV":"exchange-bmv","MYX":"exchange-myx","NSENG":"exchange-nseng","NZX":"exchange-nzx","BVL":"exchange-bvl","GPW":"exchange-gpw","QSE":"exchange-qse","BELEX":"exchange-belex","MOEX":"exchange-moex_stocks","TADAWUL":"exchange-tadawul","OMXSTO":"exchange-omxsto","SGX":"exchange-sgx_stocks","SET":"exchange-set","BIST":"exchange-bist","TWSE":"exchange-twse","LSE":"exchange-lse","LSIN":"exchange-lsin","HOSE":"exchange-hose_stocks","JSE":"exchange-jse_stocks","OSE":"exchange-osl"}')},W0m6:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19 22" width="19" height="22" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M5 1v9.13a4 4 0 0 1 0 7.75V21a1 1 0 1 1-2 0v-3-.12a4 4 0 0 1 0-7.75V1a1 1 0 0 1 2 0zM2 14a2 2 0 1 1 4 0 2 2 0 0 1-4 0zm12-9.88V1a1 1 0 1 1 2 0v3.12a4 4 0 0 1 0 7.75V21a1 1 0 1 1-2 0v-9.13a4 4 0 0 1 0-7.75zM15 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></svg>'},WK2o:function(e,t,i){"use strict";i.r(t),i.d(t,"copyLinkButtonEvent",(function(){return o}));var s=i("YFKU"),n=i("+6II");function o(e,t){const i=window.location.origin;let o="";if(t&&(o=`/pine-script-reference/v${t}/`),(null==e?void 0:e.target).matches(".js-copy-solution-link-button")){const r=e.target.dataset.id;r&&t&&navigator.clipboard.writeText(`${i}${o}#${r}`).then(()=>{Object(n.showOnElement)(e.target,{tooltipDelay:0,tooltipHideDelay:250,content:{type:"text",data:s.t("Link copied")}}),setTimeout(()=>Object(n.hide)(),1500)})}}},WoKq:function(e,t,i){},X19y:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return o}));var s=i("eF8V");function n(e){return Object(s.a)(e)}function o(e){return`<img alt="${e}" src="${n(e)}" class="tv-flag-country tv-flag-country--${e}">`}},XfUw:function(e,t){
e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M9 2.13l1.903 3.855.116.236.26.038 4.255.618-3.079 3.001-.188.184.044.259.727 4.237-3.805-2L9 12.434l-.233.122-3.805 2.001.727-4.237.044-.26-.188-.183-3.079-3.001 4.255-.618.26-.038.116-.236L9 2.13z"/></svg>'},"Y+b1":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="#ADAEB0" fill-rule="evenodd" d="M12.5 11h-.79l-.28-.27A6.47 6.47 0 0 0 13 6.5 6.5 6.5 0 1 0 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6 0C4.01 11 2 8.99 2 6.5S4.01 2 6.5 2 11 4.01 11 6.5 8.99 11 6.5 11z"/></svg>'},YDhE:function(e,t,i){"use strict";i.r(t),i.d(t,"createDialog",(function(){return o}));var s=i("6aJD"),n=i("tKRU");function o(e){const t=e.type||"popup";return delete e.type,"modal"===t?new s.TVModal(e):new n.a(e)}},YGaR:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 15" width="22" height="15"><g fill="none" fill-rule="evenodd" stroke-width="2"><path stroke="#757575" d="M6.25 5.812L11 10.087l4.75-4.275M11 9.868V.315"/><path stroke="#ADAEB0" d="M21 10v4H1v-4"/></g></svg>'},YYdM:function(e,t,i){"use strict";var s;function n(e){return void 0===e?s.Stock:["forex","crypto"].includes(e)?e:s.Stock}i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return n})),function(e){e.Stock="stock",e.Forex="forex",e.Crypto="crypto",e.CryptoMkt="crypto_mkt"}(s||(s={}))},YaO8:function(e,t,i){},Ze6a:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 10" width="10" height="10"><g fill="none" stroke="#758696" stroke-width="2"><path d="M1.125 9.11L9.13 1.104M1.125 1.105L9.13 9.11"/></g></svg>'},aJjg:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 11 9" width="11" height="9" fill="none"><path stroke-width="2" d="M0.999878 4L3.99988 7L9.99988 1"/></svg>'},aSp3:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M7 5.5a2.5 2.5 0 0 1 5 0V7H7V5.5zM6 7V5.5a3.5 3.5 0 1 1 7 0V7a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9c0-1.1.9-2 2-2zm8 2a1 1 0 0 0-1-1H6a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V9zm-3 2.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/></svg>'},"b6p+":function(e,t,i){},bQ7Y:function(e,t,i){e.exports={button:"button-2Vpz_LXc",hover:"hover-2Vpz_LXc",isInteractive:"isInteractive-2Vpz_LXc",isGrouped:"isGrouped-2Vpz_LXc",isActive:"isActive-2Vpz_LXc",isOpened:"isOpened-2Vpz_LXc",isDisabled:"isDisabled-2Vpz_LXc",text:"text-2Vpz_LXc",icon:"icon-2Vpz_LXc"}},bwY1:function(e,t,i){"use strict";i.r(t),i.d(t,"TvAccordion",(function(){return r}));i("P5fv");var s=i("aIyQ"),n=i.n(s),o=i("sFgq");i("Cfz7");class r{constructor(e,t={collapsible:!0,customScroll:!1}){this._activeIndex=-1,this._clickHandler=this._clickHandler.bind(this),this._sections=[],this._activeIndex=-1,this._options=t
;for(let i=0;i<e.children.length;++i){const t=e.children[i];t.classList.contains("tv-accordion__section-header")&&(this._sections.push({body:t.nextElementSibling,header:t}),t.addEventListener("click",this._clickHandler),t.classList.contains("tv-accordion__section-header--active")&&(this._activeIndex=i))}t.customScroll&&this._sections.forEach(e=>{e.body.classList.add("tv-accordion__section-body--custom-scroll"),e.body.innerHTML='<div style="position: relative">'+e.body.innerHTML+"</div>",e.scroll=new o.SidebarCustomScroll($(e.body),$(e.body.firstElementChild))}),t.collapsible||-1!==this._activeIndex||this.setActiveIndex(0),this.onSectionChange=new n.a}setActiveSectionByHeader(e){this.setActiveIndex(this._sections.findIndex(t=>t.header===e))}setActiveIndex(e){const t=this._activeIndex;if(this._activeIndex!==e&&(this._options.collapsible||!(e<0||e>=this._sections.length))&&(-1!==this._activeIndex&&this._sections[this._activeIndex].header.classList.remove("tv-accordion__section-header--active"),e<0||e>=this._sections.length?this._activeIndex=-1:(this._activeIndex=e,this._sections[this._activeIndex].header.classList.add("tv-accordion__section-header--active")),this._activeIndex!==t&&this.onSectionChange)){if(this._options.customScroll){const e=this._sections[this._activeIndex].scroll;e.atStart()&&e.scrollToStart(),e.resize()}this.onSectionChange.fire(this._activeIndex)}}closeAll(){-1!==this._activeIndex&&(this._sections[this._activeIndex].header.classList.remove("tv-accordion__section-header--active"),this._activeIndex=-1,this.onSectionChange.fire(this._activeIndex))}makeContentElementVisible(e,t=!1){let i=e;for(;!i.classList.contains("tv-accordion__section-body")&&null!==i.parentElement;)i=i.parentElement;if(i&&i.classList.contains("tv-accordion__section-body")&&i.previousElementSibling){const s=i.previousElementSibling;this.setActiveSectionByHeader(s);const n=e.getBoundingClientRect(),o=i.getBoundingClientRect();if(t||o.top>n.top||o.bottom<n.bottom)if(this._options.customScroll){const t=this._sections[this._activeIndex].scroll;t.isTouch()?e.scrollIntoView():t.scrollTo($(e),{areaHeight:e.offsetHeight,offsetTop:e.offsetTop,position:"top"})}else e.scrollIntoView()}}getSections(){return this._sections}getActiveSection(){return-1!==this._activeIndex?this._sections[this._activeIndex]:null}_clickHandler(e){const t=e.currentTarget;-1!==this._activeIndex&&this._sections[this._activeIndex].header===t?this.closeAll():this.setActiveSectionByHeader(t)}}},c5Dt:function(e,t,i){},dSdn:function(e,t,i){},fEjm:function(e,t,i){e.exports={favorite:"favorite-I_fAY9V2",disabled:"disabled-I_fAY9V2",active:"active-I_fAY9V2",checked:"checked-I_fAY9V2"}},fV0y:function(e,t,i){"use strict";var s=i("mrSG"),n=i("q1tI"),o=i("TSYQ"),r=i("0W35"),a=i("vCF3"),l=i("qibD");i("E9Pn");class c extends n.PureComponent{render(){const e=this.props,{inputClassName:t,labelClassName:i}=e,r=Object(s.d)(e,["inputClassName","labelClassName"]),c=o(this.props.className,l.checkbox,{[l.reverse]:Boolean(this.props.labelPositionReverse),
[l.baseline]:Boolean(this.props.labelAlignBaseline)}),d=o(l.label,i,{[l.disabled]:this.props.disabled});let h=null;return this.props.label&&(h=n.createElement("span",{className:d,title:this.props.title},this.props.label)),n.createElement("label",{className:c},n.createElement(a.a,Object.assign({},r,{className:t})),h)}}c.defaultProps={value:"on"};const d=Object(r.b)(c);i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return d}))},"gCS/":function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 973.125"><path d="M960 832L710.875 582.875C746.438 524.812 768 457.155 768 384 768 171.97 596 0 384 0 171.97 0 0 171.97 0 384c0 212 171.97 384 384 384 73.156 0 140.812-21.562 198.875-57L832 960c17.5 17.5 46.5 17.375 64 0l64-64c17.5-17.5 17.5-46.5 0-64zM384 640c-141.375 0-256-114.625-256-256s114.625-256 256-256 256 114.625 256 256-114.625 256-256 256z"/></svg>'},gX54:function(e,t,i){"use strict";i.r(t);var s=i("q1tI"),n=i("i8i4"),o=i("YFKU"),r=i("bU/s"),a=i("TSYQ"),l=i("fV0y"),c=i("tU7i"),d=i("82wv"),h=i("Iivm"),u=i("xADF"),p=i("wHCJ"),_=i("/3z9"),f=i("SawH"),g=i("LTRQ"),v=i("Mhtk"),m=i("nl5w"),b=i("whVV"),w=i("nxQu"),S=i("I1z/");const y=o.t("Expand replace panel"),C=o.t("Find"),$=o.t("Replace"),k=o.t("Replace all"),x=o.t("Match case"),I=o.t("Whole word"),T=o.t("RegExp");class E extends s.PureComponent{constructor(e){super(e),this._searchInputRef=null,this._replaceInputRef=null,this._containerRef=s.createRef(),this._resizerRef=s.createRef(),this._pendingSetFocusFn=null,this.setVisible=(e,t)=>{this.setState({isVisible:e},t)},this.setExpanded=(e,t)=>{this.setState({isExpanded:e},t)},this._onResizeHandleMousedown=e=>{if(e.defaultPrevented||!e.cancelable)return;e.preventDefault();const t=this._containerRef.current?Math.max(this._containerRef.current.clientWidth,376):376;let i;i="touches"in e?e.touches[0].clientX:e.clientX;const s=e=>{let s;e.preventDefault(),s="touches"in e?e.touches[0].clientX:e.clientX;let n=t-(s-i);n<376?n=376:n>660&&(n=660),this._setWidth(n)},n=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("touchmove",s),document.removeEventListener("mouseup",n),document.removeEventListener("touchend",n)};document.addEventListener("mousemove",s),document.addEventListener("touchmove",s,{passive:!1}),document.addEventListener("mouseup",n),document.addEventListener("touchend",n,{passive:!1})},this._handleFocus=()=>{this._updateCounters(this.state,this._getSearchOptions())},this._handleKeydown=e=>{const t=Object(_.hashFromEvent)(e);if(27===t)return this.props.onClose&&this.props.onClose(),void this.props.isVisible.setValue(!1);Object(_.modifiersFromEvent)(e)===_.Modifiers.Mod&&(t===_.Modifiers.Mod+70&&(this._focusSearchInput(),e.preventDefault()),t===_.Modifiers.Mod+72&&(this.setExpanded(!0,this._focusReplaceInput),e.preventDefault()))},this._onFindInputChange=e=>{this.setState({needle:e.currentTarget.value})},this._onFindInputKeyDown=e=>{const t=Object(_.hashFromEvent)(e);38===t&&this._onPrevButtonClick(),40===t&&this._onNextButtonClick(),
13===t&&this.state.needle.length>0&&this._find(this.state)},this._onReplaceInputChange=e=>{this.setState({replacement:e.currentTarget.value})},this._onMatchCaseSettingToggle=()=>{this.setState({matchCase:!this.state.matchCase})},this._onWholeWordSettingToggle=()=>{this.setState({wholeWord:!this.state.wholeWord})},this._onRegExpSettingToggle=()=>{this.setState({regExp:!this.state.regExp})},this._onExpandButtonClick=()=>{this.setState({isExpanded:!this.state.isExpanded})},this._onFilterButtonClick=()=>{this.setState({isFilterMenuOpened:!this.state.isFilterMenuOpened})},this._onPrevButtonClick=()=>{if(this.state.editor.findPrevious(this._getSearchOptions({backwards:!0,skipCurrent:!0})),this.state.totalMatches>0){const e=1===this.state.currentMatch?this.state.totalMatches:this.state.currentMatch-1;this.setState({currentMatch:e})}},this._onNextButtonClick=()=>{if(this.state.editor.findNext(this._getSearchOptions()),this.state.totalMatches>0){const e=this.state.currentMatch===this.state.totalMatches?1:this.state.currentMatch+1;this.setState({currentMatch:e})}},this._onCancelButtonClick=()=>{this.setState({isFilterMenuOpened:!1,isExpanded:!1,matchCase:!1,wholeWord:!1,regExp:!1,needle:"",replacement:"",currentMatch:0,totalMatches:0},()=>{this._cleanMarkers(),this.props.isVisible.setValue(!1)})},this._onReplaceButtonClick=()=>{this.state.needle.length>0&&(this.state.editor.replace(this.state.replacement,this._getSearchOptions()),this._find(this.state))},this._onReplaceAllButtonClick=()=>{if(this.state.needle.length>0){const e=this._getSearchOptions();this.state.editor.replaceAll(this.state.replacement,e),this._updateCounters(this.state,e)}},this.state={width:376,editor:e.editor,isFilterMenuOpened:!1,isVisible:e.isVisible.value(),isExpanded:e.isExpanded.value(),matchCase:!1,wholeWord:!1,regExp:!1,needle:"",replacement:"",currentMatch:0,totalMatches:0}}render(){const e=this.state.wholeWord||this.state.matchCase||this.state.regExp;return this.state.isVisible||(this.props.editor.getSession().$searchHighlight=null),s.createElement("div",{style:{width:this.state.width+"px"},className:a(S.findReplacePanel,!this.state.isVisible&&S.hidden),onKeyDown:this._handleKeydown,ref:this._containerRef},s.createElement("div",{className:S.resizeHandle,ref:this._resizerRef}),s.createElement(h.a,{className:a(S.button,S.expandButton,this.state.isExpanded&&S.expanded,"apply-common-tooltip"),icon:f,title:y,onClick:this._onExpandButtonClick}),s.createElement("div",{className:S.panelContent},s.createElement("div",{className:S.searchSection},s.createElement(p.b,{className:S.findInput,size:"small",type:"text",value:this.state.needle,placeholder:C,endSlot:s.createElement(u.c,null,s.createElement("span",{className:S.selection},this.state.currentMatch+" / "+this.state.totalMatches)),onChange:this._onFindInputChange,onKeyDown:this._onFindInputKeyDown,onFocus:this._handleFocus,reference:e=>this._searchInputRef=e,stretch:!0}),s.createElement("span",{className:S.rightContainer},s.createElement(d.b,{className:a(S.button,S.filterButton,e&&S.filterHighlighted),
arrow:!1,content:s.createElement(c.b,{icon:g}),onOpen:this._onFilterButtonClick},s.createElement("div",{className:S.dropdown},s.createElement("div",{className:S.filterOptions},s.createElement(l.a,{className:S.checkbox,checked:this.state.matchCase,label:x,tabIndex:-1,onChange:this._onMatchCaseSettingToggle}),s.createElement(l.a,{className:S.checkbox,checked:this.state.wholeWord,label:I,tabIndex:-1,onChange:this._onWholeWordSettingToggle}),s.createElement(l.a,{className:S.checkbox,checked:this.state.regExp,label:T,tabIndex:-1,onChange:this._onRegExpSettingToggle})))),s.createElement(c.b,{className:S.button,icon:v,onClick:this._onPrevButtonClick}),s.createElement(c.b,{className:a(S.button,S.nextButton),icon:v,onClick:this._onNextButtonClick}),s.createElement(c.b,{className:S.button,icon:m,onClick:this._onCancelButtonClick}))),s.createElement("div",{className:a(S.replaceSection,!this.state.isExpanded&&S.hidden)},s.createElement(p.b,{className:S.replaceInput,size:"small",type:"text",value:this.state.replacement,placeholder:$,onChange:this._onReplaceInputChange,onFocus:this._handleFocus,reference:e=>this._replaceInputRef=e,stretch:!0}),s.createElement("span",{className:S.rightContainer},s.createElement(c.b,{className:S.button,icon:s.createElement(h.a,{icon:b}),title:$,onClick:this._onReplaceButtonClick}),s.createElement(c.b,{className:S.button,icon:s.createElement(h.a,{icon:w}),title:k,onClick:this._onReplaceAllButtonClick})))))}componentDidMount(){var e,t;this.props.isVisible.subscribe(this.setVisible),this.props.isExpanded.subscribe(this.setExpanded),this.state.isExpanded?this._focusReplaceInput():this._focusSearchInput(),null===(e=this._resizerRef.current)||void 0===e||e.addEventListener("mousedown",this._onResizeHandleMousedown),null===(t=this._resizerRef.current)||void 0===t||t.addEventListener("touchstart",this._onResizeHandleMousedown)}componentWillUnmount(){var e,t;this.props.isExpanded.unsubscribe(this.setExpanded),null===(e=this._resizerRef.current)||void 0===e||e.removeEventListener("mousedown",this._onResizeHandleMousedown),null===(t=this._resizerRef.current)||void 0===t||t.removeEventListener("touchstart",this._onResizeHandleMousedown)}componentDidUpdate(e,t){t.matchCase===this.state.matchCase&&t.wholeWord===this.state.wholeWord&&t.regExp===this.state.regExp&&t.needle===this.state.needle||this._find(this.state),this._pendingSetFocusFn&&(this._pendingSetFocusFn(),this._pendingSetFocusFn=null)}setPanelFocus(e){this._pendingSetFocusFn=this._setPanelFocus.bind(this,e)}_setWidth(e){this.setState({width:e})}_setPanelFocus(e){1===e?this._focusReplaceInput():this._focusSearchInput()}_getSearchOptions(e={}){const t={needle:this.state.needle,caseSensitive:this.state.matchCase,wholeWord:this.state.wholeWord,regExp:this.state.regExp,skipCurrent:!1,backwards:!1};return Object.assign(t,e)}_focusSearchInput(){var e;null===(e=this._searchInputRef)||void 0===e||e.focus()}_focusReplaceInput(){var e;null===(e=this._replaceInputRef)||void 0===e||e.focus()}_updateCounters(e,t){
const i=e.editor.getCursorPosition(),s=e.editor.findAll(e.needle,t);this.setState({currentMatch:s>0?1:0,totalMatches:s>0?s:0}),e.editor.selection.moveTo(i.row,i.column),e.editor.selection.addRange(new r.Range(i.row,0,i.row,0))}_cleanMarkers(){Object.values(this.state.editor.session.getMarkers()).forEach(e=>{!e.clazz||"ace_selection"!==e.clazz&&"ace_selected-word"!==e.clazz||this.state.editor.session.removeMarker(e.id)})}_find(e){if(e.needle.length>0){const t=this._getSearchOptions();this._updateCounters(e,t);const i=e.editor.find(e.needle,t);void 0!==i&&e.editor.selection.addRange(i)}else this._cleanMarkers(),this.setState({currentMatch:0,totalMatches:0})}}i.d(t,"showPanel",(function(){return j})),i.d(t,"focusSearchInputOnUpdate",(function(){return F})),i.d(t,"focusReplaceInputOnUpdate",(function(){return B}));let O=null;function j(e,t){return O=s.createRef(),n.render(s.createElement(E,Object.assign({ref:O},t)),e),O}function F(){var e;null===(e=null==O?void 0:O.current)||void 0===e||e.setPanelFocus(0)}function B(){var e;null===(e=null==O?void 0:O.current)||void 0===e||e.setPanelFocus(1)}},gh0h:function(e,t,i){},h1Xg:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="299 131 12 7" width="12" height="7"><path fill="none" d="M300 132l5 5 5-5"/></svg>'},hFss:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 14" width="25" height="14" style="position:relative;top:3px"><path d="M10.43 8.683L9.345 8.68c-.943-.005-1.712-.774-1.716-1.717-.003-.452.172-.877.49-1.195.32-.32.744-.493 1.196-.492l4.002.016c.83.004 2.22.18 2.225 1.316.002.522.427.943.95.942.52-.002.942-.427.94-.95-.007-1.932-1.62-3.188-4.107-3.198l-4.003-.016c-.96-.003-1.862.368-2.54 1.045-.677.68-1.048 1.58-1.044 2.54.003.99.41 1.887 1.06 2.54.652.65 1.55 1.056 2.54 1.06l1.086.004c.522.002.947-.42.948-.942.002-.52-.42-.946-.942-.947zm13.832-1.655c-.008-2.076-1.41-3.59-3.33-3.597l-1.357-.003c-.522-.002-.947.42-.948.942-.002.52.42.946.94.947l1.356.006c.996.003 1.445.863 1.448 1.714.004.453-.17.878-.49 1.196-.317.32-.742.493-1.195.492l-4.27-.017c-1.952-.008-1.955-.924-1.957-1.315-.002-.522-.426-.943-.948-.942-.523.003-.945.428-.943.95.004.896.296 1.63.834 2.17.66.66 1.69 1.023 3.01 1.028l4.27.017c.96.003 1.86-.368 2.54-1.046.675-.678 1.046-1.58 1.043-2.54z"/></svg>'},ivrk:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 3" width="8" height="3"><path d="M0 3 L4 0 L8 3 Z"/></svg>'},j72q:function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"e",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return h}));var s=i("0UyP"),n=i("7DLB"),o=i("+GxX");let r;function a(e){r=e}function l(e){if(!Object(o.isFeatureEnabled)("screener_snowplow_enabled"))return;let t="",i="";r&&(t=Object(n.a)(r.screenerBridge),i=r.screenerType);(!r||!Object(n.b)(r.screenerBridge))&&Object(s.getTracker)().then(s=>{s&&s.trackScreenerHighLevel(e,i,t)})}function c(e){return 1===e?"auto":-1===e?"manual":""+e}function d(e){
return r.defaultFieldSets.find(t=>t.id===e)?e:"custom"}function h(e){return r.defaultFilterSets.find(t=>t.id===e)?e:"custom"}},kSsr:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var s=i("24R9");const n=Object(s.getUrlParams)().scanner_url||window.SCREENER_HOST||"https://scanner.tradingview.com";function o(e,t=e){return`${n}/${t}/`}function r(e,t){return e}},"n/vg":function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return d}));var s=i("UXvI"),n=(i("SL6B"),i("c5Dt"),i("2iWw"),i("rm87")),o=i("07JU"),r=i("C9Mz"),a=i("j72q");const l={filtersSearch:`<div class="tv-screener-search js-screener-search">\n\t\t<input type="text" class="tv-screener-search__input js-search-input" placeholder="${$.t("Search filter")}">\n\t\t${i("Y+b1")}\n\t\t<div class="tv-screener-search__reset js-search-reset">\n\t\t\t<span class="tv-screener-search__reset-icon">${i("9aS1")}</span>\n\t\t\t${$.t("Reset all")}\n\t\t</div>\n\t</div>`,filtersBody:'<div class="tv-screener-dialog js-screener-dialog">\n\t\t<div class="tv-screener-dialog__wrap js-filters-wrap"></div>\n\t</div>'};var c=[$.t("All"),$.t("Descriptive"),$.t("Fundamental"),$.t("Technical")];class d{constructor(e,t,i){this._model=e,this._view=t,this._bridge=i,this._dialogTitle="screener_filters",this._categories=null}showFiltersDialog(t){return Promise.all([i.e(18),i.e("dialogs-core"),i.e(219),i.e(557),i.e(203),i.e("tabbeddialog")]).then(i.bind(null,"jlOC")).then(({createTabbedDialog:i})=>{this._categories=this._getCategories();const d=this._categories.map(e=>({name:c[e]})),{dialog:h,tabs:u}=i({tabs:d,additionalHeaderContent:l.filtersSearch,width:Math.min(1400,Math.max(646,$(window).width()-200)),height:Math.max(450,$(window).height()-200),contentAddClass:"js-dialog-content",doNotCreatePages:!0,destroyOnClose:!0}),p=h.$content.find(".js-dialog-content"),_=h.$content.find(".js-screener-search");this.$fieldSearchInput=_.find(".js-search-input"),this.$fieldSearchInput.on("input",Object(s.default)(e=>{this._view.updateFilterSearch(),h.updateScroll()},100,{leading:!1,trailing:!0})),this.$fieldSearchInput.on("click",()=>{Object(a.e)(new o.d)});_.find(".js-search-reset").on("click",e=>this._view.resetAllFilters());const f=()=>{const e=this.$filtersPopup.get(0).clientWidth>=1292;e&&!this._$filtersWrap.is(".js-2col")?this._$filtersWrap.addClass("js-2col tv-screener-dialog__wrap--2col"):!e&&this._$filtersWrap.is(".js-2col")&&this._$filtersWrap.removeClass("js-2col tv-screener-dialog__wrap--2col")};this.$filtersPopup=$(l.filtersBody),this._$filtersWrap=this.$filtersPopup.find(".js-filters-wrap");const g=[];this._view.sortedFields.forEach(e=>{n.f[e]&&!n.f[e].disabled&&n.f[e].control&&g.push(this._view.addFieldFilter(e,this._$filtersWrap))}),Promise.all(g).then(()=>this._$filtersWrap.find(".js-wrap").each((e,t)=>{this._view.initFilterHandlers($(t))})),this.$filtersPopup.appendTo(p),t&&this._model.settingsSaver.setValue(this._model.settingKey+".filters.tab",0),u.tabChanged.subscribe(null,e=>{this.filtersDialogTabChanged(e),h.scrollToStart(),
0!==e&&Object(a.e)(new o.a(e))}),this._view.$filtersButton.addClass("js-no-pointer-events"),h.on("scroll",()=>{h.$content.find(".js-dropdown-toggle.i-opened").trigger("resetPosition",null,p.parent())});const v=this._getActiveFilters(!1).sort();h.on("destroy",t=>{const i=this._getActiveFilters(!1).sort();for(const e in n.f)"condition"===n.f[e].control&&n.f[e].value&&(Object(n.l)(n.f[e].value.value)||Object(n.l)(n.f[e].value.operator))&&(n.f[e].value=null);$(".tv-screener-dialog__filter-field").removeClass("js-hidden"),this.$fieldSearchInput.val(""),this.$filtersPopup.remove(),delete this.$filtersPopup,this._view.$filtersButton.removeClass("js-no-pointer-events"),delete this._dialog,$(window).off("resize",f),e.isEqual(v,i)||Object(a.e)(new r.a(i.join(", ")))}),this._model.trackEvent("Open filters dialog"),h.open(),$(window).on("resize",f),f(),this.$dialogContainer=h.$content,this._dialog=h})}filtersDialogTabChanged(e){const t=this._categories.map(e=>"tv-screener-dialog--cat"+e).join(" ");this.$filtersPopup.removeClass(t).addClass("tv-screener-dialog--cat"+this._categories[e]).scrollTop(0)}destroy(){this._dialog&&(this._dialog.close(),delete this._dialog)}_getCategories(){const e=[0];return this._view.sortedFields.forEach(t=>{n.f[t]&&!n.f[t].disabled&&n.f[t].control&&(e.includes(n.f[t].category)||e.push(n.f[t].category))}),e.sort()}_getDefaultFiltersForCurrentFilterSet(){const{defaultFilterSets:e}=this._model,t=this._model.currentFilterSetId();return Object.values(e).filter(e=>e.id===t)[0].content.filters}_fieldValueIsEqualToDefaultFilter(e){const t=this._getDefaultFiltersForCurrentFilterSet()[e],i=n.f[e].value;switch(n.f[e].control){case"condition":return i.operator===t.operator&&i.value.toString()===t.value.toString();case"range":case"select":return i.sort().toString()===t.sort().toString();default:return n.f[e].value===i}}_getActiveFilters(e=!0){const t=[];for(const i in n.f)if(n.f[i].value){if("condition"===n.f[i].control&&(Object(n.l)(n.f[i].value.operator)||Object(n.l)(n.f[i].value.value)))continue;e?t.push(Object(n.i)(n.f[i])):t.push(i)}return t}}}).call(this,i("F/us"))},nZrM:function(e,t,i){},nbyR:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TVPopup=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},n=d(i("9uLv")),o=i("Nkvk"),r=i("KHon"),a=i("sFgq"),l=i("A6WY"),c=d(i("lxNp"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}const h=$("body"),u=$(window),p={closeOnClickAtOtherDialogs:!0,draggable:!0,scrollWrap:'<div class="tv-dialog__scroll-wrap">',scrollWrapInner:'<div class="tv-dialog__scroll-wrap-inner">',withScroll:!0};class _ extends r.TVDialogAbstract{constructor(e={}){super(s({},p,e)),this.$scrollWrap=this.$content.hasClass("js-dialog__scroll-wrap")?this.$content:this.$content.find(".js-dialog__scroll-wrap"),
this.$scrollWrap.length?this.$scrollWrapInner=this.$scrollWrap.children().first():(this.$scrollWrap=this.$content.wrap($(this.options.scrollWrap)).parent(),this.$scrollWrapInner=this.$content.wrap($(this.options.scrollWrapInner)).parent()),this.$actions&&this.$scrollWrap.addClass("i-with-actions"),this.options.withScroll&&(this.scroll=new a.SidebarCustomScroll(this.$scrollWrap,this.$scrollWrapInner),this.scroll.scrolled.subscribe(null,()=>this.trigger("scroll"))),this.$scrollWrap.css("overflow","");const t=this.getDialogId();this.$el.addClass("tv-dialog--popup i-closed i-hidden"),this.options.width&&this.$el.css({width:"calc(100% - 20px)","max-width":this.options.width}),this._hotkeys=c.createGroup({desc:"Dialog",isDisabled:()=>!this.opened,modal:!1}),this.options.closeOnEsc&&this._hotkeys.add({desc:"Close",hotkey:27,handler:()=>this.close()}),this.$el.on("mousedown touchstart",this.toTop.bind(this)),this.options.closeOnOutsideClick&&(this._preventClick=!0,this.on("beforeOpen",()=>{setTimeout(()=>{this.opened&&($(document).on("mousedown touchstart",()=>{this._preventClick=!1}),$(document).on("click.tv-popup-"+t,e=>{if(this._preventClick)return;const t=$(e.target).closest(".js-dialog");(this.options.closeOnClickAtOtherDialogs||0===t.length)&&this.isEventOut(e)&&this.close()}))},0)}),this.on("beforeClose",()=>$(document).off("click.tv-popup-"+t))),this.on("change:zIndex",()=>{this.$el.css("z-index",this.zIndex)}),this.on("destroy",()=>{const e=()=>{this.$el.remove(),this._hotkeys.destroy()};this.opened?(this.close(),setTimeout(e,n.dur/2)):e()})}open(){return this.opened||(this.opened=!0,this.trigger("beforeOpen",[this]),this.$el.appendTo(this.$wrap).removeClass("i-hidden").css((()=>{this.calcHeight();const e=u.height(),t=u.width(),i=this.$el.height(),s=this.$el.width();let n=this.options.position;return n||(n={top:e/2-i/2,left:t/2-s/2}),n.top>e-i&&(n.top=e-i),n.left>t-s&&(n.left=t-s),n.top<10&&(n.top=10),n.left<10&&(n.left=10),n})()),this.focus(),this.toTop(),this._doOpenAnimation().then(()=>{this.opened&&(this.$el.removeClass("i-closed"),this.options.draggable&&((0,l.lazyJqueryUI)(this.$el).draggable({handle:".js-dialog__drag",cancel:"input, textarea, button, select, option, .js-dialog__no-drag, .js-dialog__close",containment:"window",cursor:"-webkit-grabbing",stop:(e,t)=>{this.trigger("dragEnd",[this])}}),this.$el.find(".js-dialog__drag").addClass("tv-dialog__grab")),this.trigger("afterOpen",[this]))}),u.on("resize.tv-popup-"+this.getDialogId(),()=>{this.calcHeight(),this.fixPos()})),this}close(){if(this.opened)return this.trigger("beforeClose",[this]),this.$el.addClass("i-closed"),this.opened=!1,this._doCloseAnimation().then(()=>{this.opened||((0,l.lazyJqueryUI)(this.$el).draggable("instance").then(e=>{e&&e.destroy()}),this.$el.addClass("i-hidden").detach(),h.css("cursor","auto"),this.trigger("afterClose",[this]),this.options.destroyOnClose&&this.destroy())}),u.off("resize.tv-popup-"+this.getDialogId()),this}hide(){this.$el.addClass("i-hidden")}show(){this.$el.removeClass("i-hidden")}fixPos(){
const e=this.$el[0].getBoundingClientRect(),t={};e.bottom>o.mediaState.height-10&&(t.top=o.mediaState.height-10-e.height,t.top<10&&(t.top=10)),e.right>o.mediaState.width-10&&(t.left=o.mediaState.width-10-e.width,t.left<10&&(t.left=10)),(t.top||t.left)&&this.$el.css(t)}calcHeight(){const e=this.$el[0].getBoundingClientRect(),t=this.$scrollWrapInner[0].getBoundingClientRect(),i=this.$scrollWrap[0].getBoundingClientRect();let s=this.options.height&&this.options.height<o.mediaState.height-20?this.options.height:o.mediaState.height-20;this.$scrollWrap.css({height:""}).removeClass("i-scrollable");const n=this.$el[0].getBoundingClientRect();(this.options.height||n.height>s)&&(s-=e.height-i.height,s<60&&(s=60),this.$scrollWrap.css({height:s})),this.options.withScroll&&this.scroll.resize();const r=s<t.height;r||this.$scrollWrapInner.css("top",0),this.$scrollWrap.toggleClass("i-scrollable",r),this.$actions&&this.$actions.toggleClass("tv-dialog__section--actions_with-border",r)}updateScroll(){this.scroll&&(this.scroll.updateScroll(),this.scroll.updateScrollBar())}scrollToStart(){this.scroll&&this.scroll.scrollToStart()}_doOpenAnimation(){return Promise.resolve()}_doCloseAnimation(){return Promise.resolve()}}t.TVPopup=_},nec0:function(e,t,i){},nl5w:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M9.7 9l4.65-4.65-.7-.7L9 8.29 4.35 3.65l-.7.7L8.29 9l-4.64 4.65.7.7L9 9.71l4.65 4.64.7-.7L9.71 9z"/></svg>'},nxQu:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path d="M0 0h18v18H0z"/><path stroke="currentColor" d="M5.5 5.5h-3v-3h3v3z"/><path stroke="currentColor" d="M7.5 3v4.5H3M13.5 11.5a2 2 0 1 1 0 4 2 2 0 0 1 0-4zM10 4.5h2.5a1 1 0 0 1 1 1V9m0 0l-2-1.5m2 1.5l2-1.5M4.5 10v2.5a1 1 0 0 0 1 1H9m0 0l-1.5-2m1.5 2l-1.5 2"/></svg>'},o3hh:function(e,t,i){e.exports={elementWrap:"elementWrap-EE_m_Lmj",itemsWrap:"itemsWrap-EE_m_Lmj",item:"item-EE_m_Lmj",active:"active-EE_m_Lmj",itemContent:"itemContent-EE_m_Lmj",dropdownItem:"dropdownItem-EE_m_Lmj",dropdownIcon:"dropdownIcon-EE_m_Lmj",dropdownListItem:"dropdownListItem-EE_m_Lmj"}},"o6+g":function(e,t,i){"use strict";i.r(t),function(e){i.d(t,"ReferenceRenderer",(function(){return c}));var s=i("YFKU"),n=i("Eyy1"),o=(i("Kmbs"),i("YaO8"),i("vZvo"))
;const r='<div id="{{id}}" class="tv-pine-reference-item tv-pine-reference-item--scroll-aligner"><div class="tv-pine-reference-item__content"><h3 class="tv-pine-reference-item__header">{{title}}</h3><span title="{{tooltipTitle}}" class="apply-common-tooltip common-tooltip-html tv-pine-reference-item__wrapper-copy-link-button"><button data-id="{{id}}" class="tv-pine-reference-item__copy-link-button js-copy-solution-link-button"><span class="tv-pine-reference-item__icon">'+i("G1jy")+'</span></button></span>{{#description}}<div class="tv-pine-reference-item__text tv-text">{{{.}}}</div>{{/description}}{{#type}}<div class="tv-pine-reference-item__sub-header">'+s.t("Type")+'</div><div class="tv-pine-reference-item__text tv-text">{{.}}</div>{{/type}}{{#syntax}}<div class="tv-pine-reference-item__syntax">{{{.}}}</div>{{/syntax}}{{#hasExamples}}<div class="tv-pine-reference-item__sub-header">'+s.t("Example")+'</div><pre class="tv-pine-reference-item__example"><code class="language-js">{{{example}}}</code></pre>{{/hasExamples}}{{#detailedDescription}}{{#desc}}<div class="tv-pine-reference-item__text tv-text">{{{.}}}</div>{{/desc}}{{#example}}<div class="tv-pine-reference-item__sub-header">'+s.t("Example")+'</div><pre class="tv-pine-reference-item__example"><code class="language-js">{{{example}}}</code></pre>{{/example}}{{/detailedDescription}}{{#hasReturns}}<div class="tv-pine-reference-item__sub-header">'+s.t("Returns")+'</div>{{/hasReturns}}{{#returns}}<div class="tv-pine-reference-item__text tv-text">{{{.}}}</div>{{/returns}}{{#hasArguments}}<div class="tv-pine-reference-item__sub-header">'+s.t("Arguments")+'</div>{{/hasArguments}}{{#args}}<div class="tv-pine-reference-item__text tv-text"><span class="tv-pine-reference-item__arg-type">{{name}} {{#type}}({{type}}) {{/type}}</span>{{{info}}}</div>{{/args}}{{#hasRemarks}}<div class="tv-pine-reference-item__sub-header">'+s.t("Remarks")+'</div>{{/hasRemarks}}{{#remarks}}<div class="tv-pine-reference-item__text tv-text">{{{.}}}</div>{{/remarks}}{{#hasSeeAlso}}<div class="tv-pine-reference-item__sub-header">'+s.t("See also")+'</div><div class="tv-pine-reference-item__see-also">{{#seeAlso}}{{> tagItemTemplate}}{{/seeAlso}}</div>{{/hasSeeAlso}}</div></div>',a=()=>(e,t)=>Object(o.encodeURI)(t(e)),l=()=>(e,t)=>t(e).toLowerCase();class c{constructor(e){this.tagRegExp=new RegExp("{@(\\w+)\\s+([\\w.]+)}","g"),this._templates=Object.assign(Object.assign({},c.defaultPartials),e),this._documentationCollectionsInfo=[]}loadReference(e){return Object(o.getReferenceDataByVersion)(Object(o.makePineVersion)(e)).then(this._loadReference.bind(this))}getScriptReferenceContentHtml(){const t=this._templates;return e.render(t.contentTemplate,{encode:a,lower:l,sections:this._documentationCollectionsInfo.map(e=>({header:e.title,items:e.collection}))},t)}getScriptReferenceTocContent(){const t=this._templates;return e.render(t.tocTemplate,{encode:a,lower:l,sections:this._documentationCollectionsInfo.map(e=>({header:e.title,items:this._prepareTocCollection(e)}))},t)}searchInDocumentation(e){const t={
titleMatches:[],textMatches:[]};return this._documentationCollectionsInfo.forEach(i=>{const s=this._searchInCollection(e,i);t.titleMatches.push(...s.titleMatches),t.textMatches.push(...s.textMatches)}),t.titleMatches=t.titleMatches.sort(),t.textMatches=t.textMatches.sort(),t}static replaceTags(e,t){return e.replace(/{@\w+\s+([\w.]+)}/g,"<code"+(!0===t||/[\r\n]/.test(e)?' class="block"':"")+">$1</code>")}_searchInCollection(e,t){const i={titleMatches:[],textMatches:[]};return t.collection.forEach(t=>{t.title.includes(e)?i.titleMatches.push(t.id):(this._searchInArgs(e,t)||this._searchInDescription(e,t)||this._searchInMisc(e,t.remarks)||this._searchInMisc(e,t.returns)||this._searchInMisc(e,t.syntax)||t.example&&(t.example||"").includes(e)||t.type&&(t.type||"").includes(e))&&i.textMatches.push(t.id)}),i}_searchInArgs(e,t){return Array.isArray(t.args)&&t.args.some(t=>(t.name||"").toLowerCase().includes(e)||(t.type||"").toLowerCase().includes(e)||(t.info||[]).some(t=>(t||"").toLowerCase().includes(e)))}_searchInDescription(e,t){return!(!Array.isArray(t.description)||!t.description.some(t=>(t||"").toLowerCase().includes(e)))||Array.isArray(t.detailedDescription)&&t.detailedDescription.some(t=>Array.isArray(t.desc)&&t.desc.some(t=>(t||"").toLowerCase().includes(e)))}_searchInMisc(e,t){return Array.isArray(t)&&t.some(t=>(t||"").toLowerCase().includes(e))}_loadReference(e){this._documentationCollectionsInfo=[{collection:this._prepareCollection(e.operators),prefix:"op",title:s.t("Language operators")},{collection:this._prepareCollection(e.variables),prefix:"var",title:s.t("Built-in variables")},{collection:this._prepareCollection(e.functions),prefix:"fun",title:s.t("Built-in functions")}]}_prepareCollection(e){const t=e.prefix,i=e.docs;return Object.keys(i).sort().map(e=>{const s=i[e];return this._prepareItem(s,e,t)})}_prepareItem(e,t,i){return{args:this._formatArgs(e.args),description:this._replaceDocTags(e.desc),detailedDescription:this._formatDetailedDescription(e.detailedDesc),id:`${i}${Object(o.encodeURI)(t)}`,remarks:e.remarks?this._replaceDocTags(e.remarks):void 0,returns:e.returns?this._replaceDocTags(e.returns):void 0,example:e.examples?this._formatExamples(e.examples):void 0,seeAlso:e.seeAlso?this._extractDocumentationTags(e.seeAlso):void 0,syntax:e.syntax,title:t,type:e.type,tooltipTitle:s.t("Copy link reference"),hasArguments:Boolean(e.args),hasDetailedDescription:Boolean(e.detailedDesc),hasExamples:Boolean(e.examples),hasRemarks:Boolean(e.remarks),hasReturns:Boolean(e.returns),hasSeeAlso:Boolean(e.seeAlso)}}_prepareTocCollection(e){return e.collection.map(t=>({kind:e.prefix,name:t.title}))}_formatExamples(e){if(e&&e.length>0)return e.join("\n")}_formatDetailedDescription(e){const t=[];if(e&&e.length>0){for(const i of e)t.push({desc:Object(n.ensureDefined)(this._replaceDocTags(i.desc)),examples:this._formatExamples(i.examples)});return t}}_formatArgs(e){if(e){for(let t=0;t<e.length;++t){const i=e[t].info;void 0!==i&&(e[t].info=this._replaceDocTags(i))}return e}}_replaceDocTags(e){if(e){if(e instanceof Array){
const t=[];for(let i=0;i<e.length;++i){let s=e[i];s=this._replaceDocTagsInStr(s),t.push(s)}return t}return e=this._replaceDocTagsInStr(e),Array.isArray(e)&&e||[e]}}_extractDocumentationTags(e){if(e){if(e instanceof Array){let t=[];for(let i=0;i<e.length;++i){const s=e[i];t=t.concat(this._extractDocumentationTagsFromString(s))}return t}{const t=this._extractDocumentationTagsFromString(e);return Array.isArray(t)&&t||[t]}}}_extractDocumentationTagsFromString(e){const t=[];let i=e.match(c._documentationTagRegExp);for(;i;)t.push({kind:i[1],name:i[2]}),i=(e=e.replace(c._documentationTagRegExp,"")).match(c._documentationTagRegExp);return t}_replaceDocTagsInStr(t){let i=t.match(c._documentationTagRegExp);for(;i;){const s=Object(o.encodeURI)(i[2]);i=(t=t.replace(c._documentationTagRegExp,e.render(this._templates.hrefItemTemplate,{name:s,text:i[2],type:i[1]}))).match(c._documentationTagRegExp)}return t}}c.defaultPartials={contentItemTemplate:r,contentSectionTemplate:'<h2 class="tv-pine-reference-header">{{header}}</h2><div>{{#items}}{{> contentItemTemplate}}{{/items}}</div>',contentTemplate:"{{#sections}}{{> contentSectionTemplate}}{{/sections}}",hrefItemTemplate:'<a href="#{{type}}_{{name}}" class="js-reference" data-href="{{type}}_{{name}}">{{text}}</a>',tagItemTemplate:'<a href="#{{#encode}}{{kind}}_{{{name}}}{{/encode}}" class="tv-tag-label js-reference" data-href="{{#encode}}{{kind}}_{{{name}}}{{/encode}}">{{name}}</a>',tocItemTemplate:'<a href="#{{#encode}}{{kind}}_{{{name}}}{{/encode}}" class="tv-pine-reference-toc-item js-reference" data-name="{{#lower}}{{name}}{{/lower}}" data-href="{{#encode}}{{kind}}_{{{name}}}{{/encode}}">{{name}}</a>',tocSectionTemplate:'<div class="tv-accordion__section-header">{{header}}</div><div class="tv-accordion__section-body">{{#items}}{{> tocItemTemplate}}{{/items}}</div>',tocTemplate:"{{#sections}}{{> tocSectionTemplate}}{{/sections}}"},c._documentationTagRegExp=/{@(fun|var|op)\s([\w.?:+\-*/%]+)}/}.call(this,i("nbsC"))},oZdu:function(e,t,i){"use strict";i.r(t);i("YFKU");const s={paper_trading:{name:"paper_trading",title:window.t("Trading Panel"),buttonOpenTooltip:window.t("Open Trading Panel"),buttonCloseTooltip:window.t("Close Trading Panel"),ctor:null,_gaEvent:"Trading Panel"},scripteditor:{name:"scripteditor",title:window.t("Pine Editor"),buttonOpenTooltip:window.t("Open Pine Script Editor"),buttonCloseTooltip:window.t("Close Pine Script Editor"),ctor:null,_gaEvent:"Pine Editor"},backtesting:{name:"backtesting",title:window.t("Strategy Tester"),buttonOpenTooltip:window.t("Open Strategy Tester"),buttonCloseTooltip:window.t("Close Strategy Tester"),ctor:null,_gaEvent:"Strategy Tester"},screener:{name:"screener",title:window.t("Screener"),buttonOpenTooltip:window.t("Open Screener"),buttonCloseTooltip:window.t("Close Screener"),ctor:null,_gaEvent:"Screener"},text_notes:{name:"text_notes",title:window.t("Text Notes"),buttonOpenTooltip:window.t("Open Text Notes Panel"),buttonCloseTooltip:window.t("Close Text Notes Panel"),ctor:null,_gaEvent:"Text Notes"}}
;var n=i("N22A"),o=i("hY0g"),r=i.n(o);class a{constructor(e){this._contentRenderer=Promise.resolve(),this._spinnerContainer=document.createElement("div"),this._renderer=Promise.resolve(),this._filter=new r.a(!0),this._bridge=e,Object(n.waitTradingService)().then(e=>{this._trading=e,this.onStatusChange(e.connectStatus()),this._trading.onConnectionStatusChange.subscribe(this,this.onStatusChange)}),i.e("spinner-renderer").then(i.bind(null,"lG9f")).then(e=>{e.render(this._spinnerContainer)})}activate(){this._contentRenderer.then(()=>{this._content&&this._content.drawAttention&&this._content.drawAttention()})}onStatusChange(e){this._connectStatus!==e&&(this._connectStatus=this._trading.connectStatus(),this._contentRenderer=Promise.resolve(),this._content&&this._content.remove(),2===e&&(this._content=this._bridge.container.appendChild(this._spinnerContainer)),3!==e&&4!==e||this._renderBrokerSelectScreen(),1===e&&this._renderAccountManager(this._trading.activeBroker()))}_renderAccountManager(e){this._renderer=this._contentRenderer=Promise.all([i.e("vendors"),i.e(3),i.e(5),i.e(13),i.e(15),i.e(23),i.e(26),i.e(31),i.e(34),i.e(51),i.e(65),i.e(102),i.e(140),i.e(219),i.e(433),i.e(4),i.e(44),i.e(203),i.e("trading-account-manager")]).then(i.bind(null,"zAqB")).then(t=>{this._contentRenderer===this._renderer&&(this._content&&this._content.remove(),this._content=new t.AccountManager(e,this._bridge,1))})}_renderBrokerSelectScreen(){this._renderer=this._contentRenderer=Promise.all([i.e(2),i.e(220),i.e(529),i.e("broker-select-screen")]).then(i.bind(null,"Azu3")).then(e=>{this._content&&this._content.remove(),this._contentRenderer===this._renderer&&(this._content=new e.BrokerSelectScreenRenderer(this._bridge.bottomAreaContainer,this._bridge.container,this._bridge.visible,this._trading,this._filter),this._content.render())})}}var l=i("q1tI"),c=i("TSYQ"),d=i("Kxc7"),h=i.n(d),u=i("b5Gw"),p=i("4qhP"),_=i("5bCf");const f=window.t("Trading Panel"),g=window.t("Account Manager"),v={4:"failed",2:"connecting",1:"connected",3:"disconnected"},m={4:window.t("Failed"),2:window.t("Connecting"),1:window.t("Connected"),3:window.t("Disconnected")};class b extends l.PureComponent{constructor(e){super(e),this._trading=null,this._tradingServiceCancelable=null,this._titleClick=()=>{const{onClick:e}=this.props;e&&e()},this.state={status:3,hasActiveBroker:!1,title:h.a.enabled("trading_terminal")?g:f}}componentDidMount(){if(h.a.enabled("trading_terminal"))return;const e=Object(n.tradingService)();null===e?(this._tradingServiceCancelable=Object(u.makeCancelable)(Object(n.waitTradingService)()),this._tradingServiceCancelable.promise.then(this._onTradingService.bind(this))):this._onTradingService(e)}componentWillUnmount(){h.a.enabled("trading_terminal")||(this._cancelWaitingTrading(),null!==this._trading&&(this._trading.onBrokerChange.unsubscribe(this,this._update),this._trading.onConnectionStatusChange.unsubscribe(this,this._update)))}render(){const{status:e,hasActiveBroker:t,title:i}=this.state;return l.createElement("div",{className:c(p.a,_.container,_[v[e]],{
[_.active]:this.props.isActive,[_.inactive]:!t}),onClick:this._titleClick,"data-name":this.props.dataName,"data-active":this.props.isActive},l.createElement("span",{className:_.title},l.createElement("span",{className:_.titleText},i)),l.createElement("div",{className:c(_.indicator,"apply-common-tooltip"),title:m[e]}))}_onTradingService(e){this._cancelWaitingTrading(),this._trading=e,e.onBrokerChange.subscribe(this,this._update),e.onConnectionStatusChange.subscribe(this,this._update),this._update()}_update(){const e=this._trading,t=e&&e.activeBroker(),i=e?e.connectStatus():3;window.is_authenticated&&!h.a.enabled("trading_terminal")&&e&&t&&1===i?this.setState({status:i,hasActiveBroker:!0,title:t.accountManagerInfo().accountTitle}):this.setState({status:i,hasActiveBroker:!1,title:f})}_cancelWaitingTrading(){null!==this._tradingServiceCancelable&&(this._tradingServiceCancelable.cancel(),this._tradingServiceCancelable=null)}}var w=i("go63"),S=i("HARt"),y=i.n(S),C=i("z4nb"),$=i.n(C),k=i("RSDG"),x=i("Vdly"),I=i("FQhm"),T=i("82wv"),E=i("N5tr"),O=i("YYdM"),j=i("Eyy1"),F=i("EiOp");const B={[O.a.Stock]:window.t("Stock Screener"),[O.a.Forex]:window.t("Forex Screener"),[O.a.Crypto]:window.t("Crypto Screener")},P=[O.a.Stock,O.a.Forex,O.a.Crypto];class R extends l.PureComponent{constructor(e){super(e),this._titleClick=()=>{const{onClick:e}=this.props;e&&e()},this._itemClick=e=>{const{selectedScreenerKey:t}=this.state;e!==t&&(x.setValue("screener.selected_type_on_chart",e,{forceFlush:!0}),I.emit("screener.selected_type_on_chart",e),this.props.activationCallback&&this.props.activationCallback())},this._setScreenerType=e=>{this.setState({selectedScreenerKey:Object(j.ensureDefined)(e)})},this.state={selectedScreenerKey:x.getValue("screener.selected_type_on_chart",O.a.Stock)}}componentDidMount(){I.subscribe("screener.selected_type_on_chart",this._setScreenerType,null)}componentWillUnmount(){I.unsubscribe("screener.selected_type_on_chart",this._setScreenerType,null)}render(){const{isActive:e,compact:t}=this.props,{selectedScreenerKey:i}=this.state;return l.createElement(l.Fragment,null,l.createElement("span",{className:c(F.title,e&&F.active,t&&F.compact),onClick:this._titleClick,"data-name":this.props.dataName,"data-active":this.props.isActive},l.createElement("span",{className:F.titleText},B[i])),l.createElement(T.b,{arrow:!0,className:F.button},P.map(e=>l.createElement(E.b,{key:e,isActive:e===i,className:F.item,label:B[e],onClick:this._itemClick,onClickArg:e}))))}}var M=i("ogJP");function D(){const e={paper_trading:{ctor:a,customTitleComponent:b},scripteditor:{ctor:y.a,onRegister:y.a.onRegister},backtesting:{ctor:w.BacktestingWidget},screener:{ctor:k.ScreenerWidget,customTitleComponent:R},text_notes:{ctor:$.a}};return Object(M.merge)(Object(M.clone)(s),e)}i.d(t,"getFullConfigSet",(function(){return D}))},pr86:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var s=i("mrSG"),n=(i("YFKU"),i("q1tI")),o=i("TSYQ"),r=i("Iivm"),a=i("sg5d"),l=i("XfUw"),c=i("fEjm");const d={add:window.t("Add to favorites"),
remove:window.t("Remove from favorites")};function h(e){const{className:t,isFilled:i,isActive:h,onClick:u}=e,p=Object(s.d)(e,["className","isFilled","isActive","onClick"]);return n.createElement(r.a,Object.assign({},p,{className:o(c.favorite,"apply-common-tooltip",i&&c.checked,h&&c.active,t),icon:i?a:l,onClick:u,title:i?d.remove:d.add}))}},qibD:function(e){e.exports=JSON.parse('{"checkbox":"checkbox-3xZUD-2M","reverse":"reverse-3xeTx96y","label":"label-cyItEVpF","baseline":"baseline-6TXKro4X"}')},r01Z:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 12" width="14" height="12"><g fill="none" fill-rule="evenodd" stroke="#9DB2BD"><path d="M1 0l12 12M13 0L1 12"/></g></svg>'},rULK:function(e,t,i){"use strict";i.r(t);var s=i("q1tI"),n=i("i8i4"),o=i("YFKU"),r=i("TSYQ"),a=i("tU7i"),l=i("82wv"),c=i("pr86"),d=i("Iksw"),h=i("N5tr"),u=i("xOeO"),p=i("Fi0z"),_=i("JWMC"),f=i("zM7N"),g=i("LiyS"),v=i("lCO3"),m=i("Iivm"),b=i("GeUm"),w=i("KKsp"),S=i("2uTr"),y=i("zbX1"),C=i("BAye"),$=i("aSp3"),k=i("u52U"),x=i("Ksp5"),I=i("9e/V"),T=i("LKtc");const E=new p.PineReferenceDialog,O=o.t("This script is read only"),j=o.t("Untitled Script"),F=o.t("Unsaved script"),B=o.t("Rename script"),P=o.t("Find/Replace"),R=o.t("Select revision"),M=o.t("revision"),D=o.t("Open",{context:"input"}),A=o.t("Recently used"),N=o.t("New blank strategy"),L=o.t("New blank indicator"),W=Object(S.appendEllipsis)(o.t("My script")),V=Object(S.appendEllipsis)(o.t("New default built-in script")),H=o.t("Save"),z=o.t("Add to Chart"),q=o.t("Publish Script"),U=o.t("More"),K=Object(S.appendEllipsis)(o.t("Make a copy")),G=o.t("Convert to v4"),X=o.t("Back to v3"),Y=o.t("Pine Script reference (pop-up)"),J=o.t("Pine Editor keyboard shortcuts");function Q(e){return{category:"Pine Editor",event:"BP Pine Editor "+e}}const Z={tutorial:{title:o.t("Pine Script documentation"),url:"https://www.tradingview.com/pine-script-docs/en/v4/Introduction.html",trackEventObject:Q("Tutorial")},reference:{title:o.t("Pine Script reference"),url:"/pine-script-reference/v4/",trackEventObject:Q("Reference New Window")},pinecoders:{title:o.t("PineCoders resources"),url:"https://www.pinecoders.com/",trackEventObject:Q("PineCoders site")},kodify:{title:o.t("Pine tutorials on Kodify"),url:"https://kodify.net/tradingview-programming-articles/",trackEventObject:Q("Tutorials on Kodify")},stackoverflow:{title:o.t("Ask a question on Stack Overflow"),url:"https://stackoverflow.com/questions/tagged/pine-script",trackEventObject:Q("Suggestions and Feedback")}};class ee extends s.PureComponent{constructor(e){super(e),this._favsModel=g.FavoriteScriptsModel.getInstance(),this._handleCurrentScriptChange=()=>{this._syncFavorite(),this._callback()},this._onScriptNameClick=()=>{this.props.readOnly.value()?this.props.saveAsHandler&&this.props.saveAsHandler():this.props.currentScript.value().scriptName?this._handleRename():this.props.saveScriptHandler&&this.props.saveScriptHandler()},this._onEditClick=()=>{this._handleRename()},this._onFavoriteClick=()=>{
this._favsModel.toggleFavorite(this.props.currentScript.value().scriptIdPart)},this._onSearchClick=()=>{this.setState({isInSearch:!this.state.isInSearch}),this.props.searchToolbarOpenHandler(this.state.isInSearch)},this._onNewStrategyClick=()=>{this._trackEvent("New","Blank strategy script"),this.props.newStrategyScriptHandler&&this.props.newStrategyScriptHandler()},this._onNewIndicatorClick=()=>{this._trackEvent("New","Blank indicator script"),this.props.newIndicatorScriptHandler&&this.props.newIndicatorScriptHandler()},this._onReferencePopupClick=()=>{this._trackEvent("Reference Pop-up"),E.open(4)},this._onShortcutsClick=()=>{this._trackEvent("Pine Editor Keyboard Shortcuts"),Object(u.showSupportDialog)({initialState:"shortcuts"})},this._syncFavorite=()=>{const e=this.props.currentScript.value();e.scriptName&&this.setState({isFavorite:this._favsModel.isFav(e.scriptIdPart)})},this._createVersionClickHandler=e=>()=>{this._trackEvent("Select version"),this.props.openScriptVersionHandler&&this.props.openScriptVersionHandler(this.props.currentScript.value().scriptIdPart,e)},this._createRecentScriptHandler=e=>()=>{this.props.openScriptWithConfirmHandler&&this.props.openScriptWithConfirmHandler(e)},this._callback=()=>this.forceUpdate(),this.state={isFavorite:!1,isInSearch:!1},this._syncFavorite()}componentDidMount(){this._subscribeModifiers(),this._favsModel.favoritesChanged().subscribe(this,this._syncFavorite),this.props.findReplacePanelVisible.subscribe(e=>{this.setState({isInSearch:e})})}componentWillUnmount(){this._unsubscribeModifiers(),this._favsModel.favoritesChanged().unsubscribe(this,this._syncFavorite)}render(){const e=this.props.currentScript.value(),t=this.props.authenticated.value(),i=this.props.modified.value(),n=this.props.readOnly.value(),o=this.props.unsaved.value(),u=this.props.forceShowConvert.value(),p=this.props.converted.value(),_=this.props.conversionDisabled.value(),g=this.props.publishingAwaited.value(),v=this.props.currentTheme.value()===f.StdTheme.Dark,S=this._getCurrentVersion(),{isInSearch:E,isFavorite:Q}=this.state,ee=n||3!==e.pineVersion||!u,te=n||!p||3===e.pineVersion||u,ie=e.scriptName?e.scriptName:j,se=this.props.recentlyUsed.value();return s.createElement("div",null,s.createElement("div",{className:r(T.content,"clearfix")},s.createElement("div",{className:T.leftControlsBlock},s.createElement(m.a,{className:T.pineIcon,icon:y}),s.createElement("div",{className:r("apply-common-tooltip",T.scriptName),title:ie,onClick:this._onScriptNameClick},ie.substr(0,20),s.createElement("div",{className:r(T.modifiedIcon,(!i||!e.scriptName)&&T.hide,"apply-common-tooltip"),title:F},"*"),s.createElement(m.a,{className:r(T.readonlyIcon,!n&&T.hide,"apply-common-tooltip"),icon:v?$:C,title:O})),s.createElement("div",{className:T.leftControlsButtons},s.createElement(a.b,{className:r(T.leftControlsBlockItem,T.editIcon,(n||o)&&T.hide),title:B,"data-name":"rename-script",icon:k,onClick:this._onEditClick}),s.createElement(c.a,{className:r(T.leftControlsBlockItem,T.favoriteIcon,(!e.scriptName||o)&&T.hide),isFilled:Q,
onClick:this._onFavoriteClick,"data-name":"editor-favorite-script","data-favorite":Q}),s.createElement(a.b,{className:r(T.leftControlsBlockItem,T.searchIcon,E&&T["searchIcon--active"],o&&T.hide),title:P,"data-name":"find-replace-script",icon:I,onClick:this._onSearchClick}),s.createElement(l.b,{className:r(T.versionMenu,"apply-common-tooltip",o&&T.hide),content:S,"data-name":"script-version-dropdown","data-revision":S,arrow:!0,title:R},s.createElement(b.a,{className:T.versionMenuTitle},M),this.props.versions.value().map((t,i,n)=>s.createElement(h.b,{key:t.displayValue,className:T.versionMenuItem,label:t.displayValue,isActive:1===n.length||e.version.isEqual(t.value),onClick:this._createVersionClickHandler(t.value.toString())}))))),s.createElement("div",{className:T.rightControlsBlock},s.createElement(l.b,{className:r(T.button,T.rightControlsBlock__button),content:D,"data-name":"open-script",arrow:!1},se.length>0&&s.createElement(s.Fragment,null,s.createElement("div",{className:T.recentlyUsedTitle},A),s.createElement("div",null,se.map(t=>s.createElement(h.b,{key:t.scriptIdPart,className:r("apply-common-tooltip",T.openMenuItem),title:t.scriptName,label:t.scriptName.substr(0,20),isActive:e.scriptIdPart===t.scriptIdPart,onClick:this._createRecentScriptHandler(t)}))),s.createElement(w.a,null)),s.createElement(h.b,{className:r(!t&&T.hide),label:W,onClick:this.props.openScriptHandler}),s.createElement(h.b,{label:V,onClick:this.props.openDefaultScriptHandler}),s.createElement(h.b,{label:L,onClick:this._onNewIndicatorClick}),s.createElement(h.b,{label:N,onClick:this._onNewStrategyClick})),s.createElement(a.b,{className:r(T.button,T.rightControlsBlock__button,n&&T.hide),text:H,"data-name":"save-script",onClick:this.props.saveScriptHandler}),s.createElement(a.b,{className:r(T.button,T.rightControlsBlock__button),text:z,"data-name":"add-script-to-chart",onClick:this.props.addScriptHandler}),s.createElement(a.b,{className:r(T.button,T.publishButton,T.rightControlsBlock__button,n&&T.hide,g&&T.awaitPublish),text:q,"data-name":"publish-script",onClick:this.props.publishScriptHandler}),s.createElement(l.b,{className:r(T.moreButton),content:s.createElement(a.b,{className:r(T.button),title:U,icon:x}),"data-name":"script-more-options",arrow:!1,horizontalDropDirection:d.b.FromRightToLeft,horizontalAttachEdge:d.a.Right},s.createElement(h.b,{isDisabled:o,label:K,onClick:this.props.saveAsHandler}),s.createElement(h.b,{className:r(ee&&T.hide),isDisabled:_,label:G,onClick:this.props.convertHandler}),s.createElement(h.b,{className:r(te&&T.hide),label:X,onClick:this.props.convertBackHandler}),s.createElement(w.a,null),s.createElement(h.b,{label:Z.tutorial.title,link:Z.tutorial.url,target:"_blank",trackEventObject:Z.tutorial.trackEventObject}),s.createElement(h.b,{label:Z.reference.title,link:Z.reference.url,target:"_blank",trackEventObject:Z.reference.trackEventObject}),s.createElement(h.b,{label:Y,onClick:this._onReferencePopupClick}),s.createElement(h.b,{label:J,onClick:this._onShortcutsClick}),s.createElement(w.a,null),s.createElement(h.b,{
label:Z.pinecoders.title,link:Z.pinecoders.url,target:"_blank",trackEventObject:Z.pinecoders.trackEventObject}),s.createElement(h.b,{label:Z.kodify.title,link:Z.kodify.url,target:"_blank",trackEventObject:Z.kodify.trackEventObject}),s.createElement(h.b,{label:Z.stackoverflow.title,link:Z.stackoverflow.url,target:"_blank",trackEventObject:Z.stackoverflow.trackEventObject})))))}_subscribeModifiers(){const{currentScript:e,authenticated:t,readOnly:i,unsaved:s,renamed:n,modified:o,converted:r,forceShowConvert:a,conversionDisabled:l,publishingAwaited:c,versions:d,recentlyUsed:h,currentTheme:u}=this.props;e.subscribe(this._handleCurrentScriptChange),t.subscribe(this._callback),i.subscribe(this._callback),s.subscribe(this._callback),n.subscribe(this,this._callback),o.subscribe(this._callback),a.subscribe(this._callback),r.subscribe(this._callback),l.subscribe(this._callback),c.subscribe(this._callback),d.subscribe(this._callback),h.subscribe(this._callback),u.subscribe(this._callback)}_unsubscribeModifiers(){const{currentScript:e,authenticated:t,readOnly:i,unsaved:s,renamed:n,modified:o,forceShowConvert:r,converted:a,conversionDisabled:l,publishingAwaited:c,versions:d,recentlyUsed:h,currentTheme:u}=this.props;e.unsubscribe(this._handleCurrentScriptChange),t.unsubscribe(this._callback),i.unsubscribe(this._callback),s.unsubscribe(this._callback),n.unsubscribe(this,this._callback),r.unsubscribe(this._callback),o.unsubscribe(this._callback),a.unsubscribe(this._callback),l.unsubscribe(this._callback),c.unsubscribe(this._callback),d.unsubscribe(this._callback),h.unsubscribe(this._callback),u.unsubscribe(this._callback)}_getCurrentVersion(){const e=this.props.currentScript.value();if(!e.version)return"1.0";const t=v.Version.parse(e.version);return t.major()<0?new v.Version(1,0).toString():t.toString()}_trackEvent(e,t){Object(_.trackEvent)("Pine Editor","BP Pine Editor "+e,t)}_handleRename(){this.props.renameHandler&&this.props.renameHandler()}}function te(e,t){n.render(s.createElement(ee,Object.assign({},t)),e)}i.d(t,"renderHeader",(function(){return te}))},sHKj:function(e,t,i){e.exports={title:"title-2VoDfDWK"}},sg5d:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path fill="currentColor" d="M9 1l2.35 4.76 5.26.77-3.8 3.7.9 5.24L9 13l-4.7 2.47.9-5.23-3.8-3.71 5.25-.77L9 1z"/></svg>'},sjor:function(e,t,i){},szLm:function(e,t,i){"use strict";function s(e){null!==e&&e.setSelectionRange(0,e.value.length)}i.d(t,"a",(function(){return s}))},tKRU:function(e,t,i){"use strict";var s=i("nbyR");i.d(t,"a",(function(){return s.TVPopup}))},tU7i:function(e,t,i){"use strict";i.d(t,"a",(function(){return l})),i.d(t,"b",(function(){return c}));var s=i("mrSG"),n=i("q1tI"),o=i("TSYQ"),r=i("Iivm"),a=i("bQ7Y");const l=a,c=n.forwardRef((e,t)=>{
const{icon:i,isActive:l,isOpened:c,isDisabled:d,isGrouped:h,isHovered:u,onClick:p,text:_,textBeforeIcon:f,title:g,theme:v=a,className:m,forceInteractive:b,"data-name":w}=e,S=Object(s.d)(e,["icon","isActive","isOpened","isDisabled","isGrouped","isHovered","onClick","text","textBeforeIcon","title","theme","className","forceInteractive","data-name"]),y=o(m,v.button,g&&"apply-common-tooltip",{[v.isActive]:l,[v.isOpened]:c,[v.isInteractive]:(b||Boolean(p))&&!d,[v.isDisabled]:d,[v.isGrouped]:h,[v.hover]:u}),C=i&&("string"==typeof i?n.createElement(r.a,{className:v.icon,icon:i}):n.cloneElement(i,{className:o(v.icon,i.props.className)}));return n.createElement("div",Object.assign({},S,{ref:t,"data-role":"button",className:y,onClick:d?void 0:p,title:g,"data-name":w}),f&&_&&n.createElement("div",{className:o("js-button-text",v.text)},_),C,!f&&_&&n.createElement("div",{className:o("js-button-text",v.text)},_))})},u52U:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M13.5 7l1.65-1.65a.5.5 0 0 0 0-.7l-1.8-1.8a.5.5 0 0 0-.7 0L11 4.5M13.5 7L11 4.5M13.5 7l-8.35 8.35a.5.5 0 0 1-.36.15H2.5v-2.3a.5.5 0 0 1 .15-.35L11 4.5"/></svg>'},uEQF:function(e,t,i){},uo4K:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 13" width="13" height="13"><path fill="currentColor" d="M5.18 6.6L1.3 2.7.6 2 2 .59l.7.7 3.9 3.9 3.89-3.9.7-.7L12.61 2l-.71.7L8 6.6l3.89 3.89.7.7-1.4 1.42-.71-.71L6.58 8 2.72 11.9l-.71.7-1.41-1.4.7-.71 3.9-3.9z"/></svg>'},upcD:function(e){
e.exports=JSON.parse('{"ACCD@tv-basicstudies":"STD;Accumulation_Distribution","studyADR@tv-basicstudies":"STD;Advance_Decline_Ratio_Bars","AROON@tv-basicstudies":"STD;Aroon","ATR@tv-basicstudies":"STD;Average_True_Range","AwesomeOscillator@tv-basicstudies":"STD;Awesome_Oscillator","BB@tv-basicstudies":"STD;Bollinger_Bands","BollingerBandsR@tv-basicstudies":"STD;Bollinger_Bands_B","BollingerBandsWidth@tv-basicstudies":"STD;Bollinger_Bands_Width","CMF@tv-basicstudies":"STD;Chaikin_Money_Flow","ChaikinOscillator@tv-basicstudies":"STD;Chaikin_Oscillator","ChoppinessIndex@tv-basicstudies":"STD;Choppiness_Index","DoubleEMA@tv-basicstudies":"STD;DEMA","WilliamR@tv-basicstudies":"STD;Willams_R","CCI@tv-basicstudies":"STD;CCI","CRSI@tv-basicstudies":"STD;Connors_RSI","DetrendedPriceOscillator@tv-basicstudies":"STD;DPO","DM@tv-basicstudies":"STD;DMI","DONCH@tv-basicstudies":"STD;Donchian_Channels","EaseOfMovement@tv-basicstudies":"STD;EOM","EFI@tv-basicstudies":"STD;EFI","ENV@tv-basicstudies":"STD;ENV","FisherTransform@tv-basicstudies":"STD;Fisher_Transform","HV@tv-basicstudies":"STD;Historical_Volatility","KLTNR@tv-basicstudies":"STD;Keltner_Channels","MOM@tv-basicstudies":"STD;Momentum","MF@tv-basicstudies":"STD;Money_Flow","UltimateOsc@tv-basicstudies":"STD;Ultimate_Oscillator","Trix@tv-basicstudies":"STD;TRIX","Stochastic@tv-basicstudies":"STD;Stochastic","StochasticRSI@tv-basicstudies":"STD;Stochastic_RSI","RSI@tv-basicstudies":"STD;RSI","ROC@tv-basicstudies":"STD;ROC","PriceOsc@tv-basicstudies":"STD;Price_Oscillator","MASimple@tv-basicstudies":"STD;SMA","OBV@tv-basicstudies":"STD;On_Balance_Volume","PSAR@tv-basicstudies":"STD;PSAR","VigorIndex@tv-basicstudies":"STD;Relative_Vigor_Index","VolatilityIndex@tv-basicstudies":"STD;Relative_Volatility_Index","SMIErgodicIndicator@tv-basicstudies":"STD;SMI_Ergodic_Indicator_Oscillator","SMIErgodicOscillator@tv-basicstudies":"STD;SMI_Ergodic_Oscillator","MACD@tv-basicstudies":"STD;MACD","MAWeighted@tv-basicstudies":"STD;WMA","MAExp@tv-basicstudies":"STD;EMA","hullMA@tv-basicstudies":"STD;Hull%1MA","chandeMO@tv-basicstudies":"STD;Chande_Momentum_Oscillator","TripleEMA@tv-basicstudies":"STD;TEMA","MAVolumeWeighted@tv-basicstudies":"STD;VWMA","WilliamsAlligator@tv-basicstudies":"STD;Williams_Alligator","WilliamsFractal@tv-basicstudies":"STD;Whilliams_Fractals"}')},v2PZ:function(e,t,i){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0}),t.TVDialogAbstract=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e};t.closeAllDialogs=function(){u.forEach(e=>e.close())};var o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(i("9uLv"));i("PzOn");var r=c(i("xZmJ"));i("nZrM"),i("nec0"),i("IwoD");var a=c(i("4O8T")),l=i("jAh7");function c(e){return e&&e.__esModule?e:{default:e}}let d,h=0,u=[];const p=$(document),_={closeOnEsc:!0,closeButton:!0,
focusFirstControl:!0,closeOnOutsideClick:!0,closeButtonAddClass:"",focusClass:"i-focused",template:'<div class="tv-dialog" tabindex="-1">',errorTemplate:'<div class="tv-dialog__error i-slided{{# errorMod }} tv-dialog__error--{{ errorMod }}{{/ errorMod }}">{{{ error }}}</div>',titleTemplate:'<div class="tv-dialog__section tv-dialog__section--title js-dialog__drag"><div class="js-title-text tv-dialog__title">{{{ title }}}</div></div>',contentWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--no-border">',actionsWrapTemplate:'<div class="tv-dialog__section tv-dialog__section--actions tv-dialog__section--no-border">',closeButtonTemplate:`<div class="tv-dialog__close js-dialog__close">${i("uo4K")}</div>`,helpButtonTemplate:'<a href="{{{ link }}}" target="_blank" class="tv-dialog__help apply-common-tooltip" title="{{{ title }}}"></a>',helpActionsMod:"tv-dialog__section--actions_with-help"},f={default:"tv-button tv-button--default",primary:"tv-button tv-button--primary",success:"tv-button tv-button--success",danger:"tv-button tv-button--danger",warning:"tv-button tv-button--warning",link:"tv-button tv-button--link",checkbox:"tv-control-checkbox tv-control-checkbox--in-actions","default-ghost":"tv-button tv-button--default_ghost","primary-ghost":"tv-button tv-button--primary_ghost","success-ghost":"tv-button tv-button--success_ghost","danger-ghost":"tv-button tv-button--danger_ghost","warning-ghost":"tv-button tv-button--warning_ghost"},g={_default:'<div data-name="{{ name }}" class="js-dialog__action-click js-dialog__no-drag {{ class }}">{{ text }}</div>',"submit-primary":'<button type="submit" class="tv-button tv-button--primary">{{ text }}</button>',"submit-success":'<button type="submit" class="tv-button tv-button--success">{{ text }}</button>'};class v extends a.default{constructor(t={}){if(super(),this.manager=t.manager||(0,l.getRootOverlapManager)(t.ownerDocument),this._id=h++,this.loadingActions=[],this.disabledActions=[],this.firstFocusControl=null,this.options=n({},_,t),this.$el=$(e.render(this.options.template,{title:this.options.title,closeButton:this.options.closeButton})),this.$el.addClass("js-dialog"),this.el=this.$el[0],this.options.dataset)for(const[e,i]of Object.entries(this.options.dataset))"string"==typeof i&&this.el.setAttribute("data-"+e,i);for(this.options.addClass&&this.$el.addClass(this.options.addClass),this.options.width&&this.$el.css({width:"100%","max-width":this.options.width}),this.on("beforeOpen",()=>{this.$wrap=this.manager.ensureWindow(this._id)}),this.on("afterClose",()=>{this.$wrap=null,this.manager.unregisterWindow(this._id)}),this.options.title&&(this.$title=$(e.render(this.options.titleTemplate,{title:this.options.title})).appendTo(this.$el)),this.$content=$(this.options.contentWrapTemplate).appendTo(this.$el),this.$contentIn=this.$content;this.$contentIn.length;)this.$contentIn=this.$contentIn.children();if(this.$contentIn=this.$contentIn.end(),this.options.content&&this.renderContent(this.options.content),
(this.options.actions||this.options.help)&&(this.$content.hasClass("tv-dialog__section")&&this.$content.addClass("tv-dialog__section--no-padding_bottom"),this.$actions=$(this.options.actionsWrapTemplate).appendTo(this.$el)),this.options.actions){this.actions={},this.$el.on("click touchend",".js-dialog__action-click",e=>{e.preventDefault(),this.actionDispatcher($(e.currentTarget).data("name"))});for(let t=this.options.actions.length-1;t>=0;t--){const i=this.options.actions[t];if(i.type||(i.type="default"),i.class||(i.class=f[i.type]?f[i.type]:f.default),"checkbox"===i.type){const e=new r.default({labelRight:i.text,name:i.name,checked:i.checked});this.actions[i.name]=e.$el.appendTo(this.$actions),this.actions[i.name].on("change",()=>{setTimeout(()=>this.actionDispatcher(i.name,e.checked))})}else this.actions[i.name]=$(e.render(i.template?i.template:g[i.type]||g._default,i,i)).appendTo(this.$actions);if(i.method&&"function"==typeof this[i.method]&&this.on("action:"+i.name,this[i.method].bind(this)),i.addClass&&this.actions[i.name].addClass(i.addClass),i.key){let e;if("string"==typeof i.key&&i.key.split("+").length>1){let t=[];const s=i.key.split("+");e=e=>{t=[]};const n=e=>{const n=""+e.keyCode;-1!==s.indexOf(n)&&t.indexOf(n)&&t.push(n),this._focused&&t.length===s.length&&(t=[],this.actionDispatcher(i.name))};this.on("afterOpen",()=>{p.on("keydown",n),p.on("keyup",e)}),this.on("beforeClose",()=>{p.off("keydown",n),p.off("keyup",e)})}else{const t=$.isArray(i.key)?i.key:[i.key];e=e=>{!e.isDefaultPrevented()&&this._focused&&-1!==t.indexOf(e.keyCode)&&this.actionDispatcher(i.name)},this.on("afterOpen",()=>p.on("keyup",e)),this.on("beforeClose",()=>p.off("keyup",e))}}}}if(this.options.help&&$(e.render(this.options.helpButtonTemplate,this.options.help)).prependTo(this.$actions.addClass(this.options.helpActionsMod)),this.options.closeButton){const e=$(this.options.closeButtonTemplate);e.addClass(this.options.closeButtonAddClass||"");let t=this.$el;1===this.$el.find(".js-close-button-place").length&&(t=this.$el.find(".js-close-button-place")),e.appendTo(t)}this.setZIndex(110+u.length),t.errorMod&&(this.errorMod=t.errorMod),this.on("afterOpen",()=>{this.$el.focus(),this.options.focusFirstControl&&!Modernizr.mobiletouch&&(this.firstFocusControl||this.$el.find('input:not([type="hidden"]), textarea').first()).focus()}),this.$el.on("click",".js-dialog__close",this.close.bind(this)),this.$el.on("mousedown touchstart",this.focus.bind(this)),u.push(this)}renderContent(e){return this.$contentIn.html("function"==typeof e?e(this):e),this}setDestroyOnClose(e){this.options.destroyOnClose=e}setZIndex(e){return this.zIndex=e,this.trigger("change:zIndex",[this]),this}toTop(){for(let e=u.length-1;e>=0;e--)u[e].zIndex>this.zIndex&&u[e].setZIndex(u[e].zIndex-1);return this.setZIndex(110+u.length),this.manager.moveToTop(this._id),this._hotkeys&&this._hotkeys.promote(),this}isEventOut(e){if(this.options.isClickOutFn){const t=this.options.isClickOutFn(e);if(void 0!==t)return t}let t=!0;const i=$(e.target)
;return i.get(0)!==this.$el.get(0)&&($(">*",this.$el).each((function(){i.get(0)===$(this).get(0)&&(t=!1),0===i.closest("HTML",$(this).get(0)).length&&(t=!1)})),t)}focus(){d&&d!==this&&d.unfocus(),this._setFocused(),this._focused=!0,this.$el.addClass(this.options.focusClass),this.trigger("focus",[this]),setTimeout(()=>{p.on("mousedown.tv-dialog-unfocus-"+this._id,e=>{this.isEventOut(e)&&(this.unfocus(),p.off("mousedown.tv-dialog-unfocus-"+this._id))})},20)}_setFocused(){d!==this&&(d=this)}_setUnfocused(){d===this&&(d=void 0)}unfocus(){d===this&&(this._setUnfocused(),this._focused=!1,this.$el.removeClass(this.options.focusClass).find(":focus").blur(),this.trigger("unfocus",[this]))}isFocused(){return this._focused}setTitle(e,t=!1){return this.$title.toggleClass("tv-dialog__section--one-line apply-overflow-tooltip",t),this.$title.html(e),this}setTitleText(e){this.$title.find(".js-title-text").text(e)}actionDispatcher(e,...t){this.disabledActions.includes(e)||this.loadingActions.includes(e)||this.trigger("action:"+e,[this,...t])}toggleAction(e,t){return t||this.disabledActions.includes(e)?t&&this.disabledActions.includes(e)&&(this.disabledActions=s.without(this.disabledActions,e)):this.disabledActions.push(e),this.actions[e].toggleClass("i-disabled",!t),this}actionLoader(e,t="init"){return this.actions[e].tvButtonLoader(t),"init"===t&&(this.actions[e].off("tv-button-loader:start.dialog-action").on("tv-button-loader:start.dialog-action",()=>{this.loadingActions.push(e)}),this.actions[e].off("tv-button-loader:stop.dialog-action").on("tv-button-loader:stop.dialog-action",()=>{this.loadingActions=s.without(this.loadingActions,e)})),this}error(t){const i=$(e.render(this.options.errorTemplate,{error:t,errorMod:this.errorMod})).appendTo(this.$el);return setTimeout(()=>i.removeClass("i-slided"),20),p.one("touchstart mousedown keydown",()=>{i.addClass("i-slided"),setTimeout(()=>i.remove(),.75*o.dur)}),this.trigger("error",[this,i]),this}destroy(){this.$wrap=null,this.manager.unregisterWindow(this._id),this._hotkeys&&this._hotkeys.destroy(),u=s.without(u,this);for(let e=0;e<u.length;e++)u[e].setZIndex(110+e);this.trigger("destroy",[this])}isOpened(){return Boolean(this.opened)}getDialogId(){return this._id}}t.TVDialogAbstract=v}).call(this,i("nbsC"),i("F/us"))},vCF3:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var s=i("q1tI"),n=i("TSYQ"),o=i("Iivm"),r=i("aJjg"),a=i("F0Qt");i("P4l+");function l(e){const t=n(a.box,a["intent-"+e.intent],{[a.check]:!Boolean(e.indeterminate),[a.dot]:Boolean(e.indeterminate),[a.noOutline]:-1===e.tabIndex}),i=n(a.wrapper,e.className);return s.createElement("span",{className:i,title:e.title},s.createElement("input",{id:e.id,tabIndex:e.tabIndex,className:a.input,type:"checkbox",name:e.name,checked:e.checked,disabled:e.disabled,value:e.value,autoFocus:e.autoFocus,role:e.role,onChange:function(){e.onChange&&e.onChange(e.value)},ref:e.reference}),s.createElement("span",{className:t},s.createElement(o.a,{icon:r,className:a.icon})))}},vvER:function(e,t,i){"use strict";i.d(t,"a",(function(){
return n}));var s=i("ivNn");function n(e){if(e&&Object(s.isNumber)(e)){const t=e.toString();return`${t.substring(0,4)}-${t.substring(4,6)}-${t.substring(6)}`}return"â"}},wHCJ:function(e,t,i){"use strict";var s=i("7FKn");i.d(t,"a",(function(){return s.a})),i.d(t,"b",(function(){return s.b}))},wHhB:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><g transform="translate(-8 -7)"><path fill-rule="evenodd" d="M17 11c1.38 0 2.63.56 3.54 1.46L18 15h6V9l-2.05 2.05A6.976 6.976 0 0 0 17 9c-3.53 0-6.43 2.61-6.92 6h2.02a5 5 0 0 1 4.9-4zm6.92 6H21.9a5 5 0 0 1-4.9 4c-1.38 0-2.63-.56-3.54-1.46L16 17h-6v6l2.05-2.05A6.976 6.976 0 0 0 17 23c1.55 0 2.98-.51 4.14-1.36l1.5-1.5A6.89 6.89 0 0 0 23.92 17z"/></g></svg>'},whVV:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18" fill="none"><path stroke="currentColor" d="M6.5 6.5h-4v-4h4v4zM4.5 9v3.5a1 1 0 0 0 1 1H9m0 0l-1.5-2m1.5 2l-1.5 2M13.5 11.5a2 2 0 1 1 0 4 2 2 0 0 1 0-4z"/></svg>'},wjmC:function(e,t,i){"use strict";i.d(t,"b",(function(){return r})),i.d(t,"a",(function(){return a})),i.d(t,"c",(function(){return l}));var s=i("gTfr"),n=i("VzPW");const o=[];for(const c in s)s.hasOwnProperty(c)&&s[c].hasOwnProperty("exchangesStocks")&&s[c].exchangesStocks.forEach(e=>{o.push(e)});const r=e=>(e={OSL:"OSE",BCBA:"BYMA",AMEX:"NYSE ARCA"}[e]||e,o.includes(e));function a(e){return n[e]||null}function l(e){return"ASX"===e}},xW9g:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 60"><path d="M0 46l35-35 14 14-35 35H0zM39 7l6-6c5-5 19 9 14 14l-6 6z"/></svg>'},xZmJ:function(e,t,i){"use strict";i.r(t),function(e){var s=i("IWoC");i("b6p+");const n=i("txPx").getLogger("Ui.TvControlCheckbox"),o={labelWrapper:'{{#hasLabel}}<label>{{#labelLeft}}<span class="tv-control-checkbox__label {{#labelAddClass}}{{labelAddClass}}{{/labelAddClass}}">{{labelLeft}}</span>{{/labelLeft}}{{> inputWrapper }}{{#labelRight}}<span class="tv-control-checkbox__label {{#labelAddClass}}{{labelAddClass}}{{/labelAddClass}}">{{labelRight}}</span>{{/labelRight}}</label>{{/hasLabel}}{{^hasLabel}}{{> inputWrapper }}{{/hasLabel}}',inputWrapper:'<{{ tag }} class="{{ customClass }}{{#disabled}} i-disabled{{/disabled}}">{{^hasCheckbox}}{{> checkbox }}{{/hasCheckbox}}{{> box }}{{> ripple }}</{{ tag }}>',checkbox:'<input{{#id}} id="{{ id }}"{{/id}} class="{{> checkboxClass }}" type="checkbox"{{#name}} name="{{ name }}"{{/name}}{{#checked}} checked{{/checked}}{{#disabled}} disabled{{/disabled}}>',checkboxClass:"{{ customClass }}__input",box:'<span class="{{ customClass }}__box {{#boxAddClass}}{{boxAddClass}}{{/boxAddClass}}">'+i("aLUT")+"</span>",ripple:'<span class="{{ customClass }}__ripple js-ripple"></span>'};class r{constructor({customClass:e="tv-control-checkbox",$checkbox:t,tag:i,id:s,name:o,checked:r,disabled:a,labelLeft:l,labelRight:c,labelAddClass:d,boxAddClass:h}){this.$el=null,void 0===i&&(i=l||c?"span":"label");const u=t instanceof $&&!!t.length;if(u){
if(!t.is("input[type=checkbox]"))return void n.logError("`$checkbox` need to be input[type=checkbox]");if(t.hasClass("i-inited"))return;this._setInputId(t,s),this._setInputClass(t,e),this._setInputName(t,o),this._setInputChecked(t,r),this._setInputDisabled(t,a),r=!!t.prop("checked"),a=!!t.attr("disabled")}this.$el=this.render({$checkbox:t,hasCheckbox:u,customClass:e,tag:i,id:s,name:o,checked:r,disabled:a,labelLeft:l,labelRight:c,hasLabel:l||c,labelAddClass:d,boxAddClass:h}),this.$checkbox=u?t:this.$el.find("input[type=checkbox]")}_setInputId(e,t){void 0!==t&&e.attr("id",t)}_setInputClass(t,i){const s=e.render(o.checkboxClass,{customClass:i});t.addClass(s)}_setInputName(e,t){void 0!==t&&e.attr("name",t)}_setInputChecked(e,t){void 0!==t&&e.prop("checked",!!t)}_setInputDisabled(e,t){void 0!==t&&(t?e.setAttribute("disabled","disabled"):e.removeAttr("disabled"))}render(t){const i=t.$checkbox,s=$(e.render(o.labelWrapper,t,o));if(t.hasCheckbox){s.insertBefore(i);s.find("."+t.customClass).andSelf().filter("."+t.customClass).eq(0).prepend(i.detach()),i.addClass("i-inited")}return s}set checked(e){this._setInputChecked(this.$checkbox,!!e)}get checked(){return!!this.$checkbox.prop("checked")}}$.fn.tvControlCheckbox=Object(s.createTvBlockWithInstance)("tv-control-checkbox",(function(e,t={}){return new r(TradingView.mergeObj(t,{$checkbox:e}))})),t.default=r}.call(this,i("nbsC"))},z4nb:function(e,t,i){"use strict";(function(t,s){i("TdlR"),i("JqBf"),i("HbRj");var n=i("sFgq").SidebarCustomScroll,o=i("JWMC").trackEvent,r=i("FBuY").TVXWindowEvents,a=i("fZEr").showConfirm,l='<div class="notes-block"><div class="textnotes-search-header"><div class="search-input-block">'+i("gCS/")+'<div class="search-clean"></div><input type="text" class="search-input" placeholder="'+window.t("Search Note")+'" maxlength="1000" autocomplete="off"></div><div class="new-note-btn">'+i("DVxT")+window.t("NEW")+'</div></div><div class="notes-wrapper"><div class="notes"></div></div></div><div class="notes-desc-block"><div class="notes-desc-wrapper"><div class="notes-desc-inner"><div class="remove-note-btn" title="'+window.t("Delete Text Note")+'">'+i("2B6P")+'</div><div class="title-wrap"><input type="text" maxlength="100" value="" class="title"></div><div class="date"><span class="created">'+window.t("Created ")+'<span class="created-val"></span>. </span><span class="modified">'+window.t("Last edited ")+'<span class="modified-val"></span></span></div><textarea></textarea></div></div></div>',c='<div class="note"><div class="note-header"><div {{#symbol}}title="'+window.t("Open {{symbol}} Text Note")+'"{{/symbol}} class="title {{#symbol}}title_with-badge{{/symbol}}">{{title}}</div>{{#symbol}}<div class="symbol-badge">'+i("hFss")+'<span class="symbol">{{symbol}}</span></div>{{/symbol}}</div><div class="note-desc">{{description}}</div><span class="favorite"></span></div>',d=function(e){this._bridge=e,this._widget=this,this.listNotes=[],this.currentId=void 0,this._createLayout(),this._requestDfd=null,is_authenticated?(this.$notesDescBlock.show(),
this._getUserTextNotes(),this._addListeners()):(this.$notesDescBlock.hide(),this._addTestNoteListeners()),this.active=!0,r.on("windowaddnote",this.attachNote.bind(this)),r.on("windowremovenote",this.deattachNote.bind(this)),r.on("windoweditnote",this.updateNote.bind(this))};function h(e,t){e.symbol_full&&!e.symbolExpr&&(e.symbolExpr=e.symbol_full),this.layout=t,this.render(e)}d.prototype._createLayout=function(){this.$content=this._bridge.$body,$(l).appendTo(this.$content),this.$notesBlock=this.$content.find(".notes-block"),this.$notesDescBlock=this.$content.find(".notes-desc-block"),this.$notesHeader=this.$content.find(".textnotes-search-header"),this.$addNoteBtn=this.$content.find(".new-note-btn"),this.$removeNoteBtn=this.$content.find(".remove-note-btn"),this.$searchInputBlock=this.$content.find(".search-input-block"),this.$searchInput=this.$content.find("input.search-input"),this.$notes=this.$content.find(".notes"),this.$notesWrap=this.$content.find(".notes-wrapper"),this.$searchClean=this.$content.find(".search-clean"),this.$noteDescTitle=this.$content.find("input.title"),this.$noteDescText=this.$content.find("textarea"),this.$notesDescWrap=this.$content.find(".notes-desc-wrapper"),this.$notesDescInner=this.$content.find(".notes-desc-inner"),this.$noteDateCreated=this.$content.find(".created-val"),this.$noteDateModified=this.$content.find(".modified-val"),this._scrollNotes=new n(this.$notesWrap,this.$notes),this._scrollDesc=new n(this.$notesDescWrap,this.$notesDescInner,{showTopShadow:!1}),"iPad"!==navigator.platform&&this.$notesDescWrap.addClass("ov"),this.$noteDescText.autosize({append:""})},d.prototype._addTestNoteListeners=function(){var e=this,t=function(){runOrSignIn((function(){e.$addNoteBtn.off("click",t),e.$removeNoteBtn.off("click",t),e.$noteDescTitle.off("focus",t),e.$searchInput.off("keydown",t),e.$noteDescText.off("keydown",t),e.$noteDescTitle.off("keydown",t),e._getUserTextNotes(),e._addListeners()}),{source:"Text notes",sourceMeta:"Chart"})};this.$addNoteBtn.on("click",t),this.$removeNoteBtn.on("click",t),this.$noteDescTitle.on("focus",t),this.$searchInput.on("keydown",t),this.$noteDescText.on("keydown",t),this.$noteDescTitle.on("keydown",t)},d.prototype._addListeners=function(){var e=this;this.$content.on("contextmenu",(function(e){var t=e.target.tagName.toLowerCase();["input","textarea"].includes(t)||e.preventDefault()})),this.$noteDescTitle.on("keyup",(function(t){13===t.keyCode&&e.$noteDescText.focus(),e.getCurrentNote().update("title",$(this).val())})),this.$noteDescTitle.on("change",(function(t){e.getCurrentNote().update("title",$(this).val(),!0)})),this.$noteDescText.on("change",(function(t){e._scrollDesc.resize(),e._scrollDesc.updateScroll(),e._scrollDesc.updateScrollBar(),e.getCurrentNote().update("description",$(this).val(),!0)})),this.$noteDescText.on("autosize.resized",(function(){e._scrollDesc.resize(),e._scrollDesc.updateScrollBar()})),this.$notesDescBlock.on("scroll",(function(t){var i=this.scrollTop;i&&(this.scrollTop=0,e._scrollDesc.scroll(-i,1))})),
this.$searchClean.on("click",(function(){e.$searchInput.val("").trigger("keyup")})),this.$searchInput.on("keyup",(function(t){for(var i=e.listNotes.length-1;i>=0;i--)-1===e.listNotes[i].get("title").toLowerCase().indexOf(e.$searchInput.val().toLowerCase())&&-1===e.listNotes[i].get("description").toLowerCase().indexOf(e.$searchInput.val().toLowerCase())&&-1===e.listNotes[i].get("symbol").toLowerCase().indexOf(e.$searchInput.val().toLowerCase())?e.listNotes[i].$view.css("display","none"):e.listNotes[i].$view.css("display","block");if(""!==e.$searchInput.val()&&e.$searchInputBlock.addClass("searching"),""===e.$searchInput.val()){e.$searchInputBlock.removeClass("searching");for(i=e.listNotes.length-1;i>=0;i--)e.listNotes[i].$view.css("display","block")}e._scrollNotes.scrollToStart()})),this._bridge.height.subscribe((function(){e.$noteDescText.trigger("autosize.resize"),e._scrollDesc.resize(),e._scrollNotes.resize()})),this._bridge.bottomToolbarMode.subscribe((function(t){"minimized"!==t&&(e.$noteDescText.trigger("autosize.resizeIncludeStyle"),e._scrollDesc.resize(),e._scrollNotes.resize())}),{callWithLast:!0}),this.$removeNoteBtn.on("click.note-remove",this.removeNote.bind(this)),this.$addNoteBtn.on("click",function(){o("Text Notes","BP Text Notes New"),this.addNote()}.bind(this))},d.prototype._getUserTextNotes=function(){this._requestDfd=$.post("/textnotes/getall/"),this._requestDfd.then(function(e){if(0===e.length)this.addNote();else{for(var t in e)this.attachNote(e[t],!0);this.listNotes.length>0&&!this.currentId&&(this.currentId=this.listNotes[0].$view.data("id"),this.$notesDescBlock.show(),this.listNotes[this.listNotes.length-1].select())}}.bind(this))},d.prototype.highlightNoteBySymbol=function(e){if(this._requestDfd){var t=this;this._requestDfd.then((function(){var i=t.getSymbolNote(e).el;i.select(),i.scroll(),i.highlight()}))}},d.prototype.addTextNoteListeners=function(e){var t=this;e.onClick((function(e,i){t._scrollDesc.scrollToStart(),i.select()})),e.$view.find(".favorite").on("click",(function(){$(this).toggleClass("active")})),e.$view.find(".symbol").on("click",(function(){t._bridge.chartWidgetCollection.setSymbol(e.$view.data("symbolExpr"))}))},d.prototype.addNote=function(e,t,i){var s={title:$.t("New Untitled Note"),description:""};t&&(s.symbol=t,s.symbol_full=i),$.post("/textnotes/add/",s,function(e){!1===e&&this._requestDfd&&this._requestDfd.then(function(){var e=null;i&&(e=this.getSymbolNote(i).el),!e&&t&&(e=this.getShortSymbolNote(t).el),e&&(this._scrollNotes.scrollTo(e.$view),e.select())}.bind(this)),e&&(r.emit("windowaddnote",JSON.stringify(e)),this.attachNote(e))}.bind(this))},d.prototype.attachNote=function(e,t){"string"==typeof e&&(e=JSON.parse(e));var i=new h(e,this);this.addTextNoteListeners(i),this.$notes.prepend(i.$view),this.listNotes.push(i),i.blocks.badge.length>0&&i.blocks.title.css("max-width",i.blocks.header.width()-i.blocks.badge.width()-1),t||(i.select(),this.$notesDescBlock.show(),this.$noteDescTitle.select(),e.symbol&&i.highlight(),this._scrollNotes.scrollToStart(),
this._scrollDesc.scrollToStart())},d.prototype.removeNote=function(e){"number"!=typeof e&&(e=this.currentId);var t=this,i=this.getNote(e).el.get("title"),s=$.t("Do you really want to delete Text Note '{name}' ?").format({name:i});a({text:s,onConfirm:function(i){return o("Text Notes","BP Text Notes Delete"),new Promise((function(s){$.post("/textnotes/remove/",{id_note:e},(function(){r.emit("windowremovenote",e),t.deattachNote(e),s(),i.dialogClose()}))}))}})},d.prototype.deattachNote=function(e){var t=this.getNote(e);t.el.$view.remove(),this.listNotes.splice(t.i,1),this.listNotes.length>0&&(this.listNotes[t.i-1]?this.listNotes[t.i-1].select():this.listNotes[t.i]?this.listNotes[t.i].select():this.listNotes[0].select(),this._scrollNotes.resize()),0===this.listNotes.length&&$(".notes-desc-block").hide()},d.prototype.editNote=function(e){var t={id:e.get("id"),title:e.get("title"),symbol:e.get("symbol"),description:e.get("description")};$.post("/textnotes/edit/",t,(function(i){t.modified=i.modified,e.update("modified",i.modified),r.emit("windoweditnote",JSON.stringify(t))}))},d.prototype.updateNote=function(e){"string"==typeof e&&(e=JSON.parse(e)),this.getNote(e.id).el.update(e),this.currentId===e.id&&(this.$noteDescTitle.val(e.title),this.$noteDescText.val(e.description))},d.prototype.getNote=function(e){e=e;for(var t={},i=this.listNotes.length-1;i>=0;i--)this.listNotes[i].$view.data("id")===e&&(t.el=this.listNotes[i],t.i=i);return t},d.prototype.getCurrentNote=function(){return this.getNote(this.currentId).el},d.prototype.getSymbolNote=function(e){for(var t={},i=this.listNotes.length-1;i>=0;i--)this.listNotes[i].get("symbolExpr")===e&&(t.el=this.listNotes[i],t.i=i);return t},d.prototype.getShortSymbolNote=function(e){for(var t={},i=this.listNotes.length-1;i>=0;i--)this.listNotes[i].get("symbol")===e&&(t.el=this.listNotes[i],t.i=i);return t},h.prototype.get=function(e){return this.$view.data(e)},h.prototype.set=function(e,t){return void 0===t&&"object"==typeof e?this.$view.data(e):"string"==typeof e&&this.$view.data(e,t),this},h.prototype.render=function(e){return this.$view=$(t.render(c,e)),this.set(e),this.blocks={modified:this.layout.$noteDateModified,title:this.$view.find(".title"),header:this.$view.find(".note-header"),badge:this.$view.find(".symbol-badge"),description:this.$view.find(".note-desc")},this},h.prototype.updateField=function(e,t){return this.set(e,t),"modified"===e&&(t=s.unix(t).format("D MMM, H:mm.")),this.blocks[e]&&this.blocks[e].text(t),this},h.prototype.update=function(e,t,i){return"string"==typeof e?this.updateField(e,t):"object"==typeof e&&$.each(e,this.updateField.bind(this)),i&&this.layout.editNote(this),this},h.prototype.select=function(){this.layout.currentId=this.get("id");var e=s.unix(this.get("created")),t=e.format("D {0}, H:mm").format(e.format("MMM")),i=s.unix(this.get("modified")),n=i.format("D {0}, H:mm").format(i.format("MMM"));return this.layout.$noteDescTitle.val(this.get("title")),this.layout.$noteDescText.val(this.get("description")).attr("style","").trigger("autosize.resize"),
this.layout.$noteDateCreated.html(t),this.layout.$noteDateModified.html(n),this.layout.$notes.find(".note").removeClass("active"),this.$view.addClass("active"),this},h.prototype.scroll=function(){return this.layout._scrollNotes.scrollTo(this.$view,{position:"top"}),this},h.prototype.highlight=function(){this.$view.highlight(2)},h.prototype.getId=function(){return this.get("id")},h.prototype.onClick=function(e){this.$view.on("click",function(t){t.stopPropagation(),t.preventDefault(),e(t,this)}.bind(this))},h.prototype.onDelete=function(e){this.$view.find(".delete").on("click",function(t){t.stopPropagation(),t.preventDefault(),e(t,this)}.bind(this))},h.prototype.onFavorite=function(e){this.$view.find(".favorite").on("click",function(t){t.stopPropagation(),t.preventDefault(),e(t,this)}.bind(this))},e.exports=d}).call(this,i("nbsC"),i("ldgD"))},zSwQ:function(e,t,i){"use strict";i.d(t,"a",(function(){return o}));var s=i("q1tI"),n=i("i8i4");function o(e){var t;return(t=class extends s.PureComponent{constructor(e){super(e),this._getComponentInstance=e=>{this._instance=e},this._throttleCalcProps=()=>{requestAnimationFrame(()=>this.setState(this._calcProps(this.props)))},this.state=this._getStateFromProps()}componentDidMount(){this._instanceElem=n.findDOMNode(this._instance),this.props.attachOnce||this._subscribe(),this.setState(this._calcProps(this.props))}componentDidUpdate(e){e.children===this.props.children&&e.top===this.props.top&&e.left===this.props.left&&e.width===this.props.width||this.setState(this._getStateFromProps(),()=>this.setState(this._calcProps(this.props)))}render(){return s.createElement("div",{style:{position:"absolute",width:"100%",top:0,left:0}},s.createElement(e,Object.assign({},this.props,{ref:this._getComponentInstance,top:this.state.top,bottom:void 0!==this.state.bottom?this.state.bottom:"auto",right:void 0!==this.state.right?this.state.right:"auto",left:this.state.left,width:this.state.width,maxWidth:this.state.maxWidth}),this.props.children))}componentWillUnmount(){this._unsubsribe()}_getStateFromProps(){return{bottom:this.props.bottom,left:this.props.left,right:this.props.right,top:void 0!==this.props.top?this.props.top:-1e4,width:this.props.inheritWidthFromTarget?this.props.target&&this.props.target.getBoundingClientRect().width:this.props.width,maxWidth:this.props.inheritMaxWidthFromTarget&&this.props.target&&this.props.target.getBoundingClientRect().width}}_calcProps(e){if(e.target&&e.attachment&&e.targetAttachment){const t=this._calcTargetProps(e.target,e.attachment,e.targetAttachment);if(null===t)return{};const{width:i,inheritWidthFromTarget:s=!0,inheritMaxWidthFromTarget:n=!1}=this.props,o={width:s?t.width:i,maxWidth:n?t.width:void 0};switch(e.attachment.vertical){case"bottom":case"middle":o.top=t.y;break;default:o[e.attachment.vertical]=t.y}switch(e.attachment.horizontal){case"right":case"center":o.left=t.x;break;default:o[e.attachment.horizontal]=t.x}return o}return{}}_calcTargetProps(e,t,i){
const s=e.getBoundingClientRect(),n=this._instanceElem.getBoundingClientRect(),o="parent"===this.props.root?this._getCoordsRelToParentEl(e,s):this._getCoordsRelToDocument(s);if(null===o)return null;const r=this._getDimensions(n),a=this._getDimensions(s).width;let l=0,c=0;switch(t.vertical){case"top":c=o[i.vertical];break;case"bottom":c=o[i.vertical]-r.height;break;case"middle":c=o[i.vertical]-r.height/2}switch(t.horizontal){case"left":l=o[i.horizontal];break;case"right":l=o[i.horizontal]-r.width;break;case"center":l=o[i.horizontal]-r.width/2}return"number"==typeof this.props.attachmentOffsetY&&(c+=this.props.attachmentOffsetY),"number"==typeof this.props.attachmentOffsetX&&(l+=this.props.attachmentOffsetX),{x:l,y:c,width:a}}_getCoordsRelToDocument(e){const t=pageYOffset,i=pageXOffset,s=e.top+t,n=e.bottom+t,o=e.left+i;return{top:s,bottom:n,left:o,right:e.right+i,middle:(s+e.height)/2,center:o+e.width/2}}_getCoordsRelToParentEl(e,t){const i=e.offsetParent;if(null===i)return null;const s=i.scrollTop,n=i.scrollLeft,o=e.offsetTop+s,r=e.offsetLeft+n,a=t.width+r;return{top:o,bottom:t.height+o,left:r,right:a,middle:(o+t.height)/2,center:(r+t.width)/2}}_getDimensions(e){return{height:e.height,width:e.width}}_subscribe(){"document"===this.props.root&&(window.addEventListener("scroll",this._throttleCalcProps,!0),window.addEventListener("resize",this._throttleCalcProps))}_unsubsribe(){window.removeEventListener("scroll",this._throttleCalcProps,!0),window.removeEventListener("resize",this._throttleCalcProps)}}).displayName="Attachable Component",t}},zbX1:function(e,t){e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 18" width="20" height="18" fill="none"><g><path fill="#078440" d="M3.15 12.06L.1 16.35c-.26.36 0 .87.45.87h18.9c.45 0 .7-.5.45-.87l-3.5-4.94-1.65.97a1.65 1.65 0 1 1-3.29-.2l-2.64-1.94a1.64 1.64 0 0 1-2.23-.14l-3.44 1.96z"/></g><g><path fill="#00B453" d="M9.57.23l-6.4 8.99a.55.55 0 0 0 .17.8l.58.34L6.13 9.1v-.14a1.65 1.65 0 1 1 3.26.34l2.54 1.86a1.64 1.64 0 0 1 2.47.14l2.36-1.38a.55.55 0 0 0 .06-.7L10.46.22a.55.55 0 0 0-.9 0z"/></g></svg>'}}]);