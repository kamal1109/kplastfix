(window.webpackJsonp=window.webpackJsonp||[]).push([[255],{JJau:function(t,i,o){"use strict";function n(t){return t.childElementCount?Array.prototype.map.call(t.childNodes,n).join("")+("DIV"===t.tagName?"\n":""):"BR"===t.tagName?"\n":t.textContent||""}o.r(i),o.d(i,"getInnerTextContent",(function(){return n}))},P6OK:function(t,i,o){},PQvG:function(t,i,o){"use strict";var n=o("TxTq"),a=o("FBuY").TVXWindowEvents,e=o("JWMC").trackEvent,s=function(){var t="tvdesktopnotifications.";a.on("desktop-notification-tab-visibility-request",(function(){"true"===TVLocalStorage.getItem(t+"tabs-hidden")&&TVLocalStorage.setItem(t+"tabs-hidden",document.hidden)}));function i(t){var i=t.split("\n");return i.length>1&&(t=i[0]),((t=t.trim()).length>30||i.length>1)&&(t=t.substring(0,30)+"..."),t}function o(){return window.Notification.permission}function s(t){var i=o();"granted"===i&&"function"==typeof t?t():"default"===i&&window.Notification.requestPermission((function(i){"granted"===i&&"function"==typeof t&&t()}))}return window.Notification?{show:function(l,c,d,f){n.ownPushStream()&&(e("Desktop Notifications","Notification Show Attempt"),"denied"!==o()&&s((function(){TVLocalStorage.setItem(t+"tabs-hidden",document.hidden),a.emit("desktop-notification-tab-visibility-request"),setTimeout((function(){"false"!==TVLocalStorage.getItem(t+"tabs-hidden")&&document.hidden?(!function(t,o,n,a){var e=new window.Notification(t,{body:i(o),icon:n||"/static/images/desktop-notification.png"});e.onclick=function(){window.focus(),"function"==typeof a&&a()},setTimeout(e.close.bind(e),5e3)}(l,c,d,f),e("Desktop Notifications","Notification Show Success")):e("Desktop Notifications","Notification Show Tab Visible")}),100)})))},askPermission:s}:{show:function(){},askPermission:function(){}}}();t.exports=s},sMRa:function(t,i,o){"use strict";o.r(i),function(t){o.d(i,"GlobalNotificationTools",(function(){return p}));o("P5fv"),o("Lqq7"),o("YFKU");var n=o("JWp+"),a=o("PQvG"),e=o("Vdly"),s=o("aIyQ"),l=o.n(s),c=o("hY0g"),d=o.n(c),f=o("TxTq"),r=o.n(f),u=o("qjxE"),h=o("JJau"),_=o("xkbY"),g=o("FBuY"),b=o("c2JX"),N=o("uFcS");const w=`<div class="tv-feed-list__item tv-global-notification-block" data-notification-id="{{id}}">\n\t\t<div class="tv-global-notification-block__general">\n\t\t\t<div class="tv-global-notification-block__read-flag-wrap js-global-notifications-unread-flag">\n\t\t\t\t{{#unread}}\n\t\t\t\t\t<span class="tv-global-notification-block__icon-bulb">${N}</span>\n\t\t\t\t{{/unread}}\n\t\t\t</div>\n\t\t\t<div class="tv-global-notification-block__time tv-global-notification-block__section-right">\n\t\t\t\t<div class="tv-global-notification-block__time-item">\n\t\t\t\t\t<span class="tv-global-notification-block__time-label"><time></time></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="tv-global-notification-block__text-wrap">\n\t\t\t\t<div class="tv-global-notification-block__text">\n\t\t\t\t\t{{{notification}}}\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>`;class p{constructor(){if(p._instance)return p._instance;p._instance=this,
this._dataLoading=!1,this._dialog=null,this._firstTimeDialog=!0,this._isAllNotificationsShowed=!1,this._newNotificationIds=[],this._deleteNotificationIds=[],this._lastShowedNotificationId=null,this._unreadNotificationsCount=new d.a(0);const t=window.lastGlobalNotificationIds;try{this._lastId=e.getInt(p.settingsKey,0)}catch(i){this._lastId=0}if(this._lastId){let i=0;for(let o=0;o<t.length;o++)t[o]>this._lastId&&(i+=1);this._unreadNotificationsCount.setValue(i)}else t.length>0&&this._changeLastId(t[0]);return p._instance}getUnreadNotificationsCount(){return this._unreadNotificationsCount}showNotificationsDialog(){this._isAllNotificationsShowed=!1,this._lastShowedNotificationId=null;const i=$(t.render('<div class="tv-global-notification-block__dialog-content">\n\t\t<div class="tv-site-widget">\n\t\t\t<div class=" js-global-notifications-list"></div>\n\t\t</div>\n\t\t<div class="tv-global-notification-block__dialog-item-spinner js-global-notifications-spinner"></div>\n\t</div>',null)),a=i.find(".js-global-notifications-list"),e=i.find(".js-global-notifications-spinner");Promise.all([o.e("vendors"),o.e(18),o.e("dialogs-core"),o.e(24),o.e(32),o.e(33),o.e(49),o.e(38),o.e(48),o.e("create-dialog")]).then(o.bind(null,"YDhE")).then(({createDialog:t})=>{this._dialog=t({content:i,destroyOnClose:!0,height:540,title:$.t("What's New"),width:500}),this._dialog.on("beforeClose",()=>{this._dialog=null,this._unreadNotificationsCount.setValue(0)}),this._dialog.open(),this._subscribeScrollToEnd(this._dialog.scroll,e[0],t=>{t.globalNotifications&&t.globalNotifications.length&&this._updateNotificationsList(t,a,()=>{this._dialog&&this._dialog.scroll&&this._dialog.scroll.updateScrollBar()})}),p.bigAjaxSpinner.spin(i[0]),this._dataLoading=!0,Object(n.getGlobalNotifications)(this._lastShowedNotificationId,p.ITEMS_PER_PAGE).then(t=>{t.globalNotifications&&t.globalNotifications.length?(this._lastShowedNotificationId=t.globalNotifications[t.globalNotifications.length-1].id,this._createNotificationsList(t,a,t=>{p._makeNotificationElement(t).appendTo(a)},()=>{this._dialog&&this._dialog.updateScroll(),p._broadcastReadAllNotifications()})):p.bigAjaxSpinner.stop()})})}subscribeNotificationsDialogToPushStream(){if(this._firstTimeDialog){this._firstTimeDialog=!1;const t=()=>null!=this._dialog;this._subscribeNewGlobalNotification(t,t=>{const i=p._makeNotificationElement(t);if(this._dialog){const t=this._dialog.$el.find(".js-global-notifications-list");t&&i.prependTo(t),this._dialog.scroll&&this._dialog.scroll.scrollToStart(),this._unreadNotificationsCount.setValue(0)}return this._changeLastId(t.id),p._broadcastReadAllNotifications(),i},void 0,!0),this._subscribeDeleteGlobalNotification(t,t=>{if(this._dialog){this._dialog.$el.find(".js-global-notifications-list").find(`[data-notification-id="${t.id}"]`).remove()}}),this._subscribeTVXWindowReadAllNotifications()}}_createNotificationsList(t,i,o,n){this._isAllNotificationsShowed=!1,i.empty(),p.bigAjaxSpinner.stop(),t.globalNotifications.forEach((t,i)=>{t.unread=i<this._unreadNotificationsCount.value(),o(t)}),
this._unreadNotificationsCount.value()>0&&this._changeLastId(t.globalNotifications[0].id);let a=this._unreadNotificationsCount.value()-p.ITEMS_PER_PAGE;a<0&&(a=0),this._unreadNotificationsCount.setValue(a),this._dataLoading=!1,p._fadeOutUnreadFlags(i),n&&n()}_updateNotificationsList(t,i,o){t.globalNotifications.forEach((t,o)=>{t.unread=o<this._unreadNotificationsCount.value();const n=p._makeNotificationElement(t);n.appendTo(i),t.unread&&p._fadeOutUnreadFlags(n)});let n=this._unreadNotificationsCount.value()-p.ITEMS_PER_PAGE;n<0&&(n=0),this._unreadNotificationsCount.setValue(n),this._dataLoading=!1,p.miniAjaxSpinner.stop(),o&&o()}_processNewNotification(t){const i=t.closedListCallBack,o=t.isListOpened,n=t.itemCallBack,e=t.newNotification,s=t.showToast||!1;if(e.language===p.locale||"all"===e.language)if(o){e.unread=!0;const t=n(e);null!=t&&p._fadeOutUnreadFlags(t)}else this._newNotificationIds.includes(e.id)||(this._newNotificationIds.push(e.id),this._unreadNotificationsCount.setValue(this._unreadNotificationsCount.value()+1),e.important&&s&&Object(_.a)(e.notification),a.show($.t("New Update"),Object(h.getInnerTextContent)($("<div>").html(e.notification)[0]),void 0,()=>{this.showNotificationsDialog()})),i&&i()}_processDeleteNotification(t){const i=t.isListOpened,o=t.itemCallBack,n=t.deleteNotification;if(n.language===p.locale||"all"===n.language)if(i)o&&o(n);else if(!this._deleteNotificationIds.includes(n.id)&&(this._deleteNotificationIds.push(n.id),this._lastId<n.id)){let t=this._unreadNotificationsCount.value()-1;t<0&&(t=0),this._unreadNotificationsCount.setValue(t),p._deleteNewNotificationDelegate.fire()}}_scrollToEnd(t){return new Promise(i=>{this._isAllNotificationsShowed||this._dataLoading||(p.miniAjaxSpinner.spin(t),this._dataLoading=!0,Object(n.getGlobalNotifications)(this._lastShowedNotificationId,p.ITEMS_PER_PAGE).then(t=>{if(!t.globalNotifications||!t.globalNotifications.length)return this._isAllNotificationsShowed=!0,void p.miniAjaxSpinner.stop();this._lastShowedNotificationId=t.globalNotifications[t.globalNotifications.length-1].id,i(t)}))})}_subscribeScrollToEnd(t,i,o){t&&t.scrolltoend.subscribe(this,()=>{this._scrollToEnd(i).then(o)})}_subscribeNewGlobalNotification(t,i,o,n){r.a.on(p.onPushStreamNewGlobalNotification,a=>{this._processNewNotification({closedListCallBack:o,isListOpened:t(),itemCallBack:i,newNotification:a,showToast:n})})}_subscribeDeleteGlobalNotification(t,i){r.a.on(p.onPushStreamDeleteGlobalNotification,o=>{this._processDeleteNotification({deleteNotification:o,isListOpened:t(),itemCallBack:i})})}_subscribeTVXWindowReadAllNotifications(t){g.TVXWindowEvents.on(p.onTVXWindowReadAllNotifications,()=>{t&&t(),this._unreadNotificationsCount.setValue(0)})}_changeLastId(t){this._lastId!==t&&(this._lastId=t,e.setValue(p.settingsKey,t,{forceFlush:!0}))}static _makeNotificationElement(i){const o=$(t.render(w,i));return Object(u.jQueryCompatibleAgoDateFormatter)(o.find(".tv-global-notification-block__time-label time"),new Date(1e3*i.created)),o}static _fadeOutUnreadFlags(t){
if(p.UNREAD_FLAGS_FADE_OUT_TIME>0){t.find(".js-global-notifications-unread-flag").animate({opacity:0},p.UNREAD_FLAGS_FADE_OUT_TIME)}}static _broadcastReadAllNotifications(){p._readAllNotificationsDelegate.fire(),g.TVXWindowEvents.emit(p.onTVXWindowReadAllNotifications)}}p.ITEMS_PER_PAGE=10,p.UNREAD_FLAGS_FADE_OUT_TIME=0,p.locale=window.locale||"en",p.settingsKey="en"===p.locale?"globalNotification":"globalNotification_"+p.locale,p.onTVXWindowReadAllNotifications="en"===p.locale?"read-all-global-notifications":"read-all-global-notifications_"+p.locale,p.onPushStreamNewGlobalNotification="new-global-notification",p.onPushStreamDeleteGlobalNotification="delete-global-notification",p.bigAjaxSpinner=new b.Spinner,p.miniAjaxSpinner=new b.Spinner("mini"),p._readAllNotificationsDelegate=new l.a,p._deleteNewNotificationDelegate=new l.a}.call(this,o("nbsC"))},uFcS:function(t,i){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 14" width="10px" height="14px"><circle cx="5" cy="7" r="3"/></svg>'},xkbY:function(t,i,o){"use strict";o.d(i,"a",(function(){return n}));o("NNtz");async function n(t){(await Promise.all([o.e(92),o.e(107),o.e(121),o.e(575),o.e(98),o.e("global-notification")]).then(o.bind(null,"K9fc"))).showGlobalNotificationToast(t)}}}]);