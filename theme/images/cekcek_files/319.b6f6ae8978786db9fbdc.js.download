(window.webpackJsonp=window.webpackJsonp||[]).push([[319],{"2Ey9":function(t,e,i){t.exports={container:"container-29Jv6tZx","type-default":"type-default-29Jv6tZx",noIcon:"noIcon-29Jv6tZx",warningIcon:"warningIcon-29Jv6tZx",hint:"hint-29Jv6tZx",warningHeader:"warningHeader-29Jv6tZx","type-notaccurate":"type-notaccurate-29Jv6tZx",noBorder:"noBorder-29Jv6tZx",closeIcon:"closeIcon-29Jv6tZx",link:"link-29Jv6tZx"}},"8ERA":function(t,e,i){"use strict";i.r(e);var r=i("q1tI"),a=i.n(r),n=i("i8i4"),o=i("YFKU"),s=i("Cx2C"),d=i("z6kS"),c=i("1uKM"),p=i("ltBP");function h(t){let e="";const i="?solution="+function(t){switch(t){case"nonStandard":return d.a.STRATEGY_UNREALISTIC_RESULTS;case"lookaheadFutureData":return d.a.STRATEGY_FUTURE_DATA}}(t);switch(t){case"nonStandard":e=o.t("Backtesting on non-standard charts produces unrealistic results.");break;case"lookaheadFutureData":e=o.t("This strategy may use look-ahead bias, which can lead to unrealistically profitable results.")}return a.a.createElement(a.a.Fragment,null,e," ",a.a.createElement("a",{className:p.solutionLink,href:i},o.t("Learn more")))}function l(t){const[e,i]=Object(r.useState)(!1),[n,d]=Object(r.useState)(!1);let l;if(t.isRangeBasedStyle&&!e)l="nonStandard";else{if(!t.hasLookaheadFutureData||n)return a.a.createElement(a.a.Fragment,null);l="lookaheadFutureData"}const u=o.t("Caution!");return a.a.createElement("div",{className:p.container},a.a.createElement(s.a,{warningHeader:u,text:h(l),warningIcon:c,onClose:()=>{"nonStandard"===l?i(!0):d(!0)}}))}function u(t,e){return n.render(r.createElement(l,Object.assign({},e)),t)}i.d(e,"addStrategyHint",(function(){return u}))},"9yfN":function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 13 11" width="13" height="11"><path fill="currentColor" d="M5 0c-.942 0-1.69.178-2.25.53-.56.354-.844.834-.844 1.47v1.906c0 .394-.137.686-.437.875-.3.19-.8.277-1.47.285v.875c.62 0 1.08.1 1.403.28.326.18.5.48.5.906V9c0 .632.274 1.12.813 1.47.537.348 1.297.522 2.28.53v-.875c-.585-.008-1.04-.092-1.344-.28-.303-.19-.437-.49-.437-.908V7.095c0-.883-.597-1.403-1.75-1.563v-.06c1.153-.16 1.75-.68 1.75-1.564V2.094C3.22 1.3 3.81.868 5 .844V0zm3 0v.844c1.19.024 1.78.457 1.78 1.25v1.812c0 .883.597 1.403 1.75 1.563v.06c-1.153.16-1.75.68-1.75 1.56v1.844c0 .42-.133.718-.436.907-.303.19-.76.274-1.344.28V11c.983-.008 1.743-.182 2.28-.53.54-.35.814-.838.814-1.47V7.125c0-.427.174-.724.5-.906.326-.187.785-.285 1.406-.285V5.06c-.673-.01-1.17-.092-1.47-.28-.3-.19-.436-.48-.436-.875V2c0-.636-.285-1.116-.844-1.47C9.69.18 8.942 0 8 0z"/></svg>'},"AXL+":function(t,e,i){"use strict";i.r(e),i.d(e,"saveTextFile",(function(){return a})),i.d(e,"escapeCSVValue",(function(){return d}));var r=i("qFKp");function a(t,e,i="text/plain"){const a=new Blob([e],{type:i});if(r.CheckMobile.iOS()){const e=new FileReader;return e.onload=()=>{e.result&&n(t,e.result.toString())},void e.readAsDataURL(a)}const o=window.URL.createObjectURL(a);navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(a,t):window.navigator.msSaveBlob?window.navigator.msSaveBlob(a,t):(n(t,o),
window.URL.revokeObjectURL(o))}function n(t,e){const i=document.createElement("a");i.style.display="none",document.body.appendChild(i),i.href=e,i.download=t,i.click(),document.body.removeChild(i)}const o=/[",\r\n]/,s=/"/g;function d(t){return o.test(t)?`"${t.replace(s,'""')}"`:t}},Cx2C:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var r=i("q1tI"),a=i.n(r),n=i("YFKU"),o=i("Iivm"),s=i("xOeO"),d=i("To8B"),c=i("2Ey9"),p=i("TSYQ"),h=i.n(p);function l(t){const{text:e,warningHeader:i,warningType:r="default",solutionId:p,warningIcon:l,onClose:u}=t,_=h()(c.container,c["type-"+r]);return a.a.createElement("div",{className:_},a.a.createElement("div",{className:c.hint},l&&a.a.createElement(o.a,{className:c.warningIcon,icon:l}),a.a.createElement("span",null,i&&a.a.createElement("span",{className:c.warningHeader},i," "),a.a.createElement("span",null,e),p&&a.a.createElement("span",{className:c.link,onClick:()=>Object(s.showSupportDialog)({solutionId:p})}," ",Object(n.t)("Learn more"))),a.a.createElement(o.a,{className:c.closeIcon,icon:d,onClick:u})))}},E0Vc:function(t,e,i){},R84a:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 14" width="17" height="14" fill="none"><path fill="currentColor" d="M1 9v1.5A2.5 2.5 0 0 0 3.5 13h10a2.5 2.5 0 0 0 2.5-2.5V9h-1v1.5a1.5 1.5 0 0 1-1.5 1.5h-10A1.5 1.5 0 0 1 2 10.5V9H1z"/><path fill="currentColor" fill-rule="evenodd" clip-rule="evenodd" d="M8 1h1v8H8V1z"/><path fill="currentColor" d="M5.35 5.65l-.7.7 3.85 3.86 3.85-3.86-.7-.7L8.5 8.79 5.35 5.65z"/></svg>'},RgOa:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14" width="14" height="14" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M8.63 1.08a2.04 2.04 0 0 1-3.26 0c-.51.14-1 .35-1.45.6l.01.2A2.05 2.05 0 0 1 1.7 3.93a6.1 6.1 0 0 0-.6 1.45 2.04 2.04 0 0 1 0 3.26c.13.51.34 1 .6 1.45l.2-.01a2.05 2.05 0 0 1 2.03 2.24c.45.26.94.47 1.45.6a2.04 2.04 0 0 1 3.26 0c.51-.13 1-.34 1.45-.6l-.01-.2a2.05 2.05 0 0 1 2.24-2.03c.26-.45.47-.94.6-1.45a2.04 2.04 0 0 1 0-3.26 6.1 6.1 0 0 0-.6-1.45 2.05 2.05 0 0 1-2.23-2.23 6.1 6.1 0 0 0-1.45-.6zM7.84.42c.17-.24.43-.47.72-.4.84.18 1.62.5 2.32.96.23.15.26.48.22.76a1.03 1.03 0 0 0 1.16 1.16c.28-.04.6-.01.76.22.45.7.78 1.48.97 2.32.06.29-.17.55-.41.72a1.02 1.02 0 0 0 0 1.68c.24.17.47.43.4.72a7.12 7.12 0 0 1-.96 2.32c-.15.23-.48.26-.76.22a1.03 1.03 0 0 0-1.17 1.01l.01.15c.04.28.01.6-.22.76-.7.45-1.48.78-2.32.97-.29.06-.55-.17-.72-.41a1.02 1.02 0 0 0-1.68 0c-.17.24-.43.47-.72.4a7.12 7.12 0 0 1-2.32-.96c-.23-.15-.26-.48-.22-.76v-.15a1.02 1.02 0 0 0-1.16-1c-.28.03-.6 0-.76-.23A7.12 7.12 0 0 1 0 8.56c-.06-.29.17-.55.41-.72a1.02 1.02 0 0 0 0-1.68c-.24-.17-.47-.43-.4-.72.18-.84.5-1.62.96-2.32.15-.23.48-.26.76-.22h.15a1.02 1.02 0 0 0 1-1.16c-.03-.28 0-.6.23-.76C3.82.53 4.6.2 5.44 0c.29-.06.55.17.72.41a1.02 1.02 0 0 0 1.68 0zM9 7a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm1 0a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/></svg>'},To8B:function(t,e){
t.exports='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"><path fill="currentColor" d="M9.707 9l4.647-4.646-.707-.708L9 8.293 4.354 3.646l-.708.708L8.293 9l-4.647 4.646.708.708L9 9.707l4.646 4.647.708-.707L9.707 9z"/></svg>'},"f2m/":function(t,e,i){"use strict";i.r(e),function(t){i.d(e,"getCSVReport",(function(){return l})),i.d(e,"createPerformanceDataForCSV",(function(){return _})),i.d(e,"getPerformanceDataCSVString",(function(){return g})),i.d(e,"currencySymbolMap",(function(){return v})),i.d(e,"createTradesDataForCSV",(function(){return b})),i.d(e,"orderTypeCaption",(function(){return w})),i.d(e,"getTradesDataCSVString",(function(){return D}));var r=i("Ialn").forceLTRStr,a=i("wiCH").currencyDecimals,n=i("wiCH").percentDecimals,o=i("wiCH").defaultDecimals,s=i("AXL+").saveTextFile,d=i("AXL+").escapeCSVValue,c=i("e1ZQ").dateFormatFunctions,p=i("jCNj"),h=i("h24c").parseIntervalValue;function l(t,e,i,r,s){if("drawdown"!==i){var d=t.currency,c=(t="performance"===i?t.performance:t.trades,e.model.mainSeries()),l=c.formatter()._fractionalLength,f=function(t){var e=t.model.model().properties().timezone,i="Etc/UTC",r=function(t,e){var i=e.value();if(i){if("exchange"===i){var r=t.model.mainSeries().symbolInfo().timezone;r&&(i=r)}return i}}(t,e);if(!r||r===i)return void(r||null);if(i=r,!p)throw new ReferenceError("PineJsCalendar is undefined");var a=p.get_timezone(r);return a.is_valid()&&a||null}(e),y=h(c.interval()),m=y&&y.intraday,v=s.replace(/ /g,"_");switch(i){case"performance":u(g(_(t,r,d,l,a,o,n),d),v);break;case"trades":u(D(b(t,d,l,a,o,n,f,m),d),v)}}}function u(t,e){var i=new Date,r=c["yyyy-MM-dd"](i,!0);s(`${e}_${r}.csv`,t,"text/csv")}function _(t,e,i,r,a,n,o){for(var s,d,c,p,h,l,u,_,g=Object.keys(e),y=[],m={},v=0,b=["all","long","short"];v<g.length;v++){for(s=g[v],_=s+"Percent",d=!1,c=e[s].title||"",m.title=c,p=0;p<b.length;p++){if(l=t[h=b[p]][s],u=t[h][_],void 0!==l){var w=f(s,l,void 0,e,i,r,a,n,o);if(m[""+b[p]]=w,void 0!==u){w=f(s,l,u,e,i,r,a,n,o);m[b[p]+"Percent"]=w}d=!0}2===p&&(y[""+v]=m,m={})}if(!d){c=e[s].title||"",l=t[s],u=t[_];w=f(s,l,void 0,e,i,r,a,n,o);if(void 0!==u){var $=f(s,l,u,e,i,r,a,n,o);m[b[0]+"Percent"]=$}m.title=c,m[""+b[0]]=w,y[""+v]=m,m={}}}return y}function g(t,e){var i=T(e);return[[d(""),d($.t("All")+""+i),d($.t("All %")),d($.t("Long")+""+i),d($.t("Long %")),d($.t("Short")+""+i),d($.t("Short %"))].join(","),...t.map((function(t){return[d(t.title),d(t.all?t.all:""),d(t.allPercent?t.allPercent:""),d(t.long?t.long:""),d(t.longPercent?t.longPercent:""),d(t.short?t.short:""),d(t.shortPercent?t.shortPercent:"")].join(",")}))].join("\r\n")}function f(t,e,i,r,a,n,o,s,d){if(void 0===e)return $.t("N/A");var c=y(e,r[t].unit,a,n,o,s,d);return void 0===i?c:i=y(i,"percent",a,n,o,s,d)}function y(t,e,i,a,n,o,s){var d=$.t("N/A"),c="";if(null===t)return d;switch(e){case"series":d=m(t,a).toFixed(a);break;case"currency":d=t<Math.pow(10,-n)?function(){for(var e,i=2;i<=8;i++)if(0!==(e=m(t,i)))return e.toFixed(i);return"0"}():m(t,n).toFixed(n),c="";break;case"percent":d=m(100*t,s),c="";break;case"pc":
d=Math.round(t);break;default:d=m(t,o)}return r(d+c)}function m(t,e){var i=Math.pow(10,e||0).toFixed(e<0?-e:0);return Math.round(t*i)/i}var v={usd:{symbol:"&dollar;",before:!0,noMarkup:"$"},eur:{symbol:"&euro;",noMarkup:"€"},aud:{symbol:"A&dollar;",noMarkup:"A$"},gbp:{symbol:"&pound;",noMarkup:"£"},cad:{symbol:"C&dollar;",noMarkup:"C$"},chf:{symbol:"₣",noMarkup:"₣"},hkd:{symbol:"HK&dollar;",noMarkup:"HK$"},jpy:{symbol:"&yen;",noMarkup:"¥"},sgd:{symbol:"S&dollar;",noMarkup:"S$"}};function b(t,e,i,r,a,n,o,s){for(var d=[],c=0;c<t.length;c++){var p=S(t[c],c,e,i,r,a,n,o,s);for(var h in p)d[""+Object.keys(d).length]=p[""+h]}return d}function w(t){return{se:$.t("Entry Short"),sx:$.t("Exit Short"),le:$.t("Entry Long"),lx:$.t("Exit Long")}[t]||t}function S(t,e,i,r,a,n,o,s,d){for(var c,p,h,l={},u={},_=["e","x"],g=!t.x.c,f=0;f<_.length;f++){h=!t[p=_[f]].c,!c&&h&&(c=!0);var m=C(c,t,"tp",i,r,a,n,o),v=C(c,t,"cp",i,r,a,n,o),b=C(c,t,"rn",i,r,a,n,o),S=C(c,t,"dd",i,r,a,n,o);u.trade=e+1,u.type=w(t[p].tp),u.signal=h&&$.t("Open")||t[p].c,u.date=!h&&t[p].tm&&W(t[p].tm,s,d),u.price=!h&&"number"==typeof t[p].p&&y(t[p].p,"series",0,r,a,n,o)||"",u.contracts=!g&&!c&&t.q||"",u.profit=!g&&m.value||"",u.profitPercent=!g&&m.percent||"",u.cumProfit=!g&&v.value||"",u.cumProfitPercent=!g&&v.percent||"",u.runUp=!g&&b.value||"",u.runUpPercent=!g&&b.percent||"",u.drawdown=!g&&S.value||"",u.drawdownPercent=!g&&S.percent||"",l[f]=u,u={}}return l}function C(t,e,i,r,a,n,o,s){if(!t&&void 0!==e[i]&&"number"==typeof e[i].v){var d=y(e[i].v,"currency",0,a,n,o,s);if("number"==typeof e[i].p){var c={};c.value=d,c.percent=y(e[i].p,"percent",0,a,n,o,s),d=c}return d}return""}function T(t){if(t){var e=t.toLowerCase();return v[e]?" "+v[e].noMarkup:" "+t}return""}function D(t,e){var i=T(e);return[[d($.t("Trade #")),d($.t("Type")),d($.t("Signal")),d($.t("Date/Time")),d($.t("Price")),d($.t("Contracts")),d($.t("Profit")+""+i),d($.t("Profit %")),d($.t("Cum. Profit")+""+i),d($.t("Cum. Profit %")),d($.t("Run-up")+""+i),d($.t("Run-up %")),d($.t("Drawdown")+""+i),d($.t("Drawdown %"))].join(","),...t.map((function(t){return[d(t.trade),d(t.type),d(t.signal),d(t.date?t.date:""),d(t.price?t.price:""),d(t.contracts?t.contracts:""),d(t.profit?t.profit:""),d(t.profitPercent?t.profitPercent:""),d(t.cumProfit?t.cumProfit:""),d(t.cumProfitPercent?t.cumProfitPercent:""),d(t.runUp?t.runUp:""),d(t.runUpPercent?t.runUpPercent:""),d(t.drawdown?t.drawdown:""),d(t.drawdownPercent?t.drawdownPercent:"")].join(",")}))].join("\r\n")}function W(e,i,r){var a=0;return i&&(a=i.offset_utc(e)),t(e+a).utc().format("YYYY-MM-DD"+(r?" HH:mm":""))}}.call(this,i("ldgD"))},go63:function(t,e,i){"use strict";(function(e,r,a){
var n,o=window,s=i("7KDR").Action,d=i("5VQP").ContextMenuManager,c=i("h24c").parseIntervalValue,p=i("jCNj"),h=i("3g8u").MiniChartWidget,l=i("bR4N"),u=l.bindPopupMenu,_=l.unbindPopupMenu,g=i("c2JX").Spinner,f=i("JWMC").trackEvent,y=i("Ialn").forceLTRStr,m=i("1fnd"),v=i("2O5g").invokeAlertEditorWithOnlineSeries,b=i("xOeO").showSupportDialog,w=i("f2m/").getCSVReport,S=i("f2m/").currencySymbolMap,C=i("f2m/").orderTypeCaption,T=i("wiCH").currencyDecimals,D=i("wiCH").percentDecimals,W=i("wiCH").defaultDecimals,L=i("2uTr").appendEllipsis,E=i("NP3r").enabled,R=i("bKsZ").ProductFeatures,k=i("oOPW").createGoProDialog,P=i("8ERA").addStrategyHint;function A(t){return t+"Percent"}function x(t,i){if(!(this instanceof x))throw new Error("BacktestingWidget is a constructor");if(this.$container=t.$body,this._isStatic=t.isStatic,this._reportWidgetsSets=[],this._reportWidgetsSet=null,i&&(this._strategyToSelect=i),this._strategyChange=new e,this._bridge=t,this._dispatcher=t.backtestingStrategyDispatcher,!this._isStatic){var r=this._dispatcher.chartWidgetCollection();r&&r.readOnly()&&(this._isStatic=!0)}!function(){if(n)return;var t=function(t){return 0!==t};n={drawdown:{_gaEvent:"Overview",settings:{title:$.t("Overview"),miniChartMinHeight:78,overviewPerformanceFields:["netProfit","totalTrades","percentProfitable","profitFactor","maxStrategyDrawDown","avgTrade","avgBarsInTrade"]},ctor:N},performance:{_gaEvent:"Performance Summary",settings:{title:$.t("Performance Summary"),fields:{netProfit:{title:$.t("Net Profit"),unit:"currency"},grossProfit:{title:$.t("Gross Profit"),unit:"currency"},grossLoss:{title:$.t("Gross Loss"),unit:"currency",isNegative:t},maxStrategyDrawDown:{title:$.t("Max Drawdown"),unit:"currency",isNegative:t},buyHoldReturn:{title:$.t("Buy & Hold Return"),unit:"currency"},sharpeRatio:{title:$.t("Sharpe Ratio")},profitFactor:{title:$.t("Profit Factor"),isNegative:function(t){return t<1}},maxContractsHeld:{title:$.t("Max Contracts Held"),unit:"pc"},openPL:{title:$.t("Open PL"),unit:"currency"},commissionPaid:{title:$.t("Commission Paid"),unit:"currency"},totalTrades:{title:$.t("Total Closed Trades"),unit:"pc"},totalOpenTrades:{title:$.t("Total Open Trades"),unit:"pc"},numberOfWiningTrades:{title:$.t("Number Winning Trades"),unit:"pc"},numberOfLosingTrades:{title:$.t("Number Losing Trades"),unit:"pc"},percentProfitable:{title:$.t("Percent Profitable"),unit:"percent"},avgTrade:{title:$.t("Avg Trade"),unit:"currency"},avgWinTrade:{title:$.t("Avg Winning Trade"),unit:"currency"},avgLosTrade:{title:$.t("Avg Losing Trade"),unit:"currency",isNegative:t},ratioAvgWinAvgLoss:{title:$.t("Ratio Avg Win / Avg Loss")},largestWinTrade:{title:$.t("Largest Winning Trade"),unit:"currency"},largestLosTrade:{title:$.t("Largest Losing Trade"),unit:"currency",isNegative:t},avgBarsInTrade:{title:$.t("Avg # Bars in Trades"),unit:"pc"},avgBarsInWinTrade:{title:$.t("Avg # Bars in Winning Trades"),unit:"pc"},avgBarsInLossTrade:{title:$.t("Avg # Bars in Losing Trades"),unit:"pc"},marginCalls:{title:$.t("Margin Calls"),unit:"pc"}}},ctor:B},trades:{
_gaEvent:"List of Trades",settings:{title:$.t("List of Trades")},ctor:F}}}(),this._prepareLayout(),this._lastDiff={removed:[],added:[]},this._dispatcher.ready().done(function(){this._dispatcher.change().subscribe(this,this._onChange),this._onChange(),this._isStatic||this._bridge.visible.subscribe(this._onVisibilityChange.bind(this))}.bind(this))}function H(t){this.data=new r(t.reportData()),this.loading=new e,this.loadingComplete=new e,this.onError=new e,t.watchedData.subscribe(this._onData.bind(this),{callWithLast:!0})}function O(t){if(!(this instanceof O))throw new Error("ReportWidget is a constructor");this._bridge=t,this._strategy=t.strategy,this._model=t.model,this.$container=t.$contentWrapper,this.$selectWrapper=t.$selectWrapper,this._activeReportType=t.getProperty("activeReport","drawdown"),this._dataHandler=new H(this._strategy),this.watchedData=new r;var e=this;this._reportDataHandler=function(t){t?(e._removeLoading(),e._removeError(),e._data=t,e.watchedData.setValue({report:t,indexes:e._strategy.barsIndexes()}),e.displayReport()):e._setLoading()},this._dataHandler.loading.subscribe(this,this._setLoading),this._dataHandler.loadingComplete.subscribe(this,this._removeLoading),this._dataHandler.onError.subscribe(this,this._setError)}function M(t,e){this._bridge=e,this._$container=e.$container,this._warningContainer=e.$warningContainer.get(0),this.update(t)}function I(t,e){var i=Math.pow(10,e||0).toFixed(e<0?-e:0);return Math.round(t*i)/i}function V(t,e){this._containers={},this._miniCharts={},Object.keys(t).forEach((function(i){var r=i.toLowerCase(),a=$('<div class="'+r+'">').appendTo(e);this._containers[r]=a,this._miniCharts[i]=new h(t[i][0],a.get(0),t[i][1])}),this),this.draw()}function N(t,e){this._type="drawdown",this._dataType=e.getProperty("dataType","absolute"),this._resize=this._resize.bind(this),this._bridge=e,this._setDefaultProperties(),M.call(this,t,e)}function B(){this._type="performance",M.apply(this,arguments)}function F(t,e){this._type="trades",this._updateView=this._updateView.bind(this),this._timezoneProperty=e.model.model().properties().timezone,this._tzName="Etc/UTC",this._timezone=null,M.call(this,t,e)}i("E0Vc"),x.prototype.destroy=function(){for(;this._reportWidgetsSets.length>0;){for(var t=this._reportWidgetsSets.pop();t.reportWidgets.length>0;)t.reportWidgets.pop().destroy();t.model=null}},x.prototype._trackEvent=function(t){f("Strategy Tester","BP Strategy Tester "+t)},x.prototype._model=function(){return this._dispatcher.model()},x.prototype._updateReportWidgetsSets=function(){for(var t=0,e=this._dispatcher.model();t<this._reportWidgetsSets.length;t++)if(e===this._reportWidgetsSets[t].model)return void(this._reportWidgetsSet!==this._reportWidgetsSets[t]&&(this.hideActiveReportWidget(),this._modelChanged=!0,this._reportWidgetsSet=this._reportWidgetsSets[t]));this.hideActiveReportWidget(),this._modelChanged=!0,this._reportWidgetsSet={model:e,reportWidgets:[]},this._reportWidgetsSets.push(this._reportWidgetsSet)},x.prototype._updateReportWidgets=function(){
var t=this._reportWidgetsSet.reportWidgets.map((function(t){return t.strategy()})),e=this._dispatcher.strategies(),i=t.filter((function(t){return-1===e.indexOf(t)})),r=e.filter((function(e){return-1===t.indexOf(e)}));i.forEach(this.removeStrategyReportWidget,this),r.forEach(this.addStrategyReportWidget,this),this._lastDiff={removed:i,added:r}},x.prototype.update=function(){if(this._updateReportWidgetsSets(),this._updateReportWidgets(),this._strategyToSelect)return this.selectStrategy(this._strategyToSelect,!0),void delete this._strategyToSelect;var t;if(this._modelChanged)if(delete this._modelChanged,this._removeEmptyStub(),this.getActiveReportWidget())this.showActiveReportWidget();else{for(var e=TVSettings.getValue(m.LAST_STRATEGY_TVSETTINGS_KEY),i=0;i<this._lastDiff.added.length;i++)if(this._lastDiff.added[i].metaInfo().scriptIdPart===e)return void this.selectStrategy(this._lastDiff.added[i],!0);if((t=this.strategies())&&t.length)return void this.selectStrategy(t[t.length-1],!0)}else{if(this._lastDiff.added.length)return void this.selectStrategy(this._lastDiff.added[this._lastDiff.added.length-1],!0);if((t=this.strategies()).length&&!this.getActiveReportWidget())return void this.selectStrategy(t[t.length-1],!0)}this._updateLayout()},x.prototype._onChange=function(){clearTimeout(this._changeToId),this._changeToId=setTimeout(this.update.bind(this),10)},x.prototype._onVisibilityChange=function(t){if(t){var e=this.getActiveReportWidget();e&&e.displayReport()}},x.prototype.getReportWidgetByStrategy=function(t){if(this._reportWidgetsSet&&Array.isArray(this._reportWidgetsSet.reportWidgets))for(var e=0;e<this._reportWidgetsSet.reportWidgets.length;e++)if(this._reportWidgetsSet.reportWidgets[e].strategy()===t)return this._reportWidgetsSet.reportWidgets[e]},x.prototype.addStrategyReportWidget=function(t){var e=this.getReportWidgetByStrategy(t);return e||(e=new O($.extend({},this._bridge,{strategy:t,model:this._model(),$contentWrapper:this.$contentWrapper,$selectWrapper:this.$selectWrapper,getProperty:this._getProperty.bind(this),setProperty:this._setProperty.bind(this),setVisibilityDownloadButton:this._setVisibilityDownloadButton.bind(this),_trackEvent:this._trackEvent.bind(this)})),this._reportWidgetsSet.reportWidgets.push(e)),e},x.prototype.removeStrategyReportWidget=function(t){var e,i=this.getReportWidgetByStrategy(t);return i&&-1!==(e=this._reportWidgetsSet.reportWidgets.indexOf(i))&&(this._reportWidgetsSet.reportWidget===i&&(this.hideActiveReportWidget(),delete this._reportWidgetsSet.reportWidget),this._reportWidgetsSet.reportWidgets.splice(e,1)),i},x.prototype.selectStrategy=function(t,e){this._removeEmptyStub(),this.$pineEditorButton&&this.$pineEditorButton.toggleClass("i-hidden",!t.metaInfo().TVScriptSourceCode),this.$alertDialogButton&&this.$alertDialogButton.toggleClass("i-hidden",!t.hasStateForAlert());var i=this.addStrategyReportWidget(t);if(this._reportWidgetsSet.reportWidget&&this._reportWidgetsSet.reportWidget.isShown()){if(this._reportWidgetsSet.reportWidget===i)return;this.hideActiveReportWidget()}
this._strategyChange.fire(),this._reportWidgetsSet.reportWidget=i,this.showActiveReportWidget(),TVSettings.setValue(m.LAST_STRATEGY_TVSETTINGS_KEY,t.metaInfo().scriptIdPart),!0===e&&this._updateLayout()},x.prototype.getActiveReportWidget=function(){return this._reportWidgetsSet&&this._reportWidgetsSet.reportWidget},x.prototype.showActiveReportWidget=function(){var t=this.getActiveReportWidget();t&&(t.show(),this._dispatcher.setActiveStrategy(t.strategy()))},x.prototype.hideActiveReportWidget=function(){var t=this.getActiveReportWidget();t&&t.hide(),this._dispatcher.unsetActiveStrategy()},x.prototype.isCurrentStrategy=function(t){var e=this.getReportWidgetByStrategy(t);return e&&this._reportWidgetsSet.reportWidget&&e===this._reportWidgetsSet.reportWidget},x.prototype.strategies=function(){return this._dispatcher.strategies()||[]},x.prototype.lastAdded=function(){return this._lastDiff&&this._lastDiff.added||[]},x.prototype.lastRemoved=function(){return this._lastDiff&&this._lastDiff.removed||[]},x.prototype.strategyChange=function(){return this._strategyChange},x.prototype._openFormatDialog=function(t){if(this._reportWidgetsSet.reportWidget){var e=this._reportWidgetsSet.reportWidget.strategy();e.userEditEnabled()&&this._bridge.chartWidgetCollection.activeChartWidget.value().showChartPropertiesForSource(e).then((function(e){t instanceof $&&"dialogWidget"in e&&(t.addClass("active"),e.dialogWidget().on("destroy",(function(){t.removeClass("active")})))}))}},x.prototype._getCSVReport=function(){if(this._reportWidgetsSet&&this._reportWidgetsSet.reportWidget)if(E(R.EXPORT_CHART_DATA)){var t=this._reportWidgetsSet.reportWidget._data,e=this._reportWidgetsSet.reportWidget._bridge,i=this._reportWidgetsSet.reportWidget._activeReportType,r=n.performance.settings.fields,a=this._reportWidgetsSet.reportWidget.strategyName();w(t,e,i,r,a)}else k({feature:"backtestingExport"})},x.prototype._openAlertDialog=function(){if(this._reportWidgetsSet&&this._reportWidgetsSet.reportWidget){var t=this._bridge.chartWidgetCollection;window.runOrSignIn(function(){v({dataSourceHub:t?t.activeChartWidget.value().model().model():void 0,series:this._reportWidgetsSet.reportWidget.strategy(),actionSource:"strategy_tester_add_alert"})}.bind(this),{source:"Strategy widget alert button"})}},x.prototype._openScriptEditor=function(){var t;if(this._reportWidgetsSet&&this._reportWidgetsSet.reportWidget){var e=this._reportWidgetsSet.reportWidget.strategy().metaInfo();t={scriptSource:e.TVScriptSourceCode,scriptIdPart:e.scriptIdPart}}TradingView.bottomWidgetBar&&TradingView.bottomWidgetBar.activateScriptEditorTab(t)},x.prototype._prepareLayout=function(){var t=this;this.$headWrapper=$('<div class="backtesting-head-wrapper">').appendTo(this.$container),this._bridge.$warningContainer=$('<div class="strategy-report-warning__container">').appendTo(this.$container);var e=this._getHeadGroup(),r=$('<span class="dropdown-arrow">').append($(i("roNk")));this.$strategySelectButtonCaption=$('<span class="caption">'),
this.$strategySelectButton=$('<div class="strategy-select">').append(this.$strategySelectButtonCaption).append(r).appendTo(e).on("click touchend",this._onStrategySelectButtonClick.bind(this)),this._isStatic||(this.$formatDialogButton=this._getHeadGroup().append($('<div class="icon-button js-backtesting-open-format-dialog apply-common-tooltip" title="'+$.t("Format")+'">').append($(i("RgOa")))),this.$pineEditorButton=this._getHeadGroup().append($('<div class="icon-button js-backtesting-open-pine-editor apply-common-tooltip" title="'+$.t("Source Code")+'">').append($(i("9yfN")))),this.$alertDialogButton=this._getHeadGroup().append($('<div class="icon-button js-backtesting-open-alert-dialog apply-common-tooltip" title="'+$.t("Add alert")+'">').append($(i("m9TK")))),this.$downloadButton=this._getHeadGroup().append($('<div class="icon-button js-backtesting-download apply-common-tooltip">').append($(i("R84a")))),this.$downloadButton.addClass("i-hidden"),this.$pineEditorButton.addClass("i-hidden"),this.$alertDialogButton.addClass("i-hidden")),this.$selectWrapper=$('<div class="backtesting-select-wrapper">').appendTo(this.$headWrapper),this.$contentWrapper=$('<div class="backtesting-content-wrapper">').appendTo(this.$container),this.$supportDialogButton=this._getHeadGroup().append($('<div class="icon-button icon-button--support js-backtesting-open-support-dialog apply-common-tooltip">').append($(i("mfcl")))),this._isStatic||this.$container.on("click touchend",".js-backtesting-open-format-dialog",(function(){t._openFormatDialog($(this))})).on("click touchend",".js-backtesting-open-pine-editor",(function(){t._trackEvent("Pine Editor"),t._openScriptEditor($(this))})).on("click touchend",".js-backtesting-open-alert-dialog",(function(){t._trackEvent("Alert Dialog"),t._openAlertDialog()})).on("click touchend",".js-backtesting-open-indicators",(function(){t._trackEvent("Indicators and Strategies"),o.studyMarket&&!o.studyMarket.visible().value()&&o.studyMarket.show()})).on("click touchend",".js-backtesting-open-support-dialog",(function(){t._trackEvent("Support Dialog"),b({solutionId:43000561856})})).on("click touchend",".js-backtesting-download",(function(){t._getCSVReport()})).on("contextmenu",(function(e){if(!e.isDefaultPrevented()&&(e.preventDefault(),t._reportWidgetsSet.reportWidget)){var i=[],r=new s({label:L(window.t("Strategy Properties")),onExecute:t._openFormatDialog.bind(t)});i.push(r);var a=new s({label:L(window.t("Strategy Source")),onExecute:t._openScriptEditor.bind(t)});i.push(a),d.createMenu(i).then((function(t){t.show(e)}))}})),this._updateLayout()},x.prototype._updateLayout=function(){var t=this.strategies(),e=t.length,i=this._reportWidgetsSet&&this._reportWidgetsSet.reportWidget&&$.t(this._reportWidgetsSet.reportWidget.strategyName(),{context:"study"})||$.t("Strategy"),r=this._bridge.isStatic?$.t("{0} Report").format(i):i;_(this.$strategySelectButton.removeClass("has-strategies dropdown")),e?(this._removeEmptyStub(),this.$strategySelectButton.addClass("has-strategies"),
t.length>1&&(this.$strategySelectButton.addClass("dropdown"),u(this.$strategySelectButton,null,{direction:"down",event:"popup-menu",addClass:"backtesting-strategies"}))):this._setEmptyStub(),this.$strategySelectButtonCaption.text(e?TradingView.clean(r,!0):$.t("No strategies on chart"))},x.prototype._setEmptyStub=function(){this._$emptyStub||(this._$emptyStub=$('<div class="backtesting-empty-stub">').html($.t('To test a strategy, apply it to the chart.{new_line}Use the symbol and time interval that you want to test.{new_line}You can use a built-in strategy from the "{indicators_link}Indicators&nbsp;&amp;&nbsp;Strategies{link_end}" dialog box, or write your own in {pine_link}Pine Editor{link_end}.').format({indicators_link:'<a class="js-backtesting-open-indicators">',pine_link:'<a class="js-backtesting-open-pine-editor">',link_end:"</a>",new_line:"<br>"})).appendTo(this.$contentWrapper),this._isStatic&&this._$emptyStub.find("a").each((function(){$(this).replaceWith((function(){return $("<span>").html($(this).html()||"&nbsp;")}))}))),this.$container.addClass("empty")},x.prototype._removeEmptyStub=function(){this._$emptyStub&&(this._$emptyStub.remove(),delete this._$emptyStub),this.$container.removeClass("empty")},x.prototype._onStrategySelectButtonClick=function(){for(var t,e,i=this.strategies(),r=[],a=0;a<i.length;a++)t=i[a].metaInfo().shortDescription,this._isStatic&&(t=$.t("{0} Report").format(t)),e={title:t},this.isCurrentStrategy(i[a])?e.active=e.selected=!0:e.action=function(t){this.selectStrategy(t),this._updateLayout()}.bind(this,i[a]),r.push(e);r.length&&this.$strategySelectButton.trigger("popup-menu",[r])},x.prototype._getHeadGroup=function(t){var e=$('<div class="group">');return t?e.insertAfter(t):e.appendTo(this.$headWrapper),e},x.prototype._getProperty=function(t,e){var i=this._bridge.properties&&this._bridge.properties.value()||{};return void 0!==i[t]&&i[t]||e},x.prototype._setProperty=function(t,e){var i=$.extend({},this._bridge.properties&&this._bridge.properties.value()||{});return i[t]=void 0!==e&&e||null,this._bridge.properties&&this._bridge.properties.setValue(i),i[t]},x.prototype._setVisibilityDownloadButton=function(t){if(!this._isStatic)switch(t){case"drawdown":this.$downloadButton.addClass("i-hidden");break;case"performance":this.$downloadButton.removeClass("i-hidden"),this.$downloadButton.find(".icon-button").attr("title",$.t("Download performance summary"));break;case"trades":this.$downloadButton.removeClass("i-hidden"),this.$downloadButton.find(".icon-button").attr("title",$.t("Download list of trades"))}},TradingView.BacktestingWidget=x,H.prototype._updateData=function(t){var e=t&&t.data&&t.data.report,i=this.data.value();t.isUpdate&&i&&(e=$.extend({},i,e)),!e||i&&e===i||this.data.setValue(e)},H.prototype._onData=function(t){switch(t&&t.method){case"data_update":this._updateData(t.nonSeriesData);break;case"study_loading":this.loading.fire();break;case"study_completed":this.loadingComplete.fire();break;case"study_error":this.onError.fire()}},O.prototype.destroy=function(){this.removeReport()
},O.prototype.getReportSettings=function(t,e){var i=n[t]&&n[t].settings;return i&&"string"==typeof e?i[e]:i},O.prototype.show=function(){if(!this._isShown){this._flashDeferred=$.Deferred().done(function(){this.$content.removeClass("opacity-transition").addClass("fade"),setTimeout(function(){this.addClass("opacity-transition").removeClass("fade")}.bind(this.$content),100)}.bind(this)),this._layoutPrepared?this._restoreLayout():this._prepareLayout();var t=this._bridge.getProperty("activeReport",this._activeReportType);this._activeReportType!==t&&(this._activeReportType=t,this._updateReportTabs()),this._dataHandler.data.subscribe(this._reportDataHandler,{callWithLast:!0}),this._isShown=!0}},O.prototype._setLoading=function(){this._flashDeferred&&this._flashDeferred.reject(),this._data?this.$content.addClass("opacity-transition fade"):!this._spinner&&this.$content&&(this._$spinnerContainer=$(document.createElement("div")).addClass("spinner-container").appendTo(this.$content),this._spinner=(new g).spin(this._$spinnerContainer.get(0)))},O.prototype._removeLoading=function(){this._spinner&&(this._spinner.stop(),delete this._spinner),this._$spinnerContainer&&(this._$spinnerContainer.remove(),delete this._$spinnerContainer),this.$content&&this.$content.removeClass("opacity-transition fade")},O.prototype._setError=function(){this._removeLoading(),this.$content.addClass("report-error")},O.prototype._removeError=function(){this.$content.removeClass("report-error")},O.prototype._prepareLayout=function(){this.$content=$('<div class="reports-content">').appendTo(this.$container),this._setReportTabs(),this._layoutPrepared=!0},O.prototype._restoreLayout=function(){this.$content.appendTo(this.$container),this._$reportTabsContainer.appendTo(this.$selectWrapper)},O.prototype._removeLayout=function(){this._$reportTabsContainer.detach(),this.$content.detach()},O.prototype._updateReportTabs=function(){Object.keys(this._reportTabs).forEach((function(t){this._reportTabs[t].toggleClass("active",t===this._activeReportType)}),this)},O.prototype._setReportTabs=function(){this._$reportTabsContainer=$('<ul class="report-tabs">').appendTo(this.$selectWrapper);var t=this;this._reportTabs={},Object.keys(n).forEach((function(e){var i=$("<li>").appendTo(t._$reportTabsContainer);i.text(t.getReportSettings(e,"title")),e===t._activeReportType&&i.addClass("active"),i.on("click",(function(){e!==t._activeReportType&&(t._onReportSelectChange(e),t._updateReportTabs())})),t._reportTabs[e]=i}))},O.prototype._onReportSelectChange=function(t){n[t]&&this._bridge._trackEvent(n[t]._gaEvent),this.removeReport(),this.displayReport(t)},O.prototype.strategy=function(){return this._strategy},O.prototype.strategyName=function(){var t=this._strategy.metaInfo();return t&&t.description},O.prototype.hide=function(){this._isShown&&(this._dataHandler.data.unsubscribe(this._reportDataHandler),this.removeReport(),this._removeLayout(),this._isShown=!1)},O.prototype.isShown=function(){return this._isShown},O.prototype.removeReport=function(){this._report&&(this._report.remove(),
delete this._report)},O.prototype.displayReport=function(t){if(this.removeNoDataStub(),t&&t!==this._activeReportType||!this._report){this._report&&this.removeReport(),t||(t=this._activeReportType);var e={height:this._bridge.height,width:this._bridge.width,strategy:this._strategy,$container:this.$content,$warningContainer:this._bridge.$warningContainer,settings:this.getReportSettings(t),model:this._model,getProperty:this._bridge.getProperty,setProperty:this._bridge.setProperty,setNoDataStub:this.setNoDataStub.bind(this),isStatic:this._bridge.isStatic},i=n[t].ctor;this._report=new i(this._data,e),this._activeReportType=t,this._bridge.setProperty("activeReport",t),this._bridge.setVisibilityDownloadButton(t)}else this._report.update(this._data);this._flashDeferred&&this._flashDeferred.resolve()},O.prototype.setNoDataStub=function(){this._$noDataStub||(this._$noDataStub=$('<div class="backtesting-empty-stub">').html("<em>"+$.t("No data")+"</em>")),this.$content.append(this._$noDataStub)},O.prototype.removeNoDataStub=function(){this._$noDataStub&&(this._$noDataStub.remove(),delete this._$noDataStub)},M.prototype.createReport=function(){this._$content||(this._$content=$('<div class="report-content'+(this._type&&" "+this._type||"")+'">').appendTo(this._$container),this._$data=$('<div class="report-data">').appendTo(this._$content))},M.prototype.getAccountCurrency=function(){return this._data.currency},M.prototype.formatValue=function(t,e,i){void 0===i&&(i=0>t);var r="&thinsp;",a=$.t("N/A"),n="";if(null===t)return a;switch(e){case"series":a=I(t,this._seriesDecimals).toFixed(this._seriesDecimals);break;case"currency":a=t<Math.pow(10,-this._currencyDecimals)?function(){for(var e,i=2;i<=8;i++)if(0!==(e=I(t,i)))return e.toFixed(i);return"0"}():I(t,this._currencyDecimals).toFixed(this._currencyDecimals);var o=this.getAccountCurrency();if(o){var s=o.toLowerCase();if(S[s]){var d=S[s].symbol;S[s].before?a=(n=d+r)+(n=a,""):n=r+d}else n="none"===s?"":r+o}else n=r+"?";break;case"percent":a=I(100*t,this._percentDecimals),n="&nbsp;%";break;case"pc":a=Math.round(t);break;default:a=I(t,this._defaultDecimals)}var c=y(a+n);return i?'<span class="neg">'+c+"</span>":c},M.prototype.isNegativeValue=function(t,e){var i=t.isNegative;return"function"==typeof i?i(e):e<0},M.prototype.remove=function(){this._$content&&(this._$content.remove(),delete this._$content,delete this._$data)},M.prototype.update=function(t){var e=this._bridge.model.mainSeries();this._seriesDecimals=e.formatter()._fractionalLength,this._currencyDecimals=T,this._percentDecimals=D,this._defaultDecimals=W;var i=c(e.interval());this._intraday=i&&i.intraday,this._data=t,this.remove(),this.hasData()?this.createReport():this._bridge.setNoDataStub()},M.prototype.getType=function(){return this._type},M.prototype.hasData=function(){return!!this._data},M.prototype._showWarning=function(){P(this._warningContainer,{isRangeBasedStyle:this._bridge.model.mainSeries().isRangeBasedStyle(),hasLookaheadFutureData:!!this._bridge.strategy.metaInfo().lookaheadFutureData})},
V.prototype.destroy=function(){Object.keys(this._miniCharts).forEach((function(t){this._miniCharts[t].destroy()}),this)},V.prototype.draw=function(){Object.keys(this._miniCharts).forEach((function(t){this._miniCharts[t].draw()}),this)},V.prototype.toggleHideChart=function(t,e){this._containers[t]&&this._containers[t].toggleClass("hidden",e)},V.prototype.onResize=function(){Object.keys(this._miniCharts).forEach((function(t){this._miniCharts[t].onResize()}),this)},inherit(N,M),N.DEFAULT_DRAWDOWN_LINE_WIDTH=1,N.DEFAULT_DRAWDOWN_LINE_COLOR="#E2745B",N.DEFAULT_DRAWDOWN_FILL_COLOR="rgba(226,116,91,.2)",N.DEFAULT_EQUITY_LINE_WIDTH=1,N.DEFAULT_EQUITY_LINE_COLOR="rgba(4,150,255,.6)",N.DEFAULT_EQUITY_FILL_COLOR="rgba(4,150,255,.25)",N.DEFAULT_BUYHOLD_LINE_WIDTH=1,N.DEFAULT_BUYHOLD_LINE_COLOR="#758696",N.prototype.createReport=function(){M.prototype.createReport.call(this),this._$miniChartContainer=$('<div class="report-minichart-container">').appendTo(this._$content),this._setLegend(),this._showWarning(),this._setOverview(),$(window).on("resize",this._resize),this._bridge.isStatic?this._resize():(this._bridge.height.subscribe(this._resize,{callWithLast:!0}),this._bridge.width.subscribe(this._resize,{callWithLast:!0}))},N.prototype._setDefaultProperties=function(){var t="miniChartHidden.buyhold";void 0===this._getProperty(t)&&this._setProperty(t,"1")},N.prototype._getProperty=function(t){return this._bridge.isStatic?this._propertiesStub&&this._propertiesStub[t]:this._bridge.getProperty(t)},N.prototype._setProperty=function(t,e){this._bridge.isStatic?(this._propertiesStub||(this._propertiesStub={}),this._propertiesStub[t]=e):this._bridge.setProperty(t,e)},N.prototype.recreateMiniCharts=function(){this._miniChart&&(this._$miniChartContainer.empty(),this._setMiniChart())},N.prototype._setLegend=function(){if(!this._$content||!this._$content.find(".report-minichart-legend").size()){this._$miniChartLegend=$('<div class="report-minichart-legend">').appendTo(this._$content);var t=this;n("drawdown",N.DEFAULT_DRAWDOWN_LINE_COLOR,$.t("Drawdown")),n("equity",N.DEFAULT_EQUITY_LINE_COLOR,$.t("Equity",{context:"trading"})),this._data.buyHold&&n("buyhold","transparent",$.t("Buy & Hold Equity"));var e=$.t("Absolute"),i=$.t("Percentage"),r=$('<div title="'+$.t("Set absolute/percentage values")+'" class="switch dropdown apply-common-tooltip"><span class="caption">'+("percent"===this._dataType?i:e)+"</span></div>");r.on("click",(function(){$(this).trigger("popup-menu",[[{title:e,action:o.bind(null,"absolute"),active:"percent"!==t._dataType},{title:i,action:o.bind(null,"percent"),active:"percent"===t._dataType}]])})).appendTo(this._$miniChartLegend),u(r,null,{direction:"down",event:"popup-menu",addClass:"backtesting-data-type"})}function a(e){if(t._miniChart){var i=$(e.target).closest(".switch"),r=i.data("prop"),a="1"===t._getProperty("miniChartHidden."+r);t._miniChart.toggleHideChart(r,!a),t._setProperty("miniChartHidden."+r,a?"0":"1"),i.toggleClass("inactive",!a),t.recreateMiniCharts()}}function n(e,i,r){
var n="1"===t._getProperty("miniChartHidden."+e);$('<div class="switch '+e+" apply-common-tooltip"+(n?" inactive":"")+'"><i style="background-color:'+i+'" class="sample '+e+'">&thinsp;</i><span class="caption">'+r+"</span></div>").attr("title",$.t("Show/hide {0}").format(e)).data("prop",e).on("click",a).appendTo(t._$miniChartLegend)}function o(a){t._setProperty("dataType",a),t._dataType=a,r.find(".caption").text("percent"===a?i:e),t.recreateMiniCharts()}},N.prototype._setOverview=function(){var t=this._bridge.settings.overviewPerformanceFields,e=n.performance.settings.fields,i=this._data.performance;t.forEach((function(t){var r=e[t];if(r){var a=i.all[t]||i[t];if(void 0!==a){var n=A(t),o=i.all[n]||i[n];$('<div class="data-item"><strong>'+this.formatValue(a,r.unit,this.isNegativeValue(r,a))+"</strong><p>"+(o?'<span class="additional_percent_value">'+this.formatValue(o,"percent",this.isNegativeValue(r,o))+"</span>":"&nbsp;")+"</p><em>"+r.title+"</em></div>").appendTo(this._$data)}}}),this);var r=this._$data.find(".data-item");r.css("width",Math.ceil(100/r.length)+"%")},N.prototype._mapChartData=function(t,e){var i="percent"===this._drawdownType?this._percentDecimals:this._currencyDecimals,r={x:[],y:[]};if(!Array.isArray(t))return r;for(var a=0;a<t.length;a++)r.x[a]=a+1,r.y[a]=I(t[a],i)*(e?-1:1);return r},N.prototype._syncRanges=function(t){var e=Math.min.apply(Math,t.drawDown[0][0].data.y),i=Math.max.apply(Math,t.drawDown[0][0].data.y),r=i-e,a=this._getProperty("miniChartHidden.buyhold"),n=a?"0"===a:!!t.buyHold,o=Math.min.apply(Math,t.equity[0][0].data.y),s=Math.max.apply(Math,t.equity[0][0].data.y);n&&(o=Math.min(o,Math.min.apply(Math,t.buyHold[0][0].data.y)),s=Math.max(s,Math.max.apply(Math,t.buyHold[0][0].data.y)));var d=s-o,c=Math.max(r,d);r<c&&(t.drawDown[1].yScale.forceMin=i-c);var p=t.equity[1].yScale;if(p.forceMax=Math.max(o+c,s),p.forceMin=o,n){var h=t.buyHold[1].yScale;h.forceMax=p.forceMax,h.forceMin=p.forceMin}},N.prototype._setMiniChart=function(){var t={};this._data.drawDown&&(t.drawDown=[[{data:this._mapChartData("percent"===this._dataType?this._data.drawDownPercent:this._data.drawDown,!0),options:{line:{color:N.DEFAULT_DRAWDOWN_LINE_COLOR,width:N.DEFAULT_DRAWDOWN_LINE_WIDTH},belowLineFillStyle:null,aboveLineFillStyle:N.DEFAULT_DRAWDOWN_FILL_COLOR}}],{grid:{xIsVisible:!1,yIsVisible:!1},noAutoResize:!0,xScale:{isTimeScale:!1,drawOverPlotArea:!1,drawTickMarkLine:!0,ingnoreFloats:!0,borderColor:"#555",height:18},yScale:{marginInPercents:0,drawOverPlotArea:!1,width:50,font:{color:N.DEFAULT_DRAWDOWN_LINE_COLOR}}}]),this._data.equity&&(t.equity=[[{data:this._mapChartData("percent"===this._dataType?this._data.equityPercent:this._data.equity),options:{line:{color:N.DEFAULT_EQUITY_LINE_COLOR,width:N.DEFAULT_EQUITY_LINE_WIDTH},belowLineFillStyle:N.DEFAULT_EQUITY_FILL_COLOR}}],{grid:{xSkipFirst:!0,yIsVisible:!1},noAutoResize:!0,xScale:{isTimeScale:!1,drawOverPlotArea:!1,drawTickMarkLine:!0,ingnoreFloats:!0,borderColor:"#555",height:18},yScale:{position:"left",marginInPercents:0,drawOverPlotArea:!1,width:50,font:{
color:N.DEFAULT_EQUITY_LINE_COLOR}},overlayLines:[{y:"percent"===this._dataType?100:0,color:N.DEFAULT_EQUITY_LINE_COLOR,style:CanvasEx.LINESTYLE_DASHED}]}]),this._data.buyHold&&(t.buyHold=[[{data:this._mapChartData("percent"===this._dataType?this._data.buyHoldPercent:this._data.buyHold),options:{line:{color:N.DEFAULT_BUYHOLD_LINE_COLOR,width:N.DEFAULT_BUYHOLD_LINE_WIDTH},belowLineFillStyle:"transparent"}}],{grid:{xSkipFirst:!0,yIsVisible:!1},noAutoResize:!0,xScale:{isTimeScale:!1,drawOverPlotArea:!1,drawTickMarkLine:!0,ingnoreFloats:!0,borderColor:"#555",height:18},yScale:{position:"left",marginInPercents:0,drawOverPlotArea:!1,width:50,font:{color:N.DEFAULT_EQUITY_LINE_COLOR}},overlayLines:[{y:"percent"===this._dataType?100:0,color:N.DEFAULT_BUYHOLD_LINE_COLOR,style:CanvasEx.LINESTYLE_DASHED}]}]);var e=Object.keys(t),i=this;t.drawDown&&t.equity&&this._drawdownType===this._equityType&&this._syncRanges(t),e.length&&(this._createMiniChart(t),e.forEach((function(t){t=t.toLowerCase(),"1"==i._getProperty("miniChartHidden."+t)&&i._miniChart.toggleHideChart(t,!0)})))},N.prototype._createMiniChart=function(t){this._destroyMiniChart(),this._miniChart=new V(t,this._$miniChartContainer)},N.prototype._destroyMiniChart=function(){this._miniChart&&(this._miniChart.destroy(),delete this._miniChart)},N.prototype._resize=function(){var t=this._bridge.settings.miniChartMinHeight||20,e=this._$miniChartContainer.height(),i=!0;this._data.drawDown.length<2||this._data.equity.length<2||e<t?(this._miniChart&&(this._$miniChartContainer.empty(),this._destroyMiniChart()),this._$miniChartLegend.addClass("hidden"),this._bridge.setNoDataStub()):(this._miniChart||(this._setMiniChart(),i=!1),this._$miniChartLegend.removeClass("hidden")),this._miniChart&&i&&this._miniChart.onResize()},N.prototype.remove=function(){this._bridge.isStatic||(this._bridge.height.unsubscribe(this._resize,{callWithLast:!0}),this._bridge.width.unsubscribe(this._resize,{callWithLast:!0})),$(window).off("resize",this._resize),this._destroyMiniChart(),M.prototype.remove.call(this)},N.prototype.hasData=function(){return!!(this._data&&this._data.performance&&this._data.drawDown&&this._data.equity)},inherit(B,M),B.prototype.createReport=function(){M.prototype.createReport.call(this),this._$data&&this._createPerformanceTable(),this._showWarning()},B.prototype._makeCellValue=function(t,e,i){if(void 0===e)return'<td><span class="neg">'+$.t("N/A")+"</span></td>";var r=this._bridge.settings.fields[t],a=this.formatValue(e,r.unit,this.isNegativeValue(r,e));return void 0===i?"<td>"+a+"</td>":"<td><div>"+a+"</div><div>"+('<span class="additional_percent_value">'+this.formatValue(i,"percent",this.isNegativeValue(r,i))+"</span>")+"</div></td>"},B.prototype._createPerformanceTable=function(){for(var t,e,i,r,a,n,o,s,d=this._data&&this._data.performance,c=this._bridge.settings.fields,p=Object.keys(c),h=0,l="",u=["all","long","short"];h<p.length;h++){for(s=A(t=p[h]),e=!1,i="<tr>",i+="<td>"+(c[t].title||"")+"</td>",r=0;r<u.length;r++)n=d[a=u[r]][t],o=d[a][s],
void 0!==n&&(i+=this._makeCellValue(t,n,o),e=!0);e||(n=d[t],o=d[s],i+=this._makeCellValue(t,n,o),i+='<td colspan="2">&nbsp;</td>'),l+=i+="</tr>"}var _=document.createElement("table");_.innerHTML="<thead><tr><td></td><td>"+$.t("All")+"</td><td>"+$.t("Long")+"</td><td>"+$.t("Short")+"</td></tr></thead><tbody>"+l+"</tbody>",this._$data.append($(_)),this._scrollTop&&this._$content.scrollTop(this._scrollTop)},B.prototype.remove=function(){this._$content&&(this._scrollTop=this._$content.scrollTop()),M.prototype.remove.call(this)},B.prototype.hasData=function(){return!(!this._data||!this._data.performance)},inherit(F,M),F.prototype._getTZName=function(){var t=this._timezoneProperty.value();if(t){if("exchange"===t){var e=this._bridge.model.mainSeries().symbolInfo().timezone;e&&(t=e)}return t}},F.prototype._updateTz=function(){var t=this._getTZName();if(t&&t!==this._tzName){if(this._tzName=t,!p)throw new ReferenceError("PineJsCalendar is undefined");var e=p.get_timezone(t);this._timezone=e.is_valid()&&e||null,this._updateView(!0)}else t||(this._timezone=null)},F.prototype._setTzListener=function(){this._timezoneProperty.subscribe(this,this._updateTz),this._updateTz()},F.prototype._unsetTzListener=function(){this._timezoneProperty.unsubscribe(this,this._updateTz)},F.prototype._getTimezoneOffset=function(t){return this._timezone?this._timezone.offset_utc(t):0},F.prototype._getOrderDate=function(t){var e=this._getTimezoneOffset(t);return a(t+e).utc().format("YYYY-MM-DD"+(this._intraday?"[&nbsp;]HH:mm":""))},F.prototype.createReport=function(){M.prototype.createReport.call(this),this._setTzListener(),this._$tableWrap=$('<div class="table-wrap">').appendTo(this._$data),this._$table=$(document.createElement("table")).appendTo(this._$tableWrap),this._$colGroup=$(document.createElement("colgroup")).html("<col><col><col><col><col><col><col>").appendTo(this._$table),this._$head=$(document.createElement("thead")).html("<tr><td>"+$.t("Trade&nbsp;#")+"</td><td>"+$.t("Type")+"</td><td>"+$.t("Signal")+'</td><td class="date">'+(this._intraday?$.t("Date/Time"):$.t("Date"))+"</td><td>"+$.t("Price")+"</td><td>"+$.t("Contracts")+"</td><td>"+$.t("Profit")+"</td><td>"+$.t("Cum. Profit")+"</td><td>"+$.t("Run-up")+"</td><td>"+$.t("Drawdown")+"</td></tr>").appendTo(this._$table),this._headHeight=this._$head.outerHeight();var t=this._createRow(this._data.trades[0],0);this._$table.get(0).appendChild(t),this._rowHeight=$(t).outerHeight(),this._rows=[t],this._bridge.isStatic||(this._bridge.height.subscribe(this._updateView),this._bridge.width.subscribe(this._updateView)),this._$content.on("scroll",this._updateView);var e=this;this._$table.on("click",".row-e, .row-x",(function(){var t=parseInt($(this).get(0).dataset.time,10);if(e._intraday){var i=e._getTimezoneOffset(t);e._gotoTime(new Date(t+i).getTime())}else e._gotoTime(new Date(e._getOrderDate(t)).getTime())})),this._updateView(!0),this._showWarning()},F.prototype._makeTradeProfitCellImpl=function(t,e,i,r){if(!t&&void 0!==e[i]&&"number"==typeof e[i].v){var a=this.formatValue(e[i].v,"currency",r)
;return"number"==typeof e[i].p&&(a+='<div class="additional_percent_value">'+this.formatValue(e[i].p,"percent",r)+"</div>"),a}return"&nbsp;"},F.prototype._makeTradeProfitCell=function(t,e){return this._makeTradeProfitCellImpl(t,e,"tp")},F.prototype._makeCumProfitCell=function(t,e){return this._makeTradeProfitCellImpl(t,e,"cp")},F.prototype._makeRunUpCell=function(t,e){return this._makeTradeProfitCellImpl(t,e,"rn")},F.prototype._makeDrawDownCell=function(t,e){return this._makeTradeProfitCellImpl(t,e,"dd",!0)},F.prototype._gotoTime=function(t){this._bridge.model.model().gotoTime(t).done(t=>{const e=this._bridge.model.model().mainSeries();void 0===t?e.clearGotoDateResult():(e.setGotoDateResult(t),setTimeout(()=>{e.clearGotoDateResult(),this._bridge.model.model().updateSource(e)},1e3))})},F.prototype._createRow=function(t,e){for(var i,r,a,n=['<td rowspan="2" class="trade-num">'+(e+1)+"</td>",""],o=["e","x"],s=0;s<o.length;s++)a=!t[r=o[s]].c,!i&&a&&(i=!0),n[s]+='<td class="trade-'+r+'-type">'+C(t[r].tp)+'</td><td class="trade-'+r+'-comment comment">'+(a&&"<em>"+$.t("Open")+"</em>"||t[r].c)+'</td><td class="trade-'+r+'-date">'+(!a&&t[r].tm&&this._getOrderDate(t[r].tm)||"&nbsp;")+'</td><td class="trade-'+r+'-price">'+(!a&&"number"==typeof t[r].p&&this.formatValue(t[r].p,"series")||"&nbsp;")+"</td>";n[0]+='<td rowspan="2" class="trade-contracts">'+(!i&&t.q||"&nbsp;")+'</td><td rowspan="2" class="trade-profit">'+this._makeTradeProfitCell(i,t)+'</td><td rowspan="2" class="cum-profit">'+this._makeCumProfitCell(i,t)+'</td><td rowspan="2" class="run-up">'+this._makeRunUpCell(i,t)+'</td><td rowspan="2" class="draw-down">'+this._makeDrawDownCell(i,t)+"</td>";var d=document.createElement("tbody");return d.innerHTML='<tr class="row-e" data-time="'+t.e.tm+'">'+n.join('</tr><tr class="row-x" data-time="'+t.x.tm+'">')+"</tr>",d},F.prototype._updateRow=function(t,e,i){var r=t.querySelector(".trade-num");r&&(r.innerHTML=String(i+1));for(var a,n,o,s=["e","x"],d=0,c={};d<s.length;d++)o=!e[n=s[d]].c,!a&&o&&(a=!0),c.row=t.querySelector(".row-e"),c.row&&c.row.setAttribute("data-time",e.e.tm),c.row=t.querySelector(".row-x"),c.row&&c.row.setAttribute("data-time",e.x.tm),c.type=t.querySelector(".trade-"+n+"-type"),c.type&&(c.type.innerHTML=C(e[n].tp)),c.comment=t.querySelector(".trade-"+n+"-comment"),c.comment&&(c.comment.innerHTML=o&&"<em>"+$.t("Open")+"</em>"||e[n].c),c.date=t.querySelector(".trade-"+n+"-date"),c.date&&(c.date.innerHTML=!o&&e[n].tm&&this._getOrderDate(e[n].tm)||"&nbsp;"),c.price=t.querySelector(".trade-"+n+"-price"),c.price&&(c.price.innerHTML=!o&&"number"==typeof e[n].p&&this.formatValue(e[n].p,"series")||"&nbsp;");var p=t.querySelector(".trade-contracts");p&&(p.innerHTML=!a&&String(e.q)||"&nbsp;");var h=this;[{s:".trade-profit",f:this._makeTradeProfitCell},{s:".cum-profit",f:this._makeCumProfitCell},{s:".run-up",f:this._makeRunUpCell},{s:".draw-down",f:this._makeDrawDownCell}].forEach((function(i){var r=t.querySelector(i.s);r&&(r.innerHTML=i.f.call(h,a,e))}))},F.prototype._updateView=function(t){
if(this._$content&&this._$tableWrap){var e=this._data.trades;this._headHeight=this._$head.outerHeight();var i=this._$content.innerHeight(),r=this._scrollTop||this._$content.scrollTop();r>=this._headHeight&&!this._headHidden?(this._$head.css("visibility","hidden"),this._headHidden=!0):r<this._headHeight&&this._headHidden&&(this._$head.css("visibility","visible"),this._headHidden=!1),this._$data.css("height",this._headHeight+e.length*this._rowHeight),this._scrollTop&&(this._$content.scrollTop(this._scrollTop),delete this._scrollTop);var a=Math.floor(Math.max(r-this._headHeight,0)/this._rowHeight),n=Math.ceil(i/this._rowHeight)+1;if(!0===t||!this._metricsCache||this._metricsCache.startRowIndex!==a||this._metricsCache.rowsCount!==n){this._$tableWrap.css("top",a*this._rowHeight);for(var o=0,s=this._$table.get(0),d=a;d<a+n&&d<e.length;o++,d++)this._rows[o]?this._updateRow(this._rows[o],e[d],d):(this._rows[o]=this._createRow(e[d],d),s.appendChild(this._rows[o]));$(s).addClass("reports-content__table-pointer"),this._metricsCache||(this._metricsCache={}),this._metricsCache.startRowIndex=a,this._metricsCache.rowsCount=n}}},F.prototype.remove=function(){this._unsetTzListener(),this._bridge.isStatic||(this._bridge.height.unsubscribe(this._updateView),this._bridge.width.unsubscribe(this._updateView)),this._$content&&(this._scrollTop=this._$content.scrollTop(),this._$content.off("scroll",this._updateView)),M.prototype.remove.call(this)},F.prototype.hasData=function(){return!!(this._data&&this._data.trades&&this._data.trades.length)},t.exports={BacktestingWidget:TradingView.BacktestingWidget}}).call(this,i("aIyQ"),i("hY0g"),i("ldgD"))},ltBP:function(t,e,i){t.exports={solutionLink:"solutionLink-1DqLGkup"}},m9TK:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="16" height="16" fill="none"><path fill="currentColor" fill-rule="evenodd" d="M3.56 1a2.56 2.56 0 0 0-1.97 4.19c.7-1.6 2-2.9 3.6-3.6A2.54 2.54 0 0 0 3.56 1zM0 3.56c0 1.07.47 2.03 1.22 2.68A7.01 7.01 0 0 0 8 15v-1a6 6 0 1 1 6-6h1c0-.6-.08-1.2-.22-1.76a3.55 3.55 0 1 0-5.02-5.02 7.01 7.01 0 0 0-3.52 0A3.55 3.55 0 0 0 0 3.56zm10.81-1.97c1.6.7 2.9 2 3.6 3.6a2.56 2.56 0 0 0-3.6-3.6zM8 4v4H5v1h4V4H8zm4 8V9h1v3h3v1h-3v3h-1v-3H9v-1h3z"/></svg>'},mfcl:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" width="28" height="28" fill="none"><path fill="currentcolor" fill-rule="evenodd" clip-rule="evenodd" d="M4 14a10 10 0 1 1 20 0 10 10 0 0 1-20 0zM14 3a11 11 0 1 0 0 22 11 11 0 0 0 0-22zm-2.27 8.15H10.3c.09-1.78 1.28-3.22 3.62-3.22 2.09 0 3.51 1.3 3.51 3 0 1.3-.67 2.23-1.73 2.87-1.05.62-1.35 1.09-1.35 1.96v.54H12.9v-.77c0-1.1.53-1.84 1.66-2.52.97-.59 1.34-1.11 1.34-2 0-1.03-.8-1.78-2.03-1.78-1.26 0-2.05.73-2.14 1.92zm2.85 7.99c0 .53-.4.94-.95.94a.94.94 0 0 1-.94-.94c0-.54.41-.95.94-.95.54 0 .95.4.95.95z"/></svg>'},roNk:function(t,e){t.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 6 9" width="6" height="9"><path fill="none" stroke="currentColor" d="M1 1l3.5 3.5L1 8"/></svg>'},wiCH:function(t,e,i){
"use strict";i.r(e),i.d(e,"currencyDecimals",(function(){return r})),i.d(e,"percentDecimals",(function(){return a})),i.d(e,"defaultDecimals",(function(){return n}));var r=2,a=2,n=3}}]);