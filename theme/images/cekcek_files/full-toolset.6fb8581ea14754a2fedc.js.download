(window.webpackJsonp=window.webpackJsonp||[]).push([["full-toolset"],{Etjd:function(t,e,a){t.exports={dropdown:"dropdown-16RCKHd2",label:"label-16RCKHd2",smallWidthTitle:"smallWidthTitle-16RCKHd2",smallWidthMenuItem:"smallWidthMenuItem-16RCKHd2",smallWidthWrapper:"smallWidthWrapper-16RCKHd2"}},FIZB:function(t,e,a){"use strict";a.d(e,"a",(function(){return l}));var i=a("Vdly"),s=a("FBuY"),n=a("aIyQ"),r=a.n(n);let o=null;class l{constructor(){this._favorites=[],this._favoritesChanged=new r.a,s.TVXWindowEvents.on("FundFavoritesChanged",t=>{const e=JSON.parse(t);this._loadFromState(e||[])}),i.onSync.subscribe(this,this._loadFavs),this._loadFavs()}isFav(t){return-1!==this._findFavIndex(t)}toggleFavorite(t){this.isFav(t)?this.removeFavorite(t):this.addFavorite(t)}toggleFavoriteArray(t){const e=t.some(t=>this.isFav(t));t.forEach(t=>{if(e){const e=this._findFavIndex(t);-1!==e&&this._favorites.splice(e,1)}else this._favorites.push(t)}),this._favoritesChanged.fire(),this._saveFavs()}addFavorite(t){this._favorites.push(t),this._favoritesChanged.fire(),this._saveFavs()}removeFavorite(t){const e=this._findFavIndex(t);-1!==e&&(this._favorites.splice(e,1),this._favoritesChanged.fire()),this._saveFavs()}favorites(){return this._favorites}favoritesChanged(){return this._favoritesChanged}static getInstance(){return null===o&&(o=new l),o}_loadFavs(){const t=i.getJSON("fundamentals.favorites",[]);this._loadFromState(t)}_saveFavs(){i.setJSON("fundamentals.favorites",this._favorites),s.TVXWindowEvents.emit("FundFavoritesChanged",JSON.stringify(this._favorites))}_loadFromState(t){this._favorites=t,this._favoritesChanged.fire()}_findFavIndex(t){return this._favorites.indexOf(t)}}},sW2s:function(t,e,a){t.exports={container:"container-27x8ya03",button:"button-27x8ya03"}},xpFj:function(t,e,a){"use strict";a.r(e);var i=a("Kxc7"),s=a("OAj1"),n=a("kg9h"),r=a("Bi3B"),o=a("miV2"),l=a("lNO7"),c=(a("bSeV"),a("q1tI")),h=a.n(c),d=a("17x9"),u=a("TSYQ"),v=a.n(u),f=a("Eyy1"),m=a("YFKU"),_=a("Db7+"),p=a("kg8i"),b=a("N5tr"),F=a("/KDZ"),g=a("dhVi"),C=a("82wv"),S=a("FIZB"),w=a("nmnj"),O=a("39J6"),x=a("GeUm"),y=a("c5ry"),E=a("1TxM"),W=a("Etjd"),j=a("35Sq");const I=Object(E.b)();class N extends h.a.PureComponent{constructor(t,e){super(t,e),this._menu=h.a.createRef(),this._favoritesStore=S.a.getInstance(),this._promise=null,this._handleStateChange=t=>{this.setState({isActive:t})},this._handleClick=()=>{const t=this.context.financialsDialogController;this.state.isActive?t.hide():t.show()},this._handleSelectIndicator=t=>{const{chartWidgetCollection:e}=this.context;window.runOrSignIn(()=>{t=Object(f.ensureDefined)(t),e.activeChartWidget.value().insertStudy({type:"pine",pineId:t.scriptIdPart,pineVersion:t.version})},{source:"Financials favorites"})},this._handleFavoriteFundamentalsChange=()=>{this.setState({favorites:new Set(this._favoritesStore.favorites())}),this._clearCache()},this._handleMouseEnter=()=>{this._prefetchFavorites()},this._handleWrapClick=()=>{this._prefetchFavorites()},this._clearCache=()=>{this._promise=null,this.setState({infos:[]})},
Object(E.d)(e,{chartWidgetCollection:d.any.isRequired,financialsDialogController:d.any.isRequired});const a=this.context.financialsDialogController;this.state={isLoading:!1,isActive:a.visible().value(),favorites:new Set(this._favoritesStore.favorites()),infos:[]}}componentDidMount(){this.context.financialsDialogController.visible().subscribe(this._handleStateChange),this._favoritesStore.favoritesChanged().subscribe(this,this._handleFavoriteFundamentalsChange)}componentWillUnmount(){this.context.financialsDialogController.visible().unsubscribe(this._handleStateChange),this._favoritesStore.favoritesChanged().unsubscribe(this,this._handleFavoriteFundamentalsChange),this._promise=null}render(){const{isActive:t,favorites:e,isLoading:a}=this.state,{className:i,displayMode:s,id:n}=this.props,r={context:"data"};return h.a.createElement(p.a,{id:n,onMouseEnter:this._handleMouseEnter,onClick:this._handleWrapClick},h.a.createElement(_.a,{displayMode:s,className:i,icon:j,isOpened:t,onClick:this._handleClick,text:Object(m.t)("Financials",r),title:Object(m.t)("Fundamental metrics for stocks",r),"data-role":"button","data-name":"open-financials-dialog"}),e.size>0&&h.a.createElement(F.a,{rule:"screen and (max-width: 428px)"},t=>h.a.createElement(C.b,{arrow:!0,closeOnClickOutside:!0,isDrawer:t,drawerPosition:"Bottom",title:Object(m.t)("Favorites",r),ref:this._menu,"data-name":"show-favorite-financials"},h.a.createElement("div",{className:v()(W.dropdown,t&&W.smallWidthWrapper)},h.a.createElement(x.a,{className:t&&W.smallWidthTitle},Object(m.t)("Favorite Financials")),a&&h.a.createElement(O.a,null),!a&&h.a.createElement(h.a.Fragment,null,this.state.infos.length>0?this.state.infos.map(e=>h.a.createElement(b.b,{className:v()(t&&W.smallWidthMenuItem),theme:t?g.a:void 0,key:e.scriptIdPart,onClick:this._handleSelectIndicator,onClickArg:e,label:h.a.createElement("span",{className:v()(!t&&W.label,t&&W.smallWidthLabel,"apply-overflow-tooltip")},k(e))})):null!==this._promise&&h.a.createElement(b.b,{isDisabled:!0,label:Object(m.t)("You have no Favorites Financials yet")}))))))}_prefetchFavorites(){if(null!==this._promise)return;this.setState({isLoading:!0});const t=this._promise=Promise.resolve(Object(w.requestFundamentalScripts)()).then(e=>{if(t!==this._promise)return;e=e.filter(t=>this.state.favorites.has(t.scriptIdPart)).sort((t,e)=>k(t).localeCompare(k(e))),this.setState({infos:e,isLoading:!1},()=>{this._menu.current&&this._menu.current.update()})})}}function k(t){let e=Object(m.t)(t.scriptName||"",{context:"study"});const a=t.extra.financialPeriod;return a&&(e+=" Â· "+Object(y.b)(a)),e}N.contextType=I;var D=a("sW2s");function M(t){return h.a.createElement("a",{id:t.id,className:u(t.className,D.container),href:"/gopro/?source=unauth_platform&feature=start_free_trial"},h.a.createElement("div",{className:D.button},Object(m.t)("Start free trial")))}var T=a("+GxX"),P=a("yihy"),R=a("DVv6"),A=a("2Jvq");function J(){return Object.assign(Object.assign({},Object(o.a)()),{Alert:i.enabled("alerts")?s.a:void 0,Replay:i.enabled("widget")?void 0:n.a,
Publish:i.enabled("footer_publish_idea_button")?r.a:void 0,PublishButtonManager:i.enabled("footer_publish_idea_button")?l.b:void 0,Financials:Object(T.isFeatureEnabled)("financials_button")?N:void 0,StartTrial:M,SymbolSearch:Object(P.canShowNewSymbolSearch)()?R.a:A.a})}a.d(e,"getToolSet",(function(){return J}))}}]);